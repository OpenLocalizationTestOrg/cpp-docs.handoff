{"nodes":[{"pos":[12,80],"content":"Transaction: How Transactions Affect Updates (ODBC) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Transaction: How Transactions Affect Updates (ODBC) | Microsoft Docs","pos":[0,68]}]},{"content":"Transaction: How Transactions Affect Updates (ODBC)","pos":[757,808]},{"content":"Updates to the <bpt id=\"p1\">[</bpt>data source<ept id=\"p1\">](../../data/odbc/data-source-odbc.md)</ept> are managed during transactions through the use of an edit buffer (the same method used outside of transactions).","pos":[809,988],"source":"Updates to the [data source](../../data/odbc/data-source-odbc.md) are managed during transactions through the use of an edit buffer (the same method used outside of transactions)."},{"content":"The field data members of a recordset collectively serve as an edit buffer that contains the current record, which the recordset backs up temporarily during an <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>.","pos":[989,1170],"source":" The field data members of a recordset collectively serve as an edit buffer that contains the current record, which the recordset backs up temporarily during an `AddNew` or **Edit**."},{"content":"During a <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> operation, the current record is not backed up within a transaction.","pos":[1171,1259],"source":" During a **Delete** operation, the current record is not backed up within a transaction."},{"content":"For more information about the edit buffer and how updates store the current record, see <bpt id=\"p1\">[</bpt>Recordset: How Recordsets Update Records (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)</ept>.","pos":[1260,1464],"source":" For more information about the edit buffer and how updates store the current record, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)."},{"pos":[1472,1813],"content":"[!NOTE]\n If you have implemented bulk row fetching, you cannot call `AddNew`, **Edit**, or **Delete**. You must instead write your own functions to perform updates to the data source. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","leadings":["","> "],"nodes":[{"content":" If you have implemented bulk row fetching, you cannot call `AddNew`, **Edit**, or **Delete**. You must instead write your own functions to perform updates to the data source. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","pos":[8,339],"nodes":[{"content":"If you have implemented bulk row fetching, you cannot call <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, or <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>.","pos":[1,94],"source":" If you have implemented bulk row fetching, you cannot call `AddNew`, **Edit**, or **Delete**."},{"content":"You must instead write your own functions to perform updates to the data source.","pos":[95,175]},{"content":"For more information about bulk row fetching, see <bpt id=\"p1\">[</bpt>Recordset: Fetching Records in Bulk (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)</ept>.","pos":[176,331],"source":" For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)."}]}]},{"content":"During transactions, <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, and <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept> operations can be committed or rolled back.","pos":[1820,1919],"source":"During transactions, `AddNew`, **Edit**, and **Delete** operations can be committed or rolled back."},{"content":"The effects of <bpt id=\"p1\">**</bpt>CommitTrans<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Rollback<ept id=\"p2\">**</ept> might cause the current record to not be restored to the edit buffer.","pos":[1920,2037],"source":" The effects of **CommitTrans** and **Rollback** might cause the current record to not be restored to the edit buffer."},{"content":"To make sure that the current record is properly restored, it is important to understand how the <bpt id=\"p1\">**</bpt>CommitTrans<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Rollback<ept id=\"p2\">**</ept> member functions of <ph id=\"ph1\">`CDatabase`</ph> work with the update functions of <ph id=\"ph2\">`CRecordset`</ph>.","pos":[2038,2247],"source":" To make sure that the current record is properly restored, it is important to understand how the **CommitTrans** and **Rollback** member functions of `CDatabase` work with the update functions of `CRecordset`."},{"pos":[2310,2341],"content":"How CommitTrans Affects Updates"},{"pos":[2345,2421],"content":"The following table explains the effects of <bpt id=\"p1\">**</bpt>CommitTrans<ept id=\"p1\">**</ept> on transactions.","source":"The following table explains the effects of **CommitTrans** on transactions."},{"content":"How CommitTrans Affects Updates","pos":[2431,2462]},{"content":"Operation","pos":[2469,2478]},{"content":"Status of data source","pos":[2479,2500]},{"pos":[2562,2602],"content":"and <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>, and then <bpt id=\"p2\">**</bpt>CommitTrans<ept id=\"p2\">**</ept>","source":" and **Update**, and then **CommitTrans**"},{"content":"New record are added to data source.","pos":[2603,2639]},{"pos":[2653,2699],"content":"(without <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>), and then <bpt id=\"p2\">**</bpt>CommitTrans<ept id=\"p2\">**</ept>","source":" (without **Update**), and then **CommitTrans**"},{"content":"New record is lost.","pos":[2700,2719]},{"content":"Record not added to data source.","pos":[2720,2752]},{"pos":[2757,2806],"content":"<bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>, and then <bpt id=\"p3\">**</bpt>CommitTrans<ept id=\"p3\">**</ept>","source":"**Edit** and **Update**, and then **CommitTrans**"},{"content":"Edits committed to data source.","pos":[2807,2838]},{"pos":[2843,2898],"content":"<bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> (without <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>), and then <bpt id=\"p3\">**</bpt>CommitTrans<ept id=\"p3\">**</ept>","source":"**Edit** (without **Update**), and then **CommitTrans**"},{"content":"Edits to the record are lost.","pos":[2899,2928]},{"content":"Record remains unchanged on the data source.","pos":[2929,2973]},{"pos":[2978,3009],"content":"<bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> then <bpt id=\"p2\">**</bpt>CommitTrans<ept id=\"p2\">**</ept>","source":"**Delete** then **CommitTrans**"},{"content":"Records deleted from data source.","pos":[3010,3043]},{"pos":[3104,3137],"content":"How Rollback Affects Transactions"},{"pos":[3141,3214],"content":"The following table explains the effects of <bpt id=\"p1\">**</bpt>Rollback<ept id=\"p1\">**</ept> on transactions.","source":"The following table explains the effects of **Rollback** on transactions."},{"content":"How Rollback Affects Transactions","pos":[3224,3257]},{"content":"Operation","pos":[3264,3273]},{"content":"Status of current record","pos":[3274,3298]},{"content":"You must also","pos":[3299,3312]},{"content":"Status of data source","pos":[3313,3334]},{"pos":[3447,3480],"content":"and <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>, then <bpt id=\"p2\">**</bpt>Rollback<ept id=\"p2\">**</ept>","source":" and **Update**, then **Rollback**"},{"content":"Content of the current record is stored temporarily to make room for new record.","pos":[3481,3561]},{"content":"New record is entered into edit buffer.","pos":[3562,3601]},{"content":"After <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> is called, the current record is restored to the edit buffer.","pos":[3602,3680],"source":" After **Update** is called, the current record is restored to the edit buffer."},{"pos":[3682,3737],"content":"Addition to data source made by <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> is reversed.","source":"Addition to data source made by **Update** is reversed."},{"pos":[3751,3790],"content":"(without <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>), then <bpt id=\"p2\">**</bpt>Rollback<ept id=\"p2\">**</ept>","source":" (without **Update**), then **Rollback**"},{"content":"Content of the current record is stored temporarily to make room for new record.","pos":[3791,3871]},{"content":"Edit buffer contains new record.","pos":[3872,3904]},{"content":"Call <ph id=\"ph1\">`AddNew`</ph> again to restore the edit buffer to an empty, new record.","pos":[3905,3976],"source":"Call `AddNew` again to restore the edit buffer to an empty, new record."},{"content":"Or call <bpt id=\"p1\">**</bpt>Move<ept id=\"p1\">**</ept>(0) to restore the old values to the edit buffer.","pos":[3977,4042],"source":" Or call **Move**(0) to restore the old values to the edit buffer."},{"pos":[4043,4124],"content":"Because <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> was not called, there were no changes made to the data source.","source":"Because **Update** was not called, there were no changes made to the data source."},{"pos":[4129,4171],"content":"<bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>, then <bpt id=\"p3\">**</bpt>Rollback<ept id=\"p3\">**</ept>","source":"**Edit** and **Update**, then **Rollback**"},{"content":"An unedited version of the current record is stored temporarily.","pos":[4172,4236]},{"content":"Edits are made to the content of the edit buffer.","pos":[4237,4286]},{"content":"After <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> is called, the unedited version of the record is still temporarily stored.","pos":[4287,4378],"source":" After **Update** is called, the unedited version of the record is still temporarily stored."},{"content":"<bpt id=\"p1\">*</bpt>Dynaset<ept id=\"p1\">*</ept>: Scroll off the current record then back to restore the unedited version of the record to the edit buffer.","pos":[4379,4495],"source":"*Dynaset*: Scroll off the current record then back to restore the unedited version of the record to the edit buffer."},{"content":"<bpt id=\"p1\">*</bpt>Snapshot<ept id=\"p1\">*</ept>: Call <bpt id=\"p2\">**</bpt>Requery<ept id=\"p2\">**</ept> to refresh the recordset from the data source.","pos":[4508,4583],"source":"*Snapshot*: Call **Requery** to refresh the recordset from the data source."},{"pos":[4584,4639],"content":"Changes to data source made by <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> are reversed.","source":"Changes to data source made by **Update** are reversed."},{"pos":[4644,4692],"content":"<bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> (without <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>), then <bpt id=\"p3\">**</bpt>Rollback<ept id=\"p3\">**</ept>","source":"**Edit** (without **Update**), then **Rollback**"},{"content":"An unedited version of the current record is stored temporarily.","pos":[4693,4757]},{"content":"Edits are made to the content of the edit buffer.","pos":[4758,4807]},{"pos":[4808,4893],"content":"Call <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> again to restore the unedited version of the record to the edit buffer.","source":"Call **Edit** again to restore the unedited version of the record to the edit buffer."},{"pos":[4894,4975],"content":"Because <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> was not called, there were no changes made to the data source.","source":"Because **Update** was not called, there were no changes made to the data source."},{"pos":[4980,5008],"content":"<bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> then <bpt id=\"p2\">**</bpt>Rollback<ept id=\"p2\">**</ept>","source":"**Delete** then **Rollback**"},{"content":"Content of the current record is deleted.","pos":[5009,5050]},{"pos":[5051,5134],"content":"Call <bpt id=\"p1\">**</bpt>Requery<ept id=\"p1\">**</ept> to restore the content of the current record from the data source.","source":"Call **Requery** to restore the content of the current record from the data source."},{"content":"Deletion of data from data source is reversed.","pos":[5135,5181]},{"content":"See Also","pos":[5191,5199]},{"content":"Transaction (ODBC)","pos":[5204,5222]},{"content":"Transaction (ODBC)","pos":[5266,5284]},{"content":"Transaction: Performing a Transaction in a Recordset (ODBC)","pos":[5328,5387]},{"content":"CDatabase Class","pos":[5471,5486]},{"content":"CRecordset Class","pos":[5533,5549]}],"content":"---\ntitle: \"Transaction: How Transactions Affect Updates (ODBC) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"transactions, updating recordsets\"\n  - \"ODBC recordsets, transactions\"\n  - \"transactions, rolling back\"\n  - \"CommitTrans method\"\n  - \"Rollback method, ODBC transactions\"\nms.assetid: 9e00bbf4-e9fb-4332-87fc-ec8ac61b3f68\ncaps.latest.revision: 9\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Transaction: How Transactions Affect Updates (ODBC)\nUpdates to the [data source](../../data/odbc/data-source-odbc.md) are managed during transactions through the use of an edit buffer (the same method used outside of transactions). The field data members of a recordset collectively serve as an edit buffer that contains the current record, which the recordset backs up temporarily during an `AddNew` or **Edit**. During a **Delete** operation, the current record is not backed up within a transaction. For more information about the edit buffer and how updates store the current record, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  \n  \n> [!NOTE]\n>  If you have implemented bulk row fetching, you cannot call `AddNew`, **Edit**, or **Delete**. You must instead write your own functions to perform updates to the data source. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  \n  \n During transactions, `AddNew`, **Edit**, and **Delete** operations can be committed or rolled back. The effects of **CommitTrans** and **Rollback** might cause the current record to not be restored to the edit buffer. To make sure that the current record is properly restored, it is important to understand how the **CommitTrans** and **Rollback** member functions of `CDatabase` work with the update functions of `CRecordset`.  \n  \n##  <a name=\"_core_how_committrans_affects_updates\"></a> How CommitTrans Affects Updates  \n The following table explains the effects of **CommitTrans** on transactions.  \n  \n### How CommitTrans Affects Updates  \n  \n|Operation|Status of data source|  \n|---------------|---------------------------|  \n|`AddNew` and **Update**, and then **CommitTrans**|New record are added to data source.|  \n|`AddNew` (without **Update**), and then **CommitTrans**|New record is lost. Record not added to data source.|  \n|**Edit** and **Update**, and then **CommitTrans**|Edits committed to data source.|  \n|**Edit** (without **Update**), and then **CommitTrans**|Edits to the record are lost. Record remains unchanged on the data source.|  \n|**Delete** then **CommitTrans**|Records deleted from data source.|  \n  \n##  <a name=\"_core_how_rollback_affects_updates\"></a> How Rollback Affects Transactions  \n The following table explains the effects of **Rollback** on transactions.  \n  \n### How Rollback Affects Transactions  \n  \n|Operation|Status of current record|You must also|Status of data source|  \n|---------------|------------------------------|-------------------|---------------------------|  \n|`AddNew` and **Update**, then **Rollback**|Content of the current record is stored temporarily to make room for new record. New record is entered into edit buffer. After **Update** is called, the current record is restored to the edit buffer.||Addition to data source made by **Update** is reversed.|  \n|`AddNew` (without **Update**), then **Rollback**|Content of the current record is stored temporarily to make room for new record. Edit buffer contains new record.|Call `AddNew` again to restore the edit buffer to an empty, new record. Or call **Move**(0) to restore the old values to the edit buffer.|Because **Update** was not called, there were no changes made to the data source.|  \n|**Edit** and **Update**, then **Rollback**|An unedited version of the current record is stored temporarily. Edits are made to the content of the edit buffer. After **Update** is called, the unedited version of the record is still temporarily stored.|*Dynaset*: Scroll off the current record then back to restore the unedited version of the record to the edit buffer.<br /><br /> *Snapshot*: Call **Requery** to refresh the recordset from the data source.|Changes to data source made by **Update** are reversed.|  \n|**Edit** (without **Update**), then **Rollback**|An unedited version of the current record is stored temporarily. Edits are made to the content of the edit buffer.|Call **Edit** again to restore the unedited version of the record to the edit buffer.|Because **Update** was not called, there were no changes made to the data source.|  \n|**Delete** then **Rollback**|Content of the current record is deleted.|Call **Requery** to restore the content of the current record from the data source.|Deletion of data from data source is reversed.|  \n  \n## See Also  \n [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)   \n [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)   \n [Transaction: Performing a Transaction in a Recordset (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)   \n [CDatabase Class](../../mfc/reference/cdatabase-class.md)   \n [CRecordset Class](../../mfc/reference/crecordset-class.md)"}