{"nodes":[{"pos":[12,57],"content":"CAtlTransactionManager Class | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"CAtlTransactionManager Class | Microsoft Docs","pos":[0,45]}]},{"content":"CAtlTransactionManager Class","pos":[696,724]},{"content":"CAtlTransactionManager class provides a wrapper to Kernel Transaction Manager (KTM) functions.","pos":[725,819]},{"pos":[827,937],"content":"[!IMPORTANT]\n This class and its members cannot be used in applications that execute in the Windows Runtime.","leadings":["","> "],"nodes":[{"content":"This class and its members cannot be used in applications that execute in the Windows Runtime.","pos":[14,108]}]},{"content":"Syntax","pos":[946,952]},{"content":"Members","pos":[1004,1011]},{"content":"Public Constructors","pos":[1021,1040]},{"content":"Name","pos":[1047,1051]},{"content":"Description","pos":[1052,1063]},{"content":"CAtlTransactionManager::~CAtlTransactionManager","pos":[1102,1149]},{"content":"CAtlTransactionManager destructor.","pos":[1205,1239]},{"content":"CAtlTransactionManager::CAtlTransactionManager","pos":[1245,1291]},{"content":"CAtlTransactionManager constructor.","pos":[1342,1377]},{"content":"Public Methods","pos":[1388,1402]},{"content":"Name","pos":[1409,1413]},{"content":"Description","pos":[1414,1425]},{"content":"CAtlTransactionManager::Close","pos":[1464,1493]},{"content":"Closes one the transaction handle.","pos":[1527,1561]},{"content":"CAtlTransactionManager::Commit","pos":[1567,1597]},{"content":"Requests that the transaction be committed.","pos":[1632,1675]},{"content":"CAtlTransactionManager::Create","pos":[1681,1711]},{"content":"Creates the transaction handle.","pos":[1746,1777]},{"content":"CAtlTransactionManager::CreateFile","pos":[1783,1817]},{"content":"Creates or opens a file, file stream, or directory as a transacted operation.","pos":[1856,1933]},{"content":"CAtlTransactionManager::DeleteFile","pos":[1939,1973]},{"content":"Deletes an existing file as a transacted operation.","pos":[2012,2063]},{"content":"CAtlTransactionManager::FindFirstFile","pos":[2069,2106]},{"content":"Searches a directory for a file or subdirectory as a transacted operation.","pos":[2148,2222]},{"content":"CAtlTransactionManager::GetFileAttributes","pos":[2228,2269]},{"content":"Retrieves file system attributes for a specified file or directory as a transacted operation.","pos":[2315,2408]},{"content":"CAtlTransactionManager::GetFileAttributesEx","pos":[2414,2457]},{"content":"Retrieves file system attributes for a specified file or directory as a transacted operation.","pos":[2505,2598]},{"content":"CAtlTransactionManager::GetHandle","pos":[2604,2637]},{"content":"Returns the transaction handle.","pos":[2675,2706]},{"content":"CAtlTransactionManager::IsFallback","pos":[2712,2746]},{"content":"Determines whether the fallback calls are enabled.","pos":[2785,2835]},{"content":"CAtlTransactionManager::MoveFile","pos":[2841,2873]},{"content":"Moves an existing file or a directory, including its children, as a transacted operation.","pos":[2910,2999]},{"content":"CAtlTransactionManager::RegCreateKeyEx","pos":[3005,3043]},{"content":"Creates the specified registry key and associates it with a transaction.","pos":[3086,3158]},{"content":"If the key already exists, the function opens it.","pos":[3159,3208]},{"content":"CAtlTransactionManager::RegDeleteKey","pos":[3214,3250]},{"content":"Deletes a subkey and its values from the specified platform-specific view of the registry as a transacted operation.","pos":[3291,3407]},{"content":"CAtlTransactionManager::RegOpenKeyEx","pos":[3413,3449]},{"content":"Opens the specified registry key and associates it with a transaction.","pos":[3490,3560]},{"content":"CAtlTransactionManager::Rollback","pos":[3566,3598]},{"content":"Requests that the transaction be rolled back.","pos":[3635,3680]},{"content":"CAtlTransactionManager::SetFileAttributes","pos":[3686,3727]},{"content":"Sets the attributes for a file or directory as a transacted operation.","pos":[3773,3843]},{"content":"Protected Data Members","pos":[3854,3876]},{"content":"Name","pos":[3883,3887]},{"content":"Description","pos":[3888,3899]},{"content":"CAtlTransactionManager::m_bFallback","pos":[3938,3973]},{"pos":[4020,4068],"content":"if the fallback is supported; <ph id=\"ph1\">`FALSE`</ph> otherwise.","source":" if the fallback is supported; `FALSE` otherwise."},{"content":"CAtlTransactionManager::m_hTransaction","pos":[4074,4112]},{"content":"The transaction handle.","pos":[4155,4178]},{"content":"Remarks","pos":[4188,4195]},{"content":"Inheritance Hierarchy","pos":[4204,4225]},{"content":"ATL::CAtlTransactionManager","pos":[4230,4257]},{"content":"Requirements","pos":[4320,4332]},{"pos":[4336,4371],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> atltransactionmanager.h","source":"**Header:** atltransactionmanager.h"},{"pos":[4449,4496],"content":"CAtlTransactionManager::~CAtlTransactionManager"},{"content":"CAtlTransactionManager destructor.","pos":[4500,4534]},{"content":"Remarks","pos":[4592,4599]},{"content":"In normal processing, the transaction is automatically committed and closed.","pos":[4603,4679]},{"content":"If the destructor is called during an exception unwind, the transaction is rolled back and closed.","pos":[4680,4778]},{"pos":[4851,4897],"content":"CAtlTransactionManager::CAtlTransactionManager"},{"content":"CAtlTransactionManager constructor.","pos":[4901,4936]},{"content":"Parameters","pos":[5043,5053]},{"content":"indicates support fallback.","pos":[5079,5106]},{"content":"If transacted function fails, the class automatically calls the \"non-transacted\" function.","pos":[5107,5197]},{"content":"indicates no \"fallback\" calls.","pos":[5206,5236]},{"content":"indicates that the transaction handler is created automatically in the constructor.","pos":[5278,5361]},{"content":"indicates that it is not.","pos":[5370,5395]},{"content":"Remarks","pos":[5405,5412]},{"pos":[5468,5497],"content":"CAtlTransactionManager::Close"},{"content":"Closes the transaction handle.","pos":[5501,5531]},{"content":"Return Value","pos":[5599,5611]},{"pos":[5622,5655],"content":"if successful; otherwise <ph id=\"ph1\">`FALSE`</ph>.","source":" if successful; otherwise `FALSE`."},{"content":"Remarks","pos":[5665,5672]},{"content":"This wrapper calls the <ph id=\"ph1\">`CloseHandle`</ph> function.","pos":[5676,5722],"source":"This wrapper calls the `CloseHandle` function."},{"content":"The method is automatically called in the destructor.","pos":[5723,5776]},{"pos":[5833,5863],"content":"CAtlTransactionManager::Commit"},{"content":"Requests that the transaction be committed.","pos":[5867,5910]},{"content":"Return Value","pos":[5979,5991]},{"pos":[6002,6035],"content":"if successful; otherwise <ph id=\"ph1\">`FALSE`</ph>.","source":" if successful; otherwise `FALSE`."},{"content":"Remarks","pos":[6045,6052]},{"content":"This wrapper calls the <ph id=\"ph1\">`CommitTransaction`</ph> function.","pos":[6056,6108],"source":"This wrapper calls the `CommitTransaction` function."},{"content":"The method is automatically called in the destructor.","pos":[6109,6162]},{"pos":[6219,6249],"content":"CAtlTransactionManager::Create"},{"content":"Creates the transaction handle.","pos":[6253,6284]},{"content":"Return Value","pos":[6353,6365]},{"pos":[6376,6409],"content":"if successful; otherwise <ph id=\"ph1\">`FALSE`</ph>.","source":" if successful; otherwise `FALSE`."},{"content":"Remarks","pos":[6419,6426]},{"content":"This wrapper calls the <ph id=\"ph1\">`CreateTransaction`</ph> function.","pos":[6430,6482],"source":"This wrapper calls the `CreateTransaction` function."},{"content":"Check it for","pos":[6483,6495]},{"pos":[6556,6590],"content":"CAtlTransactionManager::CreateFile"},{"content":"Creates or opens a file, file stream, or directory as a transacted operation.","pos":[6594,6671]},{"content":"Parameters","pos":[6953,6963]},{"content":"The name of an object to be created or opened.","pos":[6983,7029]},{"content":"The access to the object, which can be summarized as read, write, both, or neither (zero).","pos":[7057,7147]},{"content":"The most commonly used values are GENERIC_READ, GENERIC_WRITE, or both: GENERIC_READ &amp;#124; GENERIC_WRITE.","pos":[7148,7254],"source":" The most commonly used values are GENERIC_READ, GENERIC_WRITE, or both: GENERIC_READ &#124; GENERIC_WRITE."},{"content":"The sharing mode of an object, which can be read, write, both, delete, all of these, or none: 0, FILE_SHARE_DELETE, FILE_SHARE_READ, FILE_SHARE_WRITE.","pos":[7278,7428]},{"content":"A pointer to a SECURITY_ATTRIBUTES structure that contains an optional security descriptor and also determines whether or not the returned handle can be inherited by child processes.","pos":[7461,7643]},{"content":"The parameter can be <ph id=\"ph1\">`NULL`</ph>.","pos":[7644,7672],"source":" The parameter can be `NULL`."},{"content":"An action to take on files that exist and do not exist.","pos":[7706,7761]},{"content":"This parameter must be one of the following values, which cannot be combined: CREATE_ALWAYS, CREATE_NEW, OPEN_ALWAYS, OPEN_EXISTING, or TRUNCATE_EXISTING.","pos":[7762,7916]},{"content":"The file attributes and flags.","pos":[7949,7979]},{"content":"This parameter can include any combination of the available file attributes (FILE_ATTRIBUTE_*).","pos":[7980,8075]},{"content":"All other file attributes override FILE_ATTRIBUTE_NORMAL.","pos":[8076,8133]},{"content":"This parameter can also contain combinations of flags (FILE_FLAG_<ph id=\"ph1\">\\*</ph>) for control of buffering behavior, access modes, and other special-purpose flags.","pos":[8134,8284],"source":" This parameter can also contain combinations of flags (FILE_FLAG_\\*) for control of buffering behavior, access modes, and other special-purpose flags."},{"content":"These combine with any FILE_ATTRIBUTE_<ph id=\"ph1\">\\*</ph> values.","pos":[8285,8333],"source":" These combine with any FILE_ATTRIBUTE_\\* values."},{"content":"A valid handle to a template file with the GENERIC_READ access right.","pos":[8359,8428]},{"content":"The template file supplies file attributes and extended attributes for the file that is being created.","pos":[8429,8531]},{"content":"This parameter can be <ph id=\"ph1\">`NULL`</ph>.","pos":[8532,8561],"source":" This parameter can be `NULL`."},{"content":"Return Value","pos":[8571,8583]},{"content":"Returns a handle that can be used to access the object.","pos":[8587,8642]},{"content":"Remarks","pos":[8652,8659]},{"pos":[8663,8718],"content":"This wrapper calls the <ph id=\"ph1\">`CreateFileTransacted`</ph> function.","source":"This wrapper calls the `CreateFileTransacted` function."},{"pos":[8779,8813],"content":"CAtlTransactionManager::DeleteFile"},{"content":"Deletes an existing file as a transacted operation.","pos":[8817,8868]},{"content":"Parameters","pos":[8959,8969]},{"content":"The name of the file to be deleted.","pos":[8989,9024]},{"content":"Remarks","pos":[9034,9041]},{"pos":[9045,9100],"content":"This wrapper calls the <ph id=\"ph1\">`DeleteFileTransacted`</ph> function.","source":"This wrapper calls the `DeleteFileTransacted` function."},{"pos":[9164,9201],"content":"CAtlTransactionManager::FindFirstFile"},{"content":"Searches a directory for a file or subdirectory as a transacted operation.","pos":[9205,9279]},{"content":"Parameters","pos":[9407,9417]},{"content":"The directory or path, and the file name to search for.","pos":[9437,9492]},{"content":"This parameter can include wildcard characters, such as an asterisk (*) or a question mark ().","pos":[9493,9587]},{"content":"A pointer to the WIN32_FIND_DATA structure that receives information about a found file or subdirectory.","pos":[9609,9713]},{"content":"Return Value","pos":[9723,9735]},{"content":"If the function succeeds, the return value is a search handle used in a subsequent call to <ph id=\"ph1\">`FindNextFile`</ph> or <ph id=\"ph2\">`FindClose`</ph>.","pos":[9739,9860],"source":"If the function succeeds, the return value is a search handle used in a subsequent call to `FindNextFile` or `FindClose`."},{"content":"If the function fails or fails to locate files from the search string in the <ph id=\"ph1\">`lpFileName`</ph> parameter, the return value is INVALID_HANDLE_VALUE.","pos":[9861,10003],"source":" If the function fails or fails to locate files from the search string in the `lpFileName` parameter, the return value is INVALID_HANDLE_VALUE."},{"content":"Remarks","pos":[10013,10020]},{"pos":[10024,10082],"content":"This wrapper calls the <ph id=\"ph1\">`FindFirstFileTransacted`</ph> function.","source":"This wrapper calls the `FindFirstFileTransacted` function."},{"pos":[10150,10191],"content":"CAtlTransactionManager::GetFileAttributes"},{"content":"Retrieves file system attributes for a specified file or directory as a transacted operation.","pos":[10195,10288]},{"content":"Parameters","pos":[10387,10397]},{"content":"The name of the file or directory.","pos":[10417,10451]},{"content":"Remarks","pos":[10461,10468]},{"pos":[10472,10534],"content":"This wrapper calls the <ph id=\"ph1\">`GetFileAttributesTransacted`</ph> function.","source":"This wrapper calls the `GetFileAttributesTransacted` function."},{"pos":[10604,10647],"content":"CAtlTransactionManager::GetFileAttributesEx"},{"content":"Retrieves file system attributes for a specified file or directory as a transacted operation.","pos":[10651,10744]},{"content":"Parameters","pos":[10915,10925]},{"content":"The name of the file or directory.","pos":[10945,10979]},{"content":"The level of attribute information to retrieve.","pos":[11004,11051]},{"content":"A pointer to a buffer that receives the attribute information.","pos":[11081,11143]},{"content":"The type of attribute information that is stored into this buffer is determined by the value of <ph id=\"ph1\">`fInfoLevelId`</ph>.","pos":[11144,11255],"source":" The type of attribute information that is stored into this buffer is determined by the value of `fInfoLevelId`."},{"content":"If the <ph id=\"ph1\">`fInfoLevelId`</ph> parameter is GetFileExInfoStandard then this parameter points to a WIN32_FILE_ATTRIBUTE_DATA structure.","pos":[11256,11381],"source":" If the `fInfoLevelId` parameter is GetFileExInfoStandard then this parameter points to a WIN32_FILE_ATTRIBUTE_DATA structure."},{"content":"Remarks","pos":[11391,11398]},{"pos":[11402,11464],"content":"This wrapper calls the <ph id=\"ph1\">`GetFileAttributesTransacted`</ph> function.","source":"This wrapper calls the `GetFileAttributesTransacted` function."},{"pos":[11524,11557],"content":"CAtlTransactionManager::GetHandle"},{"content":"Returns the transaction handle.","pos":[11561,11592]},{"content":"Return Value","pos":[11641,11653]},{"content":"Returns the transaction handle for a class.","pos":[11657,11700]},{"content":"Returns <ph id=\"ph1\">`NULL`</ph> if the <ph id=\"ph2\">`CAtlTransactionManager`</ph> is not attached to a handle.","pos":[11701,11776],"source":" Returns `NULL` if the `CAtlTransactionManager` is not attached to a handle."},{"content":"Remarks","pos":[11786,11793]},{"pos":[11854,11888],"content":"CAtlTransactionManager::IsFallback"},{"content":"Determines whether the fallback calls are enabled.","pos":[11892,11942]},{"content":"Return Value","pos":[11990,12002]},{"content":"Returns <ph id=\"ph1\">`TRUE`</ph> is the class supports fallback calls.","pos":[12006,12058],"source":"Returns `TRUE` is the class supports fallback calls."},{"content":"otherwise.","pos":[12067,12077]},{"content":"Remarks","pos":[12087,12094]},{"pos":[12156,12191],"content":"CAtlTransactionManager::m_bFallback"},{"pos":[12202,12250],"content":"if the fallback is supported; <ph id=\"ph1\">`FALSE`</ph> otherwise.","source":" if the fallback is supported; `FALSE` otherwise."},{"content":"Remarks","pos":[12291,12298]},{"pos":[12363,12401],"content":"CAtlTransactionManager::m_hTransaction"},{"content":"The transaction handle.","pos":[12405,12428]},{"content":"Remarks","pos":[12474,12481]},{"pos":[12540,12572],"content":"CAtlTransactionManager::MoveFile"},{"content":"Moves an existing file or a directory, including its children, as a transacted operation.","pos":[12576,12665]},{"content":"Parameters","pos":[12781,12791]},{"content":"The current name of the existing file or directory on the local computer.","pos":[12814,12887]},{"content":"The new name for the file or directory.","pos":[12913,12952]},{"content":"This name must not already exist.","pos":[12953,12986]},{"content":"A new file may be on a different file system or drive.","pos":[12987,13041]},{"content":"A new directory must be on the same drive.","pos":[13042,13084]},{"content":"Remarks","pos":[13094,13101]},{"pos":[13105,13158],"content":"This wrapper calls the <ph id=\"ph1\">`MoveFileTransacted`</ph> function.","source":"This wrapper calls the `MoveFileTransacted` function."},{"pos":[13223,13261],"content":"CAtlTransactionManager::RegCreateKeyEx"},{"content":"Creates the specified registry key and associates it with a transaction.","pos":[13265,13337]},{"content":"If the key already exists, the function opens it.","pos":[13338,13387]},{"content":"Parameters","pos":[13688,13698]},{"content":"A handle to an open registry key.","pos":[13712,13745]},{"content":"The name of a subkey that this function opens or creates.","pos":[13766,13823]},{"content":"This parameter is reserved and must be zero.","pos":[13846,13890]},{"content":"The user-defined class of this key.","pos":[13910,13945]},{"content":"This parameter may be ignored.","pos":[13946,13976]},{"content":"This parameter can be NULL.","pos":[13977,14004]},{"content":"This parameter can be one of the following values: REG_OPTION_BACKUP_RESTORE, REG_OPTION_NON_VOLATILE, or REG_OPTION_VOLATILE.","pos":[14026,14152]},{"content":"A mask that specifies the access rights for the key.","pos":[14175,14227]},{"content":"Pointer to a SECURITY_ATTRIBUTES structure that determines whether the returned handle can be inherited by child processes.","pos":[14260,14383]},{"content":"If <ph id=\"ph1\">`lpSecurityAttributes`</ph> is <ph id=\"ph2\">`NULL`</ph>, the handle cannot be inherited.","pos":[14384,14452],"source":" If `lpSecurityAttributes` is `NULL`, the handle cannot be inherited."},{"content":"A pointer to a variable that receives a handle to the opened or created key.","pos":[14474,14550]},{"content":"If the key is not one of the predefined registry keys, call the <ph id=\"ph1\">`RegCloseKey`</ph> function after you have finished using the handle.","pos":[14551,14679],"source":" If the key is not one of the predefined registry keys, call the `RegCloseKey` function after you have finished using the handle."},{"content":"A pointer to a variable that receives one of the following disposition values: REG_CREATED_NEW_KEY or REG_OPENED_EXISTING_KEY.","pos":[14707,14833]},{"content":"Return Value","pos":[14843,14855]},{"content":"If the function succeeds, the return value is ERROR_SUCCESS.","pos":[14859,14919]},{"content":"If the function fails, the return value is a nonzero error code defined in Winerror.h.","pos":[14920,15006]},{"content":"Remarks","pos":[15016,15023]},{"pos":[15027,15084],"content":"This wrapper calls the <ph id=\"ph1\">`RegCreateKeyTransacted`</ph> function.","source":"This wrapper calls the `RegCreateKeyTransacted` function."},{"pos":[15147,15183],"content":"CAtlTransactionManager::RegDeleteKey"},{"content":"Deletes a subkey and its values from the specified platform-specific view of the registry as a transacted operation.","pos":[15187,15303]},{"content":"Parameters","pos":[15411,15421]},{"content":"Parameter","pos":[15428,15437]},{"content":"Description","pos":[15438,15449]},{"content":"A handle to an open registry key.","pos":[15499,15532]},{"content":"The name of the key to be deleted.","pos":[15548,15582]},{"content":"Return Value","pos":[15593,15605]},{"content":"If the function succeeds, the return value is ERROR_SUCCESS.","pos":[15609,15669]},{"content":"If the function fails, the return value is a nonzero error code defined in Winerror.h.","pos":[15670,15756]},{"content":"Remarks","pos":[15766,15773]},{"pos":[15777,15834],"content":"This wrapper calls the <ph id=\"ph1\">`RegDeleteKeyTransacted`</ph> function.","source":"This wrapper calls the `RegDeleteKeyTransacted` function."},{"pos":[15897,15933],"content":"CAtlTransactionManager::RegOpenKeyEx"},{"content":"Opens the specified registry key and associates it with a transaction.","pos":[15937,16007]},{"content":"Parameters","pos":[16181,16191]},{"content":"A handle to an open registry key.","pos":[16205,16238]},{"content":"The name of the registry subkey to be opened.","pos":[16259,16304]},{"content":"This parameter is reserved and must be zero.","pos":[16326,16370]},{"content":"A mask that specifies the access rights for the key.","pos":[16393,16445]},{"content":"A pointer to a variable that receives a handle to the opened or created key.","pos":[16467,16543]},{"content":"If the key is not one of the predefined registry keys, call the <ph id=\"ph1\">`RegCloseKey`</ph> function after you have finished using the handle.","pos":[16544,16672],"source":" If the key is not one of the predefined registry keys, call the `RegCloseKey` function after you have finished using the handle."},{"content":"Return Value","pos":[16682,16694]},{"content":"If the function succeeds, the return value is ERROR_SUCCESS.","pos":[16698,16758]},{"content":"If the function fails, the return value is a nonzero error code defined in Winerror.h","pos":[16759,16844]},{"content":"Remarks","pos":[16854,16861]},{"pos":[16865,16920],"content":"This wrapper calls the <ph id=\"ph1\">`RegOpenKeyTransacted`</ph> function.","source":"This wrapper calls the `RegOpenKeyTransacted` function."},{"pos":[16979,17011],"content":"CAtlTransactionManager::Rollback"},{"content":"Requests that the transaction be rolled back.","pos":[17015,17060]},{"content":"Return Value","pos":[17131,17143]},{"pos":[17154,17187],"content":"if successful; otherwise <ph id=\"ph1\">`FALSE`</ph>.","source":" if successful; otherwise `FALSE`."},{"content":"Remarks","pos":[17197,17204]},{"pos":[17208,17262],"content":"This wrapper calls the <ph id=\"ph1\">`RollbackTransaction`</ph> function.","source":"This wrapper calls the `RollbackTransaction` function."},{"pos":[17330,17371],"content":"CAtlTransactionManager::SetFileAttributes"},{"content":"Sets the attributes for a file or directory as a transacted operation.","pos":[17375,17445]},{"content":"Parameters","pos":[17564,17574]},{"content":"The name of the file or directory.","pos":[17594,17628]},{"content":"The file attributes to set for the file.","pos":[17653,17693]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>SetFileAttributesTransacted<ept id=\"p1\">](http://go.microsoft.com/fwlink/linkid=158699)</ept>.","pos":[17694,17796],"source":" For more information, see [SetFileAttributesTransacted](http://go.microsoft.com/fwlink/linkid=158699)."},{"content":"Remarks","pos":[17806,17813]},{"pos":[17817,17879],"content":"This wrapper calls the <ph id=\"ph1\">`SetFileAttributesTransacted`</ph> function.","source":"This wrapper calls the `SetFileAttributesTransacted` function."},{"content":"See Also","pos":[17888,17896]},{"content":"ATL COM Desktop Components","pos":[17901,17927]}],"content":"---\ntitle: \"CAtlTransactionManager Class | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\nf1_keywords: \n  - \"CAtlTransactionManager\"\n  - \"atltransactionmanager/ATL::CAtlTransactionManager\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CAtlTransactionManager class\"\nms.assetid: b01732dc-1d16-4b42-bfac-b137fca2b740\ncaps.latest.revision: 25\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# CAtlTransactionManager Class\nCAtlTransactionManager class provides a wrapper to Kernel Transaction Manager (KTM) functions.  \n  \n> [!IMPORTANT]\n>  This class and its members cannot be used in applications that execute in the Windows Runtime.  \n  \n## Syntax  \n  \n```\nclass CAtlTransactionManager;\n```  \n  \n## Members  \n  \n### Public Constructors  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CAtlTransactionManager::~CAtlTransactionManager](#catltransactionmanager___dtorcatltransactionmanager)|CAtlTransactionManager destructor.|  \n|[CAtlTransactionManager::CAtlTransactionManager](#catltransactionmanager__catltransactionmanager)|CAtlTransactionManager constructor.|  \n  \n### Public Methods  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CAtlTransactionManager::Close](#catltransactionmanager__close)|Closes one the transaction handle.|  \n|[CAtlTransactionManager::Commit](#catltransactionmanager__commit)|Requests that the transaction be committed.|  \n|[CAtlTransactionManager::Create](#catltransactionmanager__create)|Creates the transaction handle.|  \n|[CAtlTransactionManager::CreateFile](#catltransactionmanager__createfile)|Creates or opens a file, file stream, or directory as a transacted operation.|  \n|[CAtlTransactionManager::DeleteFile](#catltransactionmanager__deletefile)|Deletes an existing file as a transacted operation.|  \n|[CAtlTransactionManager::FindFirstFile](#catltransactionmanager__findfirstfile)|Searches a directory for a file or subdirectory as a transacted operation.|  \n|[CAtlTransactionManager::GetFileAttributes](#catltransactionmanager__getfileattributes)|Retrieves file system attributes for a specified file or directory as a transacted operation.|  \n|[CAtlTransactionManager::GetFileAttributesEx](#catltransactionmanager__getfileattributesex)|Retrieves file system attributes for a specified file or directory as a transacted operation.|  \n|[CAtlTransactionManager::GetHandle](#catltransactionmanager__gethandle)|Returns the transaction handle.|  \n|[CAtlTransactionManager::IsFallback](#catltransactionmanager__isfallback)|Determines whether the fallback calls are enabled.|  \n|[CAtlTransactionManager::MoveFile](#catltransactionmanager__movefile)|Moves an existing file or a directory, including its children, as a transacted operation.|  \n|[CAtlTransactionManager::RegCreateKeyEx](#catltransactionmanager__regcreatekeyex)|Creates the specified registry key and associates it with a transaction. If the key already exists, the function opens it.|  \n|[CAtlTransactionManager::RegDeleteKey](#catltransactionmanager__regdeletekey)|Deletes a subkey and its values from the specified platform-specific view of the registry as a transacted operation.|  \n|[CAtlTransactionManager::RegOpenKeyEx](#catltransactionmanager__regopenkeyex)|Opens the specified registry key and associates it with a transaction.|  \n|[CAtlTransactionManager::Rollback](#catltransactionmanager__rollback)|Requests that the transaction be rolled back.|  \n|[CAtlTransactionManager::SetFileAttributes](#catltransactionmanager__setfileattributes)|Sets the attributes for a file or directory as a transacted operation.|  \n  \n### Protected Data Members  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CAtlTransactionManager::m_bFallback](#catltransactionmanager__m_bfallback)|`TRUE` if the fallback is supported; `FALSE` otherwise.|  \n|[CAtlTransactionManager::m_hTransaction](#catltransactionmanager__m_htransaction)|The transaction handle.|  \n  \n## Remarks  \n  \n## Inheritance Hierarchy  \n [ATL::CAtlTransactionManager](../../atl/reference/catltransactionmanager-class.md)  \n  \n## Requirements  \n **Header:** atltransactionmanager.h  \n  \n##  <a name=\"catltransactionmanager___dtorcatltransactionmanager\"></a>  CAtlTransactionManager::~CAtlTransactionManager  \n CAtlTransactionManager destructor.  \n  \n```\nvirtual ~CAtlTransactionManager();\n```  \n  \n### Remarks  \n In normal processing, the transaction is automatically committed and closed. If the destructor is called during an exception unwind, the transaction is rolled back and closed.  \n  \n##  <a name=\"catltransactionmanager__catltransactionmanager\"></a>  CAtlTransactionManager::CAtlTransactionManager  \n CAtlTransactionManager constructor.  \n  \n```\nCAtlTransactionManager(BOOL bFallback = TRUE,  BOOL bAutoCreateTransaction = TRUE);\n```  \n  \n### Parameters  \n `bFallback`  \n `TRUE` indicates support fallback. If transacted function fails, the class automatically calls the \"non-transacted\" function. `FALSE` indicates no \"fallback\" calls.  \n  \n `bAutoCreateTransaction`  \n `TRUE` indicates that the transaction handler is created automatically in the constructor. `FALSE` indicates that it is not.  \n  \n### Remarks  \n  \n##  <a name=\"catltransactionmanager__close\"></a>  CAtlTransactionManager::Close  \n Closes the transaction handle.  \n  \n```\ninline BOOL CAtlTransactionManager::Close();\n```  \n  \n### Return Value  \n `TRUE` if successful; otherwise `FALSE`.  \n  \n### Remarks  \n This wrapper calls the `CloseHandle` function. The method is automatically called in the destructor.  \n  \n##  <a name=\"catltransactionmanager__commit\"></a>  CAtlTransactionManager::Commit  \n Requests that the transaction be committed.  \n  \n```\ninline BOOL CAtlTransactionManager::Commit();\n```  \n  \n### Return Value  \n `TRUE` if successful; otherwise `FALSE`.  \n  \n### Remarks  \n This wrapper calls the `CommitTransaction` function. The method is automatically called in the destructor.  \n  \n##  <a name=\"catltransactionmanager__create\"></a>  CAtlTransactionManager::Create  \n Creates the transaction handle.  \n  \n```\ninline BOOL CAtlTransactionManager::Create();\n```  \n  \n### Return Value  \n `TRUE` if successful; otherwise `FALSE`.  \n  \n### Remarks  \n This wrapper calls the `CreateTransaction` function. Check it for  \n  \n##  <a name=\"catltransactionmanager__createfile\"></a>  CAtlTransactionManager::CreateFile  \n Creates or opens a file, file stream, or directory as a transacted operation.  \n  \n```\ninline HANDLE CAtlTransactionManager::CreateFile(LPCTSTR lpFileName,\n    DWORD dwDesiredAccess,\n    DWORD dwShareMode,\n    LPSECURITY_ATTRIBUTES lpSecurityAttributes,\n    DWORD dwCreationDisposition,\n    DWORD dwFlagsAndAttributes,\n    HANDLE hTemplateFile);\n```  \n  \n### Parameters  \n `lpFileName`  \n The name of an object to be created or opened.  \n  \n `dwDesiredAccess`  \n The access to the object, which can be summarized as read, write, both, or neither (zero). The most commonly used values are GENERIC_READ, GENERIC_WRITE, or both: GENERIC_READ &#124; GENERIC_WRITE.  \n  \n `dwShareMode`  \n The sharing mode of an object, which can be read, write, both, delete, all of these, or none: 0, FILE_SHARE_DELETE, FILE_SHARE_READ, FILE_SHARE_WRITE.  \n  \n `lpSecurityAttributes`  \n A pointer to a SECURITY_ATTRIBUTES structure that contains an optional security descriptor and also determines whether or not the returned handle can be inherited by child processes. The parameter can be `NULL`.  \n  \n `dwCreationDisposition`  \n An action to take on files that exist and do not exist. This parameter must be one of the following values, which cannot be combined: CREATE_ALWAYS, CREATE_NEW, OPEN_ALWAYS, OPEN_EXISTING, or TRUNCATE_EXISTING.  \n  \n `dwFlagsAndAttributes`  \n The file attributes and flags. This parameter can include any combination of the available file attributes (FILE_ATTRIBUTE_*). All other file attributes override FILE_ATTRIBUTE_NORMAL. This parameter can also contain combinations of flags (FILE_FLAG_\\*) for control of buffering behavior, access modes, and other special-purpose flags. These combine with any FILE_ATTRIBUTE_\\* values.  \n  \n `hTemplateFile`  \n A valid handle to a template file with the GENERIC_READ access right. The template file supplies file attributes and extended attributes for the file that is being created. This parameter can be `NULL`.  \n  \n### Return Value  \n Returns a handle that can be used to access the object.  \n  \n### Remarks  \n This wrapper calls the `CreateFileTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__deletefile\"></a>  CAtlTransactionManager::DeleteFile  \n Deletes an existing file as a transacted operation.  \n  \n```\ninline BOOL CAtlTransactionManager::DeleteFile(LPCTSTR lpFileName);\n```  \n  \n### Parameters  \n `lpFileName`  \n The name of the file to be deleted.  \n  \n### Remarks  \n This wrapper calls the `DeleteFileTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__findfirstfile\"></a>  CAtlTransactionManager::FindFirstFile  \n Searches a directory for a file or subdirectory as a transacted operation.  \n  \n```\ninline HANDLE CAtlTransactionManager::FindFirstFile(LPCTSTR lpFileName,\n    WIN32_FIND_DATA* pNextInfo);\n```  \n  \n### Parameters  \n `lpFileName`  \n The directory or path, and the file name to search for. This parameter can include wildcard characters, such as an asterisk (*) or a question mark ().  \n  \n `pNextInfo`  \n A pointer to the WIN32_FIND_DATA structure that receives information about a found file or subdirectory.  \n  \n### Return Value  \n If the function succeeds, the return value is a search handle used in a subsequent call to `FindNextFile` or `FindClose`. If the function fails or fails to locate files from the search string in the `lpFileName` parameter, the return value is INVALID_HANDLE_VALUE.  \n  \n### Remarks  \n This wrapper calls the `FindFirstFileTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__getfileattributes\"></a>  CAtlTransactionManager::GetFileAttributes  \n Retrieves file system attributes for a specified file or directory as a transacted operation.  \n  \n```\ninline DWORD CAtlTransactionManager::GetFileAttributes(LPCTSTR lpFileName);\n```  \n  \n### Parameters  \n `lpFileName`  \n The name of the file or directory.  \n  \n### Remarks  \n This wrapper calls the `GetFileAttributesTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__getfileattributesex\"></a>  CAtlTransactionManager::GetFileAttributesEx  \n Retrieves file system attributes for a specified file or directory as a transacted operation.  \n  \n```\ninline BOOL CAtlTransactionManager::GetFileAttributesEx(LPCTSTR lpFileName,\n    GET_FILEEX_INFO_LEVELS fInfoLevelId,\n    LPVOID lpFileInformation);\n```  \n  \n### Parameters  \n `lpFileName`  \n The name of the file or directory.  \n  \n `fInfoLevelId`  \n The level of attribute information to retrieve.  \n  \n `lpFileInformation`  \n A pointer to a buffer that receives the attribute information. The type of attribute information that is stored into this buffer is determined by the value of `fInfoLevelId`. If the `fInfoLevelId` parameter is GetFileExInfoStandard then this parameter points to a WIN32_FILE_ATTRIBUTE_DATA structure.  \n  \n### Remarks  \n This wrapper calls the `GetFileAttributesTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__gethandle\"></a>  CAtlTransactionManager::GetHandle  \n Returns the transaction handle.  \n  \n```\nHANDLE GetHandle() const;\n```  \n  \n### Return Value  \n Returns the transaction handle for a class. Returns `NULL` if the `CAtlTransactionManager` is not attached to a handle.  \n  \n### Remarks  \n  \n##  <a name=\"catltransactionmanager__isfallback\"></a>  CAtlTransactionManager::IsFallback  \n Determines whether the fallback calls are enabled.  \n  \n```\nBOOL IsFallback() const;\n```  \n  \n### Return Value  \n Returns `TRUE` is the class supports fallback calls. `FALSE` otherwise.  \n  \n### Remarks  \n  \n##  <a name=\"catltransactionmanager__m_bfallback\"></a>  CAtlTransactionManager::m_bFallback  \n `TRUE` if the fallback is supported; `FALSE` otherwise.  \n  \n```\nBOOL m_bFallback;\n```  \n  \n### Remarks  \n  \n##  <a name=\"catltransactionmanager__m_htransaction\"></a>  CAtlTransactionManager::m_hTransaction  \n The transaction handle.  \n  \n```\nHANDLE m_hTransaction;\n```  \n  \n### Remarks  \n  \n##  <a name=\"catltransactionmanager__movefile\"></a>  CAtlTransactionManager::MoveFile  \n Moves an existing file or a directory, including its children, as a transacted operation.  \n  \n```\ninline BOOL CAtlTransactionManager::MoveFile(LPCTSTR lpOldFileName,  LPCTSTR lpNewFileName);\n```  \n  \n### Parameters  \n `lpOldFileName`  \n The current name of the existing file or directory on the local computer.  \n  \n `lpNewFileName`  \n The new name for the file or directory. This name must not already exist. A new file may be on a different file system or drive. A new directory must be on the same drive.  \n  \n### Remarks  \n This wrapper calls the `MoveFileTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__regcreatekeyex\"></a>  CAtlTransactionManager::RegCreateKeyEx  \n Creates the specified registry key and associates it with a transaction. If the key already exists, the function opens it.  \n  \n```\ninline LSTATUS CAtlTransactionManager::RegCreateKeyEx(HKEY hKey,\n    LPCTSTR lpSubKey,\n    DWORD dwReserved,\n    LPTSTR lpClass,\n    DWORD dwOptions,\n    REGSAM samDesired,\n    CONST LPSECURITY_ATTRIBUTES lpSecurityAttributes,\n    PHKEY phkResult,\n    LPDWORD lpdwDisposition);\n```  \n  \n### Parameters  \n `hKey`  \n A handle to an open registry key.  \n  \n `lpSubKey`  \n The name of a subkey that this function opens or creates.  \n  \n `dwReserved`  \n This parameter is reserved and must be zero.  \n  \n `lpClass`  \n The user-defined class of this key. This parameter may be ignored. This parameter can be NULL.  \n  \n `dwOptions`  \n This parameter can be one of the following values: REG_OPTION_BACKUP_RESTORE, REG_OPTION_NON_VOLATILE, or REG_OPTION_VOLATILE.  \n  \n `samDesired`  \n A mask that specifies the access rights for the key.  \n  \n `lpSecurityAttributes`  \n Pointer to a SECURITY_ATTRIBUTES structure that determines whether the returned handle can be inherited by child processes. If `lpSecurityAttributes` is `NULL`, the handle cannot be inherited.  \n  \n `phkResult`  \n A pointer to a variable that receives a handle to the opened or created key. If the key is not one of the predefined registry keys, call the `RegCloseKey` function after you have finished using the handle.  \n  \n `lpdwDisposition`  \n A pointer to a variable that receives one of the following disposition values: REG_CREATED_NEW_KEY or REG_OPENED_EXISTING_KEY.  \n  \n### Return Value  \n If the function succeeds, the return value is ERROR_SUCCESS. If the function fails, the return value is a nonzero error code defined in Winerror.h.  \n  \n### Remarks  \n This wrapper calls the `RegCreateKeyTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__regdeletekey\"></a>  CAtlTransactionManager::RegDeleteKey  \n Deletes a subkey and its values from the specified platform-specific view of the registry as a transacted operation.  \n  \n```\ninline LSTATUS CAtlTransactionManager::RegDeleteKeyEx(HKEY hKey,  LPCTSTR lpSubKey);\n```  \n  \n### Parameters  \n  \n|Parameter|Description|  \n|---------------|-----------------|  \n|`hKey`|A handle to an open registry key.|  \n|`lpSubKey`|The name of the key to be deleted.|  \n  \n### Return Value  \n If the function succeeds, the return value is ERROR_SUCCESS. If the function fails, the return value is a nonzero error code defined in Winerror.h.  \n  \n### Remarks  \n This wrapper calls the `RegDeleteKeyTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__regopenkeyex\"></a>  CAtlTransactionManager::RegOpenKeyEx  \n Opens the specified registry key and associates it with a transaction.  \n  \n```\ninline LSTATUS CAtlTransactionManager::RegOpenKeyEx(HKEY hKey,\n    LPCTSTR lpSubKey,\n    DWORD ulOptions,\n    REGSAM samDesired,\n    PHKEY phkResult);\n```  \n  \n### Parameters  \n `hKey`  \n A handle to an open registry key.  \n  \n `lpSubKey`  \n The name of the registry subkey to be opened.  \n  \n `ulOptions`  \n This parameter is reserved and must be zero.  \n  \n `samDesired`  \n A mask that specifies the access rights for the key.  \n  \n `phkResult`  \n A pointer to a variable that receives a handle to the opened or created key. If the key is not one of the predefined registry keys, call the `RegCloseKey` function after you have finished using the handle.  \n  \n### Return Value  \n If the function succeeds, the return value is ERROR_SUCCESS. If the function fails, the return value is a nonzero error code defined in Winerror.h  \n  \n### Remarks  \n This wrapper calls the `RegOpenKeyTransacted` function.  \n  \n##  <a name=\"catltransactionmanager__rollback\"></a>  CAtlTransactionManager::Rollback  \n Requests that the transaction be rolled back.  \n  \n```\ninline BOOL CAtlTransactionManager::Rollback();\n```  \n  \n### Return Value  \n `TRUE` if successful; otherwise `FALSE`.  \n  \n### Remarks  \n This wrapper calls the `RollbackTransaction` function.  \n  \n##  <a name=\"catltransactionmanager__setfileattributes\"></a>  CAtlTransactionManager::SetFileAttributes  \n Sets the attributes for a file or directory as a transacted operation.  \n  \n```\ninline BOOL CAtlTransactionManager::SetFileAttributes(LPCTSTR lpFileName,  DWORD dwAttributes);\n```  \n  \n### Parameters  \n `lpFileName`  \n The name of the file or directory.  \n  \n `dwAttributes`  \n The file attributes to set for the file. For more information, see [SetFileAttributesTransacted](http://go.microsoft.com/fwlink/linkid=158699).  \n  \n### Remarks  \n This wrapper calls the `SetFileAttributesTransacted` function.  \n  \n## See Also  \n [ATL COM Desktop Components](../../atl/atl-com-desktop-components.md)\n\n\n\n\n\n\n\n\n\n"}