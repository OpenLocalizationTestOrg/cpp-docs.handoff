{"nodes":[{"pos":[12,74],"content":"Walkthrough: Using the New MFC Shell Controls | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Walkthrough: Using the New MFC Shell Controls | Microsoft Docs","pos":[0,62]}]},{"content":"Walkthrough: Using the New MFC Shell Controls","pos":[604,649]},{"content":"In this walkthrough, you will create an application that resembles File Explorer.","pos":[650,731]},{"content":"You will create a window that contains two panes.","pos":[732,781]},{"content":"The left pane will contain a <bpt id=\"p1\">[</bpt>CMFCShellTreeCtrl<ept id=\"p1\">](../mfc/reference/cmfcshelltreectrl-class.md)</ept> object that displays your Desktop in a hierarchical view.","pos":[782,933],"source":" The left pane will contain a [CMFCShellTreeCtrl](../mfc/reference/cmfcshelltreectrl-class.md) object that displays your Desktop in a hierarchical view."},{"content":"The right pane will contain a <bpt id=\"p1\">[</bpt>CMFCShellListCtrl<ept id=\"p1\">](../mfc/reference/cmfcshelllistctrl-class.md)</ept> that shows the files in the folder that is selected in the left pane.","pos":[934,1098],"source":" The right pane will contain a [CMFCShellListCtrl](../mfc/reference/cmfcshelllistctrl-class.md) that shows the files in the folder that is selected in the left pane."},{"content":"Prerequisites","pos":[1107,1120]},{"content":"This walkthrough assumes that you have set up <ph id=\"ph1\">[!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)]</ph> to use <bpt id=\"p1\">**</bpt>General Development Settings<ept id=\"p1\">**</ept>.","pos":[1124,1270],"source":"This walkthrough assumes that you have set up [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)] to use **General Development Settings**."},{"content":"If you are using a different development setting, some <ph id=\"ph1\">[!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)]</ph> windows that we use in this walkthrough might not be displayed by default.","pos":[1271,1460],"source":" If you are using a different development setting, some [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)] windows that we use in this walkthrough might not be displayed by default."},{"content":"To create a new MFC application by using the MFC Application Wizard","pos":[1470,1537]},{"content":"Use the <bpt id=\"p1\">**</bpt>MFC Application Wizard<ept id=\"p1\">**</ept> to create a new MFC application.","pos":[1547,1614],"source":"Use the **MFC Application Wizard** to create a new MFC application."},{"content":"To run the wizard, from the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu select <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then select <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>.","pos":[1615,1701],"source":" To run the wizard, from the **File** menu select **New**, and then select **Project**."},{"content":"The <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box will be displayed.","pos":[1702,1751],"source":" The **New Project** dialog box will be displayed."},{"content":"In the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box, expand the <bpt id=\"p2\">**</bpt>Visual C++<ept id=\"p2\">**</ept> node in the <bpt id=\"p3\">**</bpt>Project types<ept id=\"p3\">**</ept> pane and select <bpt id=\"p4\">**</bpt>MFC<ept id=\"p4\">**</ept>.","pos":[1761,1876],"source":"In the **New Project** dialog box, expand the **Visual C++** node in the **Project types** pane and select **MFC**."},{"content":"Then, in the <bpt id=\"p1\">**</bpt>Templates<ept id=\"p1\">**</ept> pane, select <bpt id=\"p2\">**</bpt>MFC Application<ept id=\"p2\">**</ept>.","pos":[1877,1937],"source":" Then, in the **Templates** pane, select **MFC Application**."},{"content":"Type a name for the project, such as <ph id=\"ph1\">`MFCShellControls`</ph> and click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[1938,2011],"source":" Type a name for the project, such as `MFCShellControls` and click **OK**."},{"content":"The <bpt id=\"p1\">**</bpt>MFC Application Wizard<ept id=\"p1\">**</ept> will be displayed.","pos":[2012,2061],"source":" The **MFC Application Wizard** will be displayed."},{"content":"In the <bpt id=\"p1\">**</bpt>MFC Application Wizard<ept id=\"p1\">**</ept> dialog box, click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.","pos":[2071,2132],"source":"In the **MFC Application Wizard** dialog box, click **Next**."},{"content":"The <bpt id=\"p1\">**</bpt>Application Type<ept id=\"p1\">**</ept> pane will be displayed.","pos":[2133,2181],"source":" The **Application Type** pane will be displayed."},{"content":"On the <bpt id=\"p1\">**</bpt>Application Type<ept id=\"p1\">**</ept> pane, under <bpt id=\"p2\">**</bpt>Application type<ept id=\"p2\">**</ept>, clear the <bpt id=\"p3\">**</bpt>Tabbed documents<ept id=\"p3\">**</ept> option.","pos":[2191,2291],"source":"On the **Application Type** pane, under **Application type**, clear the **Tabbed documents** option."},{"content":"Next, select <bpt id=\"p1\">**</bpt>Single document<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Document/View architecture support<ept id=\"p2\">**</ept>.","pos":[2292,2375],"source":" Next, select **Single document** and select **Document/View architecture support**."},{"content":"Under <bpt id=\"p1\">**</bpt>Project style<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>Visual Studio<ept id=\"p2\">**</ept>, and from the <bpt id=\"p3\">**</bpt>Visual style and colors<ept id=\"p3\">**</ept> drop down list select <bpt id=\"p4\">**</bpt>Office 2007 (Blue theme)<ept id=\"p4\">**</ept>.","pos":[2376,2519],"source":" Under **Project style**, select **Visual Studio**, and from the **Visual style and colors** drop down list select **Office 2007 (Blue theme)**."},{"content":"Leave all other options as they are.","pos":[2520,2556]},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">**</bpt>Compound Document Support<ept id=\"p2\">**</ept> pane.","pos":[2557,2622],"source":" Click **Next** to display the **Compound Document Support** pane."},{"content":"On the <bpt id=\"p1\">**</bpt>Compound Document Support<ept id=\"p1\">**</ept> pane, select <bpt id=\"p2\">**</bpt>None<ept id=\"p2\">**</ept>.","pos":[2632,2691],"source":"On the **Compound Document Support** pane, select **None**."},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">**</bpt>Document Template Strings<ept id=\"p2\">**</ept> pane.","pos":[2692,2757],"source":" Click **Next** to display the **Document Template Strings** pane."},{"content":"Do not make any changes to the <bpt id=\"p1\">**</bpt>Document Template Strings<ept id=\"p1\">**</ept> pane.","pos":[2767,2833],"source":"Do not make any changes to the **Document Template Strings** pane."},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">**</bpt>Database Support<ept id=\"p2\">**</ept> pane.","pos":[2834,2890],"source":" Click **Next** to display the **Database Support** pane."},{"content":"On the <bpt id=\"p1\">**</bpt>Database Support<ept id=\"p1\">**</ept> pane, select <bpt id=\"p2\">**</bpt>None<ept id=\"p2\">**</ept> because this application does not use a database.","pos":[2900,2999],"source":"On the **Database Support** pane, select **None** because this application does not use a database."},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">**</bpt>User Interface Features<ept id=\"p2\">**</ept> pane.","pos":[3000,3063],"source":" Click **Next** to display the **User Interface Features** pane."},{"content":"On the <bpt id=\"p1\">**</bpt>User Interface Features<ept id=\"p1\">**</ept> pane, make sure that the <bpt id=\"p2\">**</bpt>Use a menu bar and toolbar<ept id=\"p2\">**</ept> option is selected.","pos":[3073,3183],"source":"On the **User Interface Features** pane, make sure that the **Use a menu bar and toolbar** option is selected."},{"content":"Leave all other options as they are.","pos":[3184,3220]},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">**</bpt>Advanced Features<ept id=\"p2\">**</ept> pane.","pos":[3221,3278],"source":" Click **Next** to display the **Advanced Features** pane."},{"content":"On the <bpt id=\"p1\">**</bpt>Advanced Features<ept id=\"p1\">**</ept> pane, under <bpt id=\"p2\">**</bpt>Advanced features<ept id=\"p2\">**</ept>, select only <bpt id=\"p3\">**</bpt>ActiveX controls<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>Common Control Manifest<ept id=\"p4\">**</ept>.","pos":[3287,3416],"source":"On the **Advanced Features** pane, under **Advanced features**, select only **ActiveX controls** and **Common Control Manifest**."},{"content":"Under <bpt id=\"p1\">**</bpt>Advanced frame panes<ept id=\"p1\">**</ept>, select only the <bpt id=\"p2\">**</bpt>Navigation pane<ept id=\"p2\">**</ept> option.","pos":[3417,3492],"source":" Under **Advanced frame panes**, select only the **Navigation pane** option."},{"content":"This will cause the wizard to create the pane to the left of the window with a <ph id=\"ph1\">`CMFCShellTreeCtrl`</ph> already embedded.","pos":[3493,3609],"source":" This will cause the wizard to create the pane to the left of the window with a `CMFCShellTreeCtrl` already embedded."},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">**</bpt>Generated Classes<ept id=\"p2\">**</ept> pane.","pos":[3610,3667],"source":" Click **Next** to display the **Generated Classes** pane."},{"content":"We are not going to make any changes to the <bpt id=\"p1\">**</bpt>Generated Classes<ept id=\"p1\">**</ept> pane.","pos":[3677,3748],"source":"We are not going to make any changes to the **Generated Classes** pane."},{"content":"Therefore, click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept> to create your new MFC project.","pos":[3749,3808],"source":" Therefore, click **Finish** to create your new MFC project."},{"content":"Verify that the application was created successfully by building and running it.","pos":[3818,3898]},{"content":"To build the application, from the <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept> menu select <bpt id=\"p2\">**</bpt>Build Solution<ept id=\"p2\">**</ept>.","pos":[3899,3975],"source":" To build the application, from the **Build** menu select **Build Solution**."},{"content":"If the application builds successfully, run the application by selecting <bpt id=\"p1\">**</bpt>Start Debugging<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Debug<ept id=\"p2\">**</ept> menu.","pos":[3976,4093],"source":" If the application builds successfully, run the application by selecting **Start Debugging** from the **Debug** menu."},{"pos":[4104,4318],"content":"The wizard automatically creates an application that has a standard menu bar, a standard toolbar, a standard status bar, and an Outlook bar to the left of the window with a <bpt id=\"p1\">**</bpt>Folders<ept id=\"p1\">**</ept> view and a <bpt id=\"p2\">**</bpt>Calendar<ept id=\"p2\">**</ept> view.","source":"The wizard automatically creates an application that has a standard menu bar, a standard toolbar, a standard status bar, and an Outlook bar to the left of the window with a **Folders** view and a **Calendar** view."},{"content":"To add the shell list control to the document view","pos":[4328,4378]},{"content":"In this section, you will add an instance of <ph id=\"ph1\">`CMFCShellListCtrl`</ph> to the view that the wizard created.","pos":[4388,4489],"source":"In this section, you will add an instance of `CMFCShellListCtrl` to the view that the wizard created."},{"content":"Open the view header file by double-clicking MFCShellControlsView.h in the <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>.","pos":[4490,4587],"source":" Open the view header file by double-clicking MFCShellControlsView.h in the **Solution Explorer**."},{"content":"Locate the <ph id=\"ph1\">`#pragma once`</ph> directive near the top of the header file.","pos":[4598,4666],"source":"Locate the `#pragma once` directive near the top of the header file."},{"content":"Immediately underneath it add this code to include the header file for <ph id=\"ph1\">`CMFCShellListCtrl`</ph>:","pos":[4667,4758],"source":" Immediately underneath it add this code to include the header file for `CMFCShellListCtrl`:"},{"content":"Now add a member variable of type <ph id=\"ph1\">`CMFCShellListCtrl`</ph>.","pos":[4822,4876],"source":"Now add a member variable of type `CMFCShellListCtrl`."},{"content":"First, locate the following comment in the header file:","pos":[4877,4932]},{"content":"``` *// Generated message map functions","pos":[4939,4978]},{"pos":[5058,5100],"content":"private: CMFCShellListCtrl m_wndList;","leadings":["","    "],"source":"private: \nCMFCShellListCtrl m_wndList;"},{"content":"Immediately under it, add the following method declaration:","pos":[5481,5540]},{"content":"Next, open the MainFrm.cpp source file by double-clicking it in the <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>.","pos":[5625,5715],"source":"Next, open the MainFrm.cpp source file by double-clicking it in the **Solution Explorer**."},{"content":"At the bottom of that file, add the following method definition:","pos":[5716,5780]},{"content":"Now we update the <ph id=\"ph1\">`CMFCShellControlsView`</ph> class to handle the <bpt id=\"p1\">**</bpt>WM_CREATE<ept id=\"p1\">**</ept> windows message.","pos":[5897,5989],"source":"Now we update the `CMFCShellControlsView` class to handle the **WM_CREATE** windows message."},{"content":"Open the MFCShellControlsView.h header file and click on this line of code:","pos":[5990,6065]},{"content":"Next, in the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, click the <bpt id=\"p2\">**</bpt>Messages<ept id=\"p2\">**</ept> icon.","pos":[6142,6206],"source":"Next, in the **Properties** window, click the **Messages** icon."},{"content":"Scroll down until you find the <bpt id=\"p1\">**</bpt>WM_CREATE<ept id=\"p1\">**</ept> message.","pos":[6207,6260],"source":" Scroll down until you find the **WM_CREATE** message."},{"content":"From the drop down list next to <bpt id=\"p1\">**</bpt>WM_CREATE<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt><ph id=\"ph1\">\\&lt;</ph>Add&gt; OnCreate<ept id=\"p2\">**</ept>.","pos":[6261,6335],"source":" From the drop down list next to **WM_CREATE**, select **\\<Add> OnCreate**."},{"content":"This creates a message handler for us and automatically updates the MFC message map.","pos":[6336,6420]},{"content":"In the <ph id=\"ph1\">`OnCreate`</ph> method we will now create our <ph id=\"ph2\">`CMFCShellListCtrl`</ph> object.","pos":[6431,6506],"source":"In the `OnCreate` method we will now create our `CMFCShellListCtrl` object."},{"content":"Find the <ph id=\"ph1\">`OnCreate`</ph> method definition in the MFCShellControlsView.cpp source file, and replace its implementation with the following code:","pos":[6507,6645],"source":" Find the `OnCreate` method definition in the MFCShellControlsView.cpp source file, and replace its implementation with the following code:"},{"content":"Repeat the previous step but for the <bpt id=\"p1\">**</bpt>WM_SIZE<ept id=\"p1\">**</ept> message.","pos":[6981,7038],"source":"Repeat the previous step but for the **WM_SIZE** message."},{"content":"This will cause your applications view to be redrawn whenever a user changes the size of the application window.","pos":[7039,7151]},{"content":"Replace the definition for the <ph id=\"ph1\">`OnSize`</ph> method with the following code:","pos":[7152,7223],"source":" Replace the definition for the `OnSize` method with the following code:"},{"content":"The last step is to connect the <ph id=\"ph1\">`CMFCShellTreeCtrl`</ph> and <ph id=\"ph2\">`CMFCShellListCtrl`</ph> objects by using the <bpt id=\"p1\">[</bpt>CMFCShellTreeCtrl::SetRelatedList<ept id=\"p1\">](../mfc/reference/cmfcshelltreectrl-class.md#cmfcshelltreectrl__setrelatedlist)</ept> method.","pos":[7489,7708],"source":"The last step is to connect the `CMFCShellTreeCtrl` and `CMFCShellListCtrl` objects by using the [CMFCShellTreeCtrl::SetRelatedList](../mfc/reference/cmfcshelltreectrl-class.md#cmfcshelltreectrl__setrelatedlist) method."},{"content":"After you call this method, the <ph id=\"ph1\">`CMFCShellListCtrl`</ph> will automatically display the contents of the item selected in the <ph id=\"ph2\">`CMFCShellTreeCtrl`</ph>.","pos":[7709,7849],"source":" After you call this method, the `CMFCShellListCtrl` will automatically display the contents of the item selected in the `CMFCShellTreeCtrl`."},{"content":"We will do this in the <ph id=\"ph1\">`OnActivateView`</ph> method, which is overridden from <bpt id=\"p1\">[</bpt>CView::OnActivateView<ept id=\"p1\">](../mfc/reference/cview-class.md#cview__onactivateview)</ept>.","pos":[7850,8002],"source":" We will do this in the `OnActivateView` method, which is overridden from [CView::OnActivateView](../mfc/reference/cview-class.md#cview__onactivateview)."},{"pos":[8013,8147],"content":"In the MFCShellControlsView.h header file, inside the <ph id=\"ph1\">`CMFCShellControlsView`</ph> class declaration, add the following method declaration:","source":"In the MFCShellControlsView.h header file, inside the `CMFCShellControlsView` class declaration, add the following method declaration:"},{"content":"Next, add the definition for this method to the MFCShellControlsView.cpp source file:","pos":[8297,8382]},{"pos":[8759,8910],"content":"Because we are calling methods from the <ph id=\"ph1\">`CMainFrame`</ph> class, we must add an <ph id=\"ph2\">`#include`</ph> directive at the top of the MFCShellControlsView.cpp source file:","source":"Because we are calling methods from the `CMainFrame` class, we must add an `#include` directive at the top of the MFCShellControlsView.cpp source file:"},{"content":"Verify that the application was created successfully by building and running it.","pos":[8964,9044]},{"content":"To build the application, from the <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept> menu select <bpt id=\"p2\">**</bpt>Build Solution<ept id=\"p2\">**</ept>.","pos":[9045,9121],"source":" To build the application, from the **Build** menu select **Build Solution**."},{"content":"If the application builds successfully, run it by selecting <bpt id=\"p1\">**</bpt>Start Debugging<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Debug<ept id=\"p2\">**</ept> menu.","pos":[9122,9226],"source":" If the application builds successfully, run it by selecting **Start Debugging** from the **Debug** menu."},{"content":"You should now see the details for the item selected in the <ph id=\"ph1\">`CMFCShellTreeCtrl`</ph> in the view pane.","pos":[9237,9334],"source":"You should now see the details for the item selected in the `CMFCShellTreeCtrl` in the view pane."},{"content":"When you click a node in the <ph id=\"ph1\">`CMFCShellTreeCtrl`</ph>, the <ph id=\"ph2\">`CMFCShellListCtrl`</ph> will be automatically updated.","pos":[9335,9439],"source":" When you click a node in the `CMFCShellTreeCtrl`, the `CMFCShellListCtrl` will be automatically updated."},{"content":"Likewise, if you double-click a folder in the <ph id=\"ph1\">`CMFCShellListCtrl`</ph>, the <ph id=\"ph2\">`CMFCShellTreeCtrl`</ph> should be automatically updated.","pos":[9440,9563],"source":" Likewise, if you double-click a folder in the `CMFCShellListCtrl`, the `CMFCShellTreeCtrl` should be automatically updated."},{"content":"Right click any item in the tree control or in the list control.","pos":[9574,9638]},{"content":"Note that you get the same context menu as if you were using the real File Explorer.","pos":[9639,9723]},{"content":"Next Steps","pos":[9732,9742]},{"content":"The wizard created an Outlook bar with both a <bpt id=\"p1\">**</bpt>Folders<ept id=\"p1\">**</ept> pane and a <bpt id=\"p2\">**</bpt>Calendar<ept id=\"p2\">**</ept> pane.","pos":[9752,9839],"source":"The wizard created an Outlook bar with both a **Folders** pane and a **Calendar** pane."},{"content":"It probably does not make sense to have a <bpt id=\"p1\">**</bpt>Calendar<ept id=\"p1\">**</ept> pane in an Explorer window.","pos":[9840,9922],"source":" It probably does not make sense to have a **Calendar** pane in an Explorer window."},{"content":"Therefore, remove that pane now.","pos":[9923,9955]},{"content":"The <ph id=\"ph1\">`CMFCShellListCtrl`</ph> supports viewing files in different modes, such as <bpt id=\"p1\">**</bpt>Large Icons<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Small Icons<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>List<ept id=\"p3\">**</ept>, and <bpt id=\"p4\">**</bpt>Details<ept id=\"p4\">**</ept>.","pos":[9965,10100],"source":"The `CMFCShellListCtrl` supports viewing files in different modes, such as **Large Icons**, **Small Icons**, **List**, and **Details**."},{"content":"Update your application to implement this functionality.","pos":[10101,10157]},{"content":"Hint: see <bpt id=\"p1\">[</bpt>Visual C++ Samples<ept id=\"p1\">](../visual-cpp-samples.md)</ept>.","pos":[10158,10215],"source":" Hint: see [Visual C++ Samples](../visual-cpp-samples.md)."},{"content":"See Also","pos":[10224,10232]},{"content":"Walkthroughs","pos":[10237,10249]}],"content":"---\ntitle: \"Walkthrough: Using the New MFC Shell Controls | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"shell controls (MFC)\"\nms.assetid: f0015caa-199d-4aaf-9501-5a239fce9095\ncaps.latest.revision: 14\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Walkthrough: Using the New MFC Shell Controls\nIn this walkthrough, you will create an application that resembles File Explorer. You will create a window that contains two panes. The left pane will contain a [CMFCShellTreeCtrl](../mfc/reference/cmfcshelltreectrl-class.md) object that displays your Desktop in a hierarchical view. The right pane will contain a [CMFCShellListCtrl](../mfc/reference/cmfcshelllistctrl-class.md) that shows the files in the folder that is selected in the left pane.  \n  \n## Prerequisites  \n This walkthrough assumes that you have set up [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)] to use **General Development Settings**. If you are using a different development setting, some [!INCLUDE[vsprvs](../assembler/masm/includes/vsprvs_md.md)] windows that we use in this walkthrough might not be displayed by default.  \n  \n### To create a new MFC application by using the MFC Application Wizard  \n  \n1.  Use the **MFC Application Wizard** to create a new MFC application. To run the wizard, from the **File** menu select **New**, and then select **Project**. The **New Project** dialog box will be displayed.  \n  \n2.  In the **New Project** dialog box, expand the **Visual C++** node in the **Project types** pane and select **MFC**. Then, in the **Templates** pane, select **MFC Application**. Type a name for the project, such as `MFCShellControls` and click **OK**. The **MFC Application Wizard** will be displayed.  \n  \n3.  In the **MFC Application Wizard** dialog box, click **Next**. The **Application Type** pane will be displayed.  \n  \n4.  On the **Application Type** pane, under **Application type**, clear the **Tabbed documents** option. Next, select **Single document** and select **Document/View architecture support**. Under **Project style**, select **Visual Studio**, and from the **Visual style and colors** drop down list select **Office 2007 (Blue theme)**. Leave all other options as they are. Click **Next** to display the **Compound Document Support** pane.  \n  \n5.  On the **Compound Document Support** pane, select **None**. Click **Next** to display the **Document Template Strings** pane.  \n  \n6.  Do not make any changes to the **Document Template Strings** pane. Click **Next** to display the **Database Support** pane.  \n  \n7.  On the **Database Support** pane, select **None** because this application does not use a database. Click **Next** to display the **User Interface Features** pane.  \n  \n8.  On the **User Interface Features** pane, make sure that the **Use a menu bar and toolbar** option is selected. Leave all other options as they are. Click **Next** to display the **Advanced Features** pane.  \n  \n9. On the **Advanced Features** pane, under **Advanced features**, select only **ActiveX controls** and **Common Control Manifest**. Under **Advanced frame panes**, select only the **Navigation pane** option. This will cause the wizard to create the pane to the left of the window with a `CMFCShellTreeCtrl` already embedded. Click **Next** to display the **Generated Classes** pane.  \n  \n10. We are not going to make any changes to the **Generated Classes** pane. Therefore, click **Finish** to create your new MFC project.  \n  \n11. Verify that the application was created successfully by building and running it. To build the application, from the **Build** menu select **Build Solution**. If the application builds successfully, run the application by selecting **Start Debugging** from the **Debug** menu.  \n  \n     The wizard automatically creates an application that has a standard menu bar, a standard toolbar, a standard status bar, and an Outlook bar to the left of the window with a **Folders** view and a **Calendar** view.  \n  \n### To add the shell list control to the document view  \n  \n1.  In this section, you will add an instance of `CMFCShellListCtrl` to the view that the wizard created. Open the view header file by double-clicking MFCShellControlsView.h in the **Solution Explorer**.  \n  \n     Locate the `#pragma once` directive near the top of the header file. Immediately underneath it add this code to include the header file for `CMFCShellListCtrl`:  \n  \n ```  \n    #include <afxShellListCtrl.h>  \n ```  \n  \n     Now add a member variable of type `CMFCShellListCtrl`. First, locate the following comment in the header file:  \n  \n ``` *// Generated message map functions  \n ```  \n  \n     Immediately above that comment add this code:  \n  \n ```  \n    private: \n    CMFCShellListCtrl m_wndList;  \n ```  \n  \n2.  The **MFC Application Wizard** already created a `CMFCShellTreeCtrl` object in the `CMainFrame` class, but it is a protected member. We will access this object later. Therefore, create an accessor for it now. Open the MainFrm.h header file by double-clicking it in the **Solution Explorer**. Locate the following comment:  \n  \n ``` *// Attributes  \n ```  \n  \n     Immediately under it, add the following method declaration:  \n  \n ```  \n    public: \n    CMFCShellTreeCtrl& GetShellTreeCtrl();\n\n ```  \n  \n     Next, open the MainFrm.cpp source file by double-clicking it in the **Solution Explorer**. At the bottom of that file, add the following method definition:  \n  \n ```  \n    CMFCShellTreeCtrl& CMainFrame::GetShellTreeCtrl()  \n {  \n    return m_wndTree;  \n }  \n ```  \n  \n3.  Now we update the `CMFCShellControlsView` class to handle the **WM_CREATE** windows message. Open the MFCShellControlsView.h header file and click on this line of code:  \n  \n ```  \n    class CMFCShellControlsView : public CView  \n ```  \n  \n     Next, in the **Properties** window, click the **Messages** icon. Scroll down until you find the **WM_CREATE** message. From the drop down list next to **WM_CREATE**, select **\\<Add> OnCreate**. This creates a message handler for us and automatically updates the MFC message map.  \n  \n     In the `OnCreate` method we will now create our `CMFCShellListCtrl` object. Find the `OnCreate` method definition in the MFCShellControlsView.cpp source file, and replace its implementation with the following code:  \n  \n ```  \n    int CMFCShellControlsView::OnCreate(LPCREATESTRUCT lpCreateStruct)  \n {  \n    if (CView::OnCreate(lpCreateStruct) == -1)  \n    return -1;  \n \n    CRect rectDummy (0,\n    0,\n    0,\n    0);\n\n    m_wndList.Create(WS_CHILD | WS_VISIBLE | LVS_REPORT,  \n    rectDummy,\n    this,\n    1);\n\n \n    return 0;  \n }  \n ```  \n  \n4.  Repeat the previous step but for the **WM_SIZE** message. This will cause your applications view to be redrawn whenever a user changes the size of the application window. Replace the definition for the `OnSize` method with the following code:  \n  \n ```  \n    void CMFCShellControlsView::OnSize(UINT nType,\n    int cx,\n    int cy)  \n {  \n    CView::OnSize(nType,\n    cx,\n    cy);\n\n    m_wndList.SetWindowPos(NULL, -1, -1,\n    cx,\n    cy,  \n    SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE);\n\n }  \n ```  \n  \n5.  The last step is to connect the `CMFCShellTreeCtrl` and `CMFCShellListCtrl` objects by using the [CMFCShellTreeCtrl::SetRelatedList](../mfc/reference/cmfcshelltreectrl-class.md#cmfcshelltreectrl__setrelatedlist) method. After you call this method, the `CMFCShellListCtrl` will automatically display the contents of the item selected in the `CMFCShellTreeCtrl`. We will do this in the `OnActivateView` method, which is overridden from [CView::OnActivateView](../mfc/reference/cview-class.md#cview__onactivateview).  \n  \n     In the MFCShellControlsView.h header file, inside the `CMFCShellControlsView` class declaration, add the following method declaration:  \n  \n ```  \n    protected: \n    virtual void OnActivateView(BOOL bActivate,  \n    CView* pActivateView,  \n    CView* pDeactiveView);\n\n ```  \n  \n     Next, add the definition for this method to the MFCShellControlsView.cpp source file:  \n  \n ```  \n    void CMFCShellControlsView::OnActivateView(BOOL bActivate,  \n    CView* pActivateView,  \n    CView* pDeactiveView)   \n {  \n    if (bActivate&& AfxGetMainWnd() != NULL)  \n {  \n ((CMainFrame*)AfxGetMainWnd())->GetShellTreeCtrl().SetRelatedList(&m_wndList);\n\n }  \n \n    CView::OnActivateView(bActivate,\n    pActivateView,\n    pDeactiveView);\n\n }  \n ```  \n  \n     Because we are calling methods from the `CMainFrame` class, we must add an `#include` directive at the top of the MFCShellControlsView.cpp source file:  \n  \n ```  \n    #include \"MainFrm.h\"  \n ```  \n  \n6.  Verify that the application was created successfully by building and running it. To build the application, from the **Build** menu select **Build Solution**. If the application builds successfully, run it by selecting **Start Debugging** from the **Debug** menu.  \n  \n     You should now see the details for the item selected in the `CMFCShellTreeCtrl` in the view pane. When you click a node in the `CMFCShellTreeCtrl`, the `CMFCShellListCtrl` will be automatically updated. Likewise, if you double-click a folder in the `CMFCShellListCtrl`, the `CMFCShellTreeCtrl` should be automatically updated.  \n  \n     Right click any item in the tree control or in the list control. Note that you get the same context menu as if you were using the real File Explorer.  \n  \n## Next Steps  \n  \n-   The wizard created an Outlook bar with both a **Folders** pane and a **Calendar** pane. It probably does not make sense to have a **Calendar** pane in an Explorer window. Therefore, remove that pane now.  \n  \n-   The `CMFCShellListCtrl` supports viewing files in different modes, such as **Large Icons**, **Small Icons**, **List**, and **Details**. Update your application to implement this functionality. Hint: see [Visual C++ Samples](../visual-cpp-samples.md).  \n  \n## See Also  \n [Walkthroughs](../mfc/walkthroughs-mfc.md)\n\n"}