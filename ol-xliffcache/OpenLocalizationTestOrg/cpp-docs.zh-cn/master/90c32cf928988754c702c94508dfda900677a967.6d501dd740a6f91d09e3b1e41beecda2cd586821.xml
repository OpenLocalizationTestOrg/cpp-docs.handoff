{"nodes":[{"pos":[12,49],"content":"Thread Local Storage | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Thread Local Storage | Microsoft Docs","pos":[0,37]}]},{"content":"Thread Local Storage","pos":[722,742]},{"content":"Microsoft Specific","pos":[745,763]},{"content":"Thread Local Storage (TLS) is the mechanism by which each thread in a given multithreaded process allocates storage for thread-specific data.","pos":[772,913]},{"content":"In standard multithreaded programs, data is shared among all threads of a given process, whereas thread local storage is the mechanism for allocating per-thread data.","pos":[914,1080]},{"content":"For a complete discussion of threads, see <bpt id=\"p1\">[</bpt>Processes and Threads<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms684841)</ept> in the <ph id=\"ph1\">[!INCLUDE[winsdkshort](../atl-mfc-shared/reference/includes/winsdkshort_md.md)]</ph>.","pos":[1081,1294],"source":" For a complete discussion of threads, see [Processes and Threads](http://msdn.microsoft.com/library/windows/desktop/ms684841) in the [!INCLUDE[winsdkshort](../atl-mfc-shared/reference/includes/winsdkshort_md.md)]."},{"content":"The Microsoft C language includes the extended storage-class attribute, thread, which is used with the __declspec keyword to declare a thread local variable.","pos":[1301,1458]},{"content":"For example, the following code declares an integer thread local variable and initializes it with a value:","pos":[1459,1565]},{"content":"These guidelines must be observed when you are declaring statically bound thread local variables:","pos":[1625,1722]},{"pos":[1732,1880],"content":"The use of <bpt id=\"p1\">**</bpt>__declspec(thread)<ept id=\"p1\">**</ept> may interfere with <bpt id=\"p2\">[</bpt>delay loading<ept id=\"p2\">](../build/reference/linker-support-for-delay-loaded-dlls.md)</ept> of DLL imports<bpt id=\"p3\">**</bpt>.<ept id=\"p3\">**</ept>","source":"The use of **__declspec(thread)** may interfere with [delay loading](../build/reference/linker-support-for-delay-loaded-dlls.md) of DLL imports**.**"},{"content":"You can apply the thread attribute only to data declarations and definitions.","pos":[1890,1967]},{"content":"It cannot be used on function declarations or definitions.","pos":[1968,2026]},{"content":"For example, the following code generates a compiler error:","pos":[2027,2086]},{"content":"You can specify the thread attribute only on data items with static storage duration.","pos":[2206,2291]},{"content":"This includes global data (both static and extern) and local static data.","pos":[2292,2365]},{"content":"You cannot declare automatic data with the thread attribute.","pos":[2366,2426]},{"content":"For example, the following code generates compiler errors:","pos":[2427,2485]},{"content":"You must use the thread attribute for the declaration and the definition of thread local data, regardless of whether the declaration and definition occur in the same file or separate files.","pos":[2741,2930]},{"content":"For example, the following code generates an error:","pos":[2931,2982]},{"content":"You cannot use the thread attribute as a type modifier.","pos":[3205,3260]},{"content":"For example, the following code generates a compiler error:","pos":[3261,3320]},{"content":"The address of a thread local variable is not considered constant, and any expression involving such an address is not considered a constant expression.","pos":[3407,3559]},{"content":"This means that you cannot use the address of a thread local variable as an initializer for a pointer.","pos":[3560,3662]},{"content":"For example, the compiler flags the following code as an error:","pos":[3663,3726]},{"content":"C permits initialization of a variable with an expression involving a reference to itself, but only for objects of nonstatic extent.","pos":[3867,3999]},{"content":"For example:","pos":[4000,4012]},{"content":"Note that a sizeof expression that includes the variable being initialized does not constitute a reference to itself and is allowed.","pos":[4258,4390]},{"pos":[4400,4548],"content":"The use of <bpt id=\"p1\">**</bpt>__declspec(thread)<ept id=\"p1\">**</ept> may interfere with <bpt id=\"p2\">[</bpt>delay loading<ept id=\"p2\">](../build/reference/linker-support-for-delay-loaded-dlls.md)</ept> of DLL imports<bpt id=\"p3\">**</bpt>.<ept id=\"p3\">**</ept>","source":"The use of **__declspec(thread)** may interfere with [delay loading](../build/reference/linker-support-for-delay-loaded-dlls.md) of DLL imports**.**"},{"pos":[4555,4703],"content":"For more information about using the thread attribute, see <bpt id=\"p1\">[</bpt>Multithreading Topics<ept id=\"p1\">](../parallel/multithreading-support-for-older-code-visual-cpp.md)</ept>.","source":"For more information about using the thread attribute, see [Multithreading Topics](../parallel/multithreading-support-for-older-code-visual-cpp.md)."},{"content":"END Microsoft Specific","pos":[4712,4734]},{"content":"See Also","pos":[4745,4753]},{"content":"C Extended Storage-Class Attributes","pos":[4758,4793]}],"content":"---\ntitle: \"Thread Local Storage | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\n  - \"C\"\nhelpviewer_keywords: \n  - \"thread-local variables\"\n  - \"TLS (thread local storage)\"\n  - \"thread storage-class attribute\"\n  - \"thread-local storage\"\n  - \"storage, thread local storage\"\nms.assetid: a0f1b109-c953-4079-aa10-e47f5483173d\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Thread Local Storage\n**Microsoft Specific**  \n  \n Thread Local Storage (TLS) is the mechanism by which each thread in a given multithreaded process allocates storage for thread-specific data. In standard multithreaded programs, data is shared among all threads of a given process, whereas thread local storage is the mechanism for allocating per-thread data. For a complete discussion of threads, see [Processes and Threads](http://msdn.microsoft.com/library/windows/desktop/ms684841) in the [!INCLUDE[winsdkshort](../atl-mfc-shared/reference/includes/winsdkshort_md.md)].  \n  \n The Microsoft C language includes the extended storage-class attribute, thread, which is used with the __declspec keyword to declare a thread local variable. For example, the following code declares an integer thread local variable and initializes it with a value:  \n  \n```  \n__declspec( thread ) int tls_i = 1;  \n```  \n  \n These guidelines must be observed when you are declaring statically bound thread local variables:  \n  \n-   The use of **__declspec(thread)** may interfere with [delay loading](../build/reference/linker-support-for-delay-loaded-dlls.md) of DLL imports**.**  \n  \n-   You can apply the thread attribute only to data declarations and definitions. It cannot be used on function declarations or definitions. For example, the following code generates a compiler error:  \n  \n    ```  \n    #define Thread   __declspec( thread )  \n    Thread void func();      /* Error */  \n    ```  \n  \n-   You can specify the thread attribute only on data items with static storage duration. This includes global data (both static and extern) and local static data. You cannot declare automatic data with the thread attribute. For example, the following code generates compiler errors:  \n  \n    ```  \n    #define Thread   __declspec( thread )  \n    void func1()  \n    {  \n        Thread int tls_i;            /* Error */  \n    }  \n  \n    int func2( Thread int tls_i )    /* Error */  \n    {  \n       return tls_i;  \n    }  \n    ```  \n  \n-   You must use the thread attribute for the declaration and the definition of thread local data, regardless of whether the declaration and definition occur in the same file or separate files. For example, the following code generates an error:  \n  \n    ```  \n    #define Thread   __declspec( thread )  \n    extern int tls_i;     /* This generates an error, because the   */  \n    int Thread tls_i;     /* declaration and the definition differ. */  \n    ```  \n  \n-   You cannot use the thread attribute as a type modifier. For example, the following code generates a compiler error:  \n  \n    ```  \n    char *ch __declspec( thread );      /* Error */  \n    ```  \n  \n-   The address of a thread local variable is not considered constant, and any expression involving such an address is not considered a constant expression. This means that you cannot use the address of a thread local variable as an initializer for a pointer. For example, the compiler flags the following code as an error:  \n  \n    ```  \n    #define Thread   __declspec( thread )  \n    Thread int tls_i;  \n    int *p = &tls_i;      /* Error */  \n    ```  \n  \n-   C permits initialization of a variable with an expression involving a reference to itself, but only for objects of nonstatic extent. For example:  \n  \n    ```  \n    #define Thread   __declspec( thread )  \n    Thread int tls_i = tls_i;             /* Error */  \n    int j = j;                            /* Error */  \n    Thread int tls_i = sizeof( tls_i )    /* Okay  */  \n    ```  \n  \n     Note that a sizeof expression that includes the variable being initialized does not constitute a reference to itself and is allowed.  \n  \n-   The use of **__declspec(thread)** may interfere with [delay loading](../build/reference/linker-support-for-delay-loaded-dlls.md) of DLL imports**.**  \n  \n For more information about using the thread attribute, see [Multithreading Topics](../parallel/multithreading-support-for-older-code-visual-cpp.md).  \n  \n **END Microsoft Specific**  \n  \n## See Also  \n [C Extended Storage-Class Attributes](../c-language/c-extended-storage-class-attributes.md)"}