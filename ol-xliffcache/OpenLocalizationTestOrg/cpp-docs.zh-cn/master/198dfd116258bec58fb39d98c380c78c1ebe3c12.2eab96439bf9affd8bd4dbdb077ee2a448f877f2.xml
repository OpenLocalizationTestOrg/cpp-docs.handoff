{"nodes":[{"pos":[12,79],"content":"Walkthrough: Adding a D2D Object to an MFC Project | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Walkthrough: Adding a D2D Object to an MFC Project | Microsoft Docs","pos":[0,67]}]},{"content":"Walkthrough: Adding a D2D Object to an MFC Project","pos":[613,663]},{"content":"This walkthrough teaches how to add a basic Direct2D (D2D) object to a Visual C++, Microsoft Foundation Class Library (MFC) project, and then build the project into an application that prints \"Hello, world\" on a gradient background.","pos":[664,896]},{"content":"The walkthrough shows how to accomplish these tasks:","pos":[903,955]},{"content":"Create an MFC application.","pos":[965,991]},{"content":"Create a solid-color brush and a linear-gradient brush.","pos":[1001,1056]},{"content":"Modify the gradient brush so that it will change appropriately when the window is resized.","pos":[1066,1156]},{"content":"Implement a D2D drawing handler.","pos":[1166,1198]},{"content":"Verify the results.","pos":[1208,1227]},{"content":"Prerequisites","pos":[1321,1334]},{"content":"To complete this walkthrough, you must have Visual Studio.","pos":[1338,1396]},{"content":"To create an MFC application","pos":[1406,1434]},{"pos":[1444,1510],"content":"On the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, point to <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept> and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>.","source":"On the **File** menu, point to **New** and then click **Project**."},{"content":"In the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box, in the left pane under <bpt id=\"p2\">**</bpt>Installed Templates<ept id=\"p2\">**</ept>, expand <bpt id=\"p3\">**</bpt>Visual C++<ept id=\"p3\">**</ept> and then select <bpt id=\"p4\">**</bpt>MFC<ept id=\"p4\">**</ept>.","pos":[1520,1649],"source":"In the **New Project** dialog box, in the left pane under **Installed Templates**, expand **Visual C++** and then select **MFC**."},{"content":"In the middle pane, select <bpt id=\"p1\">**</bpt>MFC Application<ept id=\"p1\">**</ept>.","pos":[1650,1697],"source":" In the middle pane, select **MFC Application**."},{"content":"In the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> box, type <ph id=\"ph1\">`MFCD2DWalkthrough`</ph>.","pos":[1698,1744],"source":" In the **Name** box, type `MFCD2DWalkthrough`."},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[1745,1758],"source":" Click **OK**."},{"pos":[1768,1850],"content":"In the <bpt id=\"p1\">**</bpt>MFC Application Wizard<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept> without changing any settings.","source":"In the **MFC Application Wizard**, click **Finish** without changing any settings."},{"content":"To create a solid-color brush and a linear-gradient brush","pos":[1860,1917]},{"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, in the <bpt id=\"p2\">**</bpt>MFCD2DWalkthrough<ept id=\"p2\">**</ept> project, in the <bpt id=\"p3\">**</bpt>Header Files<ept id=\"p3\">**</ept> folder, open MFCD2DWalkthroughView.h.","pos":[1927,2052],"source":"In **Solution Explorer**, in the **MFCD2DWalkthrough** project, in the **Header Files** folder, open MFCD2DWalkthroughView.h."},{"content":"Add the following code to the <ph id=\"ph1\">`CMFCD2DWalkthroughView`</ph> class to create three data variables.","pos":[2053,2145],"source":" Add the following code to the `CMFCD2DWalkthroughView` class to create three data variables."},{"content":"Save the file and close it.","pos":[2307,2334]},{"content":"In the <bpt id=\"p1\">**</bpt>Source Files<ept id=\"p1\">**</ept> folder, open MFCD2DWalkthroughView.cpp.","pos":[2344,2407],"source":"In the **Source Files** folder, open MFCD2DWalkthroughView.cpp."},{"content":"In the constructor for the <ph id=\"ph1\">`CMFCD2DWalkthroughView`</ph> class, add the following code.","pos":[2408,2490],"source":" In the constructor for the `CMFCD2DWalkthroughView` class, add the following code."},{"pos":[2497,2566],"content":"``` *// Enable D2D support for this window:  \nEnableD2DSupport();","leadings":["","    "],"nodes":[{"content":"``` *// Enable D2D support for this window:","pos":[0,43]},{"content":"EnableD2DSupport();","pos":[46,65]}]},{"pos":[2569,2703],"content":"*// Initialize D2D resources:  \nm_pBlackBrush = new CD2DSolidColorBrush(GetRenderTarget(),\nD2D1::ColorF(D2D1::ColorF::Black));","leadings":["","    ","    "],"nodes":[{"content":"*// Initialize D2D resources:","pos":[0,29]},{"content":"m_pBlackBrush = new CD2DSolidColorBrush(GetRenderTarget(), D2D1::ColorF(D2D1::ColorF::Black));","pos":[32,126],"source":"m_pBlackBrush = new CD2DSolidColorBrush(GetRenderTarget(),\nD2D1::ColorF(D2D1::ColorF::Black));"}]},{"pos":[2711,2792],"content":"m_pTextFormat = new CD2DTextFormat(GetRenderTarget(), _T(\"Verdana\"), 50);","leadings":["","    ","    "],"source":"m_pTextFormat = new CD2DTextFormat(GetRenderTarget(),\n_T(\"Verdana\"),\n50);"},{"content":"m_pTextFormat-&gt;Get()-&gt;SetTextAlignment(DWRITE_TEXT_ALIGNMENT_CENTER);","pos":[2798,2867],"source":"m_pTextFormat->Get()->SetTextAlignment(DWRITE_TEXT_ALIGNMENT_CENTER);"},{"content":"m_pTextFormat-&gt;Get()-&gt;SetParagraphAlignment(DWRITE_PARAGRAPH_ALIGNMENT_CENTER);","pos":[2870,2949],"source":"m_pTextFormat->Get()->SetParagraphAlignment(DWRITE_PARAGRAPH_ALIGNMENT_CENTER);"},{"content":"D2D1_GRADIENT_STOP gradientStops[2];","pos":[2957,2993]},{"content":"gradientStops[0].color = D2D1::ColorF(D2D1::ColorF::White);","pos":[3002,3061]},{"pos":[3067,3166],"content":"gradientStops[0].position = 0.f;  \ngradientStops[1].color = D2D1::ColorF(D2D1::ColorF::Indigo);","leadings":["","    "],"nodes":[{"content":"gradientStops[0].position = 0.f;","pos":[0,32]},{"content":"gradientStops[1].color = D2D1::ColorF(D2D1::ColorF::Indigo);","pos":[35,95]}]},{"content":"gradientStops[1].position = 1.f;","pos":[3172,3204]},{"pos":[3213,3434],"content":"m_pLinearGradientBrush = new CD2DLinearGradientBrush(GetRenderTarget(),   \ngradientStops,\nARRAYSIZE(gradientStops),  \nD2D1::LinearGradientBrushProperties(D2D1::Point2F(0,\n0),\nD2D1::Point2F(0,\n0)));","leadings":["","    ","    ","    ","    ","    ","    "],"nodes":[{"content":"m_pLinearGradientBrush = new CD2DLinearGradientBrush(GetRenderTarget(),","pos":[0,71]},{"content":"gradientStops, ARRAYSIZE(gradientStops),","pos":[75,115],"source":"gradientStops,\nARRAYSIZE(gradientStops),"},{"content":"D2D1::LinearGradientBrushProperties(D2D1::Point2F(0, 0), D2D1::Point2F(0, 0)));","pos":[118,197],"source":"D2D1::LinearGradientBrushProperties(D2D1::Point2F(0,\n0),\nD2D1::Point2F(0,\n0)));"}]},{"content":"m_pLinearGradientBrush-&gt;SetEndPoint(CPoint(cx, cy));","pos":[4127,4179],"source":"m_pLinearGradientBrush->SetEndPoint(CPoint(cx, cy));"},{"pos":[5050,5241],"content":"afx_msg LRESULT CMFCD2DWalkthroughView::OnDraw2D(WPARAM wParam,\nLPARAM lParam)  \n{  \nCHwndRenderTarget* pRenderTarget = (CHwndRenderTarget*)lParam;  \nASSERT_VALID(pRenderTarget);","leadings":["","    "," ","    ","    "],"nodes":[{"content":"afx_msg LRESULT CMFCD2DWalkthroughView::OnDraw2D(WPARAM wParam, LPARAM lParam)","pos":[0,78],"source":"afx_msg LRESULT CMFCD2DWalkthroughView::OnDraw2D(WPARAM wParam,\nLPARAM lParam)"},{"content":"{","pos":[81,82]},{"content":"CHwndRenderTarget<bpt id=\"p1\">*</bpt> pRenderTarget = (CHwndRenderTarget<ept id=\"p1\">*</ept>)lParam;","pos":[85,147],"source":"CHwndRenderTarget* pRenderTarget = (CHwndRenderTarget*)lParam;"},{"content":"ASSERT_VALID(pRenderTarget);","pos":[150,178]}]},{"pos":[5249,5287],"content":"CRect rect;  \nGetClientRect(rect);","leadings":["","    "],"nodes":[{"content":"CRect rect;","pos":[0,11]},{"content":"GetClientRect(rect);","pos":[14,34]}]},{"pos":[5295,5358],"content":"pRenderTarget-&gt;FillRectangle(rect, m_pLinearGradientBrush);","leadings":["","    "],"source":"pRenderTarget->FillRectangle(rect,\nm_pLinearGradientBrush);"},{"pos":[5364,5461],"content":"pRenderTarget-&gt;DrawText(_T(\"Hello, World!\"), rect, m_pBlackBrush, m_pTextFormat);","leadings":["","    ","    ","    ","    "],"source":"pRenderTarget->DrawText(_T(\"Hello,\nWorld!\"),\nrect,\nm_pBlackBrush,\nm_pTextFormat);"},{"pos":[5469,5486],"content":"return TRUE;  \n}","leadings":[""," "],"nodes":[{"content":"return TRUE;","pos":[0,12]},{"content":"}","pos":[15,16]}]}],"content":"---\ntitle: \"Walkthrough: Adding a D2D Object to an MFC Project | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MFC, D2D\"\n  - \"D2D [MFC]\"\nms.assetid: dda36c33-c231-4da6-a62f-72d69a12b6dd\ncaps.latest.revision: 20\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Walkthrough: Adding a D2D Object to an MFC Project\nThis walkthrough teaches how to add a basic Direct2D (D2D) object to a Visual C++, Microsoft Foundation Class Library (MFC) project, and then build the project into an application that prints \"Hello, world\" on a gradient background.  \n  \n The walkthrough shows how to accomplish these tasks:  \n  \n-   Create an MFC application.  \n  \n-   Create a solid-color brush and a linear-gradient brush.  \n  \n-   Modify the gradient brush so that it will change appropriately when the window is resized.  \n  \n-   Implement a D2D drawing handler.  \n  \n-   Verify the results.  \n  \n [!INCLUDE[note_settings_general](../mfc/includes/note_settings_general_md.md)]  \n  \n## Prerequisites  \n To complete this walkthrough, you must have Visual Studio.  \n  \n### To create an MFC application  \n  \n1.  On the **File** menu, point to **New** and then click **Project**.  \n  \n2.  In the **New Project** dialog box, in the left pane under **Installed Templates**, expand **Visual C++** and then select **MFC**. In the middle pane, select **MFC Application**. In the **Name** box, type `MFCD2DWalkthrough`. Click **OK**.  \n  \n3.  In the **MFC Application Wizard**, click **Finish** without changing any settings.  \n  \n### To create a solid-color brush and a linear-gradient brush  \n  \n1.  In **Solution Explorer**, in the **MFCD2DWalkthrough** project, in the **Header Files** folder, open MFCD2DWalkthroughView.h. Add the following code to the `CMFCD2DWalkthroughView` class to create three data variables.  \n  \n ```  \n    CD2DTextFormat* m_pTextFormat;  \n    CD2DSolidColorBrush* m_pBlackBrush;  \n    CD2DLinearGradientBrush* m_pLinearGradientBrush;  \n ```  \n  \n     Save the file and close it.  \n  \n2.  In the **Source Files** folder, open MFCD2DWalkthroughView.cpp. In the constructor for the `CMFCD2DWalkthroughView` class, add the following code.  \n  \n ``` *// Enable D2D support for this window:  \n    EnableD2DSupport();\n\n *// Initialize D2D resources:  \n    m_pBlackBrush = new CD2DSolidColorBrush(GetRenderTarget(),\n    D2D1::ColorF(D2D1::ColorF::Black));\n\n \n    m_pTextFormat = new CD2DTextFormat(GetRenderTarget(),\n    _T(\"Verdana\"),\n    50);\n\n    m_pTextFormat->Get()->SetTextAlignment(DWRITE_TEXT_ALIGNMENT_CENTER);\n\n m_pTextFormat->Get()->SetParagraphAlignment(DWRITE_PARAGRAPH_ALIGNMENT_CENTER);\n\n \n    D2D1_GRADIENT_STOP gradientStops[2];  \n \n    gradientStops[0].color = D2D1::ColorF(D2D1::ColorF::White);\n\n    gradientStops[0].position = 0.f;  \n    gradientStops[1].color = D2D1::ColorF(D2D1::ColorF::Indigo);\n\n    gradientStops[1].position = 1.f;  \n \n    m_pLinearGradientBrush = new CD2DLinearGradientBrush(GetRenderTarget(),   \n    gradientStops,\n    ARRAYSIZE(gradientStops),  \n    D2D1::LinearGradientBrushProperties(D2D1::Point2F(0,\n    0),\n    D2D1::Point2F(0,\n    0)));\n\n ```  \n  \n     Save the file and close it.  \n  \n### To modify the gradient brush so that it will change appropriately when the window is resized  \n  \n1.  On the **Project** menu, click **Class Wizard**.  \n  \n2.  In the **MFC Class Wizard**, under **Class name**, select `CMFCD2DWalkthroughView`.  \n  \n3.  On the **Messages** tab, in the **Messages** box, select `WM_SIZE` and then click **Add Handler**. This action adds the `OnSize` message handler to the `CMFCD2DWalkthroughView` class.  \n  \n4.  In the **Existing handlers** box, select `OnSize`. Click **Edit Code** to display the `CMFCD2DWalkthroughView::OnSize` method. At the end of the method, add the following code.  \n  \n ```  \n    m_pLinearGradientBrush->SetEndPoint(CPoint(cx, cy));\n\n ```  \n  \n     Save the file and close it.  \n  \n### To implement a D2D drawing handler  \n  \n1.  On the **Project** menu, click **Class Wizard**.  \n  \n2.  In the **MFC Class Wizard**, under **Class name**, select `CMFCD2DWalkthroughView`.  \n  \n3.  On the **Messages** tab, click **Add Custom Message**.  \n  \n4.  In the **Add Custom Message** dialog box, in the **Custom Windows Message** box, type `AFX_WM_DRAW2D`. In the **Message handler name** box, type `OnDraw2D`. Select the **Registered Message** option and then click **OK**. This action adds a message handler for the `AFX_WM_DRAW2D` message to the `CMFCD2DWalkthroughView` class.  \n  \n5.  In the **Existing handlers** box, select `OnDraw2D`. Click **Edit Code** to display the `CMFCD2DWalkthroughView::OnDraw2D` method. Use the following code for the `CMFCD2DWalkthroughView::OnDrawD2D` method.  \n  \n ```  \n    afx_msg LRESULT CMFCD2DWalkthroughView::OnDraw2D(WPARAM wParam,\n    LPARAM lParam)  \n {  \n    CHwndRenderTarget* pRenderTarget = (CHwndRenderTarget*)lParam;  \n    ASSERT_VALID(pRenderTarget);\n\n \n    CRect rect;  \n    GetClientRect(rect);\n\n \n    pRenderTarget->FillRectangle(rect,\n    m_pLinearGradientBrush);\n\n    pRenderTarget->DrawText(_T(\"Hello,\n    World!\"),\n    rect,\n    m_pBlackBrush,\n    m_pTextFormat);\n\n \n    return TRUE;  \n }  \n ```  \n  \n     Save the file and close it.  \n  \n### To verify the results  \n  \n1.  Build and run the application. It should have a gradient rectangle that changes when you resize the window. “Hello World!” should be displayed in the center of the rectangle.  \n  \n## See Also  \n [Walkthroughs](../mfc/walkthroughs-mfc.md)\n\n"}