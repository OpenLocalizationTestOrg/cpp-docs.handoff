{"nodes":[{"pos":[12,36],"content":"qsort_s | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"qsort_s | Microsoft Docs","pos":[0,24]}]},{"pos":[983,990],"content":"qsort_s","linkify":"qsort_s","nodes":[{"content":"qsort_s","pos":[0,7]}]},{"content":"Performs a quick sort.","pos":[991,1013]},{"content":"A version of <bpt id=\"p1\">[</bpt>qsort<ept id=\"p1\">](../../c-runtime-library/reference/qsort.md)</ept> with security enhancements as described in <bpt id=\"p2\">[</bpt>Security Features in the CRT<ept id=\"p2\">](../../c-runtime-library/security-features-in-the-crt.md)</ept>.","pos":[1014,1210],"source":" A version of [qsort](../../c-runtime-library/reference/qsort.md) with security enhancements as described in [Security Features in the CRT](../../c-runtime-library/security-features-in-the-crt.md)."},{"pos":[1219,1225],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1411,1421],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"Start of target array.","pos":[1435,1457]},{"content":"Array size in elements.","pos":[1473,1496]},{"content":"Element size in bytes.","pos":[1514,1536]},{"content":"Comparison function.","pos":[1556,1576]},{"content":"The first argument is the <ph id=\"ph1\">`context`</ph> pointer.","pos":[1577,1621],"source":" The first argument is the `context` pointer."},{"content":"The second argument is a pointer to the <ph id=\"ph1\">`key`</ph> for the search.","pos":[1622,1683],"source":" The second argument is a pointer to the `key` for the search."},{"content":"The third argument is a pointer to the array element to be compared with <ph id=\"ph1\">`key`</ph>.","pos":[1684,1763],"source":" The third argument is a pointer to the array element to be compared with `key`."},{"content":"A pointer to a context, which can be any object that the <ph id=\"ph1\">`compare`</ph> routine needs to access.","pos":[1783,1874],"source":" A pointer to a context, which can be any object that the `compare` routine needs to access."},{"pos":[1883,1890],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"The <ph id=\"ph1\">`qsort_s`</ph> function implements a quick-sort algorithm to sort an array of <ph id=\"ph2\">`num`</ph> elements, each of <ph id=\"ph3\">`width`</ph> bytes.","pos":[1894,2009],"source":"The `qsort_s` function implements a quick-sort algorithm to sort an array of `num` elements, each of `width` bytes."},{"content":"The argument <ph id=\"ph1\">`base`</ph> is a pointer to the base of the array to be sorted.","pos":[2010,2081],"source":" The argument `base` is a pointer to the base of the array to be sorted."},{"content":"<ph id=\"ph1\">`qsort_s`</ph> overwrites this array with the sorted elements.","pos":[2082,2139],"source":"`qsort_s` overwrites this array with the sorted elements."},{"content":"The argument <ph id=\"ph1\">`compare`</ph> is a pointer to a user-supplied routine that compares two array elements and returns a value specifying their relationship.","pos":[2140,2286],"source":" The argument `compare` is a pointer to a user-supplied routine that compares two array elements and returns a value specifying their relationship."},{"content":"<ph id=\"ph1\">`qsort_s`</ph> calls the <ph id=\"ph2\">`compare`</ph> routine one or more times during the sort, passing pointers to two array elements on each call:","pos":[2287,2412],"source":"`qsort_s` calls the `compare` routine one or more times during the sort, passing pointers to two array elements on each call:"},{"content":"The routine must compare the elements and then return one of the following values:","pos":[2492,2574]},{"content":"Return value","pos":[2581,2593]},{"content":"Description","pos":[2594,2605]},{"content":"&lt; 0","pos":[2651,2654],"source":"< 0"},{"pos":[2655,2680],"content":"<ph id=\"ph1\">`elem1`</ph> less than <ph id=\"ph2\">`elem2`</ph>","source":"`elem1` less than `elem2`"},{"content":"0","pos":[2685,2686]},{"pos":[2687,2716],"content":"<ph id=\"ph1\">`elem1`</ph> equivalent to <ph id=\"ph2\">`elem2`</ph>","source":"`elem1` equivalent to `elem2`"},{"content":"&gt; 0","pos":[2721,2724],"source":"> 0"},{"pos":[2725,2753],"content":"<ph id=\"ph1\">`elem1`</ph> greater than <ph id=\"ph2\">`elem2`</ph>","source":"`elem1` greater than `elem2`"},{"content":"The array is sorted in increasing order, as defined by the comparison function.","pos":[2761,2840]},{"content":"To sort an array in decreasing order, reverse the sense of \"greater than\" and \"less than\" in the comparison function.","pos":[2841,2958]},{"content":"If invalid parameters are passed to the function, the invalid parameter handler is invoked, as described in <bpt id=\"p1\">[</bpt>Parameter Validation<ept id=\"p1\">](../../c-runtime-library/parameter-validation.md)</ept>.","pos":[2965,3145],"source":"If invalid parameters are passed to the function, the invalid parameter handler is invoked, as described in [Parameter Validation](../../c-runtime-library/parameter-validation.md)."},{"content":"If execution is allowed to continue, then the function returns and <ph id=\"ph1\">`errno`</ph> is set to <ph id=\"ph2\">`EINVAL`</ph>.","pos":[3146,3240],"source":" If execution is allowed to continue, then the function returns and `errno` is set to `EINVAL`."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>errno, _doserrno, _sys_errlist, and _sys_nerr<ept id=\"p1\">](../../c-runtime-library/errno-doserrno-sys-errlist-and-sys-nerr.md)</ept>.","pos":[3241,3383],"source":" For more information, see [errno, _doserrno, _sys_errlist, and _sys_nerr](../../c-runtime-library/errno-doserrno-sys-errlist-and-sys-nerr.md)."},{"pos":[3393,3409],"content":"Error Conditions","linkify":"Error Conditions","nodes":[{"content":"Error Conditions","pos":[0,16]}]},{"content":"key","pos":[3416,3419]},{"content":"base","pos":[3420,3424]},{"content":"compare","pos":[3425,3432]},{"content":"num","pos":[3433,3436]},{"content":"width","pos":[3437,3442]},{"content":"errno","pos":[3443,3448]},{"content":"any","pos":[3533,3536]},{"content":"any","pos":[3537,3540]},{"content":"any","pos":[3541,3544]},{"content":"any","pos":[3545,3548]},{"content":"any","pos":[3562,3565]},{"content":"any","pos":[3573,3576]},{"content":"!= 0","pos":[3577,3581]},{"content":"any","pos":[3582,3585]},{"content":"any","pos":[3599,3602]},{"content":"any","pos":[3603,3606]},{"content":"any","pos":[3607,3610]},{"content":"any","pos":[3611,3614]},{"content":"&lt;= 0","pos":[3615,3619],"source":"<= 0"},{"content":"any","pos":[3633,3636]},{"content":"any","pos":[3637,3640]},{"content":"any","pos":[3648,3651]},{"content":"any","pos":[3652,3655]},{"content":"<ph id=\"ph1\">`qsort_s`</ph> has the same behavior as <ph id=\"ph2\">`qsort`</ph> but has the <ph id=\"ph3\">`context`</ph> parameter and sets <ph id=\"ph4\">`errno`</ph>.","pos":[3672,3764],"source":"`qsort_s` has the same behavior as `qsort` but has the `context` parameter and sets `errno`."},{"content":"By passing a <ph id=\"ph1\">`context`</ph> parameter, comparison functions can use an object pointer to access object functionality or other information not accessible through an element pointer.","pos":[3765,3940],"source":" By passing a `context` parameter, comparison functions can use an object pointer to access object functionality or other information not accessible through an element pointer."},{"content":"The addition of the <ph id=\"ph1\">`context`</ph> parameter makes <ph id=\"ph2\">`qsort_s`</ph>more secure because <ph id=\"ph3\">`context`</ph> can be used to avoid reentrancy bugs introduced by using static variables to make shared information available to the <ph id=\"ph4\">`compare`</ph> function.","pos":[3941,4163],"source":" The addition of the `context` parameter makes `qsort_s`more secure because `context` can be used to avoid reentrancy bugs introduced by using static variables to make shared information available to the `compare` function."},{"pos":[4172,4184],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"content":"Routine","pos":[4191,4198]},{"content":"Required header","pos":[4199,4214]},{"content":"<ph id=\"ph1\">\\&lt;</ph>stdlib.h&gt; and <ph id=\"ph2\">\\&lt;</ph>search.h&gt;","pos":[4269,4296],"source":"\\<stdlib.h> and \\<search.h>"},{"pos":[4304,4428],"content":"For additional compatibility information, see <bpt id=\"p1\">[</bpt>Compatibility<ept id=\"p1\">](../../c-runtime-library/compatibility.md)</ept> in the Introduction.","source":"For additional compatibility information, see [Compatibility](../../c-runtime-library/compatibility.md) in the Introduction."},{"pos":[4435,4542],"content":"<bpt id=\"p1\">**</bpt>Libraries:<ept id=\"p1\">**</ept> All versions of the <bpt id=\"p2\">[</bpt>CRT Library Features<ept id=\"p2\">](../../c-runtime-library/crt-library-features.md)</ept>.","source":"**Libraries:** All versions of the [CRT Library Features](../../c-runtime-library/crt-library-features.md)."},{"pos":[4551,4558],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example demonstrates how to use the <ph id=\"ph1\">`context`</ph> parameter in the <ph id=\"ph2\">`qsort_s`</ph>function.","pos":[4562,4657],"source":"The following example demonstrates how to use the `context` parameter in the `qsort_s`function."},{"content":"The <ph id=\"ph1\">`context`</ph> parameter makes it easier to perform thread-safe sorts.","pos":[4658,4727],"source":" The `context` parameter makes it easier to perform thread-safe sorts."},{"content":"Instead of using static variables that must be synchronized to ensure thread safety, pass a different <ph id=\"ph1\">`context`</ph> parameter in each sort.","pos":[4728,4863],"source":" Instead of using static variables that must be synchronized to ensure thread safety, pass a different `context` parameter in each sort."},{"content":"In this example, a locale object is used as the <ph id=\"ph1\">`context`</ph> parameter.","pos":[4864,4932],"source":" In this example, a locale object is used as the `context` parameter."},{"pos":[8755,8768],"content":"Sample Output","linkify":"Sample Output","nodes":[{"content":"Sample Output","pos":[0,13]}]},{"pos":[9009,9034],"content":".NET Framework Equivalent","linkify":".NET Framework Equivalent","nodes":[{"content":".NET Framework Equivalent","pos":[0,25]}]},{"content":"&lt;xref:System.Collections.ArrayList.Sort%2A&gt;","pos":[9038,9081],"source":"<xref:System.Collections.ArrayList.Sort%2A>"},{"pos":[9090,9098],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Searching and Sorting<ept id=\"p1\">](../../c-runtime-library/searching-and-sorting.md)</ept><ph id=\"ph1\"> </ph>","pos":[9102,9176],"source":"[Searching and Sorting](../../c-runtime-library/searching-and-sorting.md) "},{"content":"<bpt id=\"p1\"> [</bpt>bsearch_s<ept id=\"p1\">](../../c-runtime-library/reference/bsearch-s.md)</ept><ph id=\"ph1\"> </ph>","pos":[9179,9240],"source":" [bsearch_s](../../c-runtime-library/reference/bsearch-s.md) "},{"content":"<bpt id=\"p1\"> [</bpt>_lsearch_s<ept id=\"p1\">](../../c-runtime-library/reference/lsearch-s.md)</ept><ph id=\"ph1\"> </ph>","pos":[9243,9305],"source":" [_lsearch_s](../../c-runtime-library/reference/lsearch-s.md) "},{"content":"<bpt id=\"p1\"> [</bpt>qsort<ept id=\"p1\">](../../c-runtime-library/reference/qsort.md)</ept>","pos":[9308,9360],"source":" [qsort](../../c-runtime-library/reference/qsort.md)"}],"content":"---\ntitle: \"qsort_s | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\napiname: \n  - \"qsort_s\"\napilocation: \n  - \"msvcrt.dll\"\n  - \"msvcr80.dll\"\n  - \"msvcr90.dll\"\n  - \"msvcr100.dll\"\n  - \"msvcr100_clr0400.dll\"\n  - \"msvcr110.dll\"\n  - \"msvcr110_clr0400.dll\"\n  - \"msvcr120.dll\"\n  - \"msvcr120_clr0400.dll\"\n  - \"ucrtbase.dll\"\n  - \"api-ms-win-crt-utility-l1-1-0.dll\"\napitype: \"DLLExport\"\nf1_keywords: \n  - \"qsort_s\"\ndev_langs: \n  - \"C++\"\n  - \"C\"\nhelpviewer_keywords: \n  - \"arrays [C++], sorting\"\n  - \"quick-sort algorithm\"\n  - \"qsort_s function\"\n  - \"sorting arrays\"\nms.assetid: 6ee817b0-4408-4355-a5d4-6605e419ab91\ncaps.latest.revision: 20\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# qsort_s\nPerforms a quick sort. A version of [qsort](../../c-runtime-library/reference/qsort.md) with security enhancements as described in [Security Features in the CRT](../../c-runtime-library/security-features-in-the-crt.md).  \n  \n## Syntax  \n  \n```  \nvoid qsort_s(  \n   void *base,  \n   size_t num,  \n   size_t width,  \n   int (__cdecl *compare )(void *, const void *, const void *),  \n   void * context  \n);  \n```  \n  \n#### Parameters  \n `base`  \n Start of target array.  \n  \n `num`  \n Array size in elements.  \n  \n `width`  \n Element size in bytes.  \n  \n `compare`  \n Comparison function. The first argument is the `context` pointer. The second argument is a pointer to the `key` for the search. The third argument is a pointer to the array element to be compared with `key`.  \n  \n `context`  \n A pointer to a context, which can be any object that the `compare` routine needs to access.  \n  \n## Remarks  \n The `qsort_s` function implements a quick-sort algorithm to sort an array of `num` elements, each of `width` bytes. The argument `base` is a pointer to the base of the array to be sorted. `qsort_s` overwrites this array with the sorted elements. The argument `compare` is a pointer to a user-supplied routine that compares two array elements and returns a value specifying their relationship. `qsort_s` calls the `compare` routine one or more times during the sort, passing pointers to two array elements on each call:  \n  \n```  \ncompare( context, (void *) & elem1, (void *) & elem2 );  \n```  \n  \n The routine must compare the elements and then return one of the following values:  \n  \n|Return value|Description|  \n|------------------|-----------------|  \n|< 0|`elem1` less than `elem2`|  \n|0|`elem1` equivalent to `elem2`|  \n|> 0|`elem1` greater than `elem2`|  \n  \n The array is sorted in increasing order, as defined by the comparison function. To sort an array in decreasing order, reverse the sense of \"greater than\" and \"less than\" in the comparison function.  \n  \n If invalid parameters are passed to the function, the invalid parameter handler is invoked, as described in [Parameter Validation](../../c-runtime-library/parameter-validation.md). If execution is allowed to continue, then the function returns and `errno` is set to `EINVAL`. For more information, see [errno, _doserrno, _sys_errlist, and _sys_nerr](../../c-runtime-library/errno-doserrno-sys-errlist-and-sys-nerr.md).  \n  \n### Error Conditions  \n  \n|key|base|compare|num|width|errno|  \n|---------|----------|-------------|---------|-----------|-----------|  \n|`NULL`|any|any|any|any|`EINVAL`|  \n|any|`NULL`|any|!= 0|any|`EINVAL`|  \n|any|any|any|any|<= 0|`EINVAL`|  \n|any|any|`NULL`|any|any|`EINVAL`|  \n  \n `qsort_s` has the same behavior as `qsort` but has the `context` parameter and sets `errno`. By passing a `context` parameter, comparison functions can use an object pointer to access object functionality or other information not accessible through an element pointer. The addition of the `context` parameter makes `qsort_s`more secure because `context` can be used to avoid reentrancy bugs introduced by using static variables to make shared information available to the `compare` function.  \n  \n## Requirements  \n  \n|Routine|Required header|  \n|-------------|---------------------|  \n|`qsort_s`|\\<stdlib.h> and \\<search.h>|  \n  \n For additional compatibility information, see [Compatibility](../../c-runtime-library/compatibility.md) in the Introduction.  \n  \n **Libraries:** All versions of the [CRT Library Features](../../c-runtime-library/crt-library-features.md).  \n  \n## Example  \n The following example demonstrates how to use the `context` parameter in the `qsort_s`function. The `context` parameter makes it easier to perform thread-safe sorts. Instead of using static variables that must be synchronized to ensure thread safety, pass a different `context` parameter in each sort. In this example, a locale object is used as the `context` parameter.  \n  \n```  \n// crt_qsort_s.cpp  \n// compile with: /EHsc /MT  \n#include <stdlib.h>  \n#include <stdio.h>  \n#include <search.h>  \n#include <process.h>  \n#include <locale.h>  \n#include <locale>  \n#include <windows.h>  \nusing namespace std;  \n  \n// The sort order is dependent on the code page.  Use 'chcp' at the  \n// command line to change the codepage.  When executing this application,  \n// the command prompt codepage must match the codepage used here:  \n  \n#define CODEPAGE_850  \n  \n#ifdef CODEPAGE_850  \n// Codepage 850 is the OEM codepage used by the command line,  \n// so \\x00e1 is the German Sharp S in that codepage and \\x00a4  \n// is the n tilde.  \n  \nchar *array1[] = { \"wei\\x00e1\", \"weis\", \"annehmen\", \"weizen\", \"Zeit\",  \n                   \"weit\" };  \nchar *array2[] = { \"Espa\\x00a4ol\", \"Espa\\x00a4\" \"a\", \"espantado\" };  \nchar *array3[] = { \"table\", \"tableux\", \"tablet\" };  \n  \n#define GERMAN_LOCALE \"German_Germany.850\"  \n#define SPANISH_LOCALE \"Spanish_Spain.850\"  \n#define ENGLISH_LOCALE \"English_US.850\"  \n  \n#endif  \n  \n#ifdef CODEPAGE_1252  \n   // If using codepage 1252 (ISO 8859-1, Latin-1), use \\x00df  \n   // for the German Sharp S and \\x001f for the n tilde.  \nchar *array1[] = { \"wei\\x00df\", \"weis\", \"annehmen\", \"weizen\", \"Zeit\",  \n                   \"weit\" };  \nchar *array2[] = { \"Espa\\x00f1ol\", \"Espa\\x00f1\" \"a\", \"espantado\" };  \nchar *array3[] = { \"table\", \"tableux\", \"tablet\" };  \n  \n#define GERMAN_LOCALE \"German_Germany.1252\"  \n#define SPANISH_LOCALE \"Spanish_Spain.1252\"  \n#define ENGLISH_LOCALE \"English_US.1252\"  \n  \n#endif  \n  \n// The context parameter lets you create a more generic compare.  \n// Without this parameter, you would have stored the locale in a  \n// static variable, thus making sort_array vulnerable to thread  \n// conflicts.  \n  \nint compare( void *pvlocale, const void *str1, const void *str2)  \n{  \n    char s1[256];  \n    char s2[256];  \n    strcpy_s(s1, 256, *(char**)str1);  \n    strcpy_s(s2, 256, *(char**)str2);  \n    _strlwr_s( s1, sizeof(s1) );  \n    _strlwr_s( s2, sizeof(s2) );  \n  \n    locale& loc = *( reinterpret_cast< locale * > ( pvlocale));  \n  \n    return use_facet< collate<char> >(loc).compare(s1,   \n       &s1[strlen(s1)], s2, &s2[strlen(s2)]);  \n  \n}  \n  \nvoid sort_array(char *array[], int num, locale &loc)  \n{  \n    qsort_s(array, num, sizeof(char*), compare, &loc);  \n}  \n  \nvoid print_array(char *a[], int c)  \n{  \n   for (int i = 0; i < c; i++)  \n     printf(\"%s \", a[i]);  \n   printf(\"\\n\");  \n  \n}  \n  \nvoid sort_german(void * Dummy)  \n{  \n   sort_array(array1, 6, locale(GERMAN_LOCALE));  \n}  \n  \nvoid sort_spanish(void * Dummy)  \n{     \n   sort_array(array2, 3, locale(SPANISH_LOCALE));       \n}  \n  \nvoid sort_english(void * Dummy)  \n{     \n   sort_array(array3, 3, locale(ENGLISH_LOCALE));     \n}  \n  \nint main( )  \n{  \n  \n   int i;  \n   HANDLE threads[3];  \n  \n   printf(\"Unsorted input:\\n\");  \n   print_array(array1, 6);  \n   print_array(array2, 3);  \n   print_array(array3, 3);  \n  \n   // Create several threads that perform sorts in different  \n   // languages at the same time.   \n  \n   threads[0] = reinterpret_cast<HANDLE>(  \n                 _beginthread( sort_german , 0, NULL));  \n   threads[1] = reinterpret_cast<HANDLE>(  \n                 _beginthread( sort_spanish, 0, NULL));  \n   threads[2] = reinterpret_cast<HANDLE>(  \n                 _beginthread( sort_english, 0, NULL));  \n  \n   for (i = 0; i < 3; i++)  \n   {  \n      if (threads[i] == reinterpret_cast<HANDLE>(-1))  \n      {  \n         printf(\"Error creating threads.\\n\");  \n         exit(1);  \n      }  \n   }  \n  \n   // Wait until all threads have terminated.  \n   WaitForMultipleObjects(3, threads, true, INFINITE);  \n  \n   printf(\"Sorted output: \\n\");  \n  \n   print_array(array1, 6);  \n   print_array(array2, 3);  \n   print_array(array3, 3);  \n  \n}  \n```  \n  \n## Sample Output  \n  \n```  \nUnsorted input:  \nweiß weis annehmen weizen Zeit weit   \nEspañol España espantado   \ntable tableux tablet   \nSorted output:   \nannehmen weiß weis weit weizen Zeit   \nEspaña Español espantado   \ntable tablet tableux  \n```  \n  \n## .NET Framework Equivalent  \n <xref:System.Collections.ArrayList.Sort%2A>  \n  \n## See Also  \n [Searching and Sorting](../../c-runtime-library/searching-and-sorting.md)   \n [bsearch_s](../../c-runtime-library/reference/bsearch-s.md)   \n [_lsearch_s](../../c-runtime-library/reference/lsearch-s.md)   \n [qsort](../../c-runtime-library/reference/qsort.md)"}