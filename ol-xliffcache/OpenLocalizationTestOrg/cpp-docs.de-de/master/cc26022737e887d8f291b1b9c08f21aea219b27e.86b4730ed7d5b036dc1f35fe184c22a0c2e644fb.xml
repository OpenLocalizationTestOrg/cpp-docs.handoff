{"nodes":[{"pos":[12,48],"content":"Scheduler Instances | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Scheduler Instances | Microsoft Docs","pos":[0,36]}]},{"content":"Scheduler Instances","pos":[576,595]},{"content":"This document describes the role of scheduler instances in the Concurrency Runtime and how to use the <bpt id=\"p1\">[</bpt>concurrency::Scheduler<ept id=\"p1\">](../../parallel/concrt/reference/scheduler-class.md)</ept> and <bpt id=\"p2\">[</bpt>concurrency::CurrentScheduler<ept id=\"p2\">](../../parallel/concrt/reference/currentscheduler-class.md)</ept> classes to create and manage scheduler instances.","pos":[596,919],"source":"This document describes the role of scheduler instances in the Concurrency Runtime and how to use the [concurrency::Scheduler](../../parallel/concrt/reference/scheduler-class.md) and [concurrency::CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) classes to create and manage scheduler instances."},{"content":"Scheduler instances are useful when you want to associate explicit scheduling policies with specific types of workloads.","pos":[920,1040]},{"content":"For example, you can create one scheduler instance to run some tasks at an elevated thread priority and use the default scheduler to run other tasks at the normal thread priority.","pos":[1041,1220]},{"pos":[1228,1707],"content":"[!TIP]\n The Concurrency Runtime provides a default scheduler, and therefore you are not required to create one in your application. Because the Task Scheduler helps you fine-tune the performance of your applications, we recommend that you start with the [Parallel Patterns Library (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) or the [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) if you are new to the Concurrency Runtime.","leadings":["","> "],"nodes":[{"content":" The Concurrency Runtime provides a default scheduler, and therefore you are not required to create one in your application. Because the Task Scheduler helps you fine-tune the performance of your applications, we recommend that you start with the [Parallel Patterns Library (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) or the [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) if you are new to the Concurrency Runtime.","pos":[7,477],"nodes":[{"content":"The Concurrency Runtime provides a default scheduler, and therefore you are not required to create one in your application.","pos":[1,124]},{"content":"Because the Task Scheduler helps you fine-tune the performance of your applications, we recommend that you start with the <bpt id=\"p1\">[</bpt>Parallel Patterns Library (PPL)<ept id=\"p1\">](../../parallel/concrt/parallel-patterns-library-ppl.md)</ept> or the <bpt id=\"p2\">[</bpt>Asynchronous Agents Library<ept id=\"p2\">](../../parallel/concrt/asynchronous-agents-library.md)</ept> if you are new to the Concurrency Runtime.","pos":[125,470],"source":" Because the Task Scheduler helps you fine-tune the performance of your applications, we recommend that you start with the [Parallel Patterns Library (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) or the [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) if you are new to the Concurrency Runtime."}]}]},{"pos":[1736,1744],"content":"Sections"},{"content":"The Scheduler and CurrentScheduler Classes","pos":[1755,1797]},{"content":"Creating a Scheduler Instance","pos":[1819,1848]},{"content":"Managing the Lifetime of a Scheduler Instance","pos":[1871,1916]},{"content":"Methods and Features","pos":[1939,1959]},{"content":"Example","pos":[1982,1989]},{"pos":[2033,2075],"content":"The Scheduler and CurrentScheduler Classes"},{"content":"The Task Scheduler enables applications to use one or more <bpt id=\"p1\">*</bpt>scheduler instances<ept id=\"p1\">*</ept> to schedule work.","pos":[2079,2177],"source":"The Task Scheduler enables applications to use one or more *scheduler instances* to schedule work."},{"content":"The <bpt id=\"p1\">[</bpt>concurrency::Scheduler<ept id=\"p1\">](../../parallel/concrt/reference/scheduler-class.md)</ept> class represents a scheduler instance and encapsulates the functionality that is related to scheduling tasks.","pos":[2178,2368],"source":" The [concurrency::Scheduler](../../parallel/concrt/reference/scheduler-class.md) class represents a scheduler instance and encapsulates the functionality that is related to scheduling tasks."},{"content":"A thread that is attached to a scheduler is known as an <bpt id=\"p1\">*</bpt>execution context<ept id=\"p1\">*</ept>, or just <bpt id=\"p2\">*</bpt>context<ept id=\"p2\">*</ept>.","pos":[2375,2470],"source":"A thread that is attached to a scheduler is known as an *execution context*, or just *context*."},{"content":"One scheduler can be active on the current context at any time.","pos":[2471,2534]},{"content":"The active scheduler is also known as the <bpt id=\"p1\">*</bpt>current scheduler<ept id=\"p1\">*</ept>.","pos":[2535,2597],"source":" The active scheduler is also known as the *current scheduler*."},{"content":"The Concurrency Runtime uses the <bpt id=\"p1\">[</bpt>concurrency::CurrentScheduler<ept id=\"p1\">](../../parallel/concrt/reference/currentscheduler-class.md)</ept> class to provide access to the current scheduler.","pos":[2598,2771],"source":" The Concurrency Runtime uses the [concurrency::CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) class to provide access to the current scheduler."},{"content":"The current scheduler for one context can differ from the current scheduler for another context.","pos":[2772,2868]},{"content":"The runtime does not provide a process-level representation of the current scheduler.","pos":[2869,2954]},{"content":"Typically, the <ph id=\"ph1\">`CurrentScheduler`</ph> class is used to access the current scheduler.","pos":[2961,3041],"source":"Typically, the `CurrentScheduler` class is used to access the current scheduler."},{"content":"The <ph id=\"ph1\">`Scheduler`</ph> class is useful when you need to manage a scheduler that is not the current one.","pos":[3042,3138],"source":" The `Scheduler` class is useful when you need to manage a scheduler that is not the current one."},{"content":"The following sections describe how to create and manage a scheduler instance.","pos":[3145,3223]},{"content":"For a complete example that illustrates these tasks, see <bpt id=\"p1\">[</bpt>How to: Manage a Scheduler Instance<ept id=\"p1\">](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)</ept>.","pos":[3224,3380],"source":" For a complete example that illustrates these tasks, see [How to: Manage a Scheduler Instance](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)."},{"pos":[3387,3400],"content":"[<bpt id=\"p1\">[</bpt>Top<ept id=\"p1\">](#top)</ept>]","source":"[[Top](#top)]"},{"pos":[3434,3463],"content":"Creating a Scheduler Instance"},{"pos":[3467,3525],"content":"There are these three ways to create a <ph id=\"ph1\">`Scheduler`</ph> object:","source":"There are these three ways to create a `Scheduler` object:"},{"content":"If no scheduler exists, the runtime creates a default scheduler for you when you use runtime functionality, for example, a parallel algorithm, to perform work.","pos":[3535,3694]},{"content":"The default scheduler becomes the current scheduler for the context that initiates the parallel work.","pos":[3695,3796]},{"pos":[3807,4014],"content":"The <bpt id=\"p1\">[</bpt>concurrency::CurrentScheduler::Create<ept id=\"p1\">](reference/currentscheduler-class.md#create)</ept> method creates a <ph id=\"ph1\">`Scheduler`</ph> object that uses a specific policy and associates that scheduler with the current context.","source":"The [concurrency::CurrentScheduler::Create](reference/currentscheduler-class.md#create) method creates a `Scheduler` object that uses a specific policy and associates that scheduler with the current context."},{"pos":[4024,4214],"content":"The <bpt id=\"p1\">[</bpt>concurrency::Scheduler::Create<ept id=\"p1\">](reference/scheduler-class.md#create)</ept> method creates a <ph id=\"ph1\">`Scheduler`</ph> object that uses a specific policy, but does not associate it with the current context.","source":"The [concurrency::Scheduler::Create](reference/scheduler-class.md#create) method creates a `Scheduler` object that uses a specific policy, but does not associate it with the current context."},{"content":"Allowing the runtime to create a default scheduler enables all concurrent tasks to share the same scheduler.","pos":[4222,4330]},{"content":"Typically, the functionality that is provided by the <bpt id=\"p1\">[</bpt>Parallel Patterns Library<ept id=\"p1\">](../../parallel/concrt/parallel-patterns-library-ppl.md)</ept> (PPL) or the <bpt id=\"p2\">[</bpt>Asynchronous Agents Library<ept id=\"p2\">](../../parallel/concrt/asynchronous-agents-library.md)</ept> is used to perform parallel work.","pos":[4331,4598],"source":" Typically, the functionality that is provided by the [Parallel Patterns Library](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL) or the [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) is used to perform parallel work."},{"content":"Therefore, you do not have to work directly with the scheduler to control its policy or lifetime.","pos":[4599,4696]},{"content":"When you use the PPL or the Agents Library, the runtime creates the default scheduler if it does not exist and makes it the current scheduler for each context.","pos":[4697,4856]},{"content":"When you create a scheduler and set it as the current scheduler, then the runtime uses that scheduler to schedule tasks.","pos":[4857,4977]},{"content":"Create additional scheduler instances only when you require a specific scheduling policy.","pos":[4978,5067]},{"content":"For more information about the policies that are associated with a scheduler, see <bpt id=\"p1\">[</bpt>Scheduler Policies<ept id=\"p1\">](../../parallel/concrt/scheduler-policies.md)</ept>.","pos":[5068,5216],"source":" For more information about the policies that are associated with a scheduler, see [Scheduler Policies](../../parallel/concrt/scheduler-policies.md)."},{"pos":[5223,5236],"content":"[<bpt id=\"p1\">[</bpt>Top<ept id=\"p1\">](#top)</ept>]","source":"[[Top](#top)]"},{"pos":[5270,5315],"content":"Managing the Lifetime of a Scheduler Instance"},{"pos":[5319,5414],"content":"The runtime uses a reference-counting mechanism to control the lifetime of <ph id=\"ph1\">`Scheduler`</ph> objects.","source":"The runtime uses a reference-counting mechanism to control the lifetime of `Scheduler` objects."},{"content":"When you use the <ph id=\"ph1\">`CurrentScheduler::Create`</ph> method or the <ph id=\"ph2\">`Scheduler::Create`</ph> method to create a <ph id=\"ph3\">`Scheduler`</ph> object, the runtime sets the initial reference count of that scheduler to one.","pos":[5422,5609],"source":"When you use the `CurrentScheduler::Create` method or the `Scheduler::Create` method to create a `Scheduler` object, the runtime sets the initial reference count of that scheduler to one."},{"content":"The runtime increments the reference count when you call the <bpt id=\"p1\">[</bpt>concurrency::Scheduler::Attach<ept id=\"p1\">](reference/scheduler-class.md#attach)</ept> method.","pos":[5610,5748],"source":" The runtime increments the reference count when you call the [concurrency::Scheduler::Attach](reference/scheduler-class.md#attach) method."},{"content":"The <ph id=\"ph1\">`Scheduler::Attach`</ph> method associates the <ph id=\"ph2\">`Scheduler`</ph> object together with the current context.","pos":[5749,5848],"source":" The `Scheduler::Attach` method associates the `Scheduler` object together with the current context."},{"content":"This makes it the current scheduler.","pos":[5849,5885]},{"content":"When you call the <ph id=\"ph1\">`CurrentScheduler::Create`</ph> method, the runtime both creates a <ph id=\"ph2\">`Scheduler`</ph> object and attaches it to the current context (and sets the reference count to one).","pos":[5886,6062],"source":" When you call the `CurrentScheduler::Create` method, the runtime both creates a `Scheduler` object and attaches it to the current context (and sets the reference count to one)."},{"content":"You can also use the <bpt id=\"p1\">[</bpt>concurrency::Scheduler::Reference<ept id=\"p1\">](reference/scheduler-class.md#reference)</ept> method to increment the reference count of a <ph id=\"ph1\">`Scheduler`</ph> object.","pos":[6063,6224],"source":" You can also use the [concurrency::Scheduler::Reference](reference/scheduler-class.md#reference) method to increment the reference count of a `Scheduler` object."},{"content":"The runtime decrements the reference count when you call the <bpt id=\"p1\">[</bpt>concurrency::CurrentScheduler::Detach<ept id=\"p1\">](reference/currentscheduler-class.md#detach)</ept> method to detach the current scheduler, or call the <bpt id=\"p2\">[</bpt>concurrency::Scheduler::Release<ept id=\"p2\">](reference/scheduler-class.md#release)</ept> method.","pos":[6231,6507],"source":"The runtime decrements the reference count when you call the [concurrency::CurrentScheduler::Detach](reference/currentscheduler-class.md#detach) method to detach the current scheduler, or call the [concurrency::Scheduler::Release](reference/scheduler-class.md#release) method."},{"content":"When the reference count reaches zero, the runtime destroys the <ph id=\"ph1\">`Scheduler`</ph> object after all scheduled tasks finish.","pos":[6508,6624],"source":" When the reference count reaches zero, the runtime destroys the `Scheduler` object after all scheduled tasks finish."},{"content":"A running task is allowed to increment the reference count of the current scheduler.","pos":[6625,6709]},{"content":"Therefore, if the reference count reaches zero and a task increments the reference count, the runtime does not destroy the <ph id=\"ph1\">`Scheduler`</ph> object until the reference count again reaches zero and all tasks finish.","pos":[6710,6918],"source":" Therefore, if the reference count reaches zero and a task increments the reference count, the runtime does not destroy the `Scheduler` object until the reference count again reaches zero and all tasks finish."},{"content":"The runtime maintains an internal stack of <ph id=\"ph1\">`Scheduler`</ph> objects for each context.","pos":[6926,7006],"source":"The runtime maintains an internal stack of `Scheduler` objects for each context."},{"content":"When you call the <ph id=\"ph1\">`Scheduler::Attach`</ph> or <ph id=\"ph2\">`CurrentScheduler::Create`</ph> method, the runtime pushes that <ph id=\"ph3\">`Scheduler`</ph> object onto the stack for the current context.","pos":[7007,7165],"source":" When you call the `Scheduler::Attach` or `CurrentScheduler::Create` method, the runtime pushes that `Scheduler` object onto the stack for the current context."},{"content":"This makes it the current scheduler.","pos":[7166,7202]},{"content":"When you call <ph id=\"ph1\">`CurrentScheduler::Detach`</ph>, the runtime pops the current scheduler from the stack for current context and sets the previous one as the current scheduler.","pos":[7203,7370],"source":" When you call `CurrentScheduler::Detach`, the runtime pops the current scheduler from the stack for current context and sets the previous one as the current scheduler."},{"content":"The runtime provides several ways to manage the lifetime of a scheduler instance.","pos":[7377,7458]},{"content":"The following table shows the appropriate method that releases or detaches the scheduler from the current context for each method that creates or attaches a scheduler to the current context.","pos":[7459,7649]},{"content":"Create or attach method","pos":[7656,7679]},{"content":"Release or detach method","pos":[7680,7704]},{"content":"Calling the inappropriate release or detach method produces unspecified behavior in the runtime.","pos":[7979,8075]},{"content":"When you use functionality, for example, the PPL, that causes the runtime to create the default scheduler for you, do not release or detach this scheduler.","pos":[8082,8237]},{"content":"The runtime manages the lifetime of any scheduler that it creates.","pos":[8238,8304]},{"content":"Because the runtime does not destroy a <ph id=\"ph1\">`Scheduler`</ph> object before all tasks have finished, you can use the <bpt id=\"p1\">[</bpt>concurrency::Scheduler::RegisterShutdownEvent<ept id=\"p1\">](reference/scheduler-class.md#registershutdownevent)</ept> method or the <bpt id=\"p2\">[</bpt>concurrency::CurrentScheduler::RegisterShutdownEvent<ept id=\"p2\">](reference/currentscheduler-class.md#registershutdownevent)</ept> method to receive a notification when a <ph id=\"ph2\">`Scheduler`</ph> object is destroyed.","pos":[8312,8718],"source":"Because the runtime does not destroy a `Scheduler` object before all tasks have finished, you can use the [concurrency::Scheduler::RegisterShutdownEvent](reference/scheduler-class.md#registershutdownevent) method or the [concurrency::CurrentScheduler::RegisterShutdownEvent](reference/currentscheduler-class.md#registershutdownevent) method to receive a notification when a `Scheduler` object is destroyed."},{"content":"This is useful when you must wait for every task that is scheduled by a <ph id=\"ph1\">`Scheduler`</ph> object to finish.","pos":[8719,8820],"source":" This is useful when you must wait for every task that is scheduled by a `Scheduler` object to finish."},{"pos":[8827,8840],"content":"[<bpt id=\"p1\">[</bpt>Top<ept id=\"p1\">](#top)</ept>]","source":"[[Top](#top)]"},{"pos":[8874,8894],"content":"Methods and Features"},{"pos":[8898,8994],"content":"This section summarizes the important methods of the <ph id=\"ph1\">`CurrentScheduler`</ph> and <ph id=\"ph2\">`Scheduler`</ph> classes.","source":"This section summarizes the important methods of the `CurrentScheduler` and `Scheduler` classes."},{"content":"Think of the <ph id=\"ph1\">`CurrentScheduler`</ph> class as a helper for creating a scheduler for use on the current context.","pos":[9001,9107],"source":"Think of the `CurrentScheduler` class as a helper for creating a scheduler for use on the current context."},{"content":"The <ph id=\"ph1\">`Scheduler`</ph> class lets you control a scheduler that belongs to another context.","pos":[9108,9191],"source":" The `Scheduler` class lets you control a scheduler that belongs to another context."},{"pos":[9198,9295],"content":"The following table shows the important methods that are defined by the <ph id=\"ph1\">`CurrentScheduler`</ph> class.","source":"The following table shows the important methods that are defined by the `CurrentScheduler` class."},{"content":"Method","pos":[9302,9308]},{"content":"Description","pos":[9309,9320]},{"content":"<bpt id=\"p1\">[</bpt>Create<ept id=\"p1\">](reference/currentscheduler-class.md#create)</ept>|Creates a <ph id=\"ph1\">`Scheduler`</ph> object that uses the specified policy and associates it with the current context.|","pos":[9361,9518],"source":"[Create](reference/currentscheduler-class.md#create)|Creates a `Scheduler` object that uses the specified policy and associates it with the current context.|"},{"content":"<bpt id=\"p1\">[</bpt>Get<ept id=\"p1\">](reference/currentscheduler-class.md#get)</ept>|Retrieves a pointer to the <ph id=\"ph1\">`Scheduler`</ph> object that is associated with the current context.","pos":[9522,9659],"source":"[Get](reference/currentscheduler-class.md#get)|Retrieves a pointer to the `Scheduler` object that is associated with the current context."},{"content":"This method does not increment the reference count of the <ph id=\"ph1\">`Scheduler`</ph> object.|","pos":[9660,9738],"source":" This method does not increment the reference count of the `Scheduler` object.|"},{"content":"<bpt id=\"p1\">[</bpt>Detach<ept id=\"p1\">](reference/currentscheduler-class.md#detach)</ept>|Detaches the current scheduler from the current context and sets the previous one as the current scheduler.|","pos":[9742,9903],"source":"[Detach](reference/currentscheduler-class.md#detach)|Detaches the current scheduler from the current context and sets the previous one as the current scheduler.|"},{"content":"<bpt id=\"p1\">[</bpt>RegisterShutdownEvent<ept id=\"p1\">](reference/currentscheduler-class.md#registershutdownevent)</ept>|Registers an event that the runtime sets when the current scheduler is destroyed.|","pos":[9907,10072],"source":"[RegisterShutdownEvent](reference/currentscheduler-class.md#registershutdownevent)|Registers an event that the runtime sets when the current scheduler is destroyed.|"},{"content":"<bpt id=\"p1\">[</bpt>CreateScheduleGroup<ept id=\"p1\">](reference/currentscheduler-class.md#createschedulegroup)</ept>|Creates a <bpt id=\"p2\">[</bpt>concurrency::ScheduleGroup<ept id=\"p2\">](../../parallel/concrt/reference/schedulegroup-class.md)</ept> object in the current scheduler.|","pos":[10076,10283],"source":"[CreateScheduleGroup](reference/currentscheduler-class.md#createschedulegroup)|Creates a [concurrency::ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) object in the current scheduler.|"},{"content":"<bpt id=\"p1\">[</bpt>ScheduleTask<ept id=\"p1\">](reference/currentscheduler-class.md#scheduletask)</ept>|Adds a lightweight task to the scheduling queue of the current scheduler.|","pos":[10287,10426],"source":"[ScheduleTask](reference/currentscheduler-class.md#scheduletask)|Adds a lightweight task to the scheduling queue of the current scheduler.|"},{"content":"<bpt id=\"p1\">[</bpt>GetPolicy<ept id=\"p1\">](reference/currentscheduler-class.md#getpolicy)</ept>|Retrieves a copy of the policy that is associated with the current scheduler.|","pos":[10430,10567],"source":"[GetPolicy](reference/currentscheduler-class.md#getpolicy)|Retrieves a copy of the policy that is associated with the current scheduler.|"},{"pos":[10574,10664],"content":"The following table shows the important methods that are defined by the <ph id=\"ph1\">`Scheduler`</ph> class.","source":"The following table shows the important methods that are defined by the `Scheduler` class."},{"content":"Method","pos":[10671,10677]},{"content":"Description","pos":[10678,10689]},{"content":"<bpt id=\"p1\">[</bpt>Create<ept id=\"p1\">](reference/scheduler-class.md#create)</ept>|Creates a <ph id=\"ph1\">`Scheduler`</ph> object that uses the specified policy.|","pos":[10730,10837],"source":"[Create](reference/scheduler-class.md#create)|Creates a `Scheduler` object that uses the specified policy.|"},{"content":"<bpt id=\"p1\">[</bpt>Attach<ept id=\"p1\">](reference/scheduler-class.md#attach)</ept>|Associates the <ph id=\"ph1\">`Scheduler`</ph> object together with the current context.|","pos":[10841,10956],"source":"[Attach](reference/scheduler-class.md#attach)|Associates the `Scheduler` object together with the current context.|"},{"content":"<bpt id=\"p1\">[</bpt>Reference<ept id=\"p1\">](reference/scheduler-class.md#reference)</ept>|Increments the reference counter of the <ph id=\"ph1\">`Scheduler`</ph> object.|","pos":[10960,11072],"source":"[Reference](reference/scheduler-class.md#reference)|Increments the reference counter of the `Scheduler` object.|"},{"content":"<bpt id=\"p1\">[</bpt>Release<ept id=\"p1\">](reference/scheduler-class.md#release)</ept>|Decrements the reference counter of the <ph id=\"ph1\">`Scheduler`</ph> object.|","pos":[11076,11184],"source":"[Release](reference/scheduler-class.md#release)|Decrements the reference counter of the `Scheduler` object.|"},{"content":"<bpt id=\"p1\">[</bpt>RegisterShutdownEvent<ept id=\"p1\">](reference/scheduler-class.md#registershutdownevent)</ept>|Registers an event that the runtime sets when the <ph id=\"ph1\">`Scheduler`</ph> object is destroyed.|","pos":[11188,11347],"source":"[RegisterShutdownEvent](reference/scheduler-class.md#registershutdownevent)|Registers an event that the runtime sets when the `Scheduler` object is destroyed.|"},{"content":"<bpt id=\"p1\">[</bpt>CreateScheduleGroup<ept id=\"p1\">](reference/scheduler-class.md#createschedulegroup)</ept>|Creates a <bpt id=\"p2\">[</bpt>concurrency::ScheduleGroup<ept id=\"p2\">](../../parallel/concrt/reference/schedulegroup-class.md)</ept> object in the <ph id=\"ph1\">`Scheduler`</ph> object.|","pos":[11351,11552],"source":"[CreateScheduleGroup](reference/scheduler-class.md#createschedulegroup)|Creates a [concurrency::ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) object in the `Scheduler` object.|"},{"content":"<bpt id=\"p1\">[</bpt>ScheduleTask<ept id=\"p1\">](reference/scheduler-class.md#scheduletask)</ept>|Schedules a lightweight task from the <ph id=\"ph1\">`Scheduler`</ph> object.|","pos":[11556,11672],"source":"[ScheduleTask](reference/scheduler-class.md#scheduletask)|Schedules a lightweight task from the `Scheduler` object.|"},{"content":"<bpt id=\"p1\">[</bpt>GetPolicy<ept id=\"p1\">](reference/scheduler-class.md#getpolicy)</ept>|Retrieves a copy of the policy that is associated with the <ph id=\"ph1\">`Scheduler`</ph> object.|","pos":[11676,11807],"source":"[GetPolicy](reference/scheduler-class.md#getpolicy)|Retrieves a copy of the policy that is associated with the `Scheduler` object.|"},{"content":"<bpt id=\"p1\">[</bpt>SetDefaultSchedulerPolicy<ept id=\"p1\">](reference/scheduler-class.md#setdefaultschedulerpolicy)</ept>|Sets the policy for the runtime to use when it creates the default scheduler.|","pos":[11811,11973],"source":"[SetDefaultSchedulerPolicy](reference/scheduler-class.md#setdefaultschedulerpolicy)|Sets the policy for the runtime to use when it creates the default scheduler.|"},{"content":"<bpt id=\"p1\">[</bpt>ResetDefaultSchedulerPolicy<ept id=\"p1\">](reference/scheduler-class.md#resetdefaultschedulerpolicy)</ept>|Restores the default policy to the one that was active before the call to <ph id=\"ph1\">`SetDefaultSchedulerPolicy`</ph>.","pos":[11977,12167],"source":"[ResetDefaultSchedulerPolicy](reference/scheduler-class.md#resetdefaultschedulerpolicy)|Restores the default policy to the one that was active before the call to `SetDefaultSchedulerPolicy`."},{"content":"If the default scheduler is created after this call, the runtime uses default policy settings to create the scheduler.|","pos":[12168,12287]},{"pos":[12295,12308],"content":"[<bpt id=\"p1\">[</bpt>Top<ept id=\"p1\">](#top)</ept>]","source":"[[Top](#top)]"},{"pos":[12341,12348],"content":"Example"},{"pos":[12352,12524],"content":"For basic examples of how to create and manage a scheduler instance, see <bpt id=\"p1\">[</bpt>How to: Manage a Scheduler Instance<ept id=\"p1\">](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)</ept>.","source":"For basic examples of how to create and manage a scheduler instance, see [How to: Manage a Scheduler Instance](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)."},{"content":"See Also","pos":[12533,12541]},{"content":"Task Scheduler","pos":[12546,12560]},{"content":"How to: Manage a Scheduler Instance","pos":[12628,12663]},{"content":"Scheduler Policies","pos":[12731,12749]},{"content":"Schedule Groups","pos":[12801,12816]}],"content":"---\ntitle: \"Scheduler Instances | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"scheduler instances\"\nms.assetid: 4819365f-ef99-49cc-963e-50a2a35a8d6b\ncaps.latest.revision: 7\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Scheduler Instances\nThis document describes the role of scheduler instances in the Concurrency Runtime and how to use the [concurrency::Scheduler](../../parallel/concrt/reference/scheduler-class.md) and [concurrency::CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) classes to create and manage scheduler instances. Scheduler instances are useful when you want to associate explicit scheduling policies with specific types of workloads. For example, you can create one scheduler instance to run some tasks at an elevated thread priority and use the default scheduler to run other tasks at the normal thread priority.  \n  \n> [!TIP]\n>  The Concurrency Runtime provides a default scheduler, and therefore you are not required to create one in your application. Because the Task Scheduler helps you fine-tune the performance of your applications, we recommend that you start with the [Parallel Patterns Library (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) or the [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) if you are new to the Concurrency Runtime.  \n  \n##  <a name=\"top\"></a> Sections  \n  \n-   [The Scheduler and CurrentScheduler Classes](#classes)  \n  \n-   [Creating a Scheduler Instance](#creating)  \n  \n-   [Managing the Lifetime of a Scheduler Instance](#managing)  \n  \n-   [Methods and Features](#features)  \n  \n-   [Example](#example)  \n  \n##  <a name=\"classes\"></a> The Scheduler and CurrentScheduler Classes  \n The Task Scheduler enables applications to use one or more *scheduler instances* to schedule work. The [concurrency::Scheduler](../../parallel/concrt/reference/scheduler-class.md) class represents a scheduler instance and encapsulates the functionality that is related to scheduling tasks.  \n  \n A thread that is attached to a scheduler is known as an *execution context*, or just *context*. One scheduler can be active on the current context at any time. The active scheduler is also known as the *current scheduler*. The Concurrency Runtime uses the [concurrency::CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) class to provide access to the current scheduler. The current scheduler for one context can differ from the current scheduler for another context. The runtime does not provide a process-level representation of the current scheduler.  \n  \n Typically, the `CurrentScheduler` class is used to access the current scheduler. The `Scheduler` class is useful when you need to manage a scheduler that is not the current one.  \n  \n The following sections describe how to create and manage a scheduler instance. For a complete example that illustrates these tasks, see [How to: Manage a Scheduler Instance](../../parallel/concrt/how-to-manage-a-scheduler-instance.md).  \n  \n [[Top](#top)]  \n  \n##  <a name=\"creating\"></a> Creating a Scheduler Instance  \n There are these three ways to create a `Scheduler` object:  \n  \n-   If no scheduler exists, the runtime creates a default scheduler for you when you use runtime functionality, for example, a parallel algorithm, to perform work. The default scheduler becomes the current scheduler for the context that initiates the parallel work.  \n  \n\n-   The [concurrency::CurrentScheduler::Create](reference/currentscheduler-class.md#create) method creates a `Scheduler` object that uses a specific policy and associates that scheduler with the current context.  \n  \n-   The [concurrency::Scheduler::Create](reference/scheduler-class.md#create) method creates a `Scheduler` object that uses a specific policy, but does not associate it with the current context.  \n\n  \n Allowing the runtime to create a default scheduler enables all concurrent tasks to share the same scheduler. Typically, the functionality that is provided by the [Parallel Patterns Library](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL) or the [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) is used to perform parallel work. Therefore, you do not have to work directly with the scheduler to control its policy or lifetime. When you use the PPL or the Agents Library, the runtime creates the default scheduler if it does not exist and makes it the current scheduler for each context. When you create a scheduler and set it as the current scheduler, then the runtime uses that scheduler to schedule tasks. Create additional scheduler instances only when you require a specific scheduling policy. For more information about the policies that are associated with a scheduler, see [Scheduler Policies](../../parallel/concrt/scheduler-policies.md).  \n  \n [[Top](#top)]  \n  \n##  <a name=\"managing\"></a> Managing the Lifetime of a Scheduler Instance  \n The runtime uses a reference-counting mechanism to control the lifetime of `Scheduler` objects.  \n  \n\n When you use the `CurrentScheduler::Create` method or the `Scheduler::Create` method to create a `Scheduler` object, the runtime sets the initial reference count of that scheduler to one. The runtime increments the reference count when you call the [concurrency::Scheduler::Attach](reference/scheduler-class.md#attach) method. The `Scheduler::Attach` method associates the `Scheduler` object together with the current context. This makes it the current scheduler. When you call the `CurrentScheduler::Create` method, the runtime both creates a `Scheduler` object and attaches it to the current context (and sets the reference count to one). You can also use the [concurrency::Scheduler::Reference](reference/scheduler-class.md#reference) method to increment the reference count of a `Scheduler` object.  \n  \n The runtime decrements the reference count when you call the [concurrency::CurrentScheduler::Detach](reference/currentscheduler-class.md#detach) method to detach the current scheduler, or call the [concurrency::Scheduler::Release](reference/scheduler-class.md#release) method. When the reference count reaches zero, the runtime destroys the `Scheduler` object after all scheduled tasks finish. A running task is allowed to increment the reference count of the current scheduler. Therefore, if the reference count reaches zero and a task increments the reference count, the runtime does not destroy the `Scheduler` object until the reference count again reaches zero and all tasks finish.  \n\n  \n The runtime maintains an internal stack of `Scheduler` objects for each context. When you call the `Scheduler::Attach` or `CurrentScheduler::Create` method, the runtime pushes that `Scheduler` object onto the stack for the current context. This makes it the current scheduler. When you call `CurrentScheduler::Detach`, the runtime pops the current scheduler from the stack for current context and sets the previous one as the current scheduler.  \n  \n The runtime provides several ways to manage the lifetime of a scheduler instance. The following table shows the appropriate method that releases or detaches the scheduler from the current context for each method that creates or attaches a scheduler to the current context.  \n  \n|Create or attach method|Release or detach method|  \n|-----------------------------|------------------------------|  \n|`CurrentScheduler::Create`|`CurrentScheduler::Detach`|  \n|`Scheduler::Create`|`Scheduler::Release`|  \n|`Scheduler::Attach`|`CurrentScheduler::Detach`|  \n|`Scheduler::Reference`|`Scheduler::Release`|  \n  \n Calling the inappropriate release or detach method produces unspecified behavior in the runtime.  \n  \n When you use functionality, for example, the PPL, that causes the runtime to create the default scheduler for you, do not release or detach this scheduler. The runtime manages the lifetime of any scheduler that it creates.  \n  \n\n Because the runtime does not destroy a `Scheduler` object before all tasks have finished, you can use the [concurrency::Scheduler::RegisterShutdownEvent](reference/scheduler-class.md#registershutdownevent) method or the [concurrency::CurrentScheduler::RegisterShutdownEvent](reference/currentscheduler-class.md#registershutdownevent) method to receive a notification when a `Scheduler` object is destroyed. This is useful when you must wait for every task that is scheduled by a `Scheduler` object to finish.  \n  \n [[Top](#top)]  \n  \n##  <a name=\"features\"></a> Methods and Features  \n This section summarizes the important methods of the `CurrentScheduler` and `Scheduler` classes.  \n  \n Think of the `CurrentScheduler` class as a helper for creating a scheduler for use on the current context. The `Scheduler` class lets you control a scheduler that belongs to another context.  \n  \n The following table shows the important methods that are defined by the `CurrentScheduler` class.  \n  \n|Method|Description|  \n|------------|-----------------|  \n\n|[Create](reference/currentscheduler-class.md#create)|Creates a `Scheduler` object that uses the specified policy and associates it with the current context.|  \n|[Get](reference/currentscheduler-class.md#get)|Retrieves a pointer to the `Scheduler` object that is associated with the current context. This method does not increment the reference count of the `Scheduler` object.|  \n|[Detach](reference/currentscheduler-class.md#detach)|Detaches the current scheduler from the current context and sets the previous one as the current scheduler.|  \n|[RegisterShutdownEvent](reference/currentscheduler-class.md#registershutdownevent)|Registers an event that the runtime sets when the current scheduler is destroyed.|  \n|[CreateScheduleGroup](reference/currentscheduler-class.md#createschedulegroup)|Creates a [concurrency::ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) object in the current scheduler.|  \n|[ScheduleTask](reference/currentscheduler-class.md#scheduletask)|Adds a lightweight task to the scheduling queue of the current scheduler.|  \n|[GetPolicy](reference/currentscheduler-class.md#getpolicy)|Retrieves a copy of the policy that is associated with the current scheduler.|  \n  \n The following table shows the important methods that are defined by the `Scheduler` class.  \n  \n|Method|Description|  \n|------------|-----------------|  \n\n|[Create](reference/scheduler-class.md#create)|Creates a `Scheduler` object that uses the specified policy.|  \n|[Attach](reference/scheduler-class.md#attach)|Associates the `Scheduler` object together with the current context.|  \n|[Reference](reference/scheduler-class.md#reference)|Increments the reference counter of the `Scheduler` object.|  \n|[Release](reference/scheduler-class.md#release)|Decrements the reference counter of the `Scheduler` object.|  \n|[RegisterShutdownEvent](reference/scheduler-class.md#registershutdownevent)|Registers an event that the runtime sets when the `Scheduler` object is destroyed.|  \n|[CreateScheduleGroup](reference/scheduler-class.md#createschedulegroup)|Creates a [concurrency::ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) object in the `Scheduler` object.|  \n|[ScheduleTask](reference/scheduler-class.md#scheduletask)|Schedules a lightweight task from the `Scheduler` object.|  \n|[GetPolicy](reference/scheduler-class.md#getpolicy)|Retrieves a copy of the policy that is associated with the `Scheduler` object.|  \n|[SetDefaultSchedulerPolicy](reference/scheduler-class.md#setdefaultschedulerpolicy)|Sets the policy for the runtime to use when it creates the default scheduler.|  \n|[ResetDefaultSchedulerPolicy](reference/scheduler-class.md#resetdefaultschedulerpolicy)|Restores the default policy to the one that was active before the call to `SetDefaultSchedulerPolicy`. If the default scheduler is created after this call, the runtime uses default policy settings to create the scheduler.|  \n\n  \n [[Top](#top)]  \n  \n##  <a name=\"example\"></a> Example  \n For basic examples of how to create and manage a scheduler instance, see [How to: Manage a Scheduler Instance](../../parallel/concrt/how-to-manage-a-scheduler-instance.md).  \n  \n## See Also  \n [Task Scheduler](../../parallel/concrt/task-scheduler-concurrency-runtime.md)   \n [How to: Manage a Scheduler Instance](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)   \n [Scheduler Policies](../../parallel/concrt/scheduler-policies.md)   \n [Schedule Groups](../../parallel/concrt/schedule-groups.md)\n\n"}