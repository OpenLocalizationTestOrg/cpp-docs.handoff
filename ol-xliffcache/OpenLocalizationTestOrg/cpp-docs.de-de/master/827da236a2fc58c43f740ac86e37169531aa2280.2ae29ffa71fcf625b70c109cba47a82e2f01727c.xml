{"nodes":[{"pos":[12,42],"content":"Fetching Data | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Fetching Data | Microsoft Docs","pos":[0,30]}]},{"content":"Fetching Data","pos":[669,682]},{"content":"After you open the data source, session, and rowset objects, you can fetch data.","pos":[683,763]},{"content":"Depending on the type of accessor you are using, you might need to bind columns.","pos":[764,844]},{"content":"To fetch data","pos":[854,867]},{"pos":[877,932],"content":"Open the rowset using the appropriate <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> command.","source":"Open the rowset using the appropriate **Open** command."},{"content":"If you are using <ph id=\"ph1\">`CManualAccessor`</ph>, bind the output columns if you have not already done so.","pos":[942,1034],"source":"If you are using `CManualAccessor`, bind the output columns if you have not already done so."},{"content":"To bind the columns, call <ph id=\"ph1\">`GetColumnInfo`</ph>, and then create an accessor with the bindings, as shown in the following example:","pos":[1035,1159],"source":" To bind the columns, call `GetColumnInfo`, and then create an accessor with the bindings, as shown in the following example:"},{"content":"Write a <ph id=\"ph1\">`while`</ph> loop to retrieve the data.","pos":[1821,1863],"source":"Write a `while` loop to retrieve the data."},{"content":"In the loop, call <ph id=\"ph1\">`MoveNext`</ph> to advance the cursor and test the return value against S_OK, as shown in the following example:","pos":[1864,1989],"source":" In the loop, call `MoveNext` to advance the cursor and test the return value against S_OK, as shown in the following example:"},{"pos":[2185,2265],"content":"Within the <ph id=\"ph1\">`while`</ph> loop, you can fetch the data according to your accessor type.","source":"Within the `while` loop, you can fetch the data according to your accessor type."},{"content":"If you use the <bpt id=\"p1\">[</bpt>CAccessor<ept id=\"p1\">](../../data/oledb/caccessor-class.md)</ept> class, you should have a user record that contains data members.","pos":[2279,2407],"source":"If you use the [CAccessor](../../data/oledb/caccessor-class.md) class, you should have a user record that contains data members."},{"content":"You can access your data using those data members, as shown in the following example:","pos":[2408,2493]},{"content":"If you use the <ph id=\"ph1\">`CDynamicAccessor`</ph> or <ph id=\"ph2\">`CDynamicParameterAccessor`</ph> class, you can fetch data by using the accessing functions <ph id=\"ph3\">`GetValue`</ph> and <ph id=\"ph4\">`GetColumn`</ph>, as shown in the following example.","pos":[2810,2996],"source":"If you use the `CDynamicAccessor` or `CDynamicParameterAccessor` class, you can fetch data by using the accessing functions `GetValue` and `GetColumn`, as shown in the following example."},{"content":"If you want to determine the type of data you are using, use <ph id=\"ph1\">`GetType`</ph>.","pos":[2997,3068],"source":" If you want to determine the type of data you are using, use `GetType`."},{"pos":[3422,3572],"content":"If you use <ph id=\"ph1\">`CManualAccessor`</ph>, you must specify your own data members, bind them yourself, and access them directly, as shown in the following example:","source":"If you use `CManualAccessor`, you must specify your own data members, bind them yourself, and access them directly, as shown in the following example:"},{"content":"See Also","pos":[3817,3825]},{"content":"Working with OLE DB Consumer Templates","pos":[3830,3868]}],"content":"---\ntitle: \"Fetching Data | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"data [C++], fetching\"\n  - \"rowsets [C++], fetching\"\n  - \"fetching\"\n  - \"OLE DB consumer templates [C++], fetching data\"\nms.assetid: b07f747f-9855-4f27-a03d-b1d5b10fa284\ncaps.latest.revision: 8\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Fetching Data\nAfter you open the data source, session, and rowset objects, you can fetch data. Depending on the type of accessor you are using, you might need to bind columns.  \n  \n### To fetch data  \n  \n1.  Open the rowset using the appropriate **Open** command.  \n  \n2.  If you are using `CManualAccessor`, bind the output columns if you have not already done so. To bind the columns, call `GetColumnInfo`, and then create an accessor with the bindings, as shown in the following example:  \n  \n    ```  \n    // From the DBViewer Sample CDBTreeView::OnQueryEdit  \n    // Get the column information  \n    ULONG ulColumns       = 0;  \n    DBCOLUMNINFO* pColumnInfo  = NULL;  \n    LPOLESTR pStrings      = NULL;  \n    if (rs.GetColumnInfo(&ulColumns, &pColumnInfo, &pStrings) != S_OK)  \n        ThrowMyOLEDBException(rs.m_pRowset, IID_IColumnsInfo);  \n    struct MYBIND* pBind = new MYBIND[ulColumns];  \n    rs.CreateAccessor(ulColumns, &pBind[0], sizeof(MYBIND)*ulColumns);  \n    for (ULONG l=0; l<ulColumns; l++)  \n    rs.AddBindEntry(l+1, DBTYPE_STR, sizeof(TCHAR)*40, &pBind[l].szValue, NULL, &pBind[l].dwStatus);  \n    rs.Bind();  \n    ```  \n  \n3.  Write a `while` loop to retrieve the data. In the loop, call `MoveNext` to advance the cursor and test the return value against S_OK, as shown in the following example:  \n  \n    ```  \n    while (rs.MoveNext() == S_OK)  \n    {  \n        // Add code to fetch data here  \n        // If you are not using an auto accessor, call rs.GetData()  \n    }  \n    ```  \n  \n4.  Within the `while` loop, you can fetch the data according to your accessor type.  \n  \n    -   If you use the [CAccessor](../../data/oledb/caccessor-class.md) class, you should have a user record that contains data members. You can access your data using those data members, as shown in the following example:  \n  \n        ```  \n        while (rs.MoveNext() == S_OK)  \n        {  \n            // Use the data members directly. In this case, m_nFooID  \n            // is declared in a user record that derives from  \n            // CAccessor  \n            wsprintf_s(\"%d\", rs.m_nFooID);   \n        }  \n        ```  \n  \n    -   If you use the `CDynamicAccessor` or `CDynamicParameterAccessor` class, you can fetch data by using the accessing functions `GetValue` and `GetColumn`, as shown in the following example. If you want to determine the type of data you are using, use `GetType`.  \n  \n        ```  \n        while (rs.MoveNext() == S_OK)  \n        {  \n            // Use the dynamic accessor functions to retrieve your data.  \n  \n            ULONG ulColumns = rs.GetColumnCount();  \n            for (ULONG i=0; i<ulColumns; i++)  \n            {  \n                rs.GetValue(i);  \n            }  \n        }  \n        ```  \n  \n    -   If you use `CManualAccessor`, you must specify your own data members, bind them yourself, and access them directly, as shown in the following example:  \n  \n        ```  \n        while (rs.MoveNext() == S_OK)  \n        {  \n            // Use the data members you specified in the calls to  \n            // AddBindEntry.  \n  \n            wsprintf_s(\"%s\", szFoo);  \n        }  \n        ```  \n  \n## See Also  \n [Working with OLE DB Consumer Templates](../../data/oledb/working-with-ole-db-consumer-templates.md)"}