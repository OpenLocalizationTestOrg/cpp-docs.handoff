{"nodes":[{"pos":[12,107],"content":"Avoiding Exceptions on CLR Shutdown When Consuming COM Objects Built with -clr | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Avoiding Exceptions on CLR Shutdown When Consuming COM Objects Built with -clr | Microsoft Docs","pos":[0,95]}]},{"content":"Avoiding Exceptions on CLR Shutdown When Consuming COM Objects Built with /clr","pos":[902,980]},{"content":"Once the common language runtime (CLR) enters shutdown mode, native functions have limited access to CLR services.","pos":[981,1095]},{"content":"When attempting to call Release on a COM object compiled with <bpt id=\"p1\">**</bpt>/clr<ept id=\"p1\">**</ept>, the CLR transitions to native code and then transitions back into managed code to service the IUnknown::Release call (which is defined in managed code).","pos":[1096,1320],"source":" When attempting to call Release on a COM object compiled with **/clr**, the CLR transitions to native code and then transitions back into managed code to service the IUnknown::Release call (which is defined in managed code)."},{"content":"The CLR prevents the call back into managed code since it is in shutdown mode.","pos":[1321,1399]},{"content":"To resolve this, ensure that destructors called from Release methods only contain native code.","pos":[1406,1500]},{"content":"See Also","pos":[1509,1517]},{"content":"Mixed (Native and Managed) Assemblies","pos":[1522,1559]}],"content":"---\ntitle: \"Avoiding Exceptions on CLR Shutdown When Consuming COM Objects Built with -clr | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"interop [C++], CLR shutdown exceptions\"\n  - \"/clr compiler option [C++], CLR shutdown exceptions\"\n  - \"mixed assemblies [C++], CLR shutdown exceptions\"\n  - \"/clr compiler option [C++], COM objects\"\n  - \"interoperability [C++], CLR shutdown exceptions\"\n  - \"CLR shutdown exceptions [C++]\"\nms.assetid: 41249d83-4b51-4e46-866f-27f475f2498c\ncaps.latest.revision: 4\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Avoiding Exceptions on CLR Shutdown When Consuming COM Objects Built with /clr\nOnce the common language runtime (CLR) enters shutdown mode, native functions have limited access to CLR services. When attempting to call Release on a COM object compiled with **/clr**, the CLR transitions to native code and then transitions back into managed code to service the IUnknown::Release call (which is defined in managed code). The CLR prevents the call back into managed code since it is in shutdown mode.  \n  \n To resolve this, ensure that destructors called from Release methods only contain native code.  \n  \n## See Also  \n [Mixed (Native and Managed) Assemblies](../dotnet/mixed-native-and-managed-assemblies.md)"}