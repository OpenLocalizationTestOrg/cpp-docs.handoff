{"nodes":[{"pos":[12,61],"content":"Compiler Warning (level 2) C4412 | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Compiler Warning (level 2) C4412 | Microsoft Docs","pos":[0,49]}]},{"pos":[609,641],"content":"Compiler Warning (level 2) C4412","linkify":"Compiler Warning (level 2) C4412","nodes":[{"content":"Compiler Warning (level 2) C4412","pos":[0,32]}]},{"content":"'function' : function signature contains type 'type'; C++ objects are unsafe to pass between pure code and mixed or native.","pos":[642,765]},{"content":"The compiler detected a potentially unsafe situation that could result in a runtime error: a call is being made from a <bpt id=\"p1\">**</bpt>/clr:pure<ept id=\"p1\">**</ept> compiland to a function that was imported via dllimport and the function signature contains an unsafe type.","pos":[772,1012],"source":"The compiler detected a potentially unsafe situation that could result in a runtime error: a call is being made from a **/clr:pure** compiland to a function that was imported via dllimport and the function signature contains an unsafe type."},{"content":"A type is unsafe if it contains a member function or has a data member that is an unsafe type or an indirection to an unsafe type.","pos":[1013,1143]},{"content":"This is unsafe because of the difference in the default calling conventions between pure and native code (or mixed native and managed).","pos":[1150,1285]},{"content":"When importing (via <ph id=\"ph1\">`dllimport`</ph>) a function into a <bpt id=\"p1\">**</bpt>/clr:pure<ept id=\"p1\">**</ept> compiland, ensure that the declarations of each type in the signature are identical to those in the compiland that exports the function (being especially careful about differences in implicit calling conventions).","pos":[1286,1564],"source":" When importing (via `dllimport`) a function into a **/clr:pure** compiland, ensure that the declarations of each type in the signature are identical to those in the compiland that exports the function (being especially careful about differences in implicit calling conventions)."},{"content":"A virtual member function is especially prone to give unexpected results.","pos":[1571,1644]},{"content":"However, even a non-virtual function should be tested to ensure that you get the correct results.","pos":[1646,1743]},{"content":"If you are sure that you are getting the correct results, you can ignore this warning.","pos":[1744,1830]},{"pos":[1837,1973],"content":"For more information on <bpt id=\"p1\">**</bpt>/clr:pure<ept id=\"p1\">**</ept>, see <bpt id=\"p2\">[</bpt>How to: Migrate to /clr:pure (C++/CLI)<ept id=\"p2\">](../../dotnet/how-to-migrate-to-clr-pure-cpp-cli.md)</ept>.","source":"For more information on **/clr:pure**, see [How to: Migrate to /clr:pure (C++/CLI)](../../dotnet/how-to-migrate-to-clr-pure-cpp-cli.md)."},{"content":"C4412 is off by default.","pos":[1980,2004]},{"content":"See <bpt id=\"p1\">[</bpt>Compiler Warnings That Are Off by Default<ept id=\"p1\">](../../preprocessor/compiler-warnings-that-are-off-by-default.md)</ept> and <bpt id=\"p2\">[</bpt>dllexport, dllimport<ept id=\"p2\">](../../cpp/dllexport-dllimport.md)</ept> for more information.","pos":[2005,2200],"source":" See [Compiler Warnings That Are Off by Default](../../preprocessor/compiler-warnings-that-are-off-by-default.md) and [dllexport, dllimport](../../cpp/dllexport-dllimport.md) for more information."},{"content":"To resolve this warning, remove all functions from the type.","pos":[2207,2267]},{"pos":[2276,2283],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following sample generates C4412.","pos":[2287,2324]},{"pos":[2758,2765],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following sample is a header file that declares two types.","pos":[2769,2831]},{"content":"The <ph id=\"ph1\">`Unsafe`</ph> type is unsafe because it has a member function.","pos":[2832,2893],"source":" The `Unsafe` type is unsafe because it has a member function."},{"pos":[3233,3240],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This sample exports functions with the types defined in the header file.","pos":[3244,3316]},{"pos":[3594,3601],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The default calling convention in a <bpt id=\"p1\">**</bpt>/clr:pure<ept id=\"p1\">**</ept> compilation is different from a native compilation.","pos":[3605,3706],"source":"The default calling convention in a **/clr:pure** compilation is different from a native compilation."},{"content":"When C4412.h is included, <ph id=\"ph1\">`Test`</ph> will be default to <ph id=\"ph2\">`__clrcall`</ph>.","pos":[3708,3772],"source":"  When C4412.h is included, `Test` will be default to `__clrcall`."},{"content":"If you compile and run this program (do not use <bpt id=\"p1\">**</bpt>/c<ept id=\"p1\">**</ept>), the program will throw an exception.","pos":[3773,3866],"source":" If you compile and run this program (do not use **/c**), the program will throw an exception."},{"content":"The following sample generates C4412.","pos":[3873,3910]}],"content":"---\ntitle: \"Compiler Warning (level 2) C4412 | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"error-reference\"\nf1_keywords: \n  - \"C4412\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"C4412\"\nms.assetid: f28dc531-1a98-497b-a366-0a13e1bc81c7\ncaps.latest.revision: 9\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Compiler Warning (level 2) C4412\n'function' : function signature contains type 'type'; C++ objects are unsafe to pass between pure code and mixed or native.  \n  \n The compiler detected a potentially unsafe situation that could result in a runtime error: a call is being made from a **/clr:pure** compiland to a function that was imported via dllimport and the function signature contains an unsafe type. A type is unsafe if it contains a member function or has a data member that is an unsafe type or an indirection to an unsafe type.  \n  \n This is unsafe because of the difference in the default calling conventions between pure and native code (or mixed native and managed). When importing (via `dllimport`) a function into a **/clr:pure** compiland, ensure that the declarations of each type in the signature are identical to those in the compiland that exports the function (being especially careful about differences in implicit calling conventions).  \n  \n A virtual member function is especially prone to give unexpected results.  However, even a non-virtual function should be tested to ensure that you get the correct results. If you are sure that you are getting the correct results, you can ignore this warning.  \n  \n For more information on **/clr:pure**, see [How to: Migrate to /clr:pure (C++/CLI)](../../dotnet/how-to-migrate-to-clr-pure-cpp-cli.md).  \n  \n C4412 is off by default. See [Compiler Warnings That Are Off by Default](../../preprocessor/compiler-warnings-that-are-off-by-default.md) and [dllexport, dllimport](../../cpp/dllexport-dllimport.md) for more information.  \n  \n To resolve this warning, remove all functions from the type.  \n  \n## Example  \n The following sample generates C4412.  \n  \n```  \n// C4412.cpp  \n// compile with: /c /W2 /clr:pure  \n#pragma warning (default : 4412)  \n  \nstruct Unsafe {  \n   virtual void __cdecl Test();  \n};  \n  \nstruct Safe {  \n   int i;  \n};  \n  \n__declspec(dllimport) Unsafe * __cdecl func();  \n__declspec(dllimport) Safe * __cdecl func2();  \n  \nint main() {  \n   Unsafe *pUnsafe = func();   // C4412  \n   // pUnsafe->Test();  \n  \n   Safe *pSafe = func2();   // OK  \n}  \n```  \n  \n## Example  \n The following sample is a header file that declares two types. The `Unsafe` type is unsafe because it has a member function.  \n  \n```  \n// C4412.h  \nstruct Unsafe {  \n   // will be __clrcall if #included in pure compilation  \n   // defaults to __cdecl in native or mixed mode compilation  \n   virtual void Test(int * pi);  \n  \n   // try the following line instead  \n   // virtual void __cdecl Test(int * pi);  \n};  \n  \nstruct Safe {  \n   int i;  \n};  \n```  \n  \n## Example  \n This sample exports functions with the types defined in the header file.  \n  \n```  \n// C4412_2.cpp  \n// compile with: /LD  \n#include \"C4412.h\"  \n  \nvoid Unsafe::Test(int * pi) {  \n   *pi++;  \n}  \n  \n__declspec(dllexport) Unsafe * __cdecl func() { return new Unsafe; }  \n__declspec(dllexport) Safe * __cdecl func2() { return new Safe; }  \n```  \n  \n## Example  \n The default calling convention in a **/clr:pure** compilation is different from a native compilation.  When C4412.h is included, `Test` will be default to `__clrcall`. If you compile and run this program (do not use **/c**), the program will throw an exception.  \n  \n The following sample generates C4412.  \n  \n```  \n// C4412_3.cpp  \n// compile with: /W2 /clr:pure /c /link C4412_2.lib  \n#pragma warning (default : 4412)  \n#include \"C4412.h\"  \n  \n__declspec(dllimport) Unsafe * __cdecl func();  \n__declspec(dllimport) Safe * __cdecl func2();  \n  \nint main() {  \n   int n = 7;  \n   Unsafe *pUnsafe = func();   // C4412  \n   pUnsafe->Test(&n);  \n  \n   Safe *pSafe = func2();   // OK  \n}  \n```"}