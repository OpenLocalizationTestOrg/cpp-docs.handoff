{"nodes":[{"pos":[12,62],"content":"MFC ActiveX Controls: Using Fonts | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"MFC ActiveX Controls: Using Fonts | Microsoft Docs","pos":[0,50]}]},{"content":"MFC ActiveX Controls: Using Fonts","pos":[999,1032]},{"content":"If your ActiveX control displays text, you can allow the control user to change the text appearance by changing a font property.","pos":[1033,1161]},{"content":"Font properties are implemented as font objects and can be one of two types: stock or custom.","pos":[1162,1255]},{"content":"Stock Font properties are preimplemented font properties that you can add using the Add Property Wizard.","pos":[1256,1360]},{"content":"Custom Font properties are not preimplemented and the control developer determines the property's behavior and usage.","pos":[1361,1478]},{"content":"This article covers the following topics:","pos":[1485,1526]},{"content":"Using the Stock Font property","pos":[1537,1566]},{"content":"Using Custom Font Properties in Your Control","pos":[1616,1660]},{"pos":[1766,1795],"content":"Using the Stock Font Property"},{"content":"Stock Font properties are preimplemented by the class <bpt id=\"p1\">[</bpt>COleControl<ept id=\"p1\">](../mfc/reference/colecontrol-class.md)</ept>.","pos":[1799,1906],"source":"Stock Font properties are preimplemented by the class [COleControl](../mfc/reference/colecontrol-class.md)."},{"content":"In addition, a standard Font property page is also available, allowing the user to change various attributes of the font object, such as its name, size, and style.","pos":[1907,2070]},{"content":"Access the font object through the <bpt id=\"p1\">[</bpt>GetFont<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__getfont)</ept>, <bpt id=\"p2\">[</bpt>SetFont<ept id=\"p2\">](../mfc/reference/colecontrol-class.md#colecontrol__setfont)</ept>, and <bpt id=\"p3\">[</bpt>InternalGetFont<ept id=\"p3\">](../mfc/reference/colecontrol-class.md#colecontrol__internalgetfont)</ept> functions of <ph id=\"ph1\">`COleControl`</ph>.","pos":[2077,2371],"source":"Access the font object through the [GetFont](../mfc/reference/colecontrol-class.md#colecontrol__getfont), [SetFont](../mfc/reference/colecontrol-class.md#colecontrol__setfont), and [InternalGetFont](../mfc/reference/colecontrol-class.md#colecontrol__internalgetfont) functions of `COleControl`."},{"content":"The control user will access the font object via the <ph id=\"ph1\">`GetFont`</ph> and <ph id=\"ph2\">`SetFont`</ph> functions in the same manner as any other Get/Set property.","pos":[2372,2508],"source":" The control user will access the font object via the `GetFont` and `SetFont` functions in the same manner as any other Get/Set property."},{"content":"When access to the font object is required from within a control, use the <ph id=\"ph1\">`InternalGetFont`</ph> function.","pos":[2509,2610],"source":" When access to the font object is required from within a control, use the `InternalGetFont` function."},{"content":"As discussed in <bpt id=\"p1\">[</bpt>MFC ActiveX Controls: Properties<ept id=\"p1\">](../mfc/mfc-activex-controls-properties.md)</ept>, adding stock properties is easy with the <bpt id=\"p2\">[</bpt>Add Property Wizard<ept id=\"p2\">](../ide/names-add-property-wizard.md)</ept>.","pos":[2617,2812],"source":"As discussed in [MFC ActiveX Controls: Properties](../mfc/mfc-activex-controls-properties.md), adding stock properties is easy with the [Add Property Wizard](../ide/names-add-property-wizard.md)."},{"content":"You choose the Font property, and the Add Property Wizard automatically inserts the stock Font entry into the control's dispatch map.","pos":[2813,2946]},{"content":"To add the stock Font property using the Add Property Wizard","pos":[2957,3017]},{"content":"Load your control's project.","pos":[3027,3055]},{"content":"In Class View, expand the library node of your control.","pos":[3065,3120]},{"content":"Right-click the interface node for your control (the second node of the library node) to open the shortcut menu.","pos":[3130,3242]},{"pos":[3252,3322],"content":"From the shortcut menu, click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Add Property<ept id=\"p2\">**</ept>.","source":"From the shortcut menu, click **Add** and then click **Add Property**."},{"content":"This opens the Add Property Wizard.","pos":[3333,3368]},{"pos":[3378,3423],"content":"In the <bpt id=\"p1\">**</bpt>Property Name<ept id=\"p1\">**</ept> box, click <bpt id=\"p2\">**</bpt>Font<ept id=\"p2\">**</ept>.","source":"In the **Property Name** box, click **Font**."},{"pos":[3433,3450],"content":"Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>.","source":"Click **Finish**."},{"content":"The Add Property Wizard adds the following line to the control's dispatch map, located in the control class implementation file:","pos":[3457,3585]},{"pos":[3603,3619],"content":"NVC_MFC_AxFont#1"},{"content":"In addition, the Add Property Wizard adds the following line to the control .IDL file:","pos":[3691,3777]},{"pos":[3795,3811],"content":"NVC_MFC_AxFont#2"},{"content":"The stock Caption property is an example of a text property that can be drawn using the stock Font property information.","pos":[3883,4003]},{"content":"Adding the stock Caption property to the control uses steps similar to those used for the stock Font property.","pos":[4004,4114]},{"content":"To add the stock Caption property using the Add Property Wizard","pos":[4125,4188]},{"content":"Load your control's project.","pos":[4198,4226]},{"content":"In Class View, expand the library node of your control.","pos":[4236,4291]},{"content":"Right-click the interface node for your control (the second node of the library node) to open the shortcut menu.","pos":[4301,4413]},{"pos":[4423,4493],"content":"From the shortcut menu, click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Add Property<ept id=\"p2\">**</ept>.","source":"From the shortcut menu, click **Add** and then click **Add Property**."},{"content":"This opens the Add Property Wizard.","pos":[4504,4539]},{"pos":[4549,4597],"content":"In the <bpt id=\"p1\">**</bpt>Property Name<ept id=\"p1\">**</ept> box, click <bpt id=\"p2\">**</bpt>Caption<ept id=\"p2\">**</ept>.","source":"In the **Property Name** box, click **Caption**."},{"pos":[4607,4624],"content":"Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>.","source":"Click **Finish**."},{"content":"The Add Property Wizard adds the following line to the control's dispatch map, located in the control class implementation file:","pos":[4631,4759]},{"pos":[4777,4793],"content":"NVC_MFC_AxFont#3"},{"pos":[4919,4948],"content":"Modifying the OnDraw Function"},{"content":"The default implementation of <ph id=\"ph1\">`OnDraw`</ph> uses the Windows system font for all text displayed in the control.","pos":[4952,5058],"source":"The default implementation of `OnDraw` uses the Windows system font for all text displayed in the control."},{"content":"This means that you must modify the <ph id=\"ph1\">`OnDraw`</ph> code by selecting the font object into the device context.","pos":[5059,5162],"source":" This means that you must modify the `OnDraw` code by selecting the font object into the device context."},{"content":"To do this, call <bpt id=\"p1\">[</bpt>COleControl::SelectStockFont<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__selectstockfont)</ept> and pass the control's device context, as shown in the following example:","pos":[5163,5352],"source":" To do this, call [COleControl::SelectStockFont](../mfc/reference/colecontrol-class.md#colecontrol__selectstockfont) and pass the control's device context, as shown in the following example:"},{"pos":[5370,5386],"content":"NVC_MFC_AxFont#4"},{"pos":[5458,5629],"content":"After the <ph id=\"ph1\">`OnDraw`</ph> function has been modified to use the font object, any text within the control is displayed with characteristics from the control's stock Font property.","source":"After the `OnDraw` function has been modified to use the font object, any text within the control is displayed with characteristics from the control's stock Font property."},{"pos":[5705,5749],"content":"Using Custom Font Properties in Your Control"},{"content":"In addition to the stock Font property, the ActiveX control can have custom Font properties.","pos":[5753,5845]},{"content":"To add a custom font property you must:","pos":[5846,5885]},{"content":"Use the Add Property Wizard to implement the custom Font property.","pos":[5895,5961]},{"pos":[5971,6041],"content":"<bpt id=\"p1\">[</bpt>Processing font notifications<ept id=\"p1\">](#_core_processing_font_notifications)</ept>.","source":"[Processing font notifications](#_core_processing_font_notifications)."},{"pos":[6051,6155],"content":"<bpt id=\"p1\">[</bpt>Implementing a new font notification interface<ept id=\"p1\">](#_core_implementing_a_new_font_notification_interface)</ept>.","source":"[Implementing a new font notification interface](#_core_implementing_a_new_font_notification_interface)."},{"pos":[6223,6258],"content":"Implementing a Custom Font Property"},{"content":"To implement a custom Font property, you use the Add Property Wizard to add the property and then make some modifications to the code.","pos":[6262,6396]},{"content":"The following sections describe how to add the custom <ph id=\"ph1\">`HeadingFont`</ph> property to the Sample control.","pos":[6397,6496],"source":" The following sections describe how to add the custom `HeadingFont` property to the Sample control."},{"content":"To add the custom Font property using the Add Property Wizard","pos":[6508,6569]},{"content":"Load your control's project.","pos":[6579,6607]},{"content":"In Class View, expand the library node of your control.","pos":[6617,6672]},{"content":"Right-click the interface node for your control (the second node of the library node) to open the shortcut menu.","pos":[6682,6794]},{"pos":[6804,6874],"content":"From the shortcut menu, click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Add Property<ept id=\"p2\">**</ept>.","source":"From the shortcut menu, click **Add** and then click **Add Property**."},{"content":"This opens the Add Property Wizard.","pos":[6885,6920]},{"content":"In the <bpt id=\"p1\">**</bpt>Property Name<ept id=\"p1\">**</ept> box, type a name for the property.","pos":[6930,6989],"source":"In the **Property Name** box, type a name for the property."},{"content":"For this example, use <bpt id=\"p1\">**</bpt>HeadingFont<ept id=\"p1\">**</ept>.","pos":[6990,7028],"source":" For this example, use **HeadingFont**."},{"pos":[7038,7093],"content":"For <bpt id=\"p1\">**</bpt>Implementation Type<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Get/Set Methods<ept id=\"p2\">**</ept>.","source":"For **Implementation Type**, click **Get/Set Methods**."},{"pos":[7103,7180],"content":"In the <bpt id=\"p1\">**</bpt>Property Type<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">**</bpt>IDispatch<ph id=\"ph1\">\\*</ph><ept id=\"p2\">**</ept> for the property's type.","source":"In the **Property Type** box, select **IDispatch\\*** for the property's type."},{"pos":[7190,7207],"content":"Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>.","source":"Click **Finish**."},{"content":"The Add Property Wizard creates the code to add the <ph id=\"ph1\">`HeadingFont`</ph> custom property to the <ph id=\"ph2\">`CSampleCtrl`</ph> class and the SAMPLE.IDL file.","pos":[7214,7347],"source":"The Add Property Wizard creates the code to add the `HeadingFont` custom property to the `CSampleCtrl` class and the SAMPLE.IDL file."},{"content":"Because <ph id=\"ph1\">`HeadingFont`</ph> is a Get/Set property type, the Add Property Wizard modifies the <ph id=\"ph2\">`CSampleCtrl`</ph> class's dispatch map to include a <ph id=\"ph3\">`DISP_PROPERTY_EX_ID`</ph><bpt id=\"p1\">[</bpt>DISP_PROPERTY_EX<ept id=\"p1\">](../mfc/reference/dispatch-maps.md#disp_property_ex)</ept> macro entry:","pos":[7348,7587],"source":" Because `HeadingFont` is a Get/Set property type, the Add Property Wizard modifies the `CSampleCtrl` class's dispatch map to include a `DISP_PROPERTY_EX_ID`[DISP_PROPERTY_EX](../mfc/reference/dispatch-maps.md#disp_property_ex) macro entry:"},{"pos":[7605,7621],"content":"NVC_MFC_AxFont#5"},{"content":"The <ph id=\"ph1\">`DISP_PROPERTY_EX`</ph> macro associates the <ph id=\"ph2\">`HeadingFont`</ph> property name with its corresponding <ph id=\"ph3\">`CSampleCtrl`</ph> class Get and Set methods, <ph id=\"ph4\">`GetHeadingFont`</ph> and <ph id=\"ph5\">`SetHeadingFont`</ph>.","pos":[7693,7867],"source":"The `DISP_PROPERTY_EX` macro associates the `HeadingFont` property name with its corresponding `CSampleCtrl` class Get and Set methods, `GetHeadingFont` and `SetHeadingFont`."},{"content":"The type of the property value is also specified; in this case, <bpt id=\"p1\">**</bpt>VT_FONT<ept id=\"p1\">**</ept>.","pos":[7868,7944],"source":" The type of the property value is also specified; in this case, **VT_FONT**."},{"pos":[7951,8163],"content":"The Add Property Wizard also adds a declaration in the control header file (.H) for the <ph id=\"ph1\">`GetHeadingFont`</ph> and <ph id=\"ph2\">`SetHeadingFont`</ph> functions and adds their function templates in the control implementation file (.CPP):","source":"The Add Property Wizard also adds a declaration in the control header file (.H) for the `GetHeadingFont` and `SetHeadingFont` functions and adds their function templates in the control implementation file (.CPP):"},{"pos":[8181,8197],"content":"NVC_MFC_AxFont#6"},{"pos":[8269,8383],"content":"Finally, the Add Property Wizard modifies the control .IDL file by adding an entry for the <ph id=\"ph1\">`HeadingFont`</ph> property:","source":"Finally, the Add Property Wizard modifies the control .IDL file by adding an entry for the `HeadingFont` property:"},{"pos":[8401,8417],"content":"NVC_MFC_AxFont#7"},{"content":"Modifications to the Control Code","pos":[8492,8525]},{"pos":[8529,8704],"content":"Now that you have added the <ph id=\"ph1\">`HeadingFont`</ph> property to the control, you must make some changes to the control header and implementation files to fully support the new property.","source":"Now that you have added the `HeadingFont` property to the control, you must make some changes to the control header and implementation files to fully support the new property."},{"content":"In the control header file (.H), add the following declaration of a protected member variable:","pos":[8711,8805]},{"pos":[8823,8839],"content":"NVC_MFC_AxFont#8"},{"content":"In the control implementation file (.CPP), do the following:","pos":[8909,8969]},{"pos":[8979,9033],"content":"Initialize <ph id=\"ph1\">`m_fontHeading`</ph> in the control constructor.","source":"Initialize `m_fontHeading` in the control constructor."},{"pos":[9055,9071],"content":"NVC_MFC_AxFont#9"},{"pos":[9146,9228],"content":"Declare a static <bpt id=\"p1\">**</bpt>FONTDESC<ept id=\"p1\">**</ept> structure containing default attributes of the font.","source":"Declare a static **FONTDESC** structure containing default attributes of the font."},{"pos":[9250,9267],"content":"NVC_MFC_AxFont#10"},{"content":"In the control <ph id=\"ph1\">`DoPropExchange`</ph> member function, add a call to the <ph id=\"ph2\">`PX_Font`</ph> function.","pos":[9343,9429],"source":"In the control `DoPropExchange` member function, add a call to the `PX_Font` function."},{"content":"This provides initialization and persistence for your custom Font property.","pos":[9430,9505]},{"pos":[9527,9544],"content":"NVC_MFC_AxFont#11"},{"pos":[9620,9685],"content":"Finish implementing the control <ph id=\"ph1\">`GetHeadingFont`</ph> member function.","source":"Finish implementing the control `GetHeadingFont` member function."},{"pos":[9707,9724],"content":"NVC_MFC_AxFont#12"},{"pos":[9800,9865],"content":"Finish implementing the control <ph id=\"ph1\">`SetHeadingFont`</ph> member function.","source":"Finish implementing the control `SetHeadingFont` member function."},{"pos":[9887,9904],"content":"NVC_MFC_AxFont#13"},{"pos":[9980,10082],"content":"Modify the control <ph id=\"ph1\">`OnDraw`</ph> member function to define a variable to hold the previously selected font.","source":"Modify the control `OnDraw` member function to define a variable to hold the previously selected font."},{"pos":[10104,10121],"content":"NVC_MFC_AxFont#14"},{"pos":[10197,10352],"content":"Modify the control <ph id=\"ph1\">`OnDraw`</ph> member function to select the custom font into the device context by adding the following line wherever the font is to be used.","source":"Modify the control `OnDraw` member function to select the custom font into the device context by adding the following line wherever the font is to be used."},{"pos":[10374,10391],"content":"NVC_MFC_AxFont#15"},{"pos":[10467,10626],"content":"Modify the control <ph id=\"ph1\">`OnDraw`</ph> member function to select the previous font back into the device context by adding the following line after the font has been used.","source":"Modify the control `OnDraw` member function to select the previous font back into the device context by adding the following line after the font has been used."},{"pos":[10648,10665],"content":"NVC_MFC_AxFont#16"},{"content":"After the custom Font property has been implemented, the standard Font property page should be implemented, allowing control users to change the control's current font.","pos":[10738,10906]},{"content":"To add the property page ID for the standard Font property page, insert the following line after the <ph id=\"ph1\">`BEGIN_PROPPAGEIDS`</ph> macro:","pos":[10907,11034],"source":" To add the property page ID for the standard Font property page, insert the following line after the `BEGIN_PROPPAGEIDS` macro:"},{"pos":[11052,11069],"content":"NVC_MFC_AxFont#17"},{"content":"You must also increment the count parameter of your <ph id=\"ph1\">`BEGIN_PROPPAGEIDS`</ph> macro by one.","pos":[11142,11227],"source":"You must also increment the count parameter of your `BEGIN_PROPPAGEIDS` macro by one."},{"content":"The following line illustrates this:","pos":[11228,11264]},{"pos":[11282,11299],"content":"NVC_MFC_AxFont#18"},{"content":"After these changes have been made, rebuild the entire project to incorporate the additional functionality.","pos":[11372,11479]},{"pos":[11541,11570],"content":"Processing Font Notifications"},{"content":"In most cases the control needs to know when the characteristics of the font object have been modified.","pos":[11574,11677]},{"content":"Each font object is capable of providing notifications when it changes by calling a member function of the <bpt id=\"p1\">**</bpt>IFontNotification<ept id=\"p1\">**</ept> interface, implemented by <ph id=\"ph1\">`COleControl`</ph>.","pos":[11678,11847],"source":" Each font object is capable of providing notifications when it changes by calling a member function of the **IFontNotification** interface, implemented by `COleControl`."},{"content":"If the control uses the stock Font property, its notifications are handled by the <ph id=\"ph1\">`OnFontChanged`</ph> member function of <ph id=\"ph2\">`COleControl`</ph>.","pos":[11854,11985],"source":"If the control uses the stock Font property, its notifications are handled by the `OnFontChanged` member function of `COleControl`."},{"content":"When you add custom font properties, you can have them use the same implementation.","pos":[11986,12069]},{"content":"In the example in the previous section, this was accomplished by passing &amp;<bpt id=\"p1\">**</bpt>m_xFontNotification<ept id=\"p1\">**</ept> when initializing the <bpt id=\"p2\">**</bpt>m_fontHeading<ept id=\"p2\">**</ept> member variable.","pos":[12070,12224],"source":" In the example in the previous section, this was accomplished by passing &**m_xFontNotification** when initializing the **m_fontHeading** member variable."},{"content":"Implementing multiple font object interfaces","pos":[12233,12277]},{"content":"Implementing Multiple Font Object Interfaces","pos":[12317,12361]},{"content":"The solid lines in the figure above show that both font objects are using the same implementation of <bpt id=\"p1\">**</bpt>IFontNotification<ept id=\"p1\">**</ept>.","pos":[12368,12491],"source":"The solid lines in the figure above show that both font objects are using the same implementation of **IFontNotification**."},{"content":"This could cause problems if you wanted to distinguish which font changed.","pos":[12492,12566]},{"content":"One way to distinguish between the control's font object notifications is to create a separate implementation of the <bpt id=\"p1\">**</bpt>IFontNotification<ept id=\"p1\">**</ept> interface for each font object in the control.","pos":[12573,12758],"source":"One way to distinguish between the control's font object notifications is to create a separate implementation of the **IFontNotification** interface for each font object in the control."},{"content":"This technique allows you to optimize your drawing code by updating only the string, or strings, that use the recently modified font.","pos":[12759,12892]},{"content":"The following sections demonstrate the steps necessary to implement separate notification interfaces for a second Font property.","pos":[12893,13021]},{"content":"The second font property is assumed to be the <ph id=\"ph1\">`HeadingFont`</ph> property that was added in the previous section.","pos":[13022,13130],"source":" The second font property is assumed to be the `HeadingFont` property that was added in the previous section."},{"pos":[13209,13255],"content":"Implementing a New Font Notification Interface"},{"content":"To distinguish between the notifications of two or more fonts, a new notification interface must be implemented for each font used in the control.","pos":[13259,13405]},{"content":"The following sections describe how to implement a new font notification interface by modifying the control header and implementation files.","pos":[13406,13546]},{"content":"Additions to the Header File","pos":[13556,13584]},{"content":"In the control header file (.H), add the following lines to the class declaration:","pos":[13588,13670]},{"pos":[13688,13705],"content":"NVC_MFC_AxFont#19"},{"content":"This creates an implementation of the <ph id=\"ph1\">`IPropertyNotifySink`</ph> interface called <ph id=\"ph2\">`HeadingFontNotify`</ph>.","pos":[13776,13873],"source":"This creates an implementation of the `IPropertyNotifySink` interface called `HeadingFontNotify`."},{"content":"This new interface contains a method called <ph id=\"ph1\">`OnChanged`</ph>.","pos":[13874,13930],"source":" This new interface contains a method called `OnChanged`."},{"content":"Additions to the Implementation File","pos":[13940,13976]},{"content":"In the code that initializes the heading font (in the control constructor), change <ph id=\"ph1\">`&amp;m_xFontNotification`</ph> to <ph id=\"ph2\">`&amp;m_xHeadingFontNotify`</ph>.","pos":[13980,14113],"source":"In the code that initializes the heading font (in the control constructor), change `&m_xFontNotification` to `&m_xHeadingFontNotify`."},{"content":"Then add the following code:","pos":[14114,14142]},{"pos":[14160,14177],"content":"NVC_MFC_AxFont#20"},{"content":"The <ph id=\"ph1\">`AddRef`</ph> and <ph id=\"ph2\">`Release`</ph> methods in the <ph id=\"ph3\">`IPropertyNotifySink`</ph> interface keep track of the reference count for the ActiveX control object.","pos":[14250,14389],"source":"The `AddRef` and `Release` methods in the `IPropertyNotifySink` interface keep track of the reference count for the ActiveX control object."},{"content":"When the control obtains access to interface pointer, the control calls <ph id=\"ph1\">`AddRef`</ph> to increment the reference count.","pos":[14390,14504],"source":" When the control obtains access to interface pointer, the control calls `AddRef` to increment the reference count."},{"content":"When the control is finished with the pointer, it calls <ph id=\"ph1\">`Release`</ph>, in much the same way that <bpt id=\"p1\">**</bpt>GlobalFree<ept id=\"p1\">**</ept> might be called to free a global memory block.","pos":[14505,14659],"source":" When the control is finished with the pointer, it calls `Release`, in much the same way that **GlobalFree** might be called to free a global memory block."},{"content":"When the reference count for this interface goes to zero, the interface implementation can be freed.","pos":[14660,14760]},{"content":"In this example, the <ph id=\"ph1\">`QueryInterface`</ph> function returns a pointer to a <ph id=\"ph2\">`IPropertyNotifySink`</ph> interface on a particular object.","pos":[14761,14886],"source":" In this example, the `QueryInterface` function returns a pointer to a `IPropertyNotifySink` interface on a particular object."},{"content":"This function allows an ActiveX control to query an object to determine what interfaces it supports.","pos":[14887,14987]},{"content":"After these changes have been made to your project, rebuild the project and use Test Container to test the interface.","pos":[14994,15111]},{"content":"See <bpt id=\"p1\">[</bpt>Testing Properties and Events with Test Container<ept id=\"p1\">](../mfc/testing-properties-and-events-with-test-container.md)</ept> for information on how to access the test container.","pos":[15112,15281],"source":" See [Testing Properties and Events with Test Container](../mfc/testing-properties-and-events-with-test-container.md) for information on how to access the test container."},{"content":"See Also","pos":[15290,15298]},{"content":"MFC ActiveX Controls","pos":[15303,15323]},{"content":"MFC ActiveX Controls: Using Pictures in an ActiveX Control","pos":[15362,15420]},{"content":"MFC ActiveX Controls: Using Stock Property Pages","pos":[15496,15544]}],"content":"---\ntitle: \"MFC ActiveX Controls: Using Fonts | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"OnFontChanged\"\n  - \"HeadingFont\"\n  - \"InternalFont\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"notifications, MFC ActiveX controls fonts\"\n  - \"OnDraw method, MFC ActiveX controls\"\n  - \"InternalFont method\"\n  - \"SetFont method\"\n  - \"OnFontChanged method\"\n  - \"IPropertyNotifySink class\"\n  - \"MFC ActiveX controls, fonts\"\n  - \"Stock Font property\"\n  - \"HeadingFont property\"\n  - \"GetFont method\"\n  - \"SelectStockFont method\"\n  - \"fonts, ActiveX controls\"\nms.assetid: 7c51d602-3f5a-481d-84d1-a5d8a3a71761\ncaps.latest.revision: 12\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# MFC ActiveX Controls: Using Fonts\nIf your ActiveX control displays text, you can allow the control user to change the text appearance by changing a font property. Font properties are implemented as font objects and can be one of two types: stock or custom. Stock Font properties are preimplemented font properties that you can add using the Add Property Wizard. Custom Font properties are not preimplemented and the control developer determines the property's behavior and usage.  \n  \n This article covers the following topics:  \n  \n-   [Using the Stock Font property](#_core_using_the_stock_font_property)  \n  \n-   [Using Custom Font Properties in Your Control](#_core_implementing_a_custom_font_property)  \n  \n##  <a name=\"_core_using_the_stock_font_property\"></a> Using the Stock Font Property  \n Stock Font properties are preimplemented by the class [COleControl](../mfc/reference/colecontrol-class.md). In addition, a standard Font property page is also available, allowing the user to change various attributes of the font object, such as its name, size, and style.  \n  \n Access the font object through the [GetFont](../mfc/reference/colecontrol-class.md#colecontrol__getfont), [SetFont](../mfc/reference/colecontrol-class.md#colecontrol__setfont), and [InternalGetFont](../mfc/reference/colecontrol-class.md#colecontrol__internalgetfont) functions of `COleControl`. The control user will access the font object via the `GetFont` and `SetFont` functions in the same manner as any other Get/Set property. When access to the font object is required from within a control, use the `InternalGetFont` function.  \n  \n As discussed in [MFC ActiveX Controls: Properties](../mfc/mfc-activex-controls-properties.md), adding stock properties is easy with the [Add Property Wizard](../ide/names-add-property-wizard.md). You choose the Font property, and the Add Property Wizard automatically inserts the stock Font entry into the control's dispatch map.  \n  \n#### To add the stock Font property using the Add Property Wizard  \n  \n1.  Load your control's project.  \n  \n2.  In Class View, expand the library node of your control.  \n  \n3.  Right-click the interface node for your control (the second node of the library node) to open the shortcut menu.  \n  \n4.  From the shortcut menu, click **Add** and then click **Add Property**.  \n  \n     This opens the Add Property Wizard.  \n  \n5.  In the **Property Name** box, click **Font**.  \n  \n6.  Click **Finish**.  \n  \n The Add Property Wizard adds the following line to the control's dispatch map, located in the control class implementation file:  \n  \n [!code-cpp[NVC_MFC_AxFont#1](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_1.cpp)]  \n  \n In addition, the Add Property Wizard adds the following line to the control .IDL file:  \n  \n [!code-cpp[NVC_MFC_AxFont#2](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_2.idl)]  \n  \n The stock Caption property is an example of a text property that can be drawn using the stock Font property information. Adding the stock Caption property to the control uses steps similar to those used for the stock Font property.  \n  \n#### To add the stock Caption property using the Add Property Wizard  \n  \n1.  Load your control's project.  \n  \n2.  In Class View, expand the library node of your control.  \n  \n3.  Right-click the interface node for your control (the second node of the library node) to open the shortcut menu.  \n  \n4.  From the shortcut menu, click **Add** and then click **Add Property**.  \n  \n     This opens the Add Property Wizard.  \n  \n5.  In the **Property Name** box, click **Caption**.  \n  \n6.  Click **Finish**.  \n  \n The Add Property Wizard adds the following line to the control's dispatch map, located in the control class implementation file:  \n  \n [!code-cpp[NVC_MFC_AxFont#3](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_3.cpp)]  \n  \n##  <a name=\"_core_modifying_the_ondraw_function\"></a> Modifying the OnDraw Function  \n The default implementation of `OnDraw` uses the Windows system font for all text displayed in the control. This means that you must modify the `OnDraw` code by selecting the font object into the device context. To do this, call [COleControl::SelectStockFont](../mfc/reference/colecontrol-class.md#colecontrol__selectstockfont) and pass the control's device context, as shown in the following example:  \n  \n [!code-cpp[NVC_MFC_AxFont#4](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_4.cpp)]  \n  \n After the `OnDraw` function has been modified to use the font object, any text within the control is displayed with characteristics from the control's stock Font property.  \n  \n##  <a name=\"_core_using_custom_font_properties_in_your_control\"></a> Using Custom Font Properties in Your Control  \n In addition to the stock Font property, the ActiveX control can have custom Font properties. To add a custom font property you must:  \n  \n-   Use the Add Property Wizard to implement the custom Font property.  \n  \n-   [Processing font notifications](#_core_processing_font_notifications).  \n  \n-   [Implementing a new font notification interface](#_core_implementing_a_new_font_notification_interface).  \n  \n###  <a name=\"_core_implementing_a_custom_font_property\"></a> Implementing a Custom Font Property  \n To implement a custom Font property, you use the Add Property Wizard to add the property and then make some modifications to the code. The following sections describe how to add the custom `HeadingFont` property to the Sample control.  \n  \n##### To add the custom Font property using the Add Property Wizard  \n  \n1.  Load your control's project.  \n  \n2.  In Class View, expand the library node of your control.  \n  \n3.  Right-click the interface node for your control (the second node of the library node) to open the shortcut menu.  \n  \n4.  From the shortcut menu, click **Add** and then click **Add Property**.  \n  \n     This opens the Add Property Wizard.  \n  \n5.  In the **Property Name** box, type a name for the property. For this example, use **HeadingFont**.  \n  \n6.  For **Implementation Type**, click **Get/Set Methods**.  \n  \n7.  In the **Property Type** box, select **IDispatch\\*** for the property's type.  \n  \n8.  Click **Finish**.  \n  \n The Add Property Wizard creates the code to add the `HeadingFont` custom property to the `CSampleCtrl` class and the SAMPLE.IDL file. Because `HeadingFont` is a Get/Set property type, the Add Property Wizard modifies the `CSampleCtrl` class's dispatch map to include a `DISP_PROPERTY_EX_ID`[DISP_PROPERTY_EX](../mfc/reference/dispatch-maps.md#disp_property_ex) macro entry:  \n  \n [!code-cpp[NVC_MFC_AxFont#5](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_5.cpp)]  \n  \n The `DISP_PROPERTY_EX` macro associates the `HeadingFont` property name with its corresponding `CSampleCtrl` class Get and Set methods, `GetHeadingFont` and `SetHeadingFont`. The type of the property value is also specified; in this case, **VT_FONT**.  \n  \n The Add Property Wizard also adds a declaration in the control header file (.H) for the `GetHeadingFont` and `SetHeadingFont` functions and adds their function templates in the control implementation file (.CPP):  \n  \n [!code-cpp[NVC_MFC_AxFont#6](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_6.cpp)]  \n  \n Finally, the Add Property Wizard modifies the control .IDL file by adding an entry for the `HeadingFont` property:  \n  \n [!code-cpp[NVC_MFC_AxFont#7](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_7.idl)]  \n  \n### Modifications to the Control Code  \n Now that you have added the `HeadingFont` property to the control, you must make some changes to the control header and implementation files to fully support the new property.  \n  \n In the control header file (.H), add the following declaration of a protected member variable:  \n  \n [!code-cpp[NVC_MFC_AxFont#8](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_8.h)]  \n  \n In the control implementation file (.CPP), do the following:  \n  \n-   Initialize `m_fontHeading` in the control constructor.  \n  \n     [!code-cpp[NVC_MFC_AxFont#9](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_9.cpp)]  \n  \n-   Declare a static **FONTDESC** structure containing default attributes of the font.  \n  \n     [!code-cpp[NVC_MFC_AxFont#10](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_10.cpp)]  \n  \n-   In the control `DoPropExchange` member function, add a call to the `PX_Font` function. This provides initialization and persistence for your custom Font property.  \n  \n     [!code-cpp[NVC_MFC_AxFont#11](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_11.cpp)]  \n  \n-   Finish implementing the control `GetHeadingFont` member function.  \n  \n     [!code-cpp[NVC_MFC_AxFont#12](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_12.cpp)]  \n  \n-   Finish implementing the control `SetHeadingFont` member function.  \n  \n     [!code-cpp[NVC_MFC_AxFont#13](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_13.cpp)]  \n  \n-   Modify the control `OnDraw` member function to define a variable to hold the previously selected font.  \n  \n     [!code-cpp[NVC_MFC_AxFont#14](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_14.cpp)]  \n  \n-   Modify the control `OnDraw` member function to select the custom font into the device context by adding the following line wherever the font is to be used.  \n  \n     [!code-cpp[NVC_MFC_AxFont#15](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_15.cpp)]  \n  \n-   Modify the control `OnDraw` member function to select the previous font back into the device context by adding the following line after the font has been used.  \n  \n     [!code-cpp[NVC_MFC_AxFont#16](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_16.cpp)]  \n  \n After the custom Font property has been implemented, the standard Font property page should be implemented, allowing control users to change the control's current font. To add the property page ID for the standard Font property page, insert the following line after the `BEGIN_PROPPAGEIDS` macro:  \n  \n [!code-cpp[NVC_MFC_AxFont#17](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_17.cpp)]  \n  \n You must also increment the count parameter of your `BEGIN_PROPPAGEIDS` macro by one. The following line illustrates this:  \n  \n [!code-cpp[NVC_MFC_AxFont#18](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_18.cpp)]  \n  \n After these changes have been made, rebuild the entire project to incorporate the additional functionality.  \n  \n###  <a name=\"_core_processing_font_notifications\"></a> Processing Font Notifications  \n In most cases the control needs to know when the characteristics of the font object have been modified. Each font object is capable of providing notifications when it changes by calling a member function of the **IFontNotification** interface, implemented by `COleControl`.  \n  \n If the control uses the stock Font property, its notifications are handled by the `OnFontChanged` member function of `COleControl`. When you add custom font properties, you can have them use the same implementation. In the example in the previous section, this was accomplished by passing &**m_xFontNotification** when initializing the **m_fontHeading** member variable.  \n  \n ![Implementing multiple font object interfaces](../mfc/media/vc373q1.gif \"vc373q1\")  \nImplementing Multiple Font Object Interfaces  \n  \n The solid lines in the figure above show that both font objects are using the same implementation of **IFontNotification**. This could cause problems if you wanted to distinguish which font changed.  \n  \n One way to distinguish between the control's font object notifications is to create a separate implementation of the **IFontNotification** interface for each font object in the control. This technique allows you to optimize your drawing code by updating only the string, or strings, that use the recently modified font. The following sections demonstrate the steps necessary to implement separate notification interfaces for a second Font property. The second font property is assumed to be the `HeadingFont` property that was added in the previous section.  \n  \n###  <a name=\"_core_implementing_a_new_font_notification_interface\"></a> Implementing a New Font Notification Interface  \n To distinguish between the notifications of two or more fonts, a new notification interface must be implemented for each font used in the control. The following sections describe how to implement a new font notification interface by modifying the control header and implementation files.  \n  \n### Additions to the Header File  \n In the control header file (.H), add the following lines to the class declaration:  \n  \n [!code-cpp[NVC_MFC_AxFont#19](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_19.h)]  \n  \n This creates an implementation of the `IPropertyNotifySink` interface called `HeadingFontNotify`. This new interface contains a method called `OnChanged`.  \n  \n### Additions to the Implementation File  \n In the code that initializes the heading font (in the control constructor), change `&m_xFontNotification` to `&m_xHeadingFontNotify`. Then add the following code:  \n  \n [!code-cpp[NVC_MFC_AxFont#20](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_20.cpp)]  \n  \n The `AddRef` and `Release` methods in the `IPropertyNotifySink` interface keep track of the reference count for the ActiveX control object. When the control obtains access to interface pointer, the control calls `AddRef` to increment the reference count. When the control is finished with the pointer, it calls `Release`, in much the same way that **GlobalFree** might be called to free a global memory block. When the reference count for this interface goes to zero, the interface implementation can be freed. In this example, the `QueryInterface` function returns a pointer to a `IPropertyNotifySink` interface on a particular object. This function allows an ActiveX control to query an object to determine what interfaces it supports.  \n  \n After these changes have been made to your project, rebuild the project and use Test Container to test the interface. See [Testing Properties and Events with Test Container](../mfc/testing-properties-and-events-with-test-container.md) for information on how to access the test container.  \n  \n## See Also  \n [MFC ActiveX Controls](../mfc/mfc-activex-controls.md)   \n [MFC ActiveX Controls: Using Pictures in an ActiveX Control](../mfc/mfc-activex-controls-using-pictures-in-an-activex-control.md)   \n [MFC ActiveX Controls: Using Stock Property Pages](../mfc/mfc-activex-controls-using-stock-property-pages.md)\n\n"}