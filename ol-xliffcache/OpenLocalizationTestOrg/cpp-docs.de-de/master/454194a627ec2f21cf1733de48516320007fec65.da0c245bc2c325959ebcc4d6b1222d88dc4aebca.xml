{"nodes":[{"pos":[12,70],"content":"Walkthrough: Putting Controls On Toolbars | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Walkthrough: Putting Controls On Toolbars | Microsoft Docs","pos":[0,58]}]},{"content":"Walkthrough: Putting Controls On Toolbars","pos":[649,690]},{"content":"This topic describes how to add a toolbar button that contains a Windows control to a toolbar.","pos":[691,785]},{"content":"In MFC, a toolbar button must be a <bpt id=\"p1\">[</bpt>CMFCToolBarButton Class<ept id=\"p1\">](../mfc/reference/cmfctoolbarbutton-class.md)</ept>-derived class, for example <bpt id=\"p2\">[</bpt>CMFCToolBarComboBoxButton Class<ept id=\"p2\">](../mfc/reference/cmfctoolbarcomboboxbutton-class.md)</ept>, <bpt id=\"p3\">[</bpt>CMFCToolBarEditBoxButton Class<ept id=\"p3\">](../mfc/reference/cmfctoolbareditboxbutton-class.md)</ept>, <bpt id=\"p4\">[</bpt>CMFCDropDownToolbarButton Class<ept id=\"p4\">](../mfc/reference/cmfcdropdowntoolbarbutton-class.md)</ept>, or <bpt id=\"p5\">[</bpt>CMFCToolBarMenuButton Class<ept id=\"p5\">](../mfc/reference/cmfctoolbarmenubutton-class.md)</ept>.","pos":[786,1263],"source":" In MFC, a toolbar button must be a [CMFCToolBarButton Class](../mfc/reference/cmfctoolbarbutton-class.md)-derived class, for example [CMFCToolBarComboBoxButton Class](../mfc/reference/cmfctoolbarcomboboxbutton-class.md), [CMFCToolBarEditBoxButton Class](../mfc/reference/cmfctoolbareditboxbutton-class.md), [CMFCDropDownToolbarButton Class](../mfc/reference/cmfcdropdowntoolbarbutton-class.md), or [CMFCToolBarMenuButton Class](../mfc/reference/cmfctoolbarmenubutton-class.md)."},{"content":"Adding Controls to Toolbars","pos":[1272,1299]},{"content":"To add a control to a toolbar, follow these steps:","pos":[1303,1353]},{"content":"Reserve a dummy resource ID for the button in the parent toolbar resource.","pos":[1363,1437]},{"content":"For more information about how to create buttons by using the Toolbar Editor in Visual Studio, see the <bpt id=\"p1\">[</bpt>Toolbar Editor<ept id=\"p1\">](../mfc/toolbar-editor.md)</ept> topic.","pos":[1438,1590],"source":" For more information about how to create buttons by using the Toolbar Editor in Visual Studio, see the [Toolbar Editor](../mfc/toolbar-editor.md) topic."},{"content":"Reserve a toolbar image (button icon) for the button in all bitmaps of the parent toolbar.","pos":[1600,1690]},{"pos":[1700,1790],"content":"In the message handler that processes the <ph id=\"ph1\">`AFX_WM_RESETTOOLBAR`</ph> message, do the following:","source":"In the message handler that processes the `AFX_WM_RESETTOOLBAR` message, do the following:"},{"pos":[1804,1878],"content":"Construct the button control by using a <ph id=\"ph1\">`CMFCToolbarButton`</ph>-derived class.","source":"Construct the button control by using a `CMFCToolbarButton`-derived class."},{"content":"Replace the dummy button with the new control by using <bpt id=\"p1\">[</bpt>CMFCToolBar::ReplaceButton<ept id=\"p1\">](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__replacebutton)</ept>.","pos":[1892,2042],"source":"Replace the dummy button with the new control by using [CMFCToolBar::ReplaceButton](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__replacebutton)."},{"content":"You can construct the button object on the stack, because <ph id=\"ph1\">`ReplaceButton`</ph> copies the button object and maintains the copy.","pos":[2043,2165],"source":" You can construct the button object on the stack, because `ReplaceButton` copies the button object and maintains the copy."},{"pos":[2173,2595],"content":"[!NOTE]\n If you enabled customization in your application, you may have to reset the toolbar by using the **Reset** button on the **Toolbars** tab of the **Customize** dialog box to see the updated control in your application after recompiling. The toolbar state is saved in the Windows registry, and the registry information is loaded and applied after the `ReplaceButton` method is executed during application startup.","leadings":["","> "],"nodes":[{"content":" If you enabled customization in your application, you may have to reset the toolbar by using the **Reset** button on the **Toolbars** tab of the **Customize** dialog box to see the updated control in your application after recompiling. The toolbar state is saved in the Windows registry, and the registry information is loaded and applied after the `ReplaceButton` method is executed during application startup.","pos":[8,420],"nodes":[{"content":"If you enabled customization in your application, you may have to reset the toolbar by using the <bpt id=\"p1\">**</bpt>Reset<ept id=\"p1\">**</ept> button on the <bpt id=\"p2\">**</bpt>Toolbars<ept id=\"p2\">**</ept> tab of the <bpt id=\"p3\">**</bpt>Customize<ept id=\"p3\">**</ept> dialog box to see the updated control in your application after recompiling.","pos":[1,236],"source":" If you enabled customization in your application, you may have to reset the toolbar by using the **Reset** button on the **Toolbars** tab of the **Customize** dialog box to see the updated control in your application after recompiling."},{"content":"The toolbar state is saved in the Windows registry, and the registry information is loaded and applied after the <ph id=\"ph1\">`ReplaceButton`</ph> method is executed during application startup.","pos":[237,412],"source":" The toolbar state is saved in the Windows registry, and the registry information is loaded and applied after the `ReplaceButton` method is executed during application startup."}]}]},{"content":"Toolbar Controls and Customization","pos":[2604,2638]},{"content":"The <bpt id=\"p1\">**</bpt>Commands<ept id=\"p1\">**</ept> tab of the <bpt id=\"p2\">**</bpt>Customize<ept id=\"p2\">**</ept> dialog box contains a list of commands that are available in the application.","pos":[2642,2761],"source":"The **Commands** tab of the **Customize** dialog box contains a list of commands that are available in the application."},{"content":"By default, the <bpt id=\"p1\">**</bpt>Customize<ept id=\"p1\">**</ept> dialog box processes the application menus and builds a list of standard toolbar buttons in each menu category.","pos":[2762,2903],"source":" By default, the **Customize** dialog box processes the application menus and builds a list of standard toolbar buttons in each menu category."},{"content":"To retain the extended functionality that the toolbar controls provide, you must replace the standard toolbar button with the custom control in the <bpt id=\"p1\">**</bpt>Customize<ept id=\"p1\">**</ept> dialog box.","pos":[2904,3077],"source":" To retain the extended functionality that the toolbar controls provide, you must replace the standard toolbar button with the custom control in the **Customize** dialog box."},{"content":"When you enable customization, you create the <bpt id=\"p1\">**</bpt>Customize<ept id=\"p1\">**</ept> dialog box in the customization handler <ph id=\"ph1\">`OnViewCustomize`</ph> by using the <bpt id=\"p2\">[</bpt>CMFCToolBarsCustomizeDialog Class<ept id=\"p2\">](../mfc/reference/cmfctoolbarscustomizedialog-class.md)</ept> class.","pos":[3084,3312],"source":"When you enable customization, you create the **Customize** dialog box in the customization handler `OnViewCustomize` by using the [CMFCToolBarsCustomizeDialog Class](../mfc/reference/cmfctoolbarscustomizedialog-class.md) class."},{"content":"Before you display the <bpt id=\"p1\">**</bpt>Customize<ept id=\"p1\">**</ept> dialog box by calling <bpt id=\"p2\">[</bpt>CMFCToolBarsCustomizeDialog::Create<ept id=\"p2\">](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__create)</ept>, call <bpt id=\"p3\">[</bpt>CMFCToolBarsCustomizeDialog::ReplaceButton<ept id=\"p3\">](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__replacebutton)</ept> to replace the standard button with the new control.","pos":[3313,3702],"source":" Before you display the **Customize** dialog box by calling [CMFCToolBarsCustomizeDialog::Create](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__create), call [CMFCToolBarsCustomizeDialog::ReplaceButton](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__replacebutton) to replace the standard button with the new control."},{"content":"Example: Creating a Find Combo Box","pos":[3711,3745]},{"content":"This section describes how to create a <ph id=\"ph1\">`Find`</ph> combo box control that appears on a toolbar and contains recently-used search strings.","pos":[3749,3881],"source":"This section describes how to create a `Find` combo box control that appears on a toolbar and contains recently-used search strings."},{"content":"The user can type a string in the control and then press the enter key to search a document, or press the escape key to return the focus to the main frame.","pos":[3882,4037]},{"content":"This example assumes that the document is displayed in a <bpt id=\"p1\">[</bpt>CEditView Class<ept id=\"p1\">](../mfc/reference/ceditview-class.md)</ept>-derived view.","pos":[4038,4163],"source":" This example assumes that the document is displayed in a [CEditView Class](../mfc/reference/ceditview-class.md)-derived view."},{"content":"Creating the Find Control","pos":[4173,4198]},{"pos":[4202,4245],"content":"First, create the <ph id=\"ph1\">`Find`</ph> combo box control:","source":"First, create the `Find` combo box control:"},{"content":"Add the button and its commands to the application resources:","pos":[4255,4316]},{"pos":[4330,4491],"content":"In the application resources, add a new button with an <ph id=\"ph1\">`ID_EDIT_FIND`</ph> command ID to a toolbar in your application and to any bitmaps associated with the toolbar.","source":"In the application resources, add a new button with an `ID_EDIT_FIND` command ID to a toolbar in your application and to any bitmaps associated with the toolbar."},{"content":"Create a new menu item with the ID_EDIT_FIND command ID.","pos":[4505,4561]},{"content":"Add a new string \"Find the text\\nFind\" to the string table and assign it an <ph id=\"ph1\">`ID_EDIT_FIND_COMBO`</ph> command ID.","pos":[4575,4683],"source":"Add a new string \"Find the text\\nFind\" to the string table and assign it an `ID_EDIT_FIND_COMBO` command ID."},{"content":"This ID will be used as the command ID of the <ph id=\"ph1\">`Find`</ph> combo box button.","pos":[4684,4754],"source":" This ID will be used as the command ID of the `Find` combo box button."},{"pos":[4770,5018],"content":"[!NOTE]\n Because `ID_EDIT_FIND` is a standard command that is processed by `CEditView`, you are not required to implement a special handler for this command.  However, you must implement a handler for the new command `ID_EDIT_FIND_COMBO`.","leadings":["","        > "],"nodes":[{"content":" Because `ID_EDIT_FIND` is a standard command that is processed by `CEditView`, you are not required to implement a special handler for this command.  However, you must implement a handler for the new command `ID_EDIT_FIND_COMBO`.","pos":[8,238],"nodes":[{"content":"Because <ph id=\"ph1\">`ID_EDIT_FIND`</ph> is a standard command that is processed by <ph id=\"ph2\">`CEditView`</ph>, you are not required to implement a special handler for this command.","pos":[1,149],"source":" Because `ID_EDIT_FIND` is a standard command that is processed by `CEditView`, you are not required to implement a special handler for this command."},{"content":"However, you must implement a handler for the new command <ph id=\"ph1\">`ID_EDIT_FIND_COMBO`</ph>.","pos":[151,230],"source":"  However, you must implement a handler for the new command `ID_EDIT_FIND_COMBO`."}]}]},{"pos":[5028,5133],"content":"Create a new class, <ph id=\"ph1\">`CFindComboBox`</ph>, derived from <bpt id=\"p1\">[</bpt>CComboBox Class<ept id=\"p1\">](../mfc/reference/ccombobox-class.md)</ept>.","source":"Create a new class, `CFindComboBox`, derived from [CComboBox Class](../mfc/reference/ccombobox-class.md)."},{"content":"In the <ph id=\"ph1\">`CFindComboBox`</ph> class, override the <ph id=\"ph2\">`PreTranslateMessage`</ph> virtual method.","pos":[5143,5223],"source":"In the `CFindComboBox` class, override the `PreTranslateMessage` virtual method."},{"content":"This method will enable the combo box to process the <bpt id=\"p1\">[</bpt>WM_KEYDOWN<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms646280)</ept> message.","pos":[5224,5358],"source":" This method will enable the combo box to process the [WM_KEYDOWN](http://msdn.microsoft.com/library/windows/desktop/ms646280) message."},{"content":"If the user hits the escape key (<ph id=\"ph1\">`VK_ESCAPE`</ph>), return the focus to the main frame window.","pos":[5359,5448],"source":" If the user hits the escape key (`VK_ESCAPE`), return the focus to the main frame window."},{"content":"If the user hits the Enter key (<ph id=\"ph1\">`VK_ENTER`</ph>), post to the main frame window a <ph id=\"ph2\">`WM_COMMAND`</ph> message that contains the <ph id=\"ph3\">`ID_EDIT_FIND_COMBO`</ph> command ID.","pos":[5449,5597],"source":" If the user hits the Enter key (`VK_ENTER`), post to the main frame window a `WM_COMMAND` message that contains the `ID_EDIT_FIND_COMBO` command ID."},{"content":"Create a class for the <ph id=\"ph1\">`Find`</ph> combo box button, derived from <bpt id=\"p1\">[</bpt>CMFCToolBarComboBoxButton Class<ept id=\"p1\">](../mfc/reference/cmfctoolbarcomboboxbutton-class.md)</ept>.","pos":[5607,5755],"source":"Create a class for the `Find` combo box button, derived from [CMFCToolBarComboBoxButton Class](../mfc/reference/cmfctoolbarcomboboxbutton-class.md)."},{"content":"In this example, it is named <ph id=\"ph1\">`CFindComboButton`</ph>.","pos":[5756,5804],"source":" In this example, it is named `CFindComboButton`."},{"content":"The constructor of <ph id=\"ph1\">`CMFCToolbarComboBoxButton`</ph> takes three parameters: the command ID of the button, the button image index, and the style of the combo box.","pos":[5814,5970],"source":"The constructor of `CMFCToolbarComboBoxButton` takes three parameters: the command ID of the button, the button image index, and the style of the combo box."},{"content":"Set these parameters as follows:","pos":[5971,6003]},{"pos":[6017,6065],"content":"Pass the <ph id=\"ph1\">`ID_EDIT_FIND_COMBO`</ph> as the command ID.","source":"Pass the `ID_EDIT_FIND_COMBO` as the command ID."},{"pos":[6079,6230],"content":"Use <bpt id=\"p1\">[</bpt>CCommandManager::GetCmdImage<ept id=\"p1\">](http://msdn.microsoft.com/en-us/4094d08e-de74-4398-a483-76d27a742dca)</ept> with <ph id=\"ph1\">`ID_EDIT_FIND`</ph> to obtain the image index.","source":"Use [CCommandManager::GetCmdImage](http://msdn.microsoft.com/en-us/4094d08e-de74-4398-a483-76d27a742dca) with `ID_EDIT_FIND` to obtain the image index."},{"pos":[6244,6347],"content":"For a list of available combo box styles, see <bpt id=\"p1\">[</bpt>Combo-Box Styles<ept id=\"p1\">](../mfc/reference/combo-box-styles.md)</ept>.","source":"For a list of available combo box styles, see [Combo-Box Styles](../mfc/reference/combo-box-styles.md)."},{"content":"In the <ph id=\"ph1\">`CFindComboButton`</ph> class, override the <ph id=\"ph2\">`CMFCToolbarComboBoxButton::CreateCombo`</ph> method.","pos":[6357,6451],"source":"In the `CFindComboButton` class, override the `CMFCToolbarComboBoxButton::CreateCombo` method."},{"content":"Here you should create the <ph id=\"ph1\">`CFindComboButton`</ph> object and return a pointer to it.","pos":[6452,6532],"source":" Here you should create the `CFindComboButton` object and return a pointer to it."},{"content":"Use the <bpt id=\"p1\">[</bpt>IMPLEMENT_SERIAL<ept id=\"p1\">](../mfc/reference/run-time-object-model-services.md#implement_serial)</ept> macro to make the combo button persistent.","pos":[6542,6680],"source":"Use the [IMPLEMENT_SERIAL](../mfc/reference/run-time-object-model-services.md#implement_serial) macro to make the combo button persistent."},{"content":"The workspace manager automatically loads and saves the button's state in the Windows registry.","pos":[6681,6776]},{"content":"Implement the <ph id=\"ph1\">`ID_EDIT_FIND_COMBO`</ph> handler in your document view.","pos":[6786,6851],"source":"Implement the `ID_EDIT_FIND_COMBO` handler in your document view."},{"content":"Use <bpt id=\"p1\">[</bpt>CMFCToolBar::GetCommandButtons<ept id=\"p1\">](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__getcommandbuttons)</ept> with <ph id=\"ph1\">`ID_EDIT_FIND_COMBO`</ph> to retrieve all <ph id=\"ph2\">`Find`</ph> combo box buttons.","pos":[6852,7026],"source":" Use [CMFCToolBar::GetCommandButtons](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__getcommandbuttons) with `ID_EDIT_FIND_COMBO` to retrieve all `Find` combo box buttons."},{"content":"There can be several copies of a button with the same command ID because of customization.","pos":[7027,7117]},{"content":"In the ID_EDIT_FIND message handler <ph id=\"ph1\">`OnFind`</ph>, use <bpt id=\"p1\">[</bpt>CMFCToolBar::IsLastCommandFromButton<ept id=\"p1\">](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__islastcommandfrombutton)</ept> to determine whether the find command was sent from the <ph id=\"ph2\">`Find`</ph> combo box button.","pos":[7126,7371],"source":"In the ID_EDIT_FIND message handler `OnFind`, use [CMFCToolBar::IsLastCommandFromButton](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__islastcommandfrombutton) to determine whether the find command was sent from the `Find` combo box button."},{"content":"If so, find the text and add the search string to the combo box.","pos":[7372,7436]},{"content":"Adding the Find Control to the Main Toolbar","pos":[7446,7489]},{"content":"To add the combo box button to the toolbar, follow these steps:","pos":[7493,7556]},{"pos":[7566,7660],"content":"Implement the <ph id=\"ph1\">`AFX_WM_RESETTOOLBAR`</ph> message handler <ph id=\"ph2\">`OnToolbarReset`</ph> in the main frame window.","source":"Implement the `AFX_WM_RESETTOOLBAR` message handler `OnToolbarReset` in the main frame window."},{"pos":[7672,7953],"content":"[!NOTE]\n The framework sends this message to the main frame window when a toolbar is initialized during application startup, or when a toolbar is reset during customization. In either case, you must replace the standard toolbar button with the custom `Find` combo box button.","leadings":["","    > "],"nodes":[{"content":" The framework sends this message to the main frame window when a toolbar is initialized during application startup, or when a toolbar is reset during customization. In either case, you must replace the standard toolbar button with the custom `Find` combo box button.","pos":[8,275],"nodes":[{"content":"The framework sends this message to the main frame window when a toolbar is initialized during application startup, or when a toolbar is reset during customization.","pos":[1,165]},{"content":"In either case, you must replace the standard toolbar button with the custom <ph id=\"ph1\">`Find`</ph> combo box button.","pos":[166,267],"source":" In either case, you must replace the standard toolbar button with the custom `Find` combo box button."}]}]},{"content":"In the <ph id=\"ph1\">`AFX_WM_RESETTOOLBAR`</ph> handler, examine the toolbar ID, that is, the <ph id=\"ph2\">`WPARAM`</ph> of the <ph id=\"ph3\">`AFX_WM_RESETTOOLBAR`</ph> message.","pos":[7963,8084],"source":"In the `AFX_WM_RESETTOOLBAR` handler, examine the toolbar ID, that is, the `WPARAM` of the `AFX_WM_RESETTOOLBAR` message."},{"content":"If the toolbar ID is equal to that of the toolbar that contains the <ph id=\"ph1\">`Find`</ph> combo box button, call <bpt id=\"p1\">[</bpt>CMFCToolBar::ReplaceButton<ept id=\"p1\">](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__replacebutton)</ept> to replace the <ph id=\"ph2\">`Find`</ph> button (that is, the button with the command ID <ph id=\"ph3\">`ID_EDIT_FIND)`</ph> with a <ph id=\"ph4\">`CFindComboButton`</ph> object.","pos":[8085,8397],"source":" If the toolbar ID is equal to that of the toolbar that contains the `Find` combo box button, call [CMFCToolBar::ReplaceButton](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__replacebutton) to replace the `Find` button (that is, the button with the command ID `ID_EDIT_FIND)` with a `CFindComboButton` object."},{"pos":[8409,8553],"content":"[!NOTE]\n You can construct a `CFindComboBox` object on the stack, because `ReplaceButton` copies the button object and maintains the copy.","leadings":["","    > "],"nodes":[{"content":"You can construct a <ph id=\"ph1\">`CFindComboBox`</ph> object on the stack, because <ph id=\"ph2\">`ReplaceButton`</ph> copies the button object and maintains the copy.","pos":[9,138],"source":" You can construct a `CFindComboBox` object on the stack, because `ReplaceButton` copies the button object and maintains the copy."}]},{"content":"Adding the Find Control to the Customize Dialog Box","pos":[8563,8614]},{"pos":[8618,8933],"content":"In the customization handler <ph id=\"ph1\">`OnViewCustomize`</ph>, call <bpt id=\"p1\">[</bpt>CMFCToolBarsCustomizeDialog::ReplaceButton<ept id=\"p1\">](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__replacebutton)</ept> to replace the <ph id=\"ph2\">`Find`</ph> button (that is, the button with the command ID <ph id=\"ph3\">`ID_EDIT_FIND)`</ph> with a <ph id=\"ph4\">`CFindComboButton`</ph> object.","source":"In the customization handler `OnViewCustomize`, call [CMFCToolBarsCustomizeDialog::ReplaceButton](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__replacebutton) to replace the `Find` button (that is, the button with the command ID `ID_EDIT_FIND)` with a `CFindComboButton` object."},{"content":"See Also","pos":[8942,8950]},{"content":"Hierarchy Chart","pos":[8955,8970]},{"content":"Classes","pos":[9004,9011]},{"content":"CMFCToolBar Class","pos":[9051,9068]},{"content":"CMFCToolBarButton Class","pos":[9114,9137]},{"content":"CMFCToolBarComboBoxButton Class","pos":[9189,9220]},{"content":"CMFCToolBarsCustomizeDialog Class","pos":[9280,9313]}],"content":"---\ntitle: \"Walkthrough: Putting Controls On Toolbars | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"Customize dialog box, adding controls\"\n  - \"toolbars, adding controls\"\nms.assetid: 8fc94bdf-0da7-45d9-8bc4-52b7b1edf205\ncaps.latest.revision: 24\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Walkthrough: Putting Controls On Toolbars\nThis topic describes how to add a toolbar button that contains a Windows control to a toolbar. In MFC, a toolbar button must be a [CMFCToolBarButton Class](../mfc/reference/cmfctoolbarbutton-class.md)-derived class, for example [CMFCToolBarComboBoxButton Class](../mfc/reference/cmfctoolbarcomboboxbutton-class.md), [CMFCToolBarEditBoxButton Class](../mfc/reference/cmfctoolbareditboxbutton-class.md), [CMFCDropDownToolbarButton Class](../mfc/reference/cmfcdropdowntoolbarbutton-class.md), or [CMFCToolBarMenuButton Class](../mfc/reference/cmfctoolbarmenubutton-class.md).  \n  \n## Adding Controls to Toolbars  \n To add a control to a toolbar, follow these steps:  \n  \n1.  Reserve a dummy resource ID for the button in the parent toolbar resource. For more information about how to create buttons by using the Toolbar Editor in Visual Studio, see the [Toolbar Editor](../mfc/toolbar-editor.md) topic.  \n  \n2.  Reserve a toolbar image (button icon) for the button in all bitmaps of the parent toolbar.  \n  \n3.  In the message handler that processes the `AFX_WM_RESETTOOLBAR` message, do the following:  \n  \n    1.  Construct the button control by using a `CMFCToolbarButton`-derived class.  \n  \n    2.  Replace the dummy button with the new control by using [CMFCToolBar::ReplaceButton](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__replacebutton). You can construct the button object on the stack, because `ReplaceButton` copies the button object and maintains the copy.  \n  \n> [!NOTE]\n>  If you enabled customization in your application, you may have to reset the toolbar by using the **Reset** button on the **Toolbars** tab of the **Customize** dialog box to see the updated control in your application after recompiling. The toolbar state is saved in the Windows registry, and the registry information is loaded and applied after the `ReplaceButton` method is executed during application startup.  \n  \n## Toolbar Controls and Customization  \n The **Commands** tab of the **Customize** dialog box contains a list of commands that are available in the application. By default, the **Customize** dialog box processes the application menus and builds a list of standard toolbar buttons in each menu category. To retain the extended functionality that the toolbar controls provide, you must replace the standard toolbar button with the custom control in the **Customize** dialog box.  \n  \n When you enable customization, you create the **Customize** dialog box in the customization handler `OnViewCustomize` by using the [CMFCToolBarsCustomizeDialog Class](../mfc/reference/cmfctoolbarscustomizedialog-class.md) class. Before you display the **Customize** dialog box by calling [CMFCToolBarsCustomizeDialog::Create](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__create), call [CMFCToolBarsCustomizeDialog::ReplaceButton](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__replacebutton) to replace the standard button with the new control.  \n  \n## Example: Creating a Find Combo Box  \n This section describes how to create a `Find` combo box control that appears on a toolbar and contains recently-used search strings. The user can type a string in the control and then press the enter key to search a document, or press the escape key to return the focus to the main frame. This example assumes that the document is displayed in a [CEditView Class](../mfc/reference/ceditview-class.md)-derived view.  \n  \n### Creating the Find Control  \n First, create the `Find` combo box control:  \n  \n1.  Add the button and its commands to the application resources:  \n  \n    1.  In the application resources, add a new button with an `ID_EDIT_FIND` command ID to a toolbar in your application and to any bitmaps associated with the toolbar.  \n  \n    2.  Create a new menu item with the ID_EDIT_FIND command ID.  \n  \n    3.  Add a new string \"Find the text\\nFind\" to the string table and assign it an `ID_EDIT_FIND_COMBO` command ID. This ID will be used as the command ID of the `Find` combo box button.  \n  \n        > [!NOTE]\n        >  Because `ID_EDIT_FIND` is a standard command that is processed by `CEditView`, you are not required to implement a special handler for this command.  However, you must implement a handler for the new command `ID_EDIT_FIND_COMBO`.  \n  \n2.  Create a new class, `CFindComboBox`, derived from [CComboBox Class](../mfc/reference/ccombobox-class.md).  \n  \n3.  In the `CFindComboBox` class, override the `PreTranslateMessage` virtual method. This method will enable the combo box to process the [WM_KEYDOWN](http://msdn.microsoft.com/library/windows/desktop/ms646280) message. If the user hits the escape key (`VK_ESCAPE`), return the focus to the main frame window. If the user hits the Enter key (`VK_ENTER`), post to the main frame window a `WM_COMMAND` message that contains the `ID_EDIT_FIND_COMBO` command ID.  \n  \n4.  Create a class for the `Find` combo box button, derived from [CMFCToolBarComboBoxButton Class](../mfc/reference/cmfctoolbarcomboboxbutton-class.md). In this example, it is named `CFindComboButton`.  \n  \n5.  The constructor of `CMFCToolbarComboBoxButton` takes three parameters: the command ID of the button, the button image index, and the style of the combo box. Set these parameters as follows:  \n  \n    1.  Pass the `ID_EDIT_FIND_COMBO` as the command ID.  \n  \n    2.  Use [CCommandManager::GetCmdImage](http://msdn.microsoft.com/en-us/4094d08e-de74-4398-a483-76d27a742dca) with `ID_EDIT_FIND` to obtain the image index.  \n  \n    3.  For a list of available combo box styles, see [Combo-Box Styles](../mfc/reference/combo-box-styles.md).  \n  \n6.  In the `CFindComboButton` class, override the `CMFCToolbarComboBoxButton::CreateCombo` method. Here you should create the `CFindComboButton` object and return a pointer to it.  \n  \n7.  Use the [IMPLEMENT_SERIAL](../mfc/reference/run-time-object-model-services.md#implement_serial) macro to make the combo button persistent. The workspace manager automatically loads and saves the button's state in the Windows registry.  \n  \n8.  Implement the `ID_EDIT_FIND_COMBO` handler in your document view. Use [CMFCToolBar::GetCommandButtons](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__getcommandbuttons) with `ID_EDIT_FIND_COMBO` to retrieve all `Find` combo box buttons. There can be several copies of a button with the same command ID because of customization.  \n  \n9. In the ID_EDIT_FIND message handler `OnFind`, use [CMFCToolBar::IsLastCommandFromButton](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__islastcommandfrombutton) to determine whether the find command was sent from the `Find` combo box button. If so, find the text and add the search string to the combo box.  \n  \n### Adding the Find Control to the Main Toolbar  \n To add the combo box button to the toolbar, follow these steps:  \n  \n1.  Implement the `AFX_WM_RESETTOOLBAR` message handler `OnToolbarReset` in the main frame window.  \n  \n    > [!NOTE]\n    >  The framework sends this message to the main frame window when a toolbar is initialized during application startup, or when a toolbar is reset during customization. In either case, you must replace the standard toolbar button with the custom `Find` combo box button.  \n  \n2.  In the `AFX_WM_RESETTOOLBAR` handler, examine the toolbar ID, that is, the `WPARAM` of the `AFX_WM_RESETTOOLBAR` message. If the toolbar ID is equal to that of the toolbar that contains the `Find` combo box button, call [CMFCToolBar::ReplaceButton](../mfc/reference/cmfctoolbar-class.md#cmfctoolbar__replacebutton) to replace the `Find` button (that is, the button with the command ID `ID_EDIT_FIND)` with a `CFindComboButton` object.  \n  \n    > [!NOTE]\n    >  You can construct a `CFindComboBox` object on the stack, because `ReplaceButton` copies the button object and maintains the copy.  \n  \n### Adding the Find Control to the Customize Dialog Box  \n In the customization handler `OnViewCustomize`, call [CMFCToolBarsCustomizeDialog::ReplaceButton](../mfc/reference/cmfctoolbarscustomizedialog-class.md#cmfctoolbarscustomizedialog__replacebutton) to replace the `Find` button (that is, the button with the command ID `ID_EDIT_FIND)` with a `CFindComboButton` object.  \n  \n## See Also  \n [Hierarchy Chart](../mfc/hierarchy-chart.md)   \n [Classes](../mfc/reference/mfc-classes.md)   \n [CMFCToolBar Class](../mfc/reference/cmfctoolbar-class.md)   \n [CMFCToolBarButton Class](../mfc/reference/cmfctoolbarbutton-class.md)   \n [CMFCToolBarComboBoxButton Class](../mfc/reference/cmfctoolbarcomboboxbutton-class.md)   \n [CMFCToolBarsCustomizeDialog Class](../mfc/reference/cmfctoolbarscustomizedialog-class.md)\n"}