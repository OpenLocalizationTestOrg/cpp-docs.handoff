{"nodes":[{"pos":[12,49],"content":"-OPT (Optimizations) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"-OPT (Optimizations) | Microsoft Docs","pos":[0,37]}]},{"content":"/OPT (Optimizations)","pos":[1061,1081]},{"content":"Controls the optimizations that LINK performs during a build.","pos":[1082,1143]},{"content":"Syntax","pos":[1152,1158]},{"content":"Arguments","pos":[1258,1267]},{"content":"<bpt id=\"p1\">**</bpt>REF<ept id=\"p1\">**</ept> &amp;#124; <bpt id=\"p2\">**</bpt>NOREF<ept id=\"p2\">**</ept>","pos":[1271,1295],"source":"**REF** &#124; **NOREF**"},{"content":"<bpt id=\"p1\"> **</bpt>/OPT:REF<ept id=\"p1\">**</ept> eliminates functions and data that are never referenced; <bpt id=\"p2\">**</bpt>/OPT:NOREF<ept id=\"p2\">**</ept> keeps functions and data that are never referenced.","pos":[1298,1435],"source":" **/OPT:REF** eliminates functions and data that are never referenced; **/OPT:NOREF** keeps functions and data that are never referenced."},{"content":"When /OFT:REF is enabled, LINK removes unreferenced packaged functions and data.","pos":[1442,1522]},{"content":"An object contains packaged functions and data (COMDATs) if it was compiled by using the <bpt id=\"p1\">[</bpt>/Gy<ept id=\"p1\">](../../build/reference/gy-enable-function-level-linking.md)</ept> option.","pos":[1523,1684],"source":" An object contains packaged functions and data (COMDATs) if it was compiled by using the [/Gy](../../build/reference/gy-enable-function-level-linking.md) option."},{"content":"This optimization is known as transitive COMDAT elimination.","pos":[1685,1745]},{"content":"By default, <bpt id=\"p1\">**</bpt>/OPT:REF<ept id=\"p1\">**</ept> is enabled in non-debug builds.","pos":[1746,1802],"source":" By default, **/OPT:REF** is enabled in non-debug builds."},{"content":"To override this default and keep unreferenced COMDATs in the program, specify <bpt id=\"p1\">**</bpt>/OPT:NOREF<ept id=\"p1\">**</ept>.","pos":[1803,1897],"source":" To override this default and keep unreferenced COMDATs in the program, specify **/OPT:NOREF**."},{"content":"You can use the <bpt id=\"p1\">[</bpt>/INCLUDE<ept id=\"p1\">](../../build/reference/include-force-symbol-references.md)</ept> option to override the removal of a specific symbol.","pos":[1898,2035],"source":" You can use the [/INCLUDE](../../build/reference/include-force-symbol-references.md) option to override the removal of a specific symbol."},{"content":"When <bpt id=\"p1\">**</bpt>/OPT:REF<ept id=\"p1\">**</ept> is enabled either explicitly or by default, a limited form of <bpt id=\"p2\">**</bpt>/OPT:ICF<ept id=\"p2\">**</ept> is enabled that only folds identical functions.","pos":[2042,2182],"source":"When **/OPT:REF** is enabled either explicitly or by default, a limited form of **/OPT:ICF** is enabled that only folds identical functions."},{"content":"If you want <bpt id=\"p1\">**</bpt>/OPT:REF<ept id=\"p1\">**</ept> but not <bpt id=\"p2\">**</bpt>/OPT:ICF<ept id=\"p2\">**</ept>, you must specify either <bpt id=\"p3\">**</bpt>/OPT:REF,NOICF<ept id=\"p3\">**</ept> or <bpt id=\"p4\">**</bpt>/OPT:NOICF<ept id=\"p4\">**</ept>.","pos":[2183,2291],"source":" If you want **/OPT:REF** but not **/OPT:ICF**, you must specify either **/OPT:REF,NOICF** or **/OPT:NOICF**."},{"content":"If <bpt id=\"p1\">[</bpt>/DEBUG<ept id=\"p1\">](../../build/reference/debug-generate-debug-info.md)</ept> is specified, the default for <bpt id=\"p2\">**</bpt>/OPT<ept id=\"p2\">**</ept> is <bpt id=\"p3\">**</bpt>NOREF<ept id=\"p3\">**</ept>, and all functions are preserved in the image.","pos":[2298,2460],"source":"If [/DEBUG](../../build/reference/debug-generate-debug-info.md) is specified, the default for **/OPT** is **NOREF**, and all functions are preserved in the image."},{"content":"To override this default and optimize a debugging build, specify <bpt id=\"p1\">**</bpt>/OPT:REF<ept id=\"p1\">**</ept>.","pos":[2461,2539],"source":" To override this default and optimize a debugging build, specify **/OPT:REF**."},{"content":"Because <bpt id=\"p1\">**</bpt>/OPT:REF<ept id=\"p1\">**</ept> implies <bpt id=\"p2\">**</bpt>/OPT:ICF<ept id=\"p2\">**</ept>, we recommend that you also specify <bpt id=\"p3\">**</bpt>/OPT:NOICF<ept id=\"p3\">**</ept> to preserve identical functions in debugging builds.","pos":[2540,2685],"source":" Because **/OPT:REF** implies **/OPT:ICF**, we recommend that you also specify **/OPT:NOICF** to preserve identical functions in debugging builds."},{"content":"This makes it easier to read stack traces and set breakpoints in functions that would otherwise be folded together.","pos":[2686,2801]},{"content":"The <bpt id=\"p1\">**</bpt>/OPT:REF<ept id=\"p1\">**</ept> option disables incremental linking.","pos":[2802,2855],"source":" The **/OPT:REF** option disables incremental linking."},{"pos":[2862,2968],"content":"You have to explicitly mark <ph id=\"ph1\">`const`</ph> data as a COMDAT; use <bpt id=\"p1\">[</bpt>__declspec(selectany)<ept id=\"p1\">](../../cpp/selectany.md)</ept>.","source":"You have to explicitly mark `const` data as a COMDAT; use [__declspec(selectany)](../../cpp/selectany.md)."},{"pos":[2975,3039],"content":"Specifying <bpt id=\"p1\">**</bpt>/OPT:ICF<ept id=\"p1\">**</ept> does not enable the <bpt id=\"p2\">**</bpt>/OPT:REF<ept id=\"p2\">**</ept> option.","source":"Specifying **/OPT:ICF** does not enable the **/OPT:REF** option."},{"content":"<bpt id=\"p1\">**</bpt>ICF[=<ept id=\"p1\">**</ept>  <ph id=\"ph1\">`iterations`</ph> <bpt id=\"p2\">**</bpt>] &amp;#124; NOICF<ept id=\"p2\">**</ept>","pos":[3046,3088],"source":"**ICF[=**  `iterations` **] &#124; NOICF**"},{"content":"Use <bpt id=\"p1\">**</bpt>/OPT:ICF[=<ept id=\"p1\">**</ept><ph id=\"ph1\">`iterations`</ph><bpt id=\"p2\">**</bpt>]<ept id=\"p2\">**</ept> to perform identical COMDAT folding.","pos":[3092,3164],"source":" Use **/OPT:ICF[=**`iterations`**]** to perform identical COMDAT folding."},{"content":"Redundant COMDATs can be removed from the linker output.","pos":[3165,3221]},{"content":"The optional <ph id=\"ph1\">`iterations`</ph> parameter specifies the number of times to traverse the symbols for duplicates.","pos":[3222,3327],"source":" The optional `iterations` parameter specifies the number of times to traverse the symbols for duplicates."},{"content":"The default number of iterations is two.","pos":[3328,3368]},{"content":"Additional iterations may locate more duplicates that are uncovered through folding in the previous iteration.","pos":[3369,3479]},{"content":"The linker behaves differently when <bpt id=\"p1\">**</bpt>/OPT:REF<ept id=\"p1\">**</ept> is specified—and <bpt id=\"p2\">**</bpt>ICF<ept id=\"p2\">**</ept> is in effect by default—than it does when <bpt id=\"p3\">**</bpt>/OPT:REF,ICF<ept id=\"p3\">**</ept> is specified explicitly.","pos":[3486,3643],"source":"The linker behaves differently when **/OPT:REF** is specified—and **ICF** is in effect by default—than it does when **/OPT:REF,ICF** is specified explicitly."},{"content":"The form of <bpt id=\"p1\">**</bpt>ICF<ept id=\"p1\">**</ept> that's enabled with <bpt id=\"p2\">**</bpt>/OPT:REF<ept id=\"p2\">**</ept> alone does not fold read-only data—this includes .rdata, .pdata, and .xdata.","pos":[3644,3773],"source":" The form of **ICF** that's enabled with **/OPT:REF** alone does not fold read-only data—this includes .rdata, .pdata, and .xdata."},{"content":"Therefore, fewer functions are folded when images are produced for <ph id=\"ph1\">[!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)]</ph> because functions in these modules are more dependent on read-only data—for example, .pdata and .xdata.","pos":[3774,4011],"source":" Therefore, fewer functions are folded when images are produced for [!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)] because functions in these modules are more dependent on read-only data—for example, .pdata and .xdata."},{"content":"To get full <bpt id=\"p1\">**</bpt>ICF<ept id=\"p1\">**</ept> folding behavior, explicitly specify <bpt id=\"p2\">**</bpt>/OPT:ICF<ept id=\"p2\">**</ept>.","pos":[4012,4082],"source":" To get full **ICF** folding behavior, explicitly specify **/OPT:ICF**."},{"content":"To place functions in COMDATs, you use the <bpt id=\"p1\">**</bpt>/Gy<ept id=\"p1\">**</ept> compiler option; to place <ph id=\"ph1\">`const`</ph> data, you declare it <ph id=\"ph2\">`__declspec(selectany)`</ph>.","pos":[4089,4219],"source":"To place functions in COMDATs, you use the **/Gy** compiler option; to place `const` data, you declare it `__declspec(selectany)`."},{"content":"For information about how to specify data for folding, see <bpt id=\"p1\">[</bpt>selectany<ept id=\"p1\">](../../cpp/selectany.md)</ept>.","pos":[4220,4315],"source":" For information about how to specify data for folding, see [selectany](../../cpp/selectany.md)."},{"content":"By default, <bpt id=\"p1\">**</bpt>ICF<ept id=\"p1\">**</ept> is on if <bpt id=\"p2\">**</bpt>REF<ept id=\"p2\">**</ept> is on.","pos":[4322,4365],"source":"By default, **ICF** is on if **REF** is on."},{"content":"To override this default if <bpt id=\"p1\">**</bpt>REF<ept id=\"p1\">**</ept> is specified, use <bpt id=\"p2\">**</bpt>NOICF<ept id=\"p2\">**</ept>.","pos":[4366,4430],"source":" To override this default if **REF** is specified, use **NOICF**."},{"content":"When <bpt id=\"p1\">**</bpt>/OPT:REF<ept id=\"p1\">**</ept> is not specified in a debug build, you must explicitly specify <bpt id=\"p2\">**</bpt>/OPT:ICF<ept id=\"p2\">**</ept> to enable COMDAT folding.","pos":[4431,4550],"source":" When **/OPT:REF** is not specified in a debug build, you must explicitly specify **/OPT:ICF** to enable COMDAT folding."},{"content":"However, because <bpt id=\"p1\">**</bpt>/OPT:ICF<ept id=\"p1\">**</ept> can merge identical data or functions, it can change the function names that appear in stack traces.","pos":[4551,4681],"source":" However, because **/OPT:ICF** can merge identical data or functions, it can change the function names that appear in stack traces."},{"content":"It can also make it impossible to set breakpoints in certain functions or to examine some data in the debugger, and take you into unexpected functions when you single-step through code.","pos":[4682,4867]},{"content":"Therefore, we do not recommend that you use <bpt id=\"p1\">**</bpt>/OPT:ICF<ept id=\"p1\">**</ept> in debug builds unless the advantages of smaller code outweigh these disadvantages.","pos":[4868,5008],"source":" Therefore, we do not recommend that you use **/OPT:ICF** in debug builds unless the advantages of smaller code outweigh these disadvantages."},{"pos":[5016,5406],"content":"[!NOTE]\n Because **/OPT:ICF** can cause the same address to be assigned to different functions or read-only data members (`const` variables compiled by using **/Gy**), it can break a program that depends on unique addresses for functions or read-only data members. For more information, see [/Gy (Enable Function-Level Linking)](../../build/reference/gy-enable-function-level-linking.md).","leadings":["","> "],"nodes":[{"content":" Because **/OPT:ICF** can cause the same address to be assigned to different functions or read-only data members (`const` variables compiled by using **/Gy**), it can break a program that depends on unique addresses for functions or read-only data members. For more information, see [/Gy (Enable Function-Level Linking)](../../build/reference/gy-enable-function-level-linking.md).","pos":[8,388],"nodes":[{"content":"Because <bpt id=\"p1\">**</bpt>/OPT:ICF<ept id=\"p1\">**</ept> can cause the same address to be assigned to different functions or read-only data members (<ph id=\"ph1\">`const`</ph> variables compiled by using <bpt id=\"p2\">**</bpt>/Gy<ept id=\"p2\">**</ept>), it can break a program that depends on unique addresses for functions or read-only data members.","pos":[1,256],"source":" Because **/OPT:ICF** can cause the same address to be assigned to different functions or read-only data members (`const` variables compiled by using **/Gy**), it can break a program that depends on unique addresses for functions or read-only data members."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>/Gy (Enable Function-Level Linking)<ept id=\"p1\">](../../build/reference/gy-enable-function-level-linking.md)</ept>.","pos":[257,380],"source":" For more information, see [/Gy (Enable Function-Level Linking)](../../build/reference/gy-enable-function-level-linking.md)."}]}]},{"content":"<bpt id=\"p1\">**</bpt>LBR<ept id=\"p1\">**</ept> &amp;#124; <bpt id=\"p2\">**</bpt>NOLBR<ept id=\"p2\">**</ept>","pos":[5413,5437],"source":"**LBR** &#124; **NOLBR**"},{"content":"The <bpt id=\"p1\">**</bpt>/OPT:LBR<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>/OPT:NOLBR<ept id=\"p2\">**</ept> options apply only to ARM binaries.","pos":[5441,5512],"source":" The **/OPT:LBR** and **/OPT:NOLBR** options apply only to ARM binaries."},{"content":"Because certain ARM processor branch instructions have a limited range, if the linker detects a jump to an out-of-range address, it replaces the branch instruction’s destination address with the address of a code \"island\" that contains a branch instruction that targets the actual destination.","pos":[5513,5806]},{"content":"You can use <bpt id=\"p1\">**</bpt>/OPT:LBR<ept id=\"p1\">**</ept> to optimize the detection of long branch instructions and the placement of intermediate code islands to minimize overall code size.","pos":[5807,5963],"source":" You can use **/OPT:LBR** to optimize the detection of long branch instructions and the placement of intermediate code islands to minimize overall code size."},{"content":"<bpt id=\"p1\">**</bpt>/OPT:NOLBR<ept id=\"p1\">**</ept> instructs the linker to generate code islands for long branch instructions as they are encountered, without optimization.","pos":[5964,6100],"source":"**/OPT:NOLBR** instructs the linker to generate code islands for long branch instructions as they are encountered, without optimization."},{"content":"By default, the <bpt id=\"p1\">**</bpt>/OPT:LBR<ept id=\"p1\">**</ept> option is set when incremental linking is not enabled.","pos":[6107,6190],"source":"By default, the **/OPT:LBR** option is set when incremental linking is not enabled."},{"content":"If you want a non-incremental link but not long branch optimizations, specify <bpt id=\"p1\">**</bpt>/OPT:NOLBR<ept id=\"p1\">**</ept>.","pos":[6191,6284],"source":" If you want a non-incremental link but not long branch optimizations, specify **/OPT:NOLBR**."},{"content":"The <bpt id=\"p1\">**</bpt>/OPT:LBR<ept id=\"p1\">**</ept> option disables incremental linking.","pos":[6285,6338],"source":" The **/OPT:LBR** option disables incremental linking."},{"content":"Remarks","pos":[6347,6354]},{"content":"Optimizations generally decrease the image size and increase the program speed at a cost of increased link time.","pos":[6358,6470]},{"pos":[6477,6673],"content":"You can use the <bpt id=\"p1\">[</bpt>/VERBOSE<ept id=\"p1\">](../../build/reference/verbose-print-progress-messages.md)</ept> option to see the functions that are removed by <bpt id=\"p2\">**</bpt>/OPT:REF<ept id=\"p2\">**</ept> and the functions that are folded by <bpt id=\"p3\">**</bpt>/OPT:ICF<ept id=\"p3\">**</ept>.","source":"You can use the [/VERBOSE](../../build/reference/verbose-print-progress-messages.md) option to see the functions that are removed by **/OPT:REF** and the functions that are folded by **/OPT:ICF**."},{"content":"To set the OPT:ICF or OPT:REF linker option in the Visual Studio development environment","pos":[6683,6771]},{"content":"Open the project's <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box.","pos":[6781,6830],"source":"Open the project's **Property Pages** dialog box."},{"content":"For details, see <bpt id=\"p1\">[</bpt>Working with Project Properties<ept id=\"p1\">](../../ide/working-with-project-properties.md)</ept>.","pos":[6831,6928],"source":" For details, see [Working with Project Properties](../../ide/working-with-project-properties.md)."},{"pos":[6938,7022],"content":"In the left pane, expand <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Linker<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Optimization<ept id=\"p3\">**</ept>.","source":"In the left pane, expand **Configuration Properties**, **Linker**, **Optimization**."},{"content":"Modify one of these properties:","pos":[7032,7063]},{"content":"Enable COMDAT Folding","pos":[7079,7100]},{"content":"References","pos":[7118,7128]},{"content":"To set the OPT:LBR linker option in the Visual Studio development environment","pos":[7140,7217]},{"content":"Open the project's <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box.","pos":[7227,7276],"source":"Open the project's **Property Pages** dialog box."},{"content":"For details, see <bpt id=\"p1\">[</bpt>Setting Visual C++ Project Properties<ept id=\"p1\">](../../ide/working-with-project-properties.md)</ept>.","pos":[7277,7380],"source":" For details, see [Setting Visual C++ Project Properties](../../ide/working-with-project-properties.md)."},{"pos":[7390,7419],"content":"Select the <bpt id=\"p1\">**</bpt>Linker<ept id=\"p1\">**</ept> folder.","source":"Select the **Linker** folder."},{"pos":[7429,7471],"content":"Select the <bpt id=\"p1\">**</bpt>Command Line<ept id=\"p1\">**</ept> property page.","source":"Select the **Command Line** property page."},{"pos":[7481,7524],"content":"Enter the option in <bpt id=\"p1\">**</bpt>Additional Options<ept id=\"p1\">**</ept>:","source":"Enter the option in **Additional Options**:"},{"content":"To set this linker option programmatically","pos":[7555,7597]},{"content":"See &lt;xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.EnableCOMDATFolding%2A&gt; and &lt;xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.OptimizeReferences%2A&gt; properties.","pos":[7607,7789],"source":"See <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.EnableCOMDATFolding%2A> and <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.OptimizeReferences%2A> properties."},{"content":"See Also","pos":[7798,7806]},{"content":"Setting Linker Options","pos":[7811,7833]},{"content":"Linker Options","pos":[7889,7903]}],"content":"---\ntitle: \"-OPT (Optimizations) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"VC.Project.VCLinkerTool.OptimizeReferences\"\n  - \"/opt\"\n  - \"VC.Project.VCLinkerTool.OptimizeForWindows98\"\n  - \"VC.Project.VCLinkerTool.EnableCOMDATFolding\"\n  - \"VC.Project.VCLinkerTool.OptimizeFolding\"\n  - \"VC.Project.VCLinkerTool.FoldingIterations\"\n  - \"VC.Project.VCLinkerTool.OptimizeFoldingIterations\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"LINK tool [C++], controlling optimizations\"\n  - \"-OPT linker option\"\n  - \"linker [C++], optimizations\"\n  - \"OPT linker option\"\n  - \"optimization, linker\"\n  - \"/OPT linker option\"\nms.assetid: 8f229863-5f53-48a8-9478-243a647093ac\ncaps.latest.revision: 23\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# /OPT (Optimizations)\nControls the optimizations that LINK performs during a build.  \n  \n## Syntax  \n  \n```  \n/OPT:{REF | NOREF}  \n/OPT:{ICF[=iterations] | NOICF}  \n/OPT:{LBR | NOLBR}  \n```  \n  \n## Arguments  \n **REF** &#124; **NOREF**  \n **/OPT:REF** eliminates functions and data that are never referenced; **/OPT:NOREF** keeps functions and data that are never referenced.  \n  \n When /OFT:REF is enabled, LINK removes unreferenced packaged functions and data. An object contains packaged functions and data (COMDATs) if it was compiled by using the [/Gy](../../build/reference/gy-enable-function-level-linking.md) option. This optimization is known as transitive COMDAT elimination. By default, **/OPT:REF** is enabled in non-debug builds. To override this default and keep unreferenced COMDATs in the program, specify **/OPT:NOREF**. You can use the [/INCLUDE](../../build/reference/include-force-symbol-references.md) option to override the removal of a specific symbol.  \n  \n When **/OPT:REF** is enabled either explicitly or by default, a limited form of **/OPT:ICF** is enabled that only folds identical functions. If you want **/OPT:REF** but not **/OPT:ICF**, you must specify either **/OPT:REF,NOICF** or **/OPT:NOICF**.  \n  \n If [/DEBUG](../../build/reference/debug-generate-debug-info.md) is specified, the default for **/OPT** is **NOREF**, and all functions are preserved in the image. To override this default and optimize a debugging build, specify **/OPT:REF**. Because **/OPT:REF** implies **/OPT:ICF**, we recommend that you also specify **/OPT:NOICF** to preserve identical functions in debugging builds. This makes it easier to read stack traces and set breakpoints in functions that would otherwise be folded together. The **/OPT:REF** option disables incremental linking.  \n  \n You have to explicitly mark `const` data as a COMDAT; use [__declspec(selectany)](../../cpp/selectany.md).  \n  \n Specifying **/OPT:ICF** does not enable the **/OPT:REF** option.  \n  \n **ICF[=**  `iterations` **] &#124; NOICF**  \n Use **/OPT:ICF[=**`iterations`**]** to perform identical COMDAT folding. Redundant COMDATs can be removed from the linker output. The optional `iterations` parameter specifies the number of times to traverse the symbols for duplicates. The default number of iterations is two. Additional iterations may locate more duplicates that are uncovered through folding in the previous iteration.  \n  \n The linker behaves differently when **/OPT:REF** is specified—and **ICF** is in effect by default—than it does when **/OPT:REF,ICF** is specified explicitly. The form of **ICF** that's enabled with **/OPT:REF** alone does not fold read-only data—this includes .rdata, .pdata, and .xdata. Therefore, fewer functions are folded when images are produced for [!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)] because functions in these modules are more dependent on read-only data—for example, .pdata and .xdata. To get full **ICF** folding behavior, explicitly specify **/OPT:ICF**.  \n  \n To place functions in COMDATs, you use the **/Gy** compiler option; to place `const` data, you declare it `__declspec(selectany)`. For information about how to specify data for folding, see [selectany](../../cpp/selectany.md).  \n  \n By default, **ICF** is on if **REF** is on. To override this default if **REF** is specified, use **NOICF**. When **/OPT:REF** is not specified in a debug build, you must explicitly specify **/OPT:ICF** to enable COMDAT folding. However, because **/OPT:ICF** can merge identical data or functions, it can change the function names that appear in stack traces. It can also make it impossible to set breakpoints in certain functions or to examine some data in the debugger, and take you into unexpected functions when you single-step through code. Therefore, we do not recommend that you use **/OPT:ICF** in debug builds unless the advantages of smaller code outweigh these disadvantages.  \n  \n> [!NOTE]\n>  Because **/OPT:ICF** can cause the same address to be assigned to different functions or read-only data members (`const` variables compiled by using **/Gy**), it can break a program that depends on unique addresses for functions or read-only data members. For more information, see [/Gy (Enable Function-Level Linking)](../../build/reference/gy-enable-function-level-linking.md).  \n  \n **LBR** &#124; **NOLBR**  \n The **/OPT:LBR** and **/OPT:NOLBR** options apply only to ARM binaries. Because certain ARM processor branch instructions have a limited range, if the linker detects a jump to an out-of-range address, it replaces the branch instruction’s destination address with the address of a code \"island\" that contains a branch instruction that targets the actual destination. You can use **/OPT:LBR** to optimize the detection of long branch instructions and the placement of intermediate code islands to minimize overall code size. **/OPT:NOLBR** instructs the linker to generate code islands for long branch instructions as they are encountered, without optimization.  \n  \n By default, the **/OPT:LBR** option is set when incremental linking is not enabled. If you want a non-incremental link but not long branch optimizations, specify **/OPT:NOLBR**. The **/OPT:LBR** option disables incremental linking.  \n  \n## Remarks  \n Optimizations generally decrease the image size and increase the program speed at a cost of increased link time.  \n  \n You can use the [/VERBOSE](../../build/reference/verbose-print-progress-messages.md) option to see the functions that are removed by **/OPT:REF** and the functions that are folded by **/OPT:ICF**.  \n  \n### To set the OPT:ICF or OPT:REF linker option in the Visual Studio development environment  \n  \n1.  Open the project's **Property Pages** dialog box. For details, see [Working with Project Properties](../../ide/working-with-project-properties.md).  \n  \n2.  In the left pane, expand **Configuration Properties**, **Linker**, **Optimization**.  \n  \n3.  Modify one of these properties:  \n  \n    -   **Enable COMDAT Folding**  \n  \n    -   **References**  \n  \n### To set the OPT:LBR linker option in the Visual Studio development environment  \n  \n1.  Open the project's **Property Pages** dialog box. For details, see [Setting Visual C++ Project Properties](../../ide/working-with-project-properties.md).  \n  \n2.  Select the **Linker** folder.  \n  \n3.  Select the **Command Line** property page.  \n  \n4.  Enter the option in **Additional Options**:  \n  \n     `/opt:lbr`  \n  \n### To set this linker option programmatically  \n  \n1.  See <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.EnableCOMDATFolding%2A> and <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.OptimizeReferences%2A> properties.  \n  \n## See Also  \n [Setting Linker Options](../../build/reference/setting-linker-options.md)   \n [Linker Options](../../build/reference/linker-options.md)"}