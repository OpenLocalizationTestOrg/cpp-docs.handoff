{"nodes":[{"pos":[12,47],"content":"Transaction (ODBC) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Transaction (ODBC) | Microsoft Docs","pos":[0,35]}]},{"content":"Transaction (ODBC)","pos":[809,827]},{"content":"This topic applies to the MFC ODBC classes.","pos":[828,871]},{"content":"A transaction is a way to group, or batch, a series of updates to a <bpt id=\"p1\">[</bpt>data source<ept id=\"p1\">](../../data/odbc/data-source-odbc.md)</ept> so that all are committed at once or none are committed if you roll back the transaction.","pos":[878,1086],"source":"A transaction is a way to group, or batch, a series of updates to a [data source](../../data/odbc/data-source-odbc.md) so that all are committed at once or none are committed if you roll back the transaction."},{"content":"If you do not use a transaction, changes to the data source are committed automatically rather than being committed on demand.","pos":[1087,1213]},{"pos":[1221,1834],"content":"[!NOTE]\n Not all ODBC database drivers support transactions. Call the `CanTransact` member function of your [CDatabase](../../mfc/reference/cdatabase-class.md) or [CRecordset](../../mfc/reference/crecordset-class.md) object to determine whether your driver supports transactions for a given database. Note that `CanTransact` does not tell you whether the data source provides full transaction support. You must also call `CDatabase::GetCursorCommitBehavior` and `CDatabase::GetCursorRollbackBehavior` after **CommitTrans** and **Rollback** to check the effect of the transaction on the open `CRecordset` object.","leadings":["","> "],"nodes":[{"content":" Not all ODBC database drivers support transactions. Call the `CanTransact` member function of your [CDatabase](../../mfc/reference/cdatabase-class.md) or [CRecordset](../../mfc/reference/crecordset-class.md) object to determine whether your driver supports transactions for a given database. Note that `CanTransact` does not tell you whether the data source provides full transaction support. You must also call `CDatabase::GetCursorCommitBehavior` and `CDatabase::GetCursorRollbackBehavior` after **CommitTrans** and **Rollback** to check the effect of the transaction on the open `CRecordset` object.","pos":[8,611],"nodes":[{"content":"Not all ODBC database drivers support transactions.","pos":[1,52]},{"content":"Call the <ph id=\"ph1\">`CanTransact`</ph> member function of your <bpt id=\"p1\">[</bpt>CDatabase<ept id=\"p1\">](../../mfc/reference/cdatabase-class.md)</ept> or <bpt id=\"p2\">[</bpt>CRecordset<ept id=\"p2\">](../../mfc/reference/crecordset-class.md)</ept> object to determine whether your driver supports transactions for a given database.","pos":[53,292],"source":" Call the `CanTransact` member function of your [CDatabase](../../mfc/reference/cdatabase-class.md) or [CRecordset](../../mfc/reference/crecordset-class.md) object to determine whether your driver supports transactions for a given database."},{"content":"Note that <ph id=\"ph1\">`CanTransact`</ph> does not tell you whether the data source provides full transaction support.","pos":[293,393],"source":" Note that `CanTransact` does not tell you whether the data source provides full transaction support."},{"content":"You must also call <ph id=\"ph1\">`CDatabase::GetCursorCommitBehavior`</ph> and <ph id=\"ph2\">`CDatabase::GetCursorRollbackBehavior`</ph> after <bpt id=\"p1\">**</bpt>CommitTrans<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Rollback<ept id=\"p2\">**</ept> to check the effect of the transaction on the open <ph id=\"ph3\">`CRecordset`</ph> object.","pos":[394,603],"source":" You must also call `CDatabase::GetCursorCommitBehavior` and `CDatabase::GetCursorRollbackBehavior` after **CommitTrans** and **Rollback** to check the effect of the transaction on the open `CRecordset` object."}]}]},{"content":"Calls to the <ph id=\"ph1\">`AddNew`</ph> and <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> member functions of a <ph id=\"ph2\">`CRecordset`</ph> object affect the data source immediately when you call <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>.","pos":[1841,1978],"source":"Calls to the `AddNew` and **Edit** member functions of a `CRecordset` object affect the data source immediately when you call **Update**."},{"content":"<bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> calls also take effect immediately.","pos":[1979,2025],"source":"**Delete** calls also take effect immediately."},{"content":"In contrast, you can use a transaction consisting of multiple calls to <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Delete<ept id=\"p3\">**</ept>, which are performed but not committed until you call <bpt id=\"p4\">**</bpt>CommitTrans<ept id=\"p4\">**</ept> explicitly.","pos":[2026,2225],"source":" In contrast, you can use a transaction consisting of multiple calls to `AddNew`, **Edit**, **Update**, and **Delete**, which are performed but not committed until you call **CommitTrans** explicitly."},{"content":"By establishing a transaction, you can execute a series of such calls while retaining the ability to roll them back.","pos":[2226,2342]},{"content":"If a critical resource is unavailable or some other condition prevents the entire transaction from being completed, you can roll back the transaction instead of committing it.","pos":[2343,2518]},{"content":"In that case, none of the changes belonging to the transaction affect the data source.","pos":[2519,2605]},{"pos":[2613,3097],"content":"[!NOTE]\n Currently, class `CRecordset` does not support updates to the data source if you have implemented bulk row fetching. This means you cannot make calls to `AddNew`, **Edit**, **Delete**, or **Update**. However, you can write you own functions to perform updates and then call those functions within a given transaction. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","leadings":["","> "],"nodes":[{"content":" Currently, class `CRecordset` does not support updates to the data source if you have implemented bulk row fetching. This means you cannot make calls to `AddNew`, **Edit**, **Delete**, or **Update**. However, you can write you own functions to perform updates and then call those functions within a given transaction. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","pos":[8,482],"nodes":[{"content":"Currently, class <ph id=\"ph1\">`CRecordset`</ph> does not support updates to the data source if you have implemented bulk row fetching.","pos":[1,117],"source":" Currently, class `CRecordset` does not support updates to the data source if you have implemented bulk row fetching."},{"content":"This means you cannot make calls to <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>, or <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept>.","pos":[118,200],"source":" This means you cannot make calls to `AddNew`, **Edit**, **Delete**, or **Update**."},{"content":"However, you can write you own functions to perform updates and then call those functions within a given transaction.","pos":[201,318]},{"content":"For more information about bulk row fetching, see <bpt id=\"p1\">[</bpt>Recordset: Fetching Records in Bulk (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)</ept>.","pos":[319,474],"source":" For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)."}]}]},{"pos":[3105,3332],"content":"[!NOTE]\n Besides affecting your recordset, transactions affect SQL statements that you execute directly as long as you use the ODBC **HDBC** associated with your `CDatabase` object or an ODBC **HSTMT** based on that **HDBC**.","leadings":["","> "],"nodes":[{"content":"Besides affecting your recordset, transactions affect SQL statements that you execute directly as long as you use the ODBC <bpt id=\"p1\">**</bpt>HDBC<ept id=\"p1\">**</ept> associated with your <ph id=\"ph1\">`CDatabase`</ph> object or an ODBC <bpt id=\"p2\">**</bpt>HSTMT<ept id=\"p2\">**</ept> based on that <bpt id=\"p3\">**</bpt>HDBC<ept id=\"p3\">**</ept>.","pos":[9,225],"source":" Besides affecting your recordset, transactions affect SQL statements that you execute directly as long as you use the ODBC **HDBC** associated with your `CDatabase` object or an ODBC **HSTMT** based on that **HDBC**."}]},{"content":"Transactions are particularly useful when you have multiple records that must be updated simultaneously.","pos":[3339,3443]},{"content":"In this case, you want to avoid a half-completed transaction, such as might happen if an exception was thrown before the last update was made.","pos":[3444,3586]},{"content":"Grouping such updates into a transaction allows a recovery (rollback) from the changes and returns the records to the pretransaction state.","pos":[3587,3726]},{"content":"For example, if a bank transfers money from account A to account B, both the withdrawal from A and the deposit to B must succeed to process the funds correctly or the whole transaction must fail.","pos":[3727,3922]},{"content":"In the database classes, you perform transactions through <ph id=\"ph1\">`CDatabase`</ph> objects.","pos":[3929,4007],"source":"In the database classes, you perform transactions through `CDatabase` objects."},{"content":"A <ph id=\"ph1\">`CDatabase`</ph> object represents a connection to a data source, and one or more recordsets associated with that <ph id=\"ph2\">`CDatabase`</ph> object operate on tables of the database through recordset member functions.","pos":[4008,4207],"source":" A `CDatabase` object represents a connection to a data source, and one or more recordsets associated with that `CDatabase` object operate on tables of the database through recordset member functions."},{"pos":[4215,4353],"content":"[!NOTE]\n Only one level of transactions is supported. You cannot nest transactions nor can a transaction span multiple database objects.","leadings":["","> "],"nodes":[{"content":" Only one level of transactions is supported. You cannot nest transactions nor can a transaction span multiple database objects.","pos":[8,136],"nodes":[{"content":"Only one level of transactions is supported.","pos":[1,45]},{"content":"You cannot nest transactions nor can a transaction span multiple database objects.","pos":[46,128]}]}]},{"content":"The following topics provide more information about how transactions are performed:","pos":[4360,4443]},{"content":"Transaction: Performing a Transaction in a Recordset (ODBC)","pos":[4454,4513]},{"content":"Transaction: How Transactions Affect Updates (ODBC)","pos":[4602,4653]},{"content":"See Also","pos":[4732,4740]},{"content":"Open Database Connectivity (ODBC)","pos":[4745,4778]}],"content":"---\ntitle: \"Transaction (ODBC) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"ODBC recordsets [C++], updating\"\n  - \"transactions [C++], MFC ODBC classes\"\n  - \"ODBC [C++], transactions\"\n  - \"recordsets [C++], updating\"\n  - \"databases [C++], transactions\"\n  - \"recordsets [C++], transactions\"\n  - \"ODBC recordsets [C++], transactions\"\nms.assetid: a2ec0995-2029-45f2-8092-6efd6f2a77f4\ncaps.latest.revision: 8\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Transaction (ODBC)\nThis topic applies to the MFC ODBC classes.  \n  \n A transaction is a way to group, or batch, a series of updates to a [data source](../../data/odbc/data-source-odbc.md) so that all are committed at once or none are committed if you roll back the transaction. If you do not use a transaction, changes to the data source are committed automatically rather than being committed on demand.  \n  \n> [!NOTE]\n>  Not all ODBC database drivers support transactions. Call the `CanTransact` member function of your [CDatabase](../../mfc/reference/cdatabase-class.md) or [CRecordset](../../mfc/reference/crecordset-class.md) object to determine whether your driver supports transactions for a given database. Note that `CanTransact` does not tell you whether the data source provides full transaction support. You must also call `CDatabase::GetCursorCommitBehavior` and `CDatabase::GetCursorRollbackBehavior` after **CommitTrans** and **Rollback** to check the effect of the transaction on the open `CRecordset` object.  \n  \n Calls to the `AddNew` and **Edit** member functions of a `CRecordset` object affect the data source immediately when you call **Update**. **Delete** calls also take effect immediately. In contrast, you can use a transaction consisting of multiple calls to `AddNew`, **Edit**, **Update**, and **Delete**, which are performed but not committed until you call **CommitTrans** explicitly. By establishing a transaction, you can execute a series of such calls while retaining the ability to roll them back. If a critical resource is unavailable or some other condition prevents the entire transaction from being completed, you can roll back the transaction instead of committing it. In that case, none of the changes belonging to the transaction affect the data source.  \n  \n> [!NOTE]\n>  Currently, class `CRecordset` does not support updates to the data source if you have implemented bulk row fetching. This means you cannot make calls to `AddNew`, **Edit**, **Delete**, or **Update**. However, you can write you own functions to perform updates and then call those functions within a given transaction. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  \n  \n> [!NOTE]\n>  Besides affecting your recordset, transactions affect SQL statements that you execute directly as long as you use the ODBC **HDBC** associated with your `CDatabase` object or an ODBC **HSTMT** based on that **HDBC**.  \n  \n Transactions are particularly useful when you have multiple records that must be updated simultaneously. In this case, you want to avoid a half-completed transaction, such as might happen if an exception was thrown before the last update was made. Grouping such updates into a transaction allows a recovery (rollback) from the changes and returns the records to the pretransaction state. For example, if a bank transfers money from account A to account B, both the withdrawal from A and the deposit to B must succeed to process the funds correctly or the whole transaction must fail.  \n  \n In the database classes, you perform transactions through `CDatabase` objects. A `CDatabase` object represents a connection to a data source, and one or more recordsets associated with that `CDatabase` object operate on tables of the database through recordset member functions.  \n  \n> [!NOTE]\n>  Only one level of transactions is supported. You cannot nest transactions nor can a transaction span multiple database objects.  \n  \n The following topics provide more information about how transactions are performed:  \n  \n-   [Transaction: Performing a Transaction in a Recordset (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)  \n  \n-   [Transaction: How Transactions Affect Updates (ODBC)](../../data/odbc/transaction-how-transactions-affect-updates-odbc.md)  \n  \n## See Also  \n [Open Database Connectivity (ODBC)](../../data/odbc/open-database-connectivity-odbc.md)"}