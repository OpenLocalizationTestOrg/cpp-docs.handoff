{"nodes":[{"pos":[12,47],"content":"CRT Initialization | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"CRT Initialization | Microsoft Docs","pos":[0,35]}]},{"content":"CRT Initialization","pos":[580,598]},{"content":"This topic describes how the CRT initializes global states in native code.","pos":[599,673]},{"content":"By default, the linker includes the CRT library, which provides its own startup code.","pos":[680,765]},{"content":"This startup code initializes the CRT library, calls global initializers, and then calls the user-provided <ph id=\"ph1\">`main`</ph> function for console applications.","pos":[766,914],"source":" This startup code initializes the CRT library, calls global initializers, and then calls the user-provided `main` function for console applications."},{"content":"Initializing a Global Object","pos":[923,951]},{"content":"Consider the following code:","pos":[955,983]},{"content":"According to the C/C++ standard, <ph id=\"ph1\">`func()`</ph> must be called before <ph id=\"ph2\">`main()`</ph> is executed.","pos":[1109,1194],"source":"According to the C/C++ standard, `func()` must be called before `main()` is executed."},{"content":"But who calls it?","pos":[1195,1212]},{"content":"One way to determine this is to set a breakpoint in <ph id=\"ph1\">`func()`</ph>, debug the application, and examine the stack.","pos":[1219,1326],"source":"One way to determine this is to set a breakpoint in `func()`, debug the application, and examine the stack."},{"content":"This is possible because the CRT source code is included with Visual Studio.","pos":[1327,1403]},{"content":"When you browse the functions on the stack, you will find that the CRT is looping through a list of function pointers and calling each one as it encounters them.","pos":[1410,1571]},{"content":"These functions are either similar to <ph id=\"ph1\">`func()`</ph> or constructors for class instances.","pos":[1572,1655],"source":" These functions are either similar to `func()` or constructors for class instances."},{"content":"The CRT obtains the list of function pointers from the Visual C++ compiler.","pos":[1662,1737]},{"content":"When the compiler sees a global initializer, it generates a dynamic initializer in the <ph id=\"ph1\">`.CRT$XCU`</ph> section (where <ph id=\"ph2\">`CRT`</ph> is the section name and <ph id=\"ph3\">`XCU`</ph> is the group name).","pos":[1738,1906],"source":" When the compiler sees a global initializer, it generates a dynamic initializer in the `.CRT$XCU` section (where `CRT` is the section name and `XCU` is the group name)."},{"content":"To obtain a list of those dynamic initializers run the command <bpt id=\"p1\">**</bpt>dumpbin /all main.obj<ept id=\"p1\">**</ept>, and then search the <ph id=\"ph1\">`.CRT$XCU`</ph> section (when main.cpp is compiled as a C++ file, not a C file).","pos":[1907,2092],"source":" To obtain a list of those dynamic initializers run the command **dumpbin /all main.obj**, and then search the `.CRT$XCU` section (when main.cpp is compiled as a C++ file, not a C file)."},{"content":"It will be similar to the following:","pos":[2093,2129]},{"content":"The CRT defines two pointers:","pos":[3001,3030]},{"pos":[3049,3051],"content":"in"},{"pos":[3081,3083],"content":"in"},{"pos":[3101,3180],"content":"Both groups do not have any other symbols defined except <ph id=\"ph1\">`__xc_a`</ph> and <ph id=\"ph2\">`__xc_z`</ph>.","source":"Both groups do not have any other symbols defined except `__xc_a` and `__xc_z`."},{"content":"Now, when the linker reads various <ph id=\"ph1\">`.CRT`</ph> groups, it combines them in one section and orders them alphabetically.","pos":[3187,3300],"source":"Now, when the linker reads various `.CRT` groups, it combines them in one section and orders them alphabetically."},{"content":"This means that the user-defined global initializers (which the Visual C++ compiler puts in <ph id=\"ph1\">`.CRT$XCU`</ph>) will always come after <ph id=\"ph2\">`.CRT$XCA`</ph> and before <ph id=\"ph3\">`.CRT$XCZ`</ph>.","pos":[3301,3461],"source":" This means that the user-defined global initializers (which the Visual C++ compiler puts in `.CRT$XCU`) will always come after `.CRT$XCA` and before `.CRT$XCZ`."},{"content":"The section will resemble the following:","pos":[3468,3508]},{"pos":[3697,3894],"content":"So, the CRT library uses both <ph id=\"ph1\">`__xc_a`</ph> and <ph id=\"ph2\">`__xc_z`</ph> to determine the start and end of the global initializers list because of the way in which they are laid out in memory after the image is loaded.","source":"So, the CRT library uses both `__xc_a` and `__xc_z` to determine the start and end of the global initializers list because of the way in which they are laid out in memory after the image is loaded."},{"content":"See Also","pos":[3903,3911]},{"content":"CRT Library Features","pos":[3916,3936]}],"content":"---\ntitle: \"CRT Initialization | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CRT initialization [C++]\"\nms.assetid: e7979813-1856-4848-9639-f29c86b74ad7\ncaps.latest.revision: 5\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# CRT Initialization\nThis topic describes how the CRT initializes global states in native code.  \n  \n By default, the linker includes the CRT library, which provides its own startup code. This startup code initializes the CRT library, calls global initializers, and then calls the user-provided `main` function for console applications.  \n  \n## Initializing a Global Object  \n Consider the following code:  \n  \n```  \nint func(void)  \n{  \n    return 3;  \n}  \n  \nint gi = func();  \n  \nint main()  \n{  \n    return gi;  \n}  \n```  \n  \n According to the C/C++ standard, `func()` must be called before `main()` is executed. But who calls it?  \n  \n One way to determine this is to set a breakpoint in `func()`, debug the application, and examine the stack. This is possible because the CRT source code is included with Visual Studio.  \n  \n When you browse the functions on the stack, you will find that the CRT is looping through a list of function pointers and calling each one as it encounters them. These functions are either similar to `func()` or constructors for class instances.  \n  \n The CRT obtains the list of function pointers from the Visual C++ compiler. When the compiler sees a global initializer, it generates a dynamic initializer in the `.CRT$XCU` section (where `CRT` is the section name and `XCU` is the group name). To obtain a list of those dynamic initializers run the command **dumpbin /all main.obj**, and then search the `.CRT$XCU` section (when main.cpp is compiled as a C++ file, not a C file). It will be similar to the following:  \n  \n```  \nSECTION HEADER #6  \n.CRT$XCU name  \n       0 physical address  \n       0 virtual address  \n       4 size of raw data  \n     1F2 file pointer to raw data (000001F2 to 000001F5)  \n     1F6 file pointer to relocation table  \n       0 file pointer to line numbers  \n       1 number of relocations  \n       0 number of line numbers  \n40300040 flags  \n         Initialized Data  \n         4 byte align  \n         Read Only  \n  \nRAW DATA #6  \n  00000000: 00 00 00 00                                      ....  \n  \nRELOCATIONS #6  \n                                                Symbol    Symbol  \n Offset    Type              Applied To         Index     Name  \n --------  ----------------  -----------------  --------  ------  \n 00000000  DIR32                      00000000         C  ??__Egi@@YAXXZ (void __cdecl `dynamic initializer for 'gi''(void))  \n```  \n  \n The CRT defines two pointers:  \n  \n-   `__xc_a` in `.CRT$XCA`  \n  \n-   `__xc_z` in `.CRT$XCZ`  \n  \n Both groups do not have any other symbols defined except `__xc_a` and `__xc_z`.  \n  \n Now, when the linker reads various `.CRT` groups, it combines them in one section and orders them alphabetically. This means that the user-defined global initializers (which the Visual C++ compiler puts in `.CRT$XCU`) will always come after `.CRT$XCA` and before `.CRT$XCZ`.  \n  \n The section will resemble the following:  \n  \n```  \n.CRT$XCA  \n            __xc_a  \n.CRT$XCU  \n            Pointer to Global Initializer 1  \n            Pointer to Global Initializer 2  \n.CRT$XCZ  \n            __xc_z  \n```  \n  \n So, the CRT library uses both `__xc_a` and `__xc_z` to determine the start and end of the global initializers list because of the way in which they are laid out in memory after the image is loaded.  \n  \n## See Also  \n [CRT Library Features](../c-runtime-library/crt-library-features.md)"}