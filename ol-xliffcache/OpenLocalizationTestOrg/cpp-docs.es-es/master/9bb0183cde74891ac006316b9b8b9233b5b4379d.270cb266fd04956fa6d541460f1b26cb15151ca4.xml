{"nodes":[{"pos":[12,104],"content":"_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler | Microsoft Docs","pos":[0,92]}]},{"content":"_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler","pos":[1316,1391]},{"content":"Sets a function to be called when the CRT detects an invalid argument.","pos":[1392,1462]},{"content":"Syntax","pos":[1471,1477]},{"content":"Parameters","pos":[1722,1732]},{"content":"[in]","pos":[1736,1740]},{"content":"The function pointer to the new invalid parameter handler.","pos":[1751,1809]},{"content":"Return Value","pos":[1818,1830]},{"content":"A pointer to the invalid parameter handler before the call.","pos":[1834,1893]},{"content":"Remarks","pos":[1902,1909]},{"content":"Many C runtime functions check the validity of arguments passed to them.","pos":[1913,1985]},{"content":"If an invalid argument is passed, the function can set the <ph id=\"ph1\">`errno`</ph> error number or return an error code.","pos":[1986,2090],"source":" If an invalid argument is passed, the function can set the `errno` error number or return an error code."},{"content":"In such cases, the invalid parameter handler is also called.","pos":[2091,2151]},{"content":"The C runtime supplies a default global invalid parameter handler that terminates the program and displays a runtime error message.","pos":[2152,2283]},{"content":"You can use the <ph id=\"ph1\">`_set_invalid_parameter_handler`</ph> to set your own function as the global invalid parameter handler.","pos":[2284,2398],"source":" You can use the `_set_invalid_parameter_handler` to set your own function as the global invalid parameter handler."},{"content":"The C runtime also supports a thread-local invalid parameter handler.","pos":[2399,2468]},{"content":"If a thread-local parameter handler is set in a thread by using <ph id=\"ph1\">`_set_thread_local_invalid_parameter_handler`</ph>, the C runtime functions called from the thread use that handler instead of the global handler.","pos":[2469,2674],"source":" If a thread-local parameter handler is set in a thread by using `_set_thread_local_invalid_parameter_handler`, the C runtime functions called from the thread use that handler instead of the global handler."},{"content":"Only one function can be specified as the global invalid argument handler at a time.","pos":[2675,2759]},{"content":"Only one function can be specified as the thread-local invalid argument handler per thread, but different threads can have different thread-local handlers.","pos":[2760,2915]},{"content":"This allows you to change the handler used in one part of your code without affecting the behavior of other threads.","pos":[2916,3032]},{"content":"When the runtime calls the invalid parameter function, it usually means that a nonrecoverable error occurred.","pos":[3039,3148]},{"content":"The invalid parameter handler function you supply should save any data it can and then abort.","pos":[3149,3242]},{"content":"It should not return control to the main function unless you are confident that the error is recoverable.","pos":[3243,3348]},{"content":"The invalid parameter handler function must have the following prototype:","pos":[3355,3428]},{"content":"The <ph id=\"ph1\">`expression`</ph> argument is a wide string representation of the argument expression that raised the error.","pos":[3625,3732],"source":"The `expression` argument is a wide string representation of the argument expression that raised the error."},{"content":"The <ph id=\"ph1\">`function`</ph> argument is the name of the CRT function that received the invalid argument.","pos":[3733,3824],"source":" The `function` argument is the name of the CRT function that received the invalid argument."},{"content":"The <ph id=\"ph1\">`file`</ph> argument is the name of the CRT source file that contains the function.","pos":[3825,3907],"source":" The `file` argument is the name of the CRT source file that contains the function."},{"content":"The <ph id=\"ph1\">`line`</ph> argument is the line number in that file.","pos":[3908,3960],"source":" The `line` argument is the line number in that file."},{"content":"The last argument is reserved.","pos":[3961,3991]},{"content":"The parameters all have the value <ph id=\"ph1\">`NULL`</ph> unless a debug version of the CRT library is used.","pos":[3992,4083],"source":" The parameters all have the value `NULL` unless a debug version of the CRT library is used."},{"content":"Requirements","pos":[4092,4104]},{"content":"Routine","pos":[4111,4118]},{"content":"Required header","pos":[4119,4134]},{"pos":[4211,4212],"content":","},{"content":"C: <ph id=\"ph1\">\\&lt;</ph>stdlib.h&gt;","pos":[4259,4273],"source":"C: \\<stdlib.h>"},{"content":"C++: <ph id=\"ph1\">\\&lt;</ph>cstdlib&gt; or <ph id=\"ph2\">\\&lt;</ph>stdlib.h&gt;","pos":[4286,4316],"source":"C++: \\<cstdlib> or \\<stdlib.h>"},{"content":"The <ph id=\"ph1\">`_set_invalid_parameter_handler`</ph> and <ph id=\"ph2\">`_set_thread_local_invalid_parameter_handler`</ph> functions are Microsoft specific.","pos":[4324,4444],"source":"The `_set_invalid_parameter_handler` and `_set_thread_local_invalid_parameter_handler` functions are Microsoft specific."},{"content":"For compatibility information, see <bpt id=\"p1\">[</bpt>Compatibility<ept id=\"p1\">](../../c-runtime-library/compatibility.md)</ept>.","pos":[4445,4538],"source":" For compatibility information, see [Compatibility](../../c-runtime-library/compatibility.md)."},{"content":"Example","pos":[4547,4554]},{"content":"In the following example, an invalid parameter error handler is used to print the function that received the invalid parameter and the file and line in CRT sources.","pos":[4558,4722]},{"content":"When the debug CRT library is used, invalid parameter errors also raise an assertion, which is disabled in this example using <bpt id=\"p1\">[</bpt>_CrtSetReportMode<ept id=\"p1\">](../../c-runtime-library/reference/crtsetreportmode.md)</ept>.","pos":[4723,4924],"source":" When the debug CRT library is used, invalid parameter errors also raise an assertion, which is disabled in this example using [_CrtSetReportMode](../../c-runtime-library/reference/crtsetreportmode.md)."},{"content":"See Also","pos":[6058,6066]},{"content":"_get_invalid_parameter_handler, _get_thread_local_invalid_parameter_handler","pos":[6071,6146]},{"content":"Security-Enhanced Versions of CRT Functions","pos":[6264,6307]},{"content":"errno, _doserrno, _sys_errlist, and _sys_nerr","pos":[6386,6431]}],"content":"---\ntitle: \"_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\napiname: \n  - \"_set_invalid_parameter_handler\"\n  - \"_set_thread_local_invalid_parameter_handler\"\napilocation: \n  - \"msvcrt.dll\"\n  - \"msvcr80.dll\"\n  - \"msvcr90.dll\"\n  - \"msvcr100.dll\"\n  - \"msvcr100_clr0400.dll\"\n  - \"msvcr110.dll\"\n  - \"msvcr110_clr0400.dll\"\n  - \"msvcr120.dll\"\n  - \"msvcr120_clr0400.dll\"\n  - \"ucrtbase.dll\"\n  - \"api-ms-win-crt-runtime-l1-1-0.dll\"\napitype: \"DLLExport\"\nf1_keywords: \n  - \"set_invalid_parameter_handler\"\n  - \"_set_invalid_parameter_handler\"\n  - \"_set_thread_local_invalid_parameter_handler\"\ndev_langs: \n  - \"C++\"\n  - \"C\"\nhelpviewer_keywords: \n  - \"invalid parameter handler\"\n  - \"set_invalid_parameter_handler function\"\n  - \"_set_invalid_parameter_handler function\"\n  - \"_set_thread_local_invalid_parameter_handler function\"\nms.assetid: c0e67934-1a41-4016-ad8e-972828f3ac11\ncaps.latest.revision: 27\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# _set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler\nSets a function to be called when the CRT detects an invalid argument.  \n  \n## Syntax  \n  \n```  \n_invalid_parameter_handler _set_invalid_parameter_handler(  \n   _invalid_parameter_handler pNew  \n);  \n_invalid_parameter_handler _set_thread_local_invalid_parameter_handler(  \n   _invalid_parameter_handler pNew  \n);  \n```  \n  \n#### Parameters  \n [in] `pNew`  \n The function pointer to the new invalid parameter handler.  \n  \n## Return Value  \n A pointer to the invalid parameter handler before the call.  \n  \n## Remarks  \n Many C runtime functions check the validity of arguments passed to them. If an invalid argument is passed, the function can set the `errno` error number or return an error code. In such cases, the invalid parameter handler is also called. The C runtime supplies a default global invalid parameter handler that terminates the program and displays a runtime error message. You can use the `_set_invalid_parameter_handler` to set your own function as the global invalid parameter handler. The C runtime also supports a thread-local invalid parameter handler. If a thread-local parameter handler is set in a thread by using `_set_thread_local_invalid_parameter_handler`, the C runtime functions called from the thread use that handler instead of the global handler. Only one function can be specified as the global invalid argument handler at a time. Only one function can be specified as the thread-local invalid argument handler per thread, but different threads can have different thread-local handlers. This allows you to change the handler used in one part of your code without affecting the behavior of other threads.  \n  \n When the runtime calls the invalid parameter function, it usually means that a nonrecoverable error occurred. The invalid parameter handler function you supply should save any data it can and then abort. It should not return control to the main function unless you are confident that the error is recoverable.  \n  \n The invalid parameter handler function must have the following prototype:  \n  \n```c  \nvoid _invalid_parameter(  \n   const wchar_t * expression,  \n   const wchar_t * function,   \n   const wchar_t * file,   \n   unsigned int line,  \n   uintptr_t pReserved  \n);  \n```  \n  \n The `expression` argument is a wide string representation of the argument expression that raised the error. The `function` argument is the name of the CRT function that received the invalid argument. The `file` argument is the name of the CRT source file that contains the function. The `line` argument is the line number in that file. The last argument is reserved. The parameters all have the value `NULL` unless a debug version of the CRT library is used.  \n  \n## Requirements  \n  \n|Routine|Required header|  \n|-------------|---------------------|  \n|`_set_invalid_parameter_handler`, `_set_thread_local_invalid_parameter_handler`|C: \\<stdlib.h><br /><br /> C++: \\<cstdlib> or \\<stdlib.h>|  \n  \n The `_set_invalid_parameter_handler` and `_set_thread_local_invalid_parameter_handler` functions are Microsoft specific. For compatibility information, see [Compatibility](../../c-runtime-library/compatibility.md).  \n  \n## Example  \n In the following example, an invalid parameter error handler is used to print the function that received the invalid parameter and the file and line in CRT sources. When the debug CRT library is used, invalid parameter errors also raise an assertion, which is disabled in this example using [_CrtSetReportMode](../../c-runtime-library/reference/crtsetreportmode.md).  \n  \n```c  \n// crt_set_invalid_parameter_handler.c  \n// compile with: /Zi /MTd  \n#include <stdio.h>  \n#include <stdlib.h>  \n#include <crtdbg.h>  // For _CrtSetReportMode  \n  \nvoid myInvalidParameterHandler(const wchar_t* expression,  \n   const wchar_t* function,   \n   const wchar_t* file,   \n   unsigned int line,   \n   uintptr_t pReserved)  \n{  \n   wprintf(L\"Invalid parameter detected in function %s.\"  \n            L\" File: %s Line: %d\\n\", function, file, line);  \n   wprintf(L\"Expression: %s\\n\", expression);  \n   abort();  \n}  \n  \nint main( )  \n{  \n   char* formatString;  \n  \n   _invalid_parameter_handler oldHandler, newHandler;  \n   newHandler = myInvalidParameterHandler;  \n   oldHandler = _set_invalid_parameter_handler(newHandler);  \n  \n   // Disable the message box for assertions.  \n   _CrtSetReportMode(_CRT_ASSERT, 0);  \n  \n   // Call printf_s with invalid parameters.  \n  \n   formatString = NULL;  \n   printf(formatString);  \n}  \n```  \n  \n```Output  \nInvalid parameter detected in function common_vfprintf. File: minkernel\\crts\\ucrt\\src\\appcrt\\stdio\\output.cpp Line: 32  \nExpression: format != nullptr  \n```  \n  \n## See Also  \n [_get_invalid_parameter_handler, _get_thread_local_invalid_parameter_handler](../../c-runtime-library/reference/get-invalid-parameter-handler-get-thread-local-invalid-parameter-handler.md)   \n [Security-Enhanced Versions of CRT Functions](../../c-runtime-library/security-enhanced-versions-of-crt-functions.md)   \n [errno, _doserrno, _sys_errlist, and _sys_nerr](../../c-runtime-library/errno-doserrno-sys-errlist-and-sys-nerr.md)"}