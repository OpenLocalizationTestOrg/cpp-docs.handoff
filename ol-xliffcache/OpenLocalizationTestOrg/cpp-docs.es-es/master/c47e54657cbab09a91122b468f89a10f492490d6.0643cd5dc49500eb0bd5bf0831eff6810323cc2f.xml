{"nodes":[{"pos":[12,71],"content":"Supporting Free Threading in Your Provider | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Supporting Free Threading in Your Provider | Microsoft Docs","pos":[0,59]}]},{"content":"Supporting Free Threading in Your Provider","pos":[644,686]},{"content":"All the OLE DB provider classes are thread-safe, and registry entries are set accordingly.","pos":[687,777]},{"content":"It is a good idea to support free threading to help provide a high level of performance in multiuser situations.","pos":[778,890]},{"content":"To help keep your provider thread-safe, you must verify that your code is blocked properly.","pos":[891,982]},{"content":"Whenever you write or store data, you must block the access with critical sections.","pos":[983,1066]},{"content":"Each OLE DB provider template object has its own critical section.","pos":[1073,1139]},{"content":"To make blocking easier, each new class you create should be a template class taking the parent class name as an argument.","pos":[1140,1262]},{"content":"The following example shows how to block your code:","pos":[1269,1320]},{"pos":[1826,2046],"content":"For more information about how to protect critical sections with <ph id=\"ph1\">`Lock`</ph> and <ph id=\"ph2\">`Unlock`</ph>, see <bpt id=\"p1\">[</bpt>Multithreading: How To Use the Synchronization Classes<ept id=\"p1\">](../../parallel/multithreading-how-to-use-the-synchronization-classes.md)</ept>.","source":"For more information about how to protect critical sections with `Lock` and `Unlock`, see [Multithreading: How To Use the Synchronization Classes](../../parallel/multithreading-how-to-use-the-synchronization-classes.md)."},{"pos":[2053,2140],"content":"You must also verify that any methods you override (such as <ph id=\"ph1\">`Execute`</ph>) are thread-safe.","source":"You must also verify that any methods you override (such as `Execute`) are thread-safe."},{"content":"See Also","pos":[2149,2157]},{"content":"Working with OLE DB Provider Templates","pos":[2162,2200]}],"content":"---\ntitle: \"Supporting Free Threading in Your Provider | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"OLE DB providers, multithreaded\"\n  - \"threading [C++], providers\"\nms.assetid: a91270dc-cdf9-4855-88e7-88a54be7cbe8\ncaps.latest.revision: 8\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Supporting Free Threading in Your Provider\nAll the OLE DB provider classes are thread-safe, and registry entries are set accordingly. It is a good idea to support free threading to help provide a high level of performance in multiuser situations. To help keep your provider thread-safe, you must verify that your code is blocked properly. Whenever you write or store data, you must block the access with critical sections.  \n  \n Each OLE DB provider template object has its own critical section. To make blocking easier, each new class you create should be a template class taking the parent class name as an argument.  \n  \n The following example shows how to block your code:  \n  \n```  \ntemplate <class T>  \nclass CMyObject<T> : public...  \n  \nHRESULT MyObject::MyMethod(void)  \n{  \n   T* pT = (T*)this;      // this gets the parent class   \n  \n// You don't need to do anything if you are only reading information  \n  \n// If you want to write information, do the following:  \n   pT->Lock();         // engages critical section in the object  \n   ...;                // write whatever information you wish  \n   pT->Unlock();       // disengages the critical section  \n}  \n```  \n  \n For more information about how to protect critical sections with `Lock` and `Unlock`, see [Multithreading: How To Use the Synchronization Classes](../../parallel/multithreading-how-to-use-the-synchronization-classes.md).  \n  \n You must also verify that any methods you override (such as `Execute`) are thread-safe.  \n  \n## See Also  \n [Working with OLE DB Provider Templates](../../data/oledb/working-with-ole-db-provider-templates.md)"}