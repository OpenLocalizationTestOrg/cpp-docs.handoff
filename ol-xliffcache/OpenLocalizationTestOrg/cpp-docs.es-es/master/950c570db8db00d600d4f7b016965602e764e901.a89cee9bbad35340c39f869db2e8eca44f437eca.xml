{"nodes":[{"pos":[12,89],"content":"How to: Use Exception Handling to Break from a Parallel Loop | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Use Exception Handling to Break from a Parallel Loop | Microsoft Docs","pos":[0,77]}]},{"content":"How to: Use Exception Handling to Break from a Parallel Loop","pos":[727,787]},{"content":"This topic shows how to write a search algorithm for a basic tree structure.","pos":[788,864]},{"content":"The topic <bpt id=\"p1\">[</bpt>Cancellation<ept id=\"p1\">](cancellation-in-the-ppl.md)</ept> explains the role of cancellation in the Parallel Patterns Library.","pos":[871,991],"source":"The topic [Cancellation](cancellation-in-the-ppl.md) explains the role of cancellation in the Parallel Patterns Library."},{"content":"The use of exception handling is a less efficient way to cancel parallel work than the use of the <bpt id=\"p1\">[</bpt>concurrency::task_group::cancel<ept id=\"p1\">](reference/task-group-class.md#cancel)</ept> and <bpt id=\"p2\">[</bpt>concurrency::structured_task_group::cancel<ept id=\"p2\">](reference/structured-task-group-class.md#cancel)</ept> methods.","pos":[992,1268],"source":" The use of exception handling is a less efficient way to cancel parallel work than the use of the [concurrency::task_group::cancel](reference/task-group-class.md#cancel) and [concurrency::structured_task_group::cancel](reference/structured-task-group-class.md#cancel) methods."},{"content":"However, one scenario where the use of exception handling to cancel work is appropriate is when you call into a third-party library that uses tasks or parallel algorithms but does not provide a <ph id=\"ph1\">`task_group`</ph> or <ph id=\"ph2\">`structured_task_group`</ph> object to cancel.","pos":[1269,1520],"source":" However, one scenario where the use of exception handling to cancel work is appropriate is when you call into a third-party library that uses tasks or parallel algorithms but does not provide a `task_group` or `structured_task_group` object to cancel."},{"content":"Example","pos":[1530,1537]},{"content":"The following example shows a basic <ph id=\"ph1\">`tree`</ph> type that contains a data element and a list of child nodes.","pos":[1541,1644],"source":"The following example shows a basic `tree` type that contains a data element and a list of child nodes."},{"content":"The following section shows the body of the <ph id=\"ph1\">`for_all`</ph> method, which recursively performs a work function on each child node.","pos":[1645,1769],"source":" The following section shows the body of the `for_all` method, which recursively performs a work function on each child node."},{"pos":[1787,1812],"content":"concrt-task-tree-search#2"},{"content":"Example","pos":[1928,1935]},{"content":"The following example shows the <ph id=\"ph1\">`for_all`</ph> method.","pos":[1939,1988],"source":"The following example shows the `for_all` method."},{"content":"It uses the <bpt id=\"p1\">[</bpt>concurrency::parallel_for_each<ept id=\"p1\">](reference/concurrency-namespace-functions.md#parallel_for_each)</ept> algorithm to perform a work function on each node of the tree in parallel.","pos":[1989,2172],"source":" It uses the [concurrency::parallel_for_each](reference/concurrency-namespace-functions.md#parallel_for_each) algorithm to perform a work function on each node of the tree in parallel."},{"pos":[2190,2215],"content":"concrt-task-tree-search#1"},{"content":"Example","pos":[2331,2338]},{"content":"The following example shows the <ph id=\"ph1\">`search_for_value`</ph> function, which searches for a value in the provided <ph id=\"ph2\">`tree`</ph> object.","pos":[2342,2460],"source":"The following example shows the `search_for_value` function, which searches for a value in the provided `tree` object."},{"content":"This function passes to the <ph id=\"ph1\">`for_all`</ph> method a work function that throws when it finds a tree node that contains the provided value.","pos":[2461,2593],"source":" This function passes to the `for_all` method a work function that throws when it finds a tree node that contains the provided value."},{"content":"Assume that the <ph id=\"ph1\">`tree`</ph> class is provided by a third-party library, and that you cannot modify it.","pos":[2600,2697],"source":"Assume that the `tree` class is provided by a third-party library, and that you cannot modify it."},{"content":"In this case, the use of exception handling is appropriate because the <ph id=\"ph1\">`for_all`</ph> method does not provide a <ph id=\"ph2\">`task_group`</ph> or <ph id=\"ph3\">`structured_task_group`</ph> object to the caller.","pos":[2698,2866],"source":" In this case, the use of exception handling is appropriate because the `for_all` method does not provide a `task_group` or `structured_task_group` object to the caller."},{"content":"Therefore, the work function is unable to directly cancel its parent task group.","pos":[2867,2947]},{"content":"When the work function that you provide to a task group throws an exception, the runtime stops all tasks that are in the task group (including any child task groups) and discards any tasks that have not yet started.","pos":[2954,3169]},{"content":"The <ph id=\"ph1\">`search_for_value`</ph> function uses a <ph id=\"ph2\">`try`-`catch`</ph> block to capture the exception and print the result to the console.","pos":[3170,3290],"source":" The `search_for_value` function uses a `try`-`catch` block to capture the exception and print the result to the console."},{"pos":[3308,3333],"content":"concrt-task-tree-search#3"},{"content":"Example","pos":[3449,3456]},{"content":"The following example creates a <ph id=\"ph1\">`tree`</ph> object and searches it for several values in parallel.","pos":[3460,3553],"source":"The following example creates a `tree` object and searches it for several values in parallel."},{"content":"The <ph id=\"ph1\">`build_tree`</ph> function is shown later in this topic.","pos":[3554,3609],"source":" The `build_tree` function is shown later in this topic."},{"pos":[3627,3652],"content":"concrt-task-tree-search#4"},{"content":"This example uses the <bpt id=\"p1\">[</bpt>concurrency::parallel_invoke<ept id=\"p1\">](reference/concurrency-namespace-functions.md#parallel_invoke)</ept> algorithm to search for values in parallel.","pos":[3766,3924],"source":"This example uses the [concurrency::parallel_invoke](reference/concurrency-namespace-functions.md#parallel_invoke) algorithm to search for values in parallel."},{"content":"For more information about this algorithm, see <bpt id=\"p1\">[</bpt>Parallel Algorithms<ept id=\"p1\">](../../parallel/concrt/parallel-algorithms.md)</ept>.","pos":[3925,4040],"source":" For more information about this algorithm, see [Parallel Algorithms](../../parallel/concrt/parallel-algorithms.md)."},{"content":"Example","pos":[4049,4056]},{"content":"The following complete example uses exception handling to search for values in a basic tree structure.","pos":[4060,4162]},{"pos":[4180,4205],"content":"concrt-task-tree-search#5"},{"content":"This example produces the following sample output.","pos":[4319,4369]},{"content":"Compiling the Code","pos":[4503,4521]},{"pos":[4525,4723],"content":"Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named <ph id=\"ph1\">`task-tree-search.cpp`</ph> and then run the following command in a Visual Studio Command Prompt window.","source":"Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `task-tree-search.cpp` and then run the following command in a Visual Studio Command Prompt window."},{"content":"cl.exe /EHsc task-tree-search.cpp","pos":[4732,4765]},{"content":"See Also","pos":[4776,4784]},{"content":"Cancellation in the PPL","pos":[4789,4812]},{"content":"Exception Handling","pos":[4847,4865]},{"content":"Task Parallelism","pos":[4944,4960]},{"content":"Parallel Algorithms","pos":[5030,5049]},{"content":"task_group Class","pos":[5102,5118]},{"content":"structured_task_group Class","pos":[5156,5183]},{"content":"parallel_for_each Function","pos":[5254,5280]}],"content":"---\ntitle: \"How to: Use Exception Handling to Break from a Parallel Loop | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"search algorithm, writing [Concurrency Runtime]\"\n  - \"writing a search algorithm [Concurrency Runtime]\"\nms.assetid: 16d7278c-2d10-4014-9f58-f1899e719ff9\ncaps.latest.revision: 15\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"ru-ru\"\n  - \"zh-cn\"\n  - \"zh-tw\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# How to: Use Exception Handling to Break from a Parallel Loop\nThis topic shows how to write a search algorithm for a basic tree structure.  \n  \n The topic [Cancellation](cancellation-in-the-ppl.md) explains the role of cancellation in the Parallel Patterns Library. The use of exception handling is a less efficient way to cancel parallel work than the use of the [concurrency::task_group::cancel](reference/task-group-class.md#cancel) and [concurrency::structured_task_group::cancel](reference/structured-task-group-class.md#cancel) methods. However, one scenario where the use of exception handling to cancel work is appropriate is when you call into a third-party library that uses tasks or parallel algorithms but does not provide a `task_group` or `structured_task_group` object to cancel.  \n\n  \n## Example  \n The following example shows a basic `tree` type that contains a data element and a list of child nodes. The following section shows the body of the `for_all` method, which recursively performs a work function on each child node.  \n  \n [!code-cpp[concrt-task-tree-search#2](../../parallel/concrt/codesnippet/cpp/how-to-use-exception-handling-to-break-from-a-parallel-loop_1.cpp)]  \n  \n## Example  \n The following example shows the `for_all` method. It uses the [concurrency::parallel_for_each](reference/concurrency-namespace-functions.md#parallel_for_each) algorithm to perform a work function on each node of the tree in parallel.  \n  \n [!code-cpp[concrt-task-tree-search#1](../../parallel/concrt/codesnippet/cpp/how-to-use-exception-handling-to-break-from-a-parallel-loop_2.cpp)]  \n  \n## Example  \n The following example shows the `search_for_value` function, which searches for a value in the provided `tree` object. This function passes to the `for_all` method a work function that throws when it finds a tree node that contains the provided value.  \n  \n Assume that the `tree` class is provided by a third-party library, and that you cannot modify it. In this case, the use of exception handling is appropriate because the `for_all` method does not provide a `task_group` or `structured_task_group` object to the caller. Therefore, the work function is unable to directly cancel its parent task group.  \n  \n When the work function that you provide to a task group throws an exception, the runtime stops all tasks that are in the task group (including any child task groups) and discards any tasks that have not yet started. The `search_for_value` function uses a `try`-`catch` block to capture the exception and print the result to the console.  \n  \n [!code-cpp[concrt-task-tree-search#3](../../parallel/concrt/codesnippet/cpp/how-to-use-exception-handling-to-break-from-a-parallel-loop_3.cpp)]  \n  \n## Example  \n The following example creates a `tree` object and searches it for several values in parallel. The `build_tree` function is shown later in this topic.  \n  \n [!code-cpp[concrt-task-tree-search#4](../../parallel/concrt/codesnippet/cpp/how-to-use-exception-handling-to-break-from-a-parallel-loop_4.cpp)]  \n  \n This example uses the [concurrency::parallel_invoke](reference/concurrency-namespace-functions.md#parallel_invoke) algorithm to search for values in parallel. For more information about this algorithm, see [Parallel Algorithms](../../parallel/concrt/parallel-algorithms.md).  \n  \n## Example  \n The following complete example uses exception handling to search for values in a basic tree structure.  \n  \n [!code-cpp[concrt-task-tree-search#5](../../parallel/concrt/codesnippet/cpp/how-to-use-exception-handling-to-break-from-a-parallel-loop_5.cpp)]  \n  \n This example produces the following sample output.  \n  \n```Output  \nFound a node with value 32614.  \nFound a node with value 86131.  \nDid not find node with value 17522.  \n```  \n  \n## Compiling the Code  \n Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `task-tree-search.cpp` and then run the following command in a Visual Studio Command Prompt window.  \n  \n **cl.exe /EHsc task-tree-search.cpp**  \n  \n## See Also  \n [Cancellation in the PPL](cancellation-in-the-ppl.md)   \n [Exception Handling](../../parallel/concrt/exception-handling-in-the-concurrency-runtime.md)   \n [Task Parallelism](../../parallel/concrt/task-parallelism-concurrency-runtime.md)   \n [Parallel Algorithms](../../parallel/concrt/parallel-algorithms.md)   \n [task_group Class](reference/task-group-class.md)   \n [structured_task_group Class](../../parallel/concrt/reference/structured-task-group-class.md)   \n [parallel_for_each Function](reference/concurrency-namespace-functions.md#parallel_for_each)\n\n\n"}