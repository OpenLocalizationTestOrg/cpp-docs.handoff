{"nodes":[{"pos":[12,62],"content":"Consumer Wizard-Generated Methods | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Consumer Wizard-Generated Methods | Microsoft Docs","pos":[0,50]}]},{"content":"Consumer Wizard-Generated Methods","pos":[976,1009]},{"content":"The ATL OLE DB Consumer Wizard and the MFC Application Wizard generate certain functions of which you should be aware.","pos":[1010,1128]},{"content":"Note that some methods are implemented differently in attributed projects, so there are a few caveats; each case is covered below.","pos":[1129,1259]},{"content":"For information about viewing injected code, see <bpt id=\"p1\">[</bpt>Debugging Injected Code<ept id=\"p1\">](http://msdn.microsoft.com/library/a1b4104d-d49e-451f-a91e-e39ceaf35875)</ept>.","pos":[1260,1407],"source":" For information about viewing injected code, see [Debugging Injected Code](http://msdn.microsoft.com/library/a1b4104d-d49e-451f-a91e-e39ceaf35875)."},{"pos":[1427,1504],"content":"opens the data source, rowsets, and turns on bookmarks if they are available."},{"pos":[1525,1585],"content":"closes all open rowsets and releases all command executions."},{"pos":[1608,1670],"content":"is called by OpenAll to open the consumer's rowset or rowsets."},{"pos":[1702,1784],"content":"retrieves a pointer to the rowset's property set with which properties can be set."},{"pos":[1811,1922],"content":"opens the data source using the initialization string you specified in the <bpt id=\"p1\">**</bpt>Data Link Properties<ept id=\"p1\">**</ept> dialog box.","source":" opens the data source using the initialization string you specified in the **Data Link Properties** dialog box."},{"pos":[1950,1998],"content":"closes the data source in an appropriate manner."},{"content":"OpenAll and CloseAll","pos":[2007,2027]},{"content":"The following example shows how you can call <ph id=\"ph1\">`OpenAll`</ph> and <ph id=\"ph2\">`CloseAll`</ph> when you execute the same command repeatedly.","pos":[2090,2205],"source":"The following example shows how you can call `OpenAll` and `CloseAll` when you execute the same command repeatedly."},{"content":"Compare the code example in <bpt id=\"p1\">[</bpt>CCommand::Close<ept id=\"p1\">](../../data/oledb/ccommand-close.md)</ept>, which shows a variation that calls <bpt id=\"p2\">**</bpt>Close<ept id=\"p2\">**</ept> and <ph id=\"ph1\">`ReleaseCommand`</ph> instead of <ph id=\"ph2\">`CloseAll`</ph>.","pos":[2206,2377],"source":" Compare the code example in [CCommand::Close](../../data/oledb/ccommand-close.md), which shows a variation that calls **Close** and `ReleaseCommand` instead of `CloseAll`."},{"content":"Remarks","pos":[3597,3604]},{"pos":[3608,3782],"content":"Note that if you define a <ph id=\"ph1\">`HasBookmark`</ph> method, the <ph id=\"ph2\">`OpenAll`</ph> code sets the DBPROP_IRowsetLocate property; make sure you only do this if your provider supports that property.","source":"Note that if you define a `HasBookmark` method, the `OpenAll` code sets the DBPROP_IRowsetLocate property; make sure you only do this if your provider supports that property."},{"content":"OpenRowset","pos":[3791,3801]},{"content":"<bpt id=\"p1\">**</bpt>OpenAll<ept id=\"p1\">**</ept> calls this method to open the rowset or rowsets in the consumer.","pos":[4009,4085],"source":"**OpenAll** calls this method to open the rowset or rowsets in the consumer."},{"content":"Typically, you do not need to call <ph id=\"ph1\">`OpenRowset`</ph> unless you want to work with multiple data sources/sessions/rowsets.","pos":[4086,4202],"source":" Typically, you do not need to call `OpenRowset` unless you want to work with multiple data sources/sessions/rowsets."},{"content":"is declared in the command or table class header file:","pos":[4216,4270]},{"content":"The attributes implement this method differently.","pos":[4531,4580]},{"content":"This version takes a session object and a command string that defaults to the command string specified in db_command, although you can pass a different one.","pos":[4581,4737]},{"content":"Note that if you define a <ph id=\"ph1\">`HasBookmark`</ph> method, the <ph id=\"ph2\">`OpenRowset`</ph> code sets the DBPROP_IRowsetLocate property; make sure you only do this if your provider supports that property.","pos":[4738,4915],"source":" Note that if you define a `HasBookmark` method, the `OpenRowset` code sets the DBPROP_IRowsetLocate property; make sure you only do this if your provider supports that property."},{"content":"GetRowsetProperties","pos":[5270,5289]},{"content":"This method retrieves a pointer to the rowset's property set; you can use this pointer to set properties such as DBPROP_IRowsetChange.","pos":[5361,5495]},{"content":"is used in the user record class as follows.","pos":[5518,5562]},{"content":"You can modify this code to set additional rowset properties:","pos":[5563,5624]},{"content":"Remarks","pos":[6068,6075]},{"content":"You should not define a global <ph id=\"ph1\">`GetRowsetProperties`</ph> method because it could conflict with the one defined by the wizard.","pos":[6079,6200],"source":"You should not define a global `GetRowsetProperties` method because it could conflict with the one defined by the wizard."},{"content":"Note that this is a wizard-generated method that you get with templated and attributed projects; the attributes do not inject this code.","pos":[6201,6337]},{"content":"OpenDataSource and CloseDataSource","pos":[6346,6380]},{"content":"Remarks","pos":[6459,6466]},{"pos":[6470,6670],"content":"The wizard defines the methods <ph id=\"ph1\">`OpenDataSource`</ph> and <ph id=\"ph2\">`CloseDataSource`</ph>; <ph id=\"ph3\">`OpenDataSource`</ph> calls <bpt id=\"p1\">[</bpt>CDataSource::OpenFromInitializationString<ept id=\"p1\">](../../data/oledb/cdatasource-openfrominitializationstring.md)</ept>.","source":"The wizard defines the methods `OpenDataSource` and `CloseDataSource`; `OpenDataSource` calls [CDataSource::OpenFromInitializationString](../../data/oledb/cdatasource-openfrominitializationstring.md)."},{"content":"See Also","pos":[6679,6687]},{"content":"Creating an OLE DB Consumer Using a Wizard","pos":[6692,6734]}],"content":"---\ntitle: \"Consumer Wizard-Generated Methods | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"OpenAll method\"\n  - \"attribute-injected classes and methods\"\n  - \"wizard-generated classes and methods\"\n  - \"OLE DB consumers, wizard-generated classes and methods\"\n  - \"methods [C++], OLE DB Consumer Wizard-generated\"\n  - \"CloseDataSource method\"\n  - \"consumer wizard-generated classes and methods\"\n  - \"OpenDataSource method\"\n  - \"CloseAll method\"\n  - \"OpenRowset method\"\n  - \"GetRowsetProperties method\"\nms.assetid: d80ee51c-8bb3-4dca-8760-5808e0fb47b4\ncaps.latest.revision: 7\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Consumer Wizard-Generated Methods\nThe ATL OLE DB Consumer Wizard and the MFC Application Wizard generate certain functions of which you should be aware. Note that some methods are implemented differently in attributed projects, so there are a few caveats; each case is covered below. For information about viewing injected code, see [Debugging Injected Code](http://msdn.microsoft.com/library/a1b4104d-d49e-451f-a91e-e39ceaf35875).  \n  \n-   `OpenAll` opens the data source, rowsets, and turns on bookmarks if they are available.  \n  \n-   `CloseAll` closes all open rowsets and releases all command executions.  \n  \n-   `OpenRowset` is called by OpenAll to open the consumer's rowset or rowsets.  \n  \n-   `GetRowsetProperties` retrieves a pointer to the rowset's property set with which properties can be set.  \n  \n-   `OpenDataSource` opens the data source using the initialization string you specified in the **Data Link Properties** dialog box.  \n  \n-   `CloseDataSource` closes the data source in an appropriate manner.  \n  \n## OpenAll and CloseAll  \n  \n```  \nHRESULT OpenAll();   \nvoid CloseAll();  \n```  \n  \n The following example shows how you can call `OpenAll` and `CloseAll` when you execute the same command repeatedly. Compare the code example in [CCommand::Close](../../data/oledb/ccommand-close.md), which shows a variation that calls **Close** and `ReleaseCommand` instead of `CloseAll`.  \n  \n```  \nint main(int argc, char* argv[])  \n{  \n   HRESULT hr;  \n  \n   hr = CoInitialize(NULL);  \n  \n   CCustOrdersDetail rs;      // Your CCommand-derived class  \n   rs.m_OrderID = 10248;      // Open order 10248  \n   hr = rs.OpenAll();         // (Open also executes the command)  \n   hr = rs.MoveFirst();         // Move to the first row and print it  \n   printf( \"Name: %s, Unit Price: %d, Quantity: %d, Discount %d, Extended Price %d\\n\", rs.m_ProductName, rs.m_UnitPrice.int64, rs.m_Quantity, rs.m_Discount, rs.m_ExtendedPrice.int64 );  \n  \n   // Close the first command execution  \n   rs.Close();  \n  \n   rs.m_OrderID = 10249;      // Open order 10249 (a new order)  \n   hr = rs.Open();            // (Open also executes the command)  \n   hr = rs.MoveFirst();         // Move to the first row and print it  \n   printf( \"Name: %s, Unit Price: %d, Quantity: %d, Discount %d, Extended Price %d\\n\", rs.m_ProductName, rs.m_UnitPrice.int64, rs.m_Quantity, rs.m_Discount, rs.m_ExtendedPrice.int64 );  \n  \n   // Close the second command execution;  \n   // Instead of rs.CloseAll() you could call  \n   // rs.Close() and rs.ReleaseCommand():  \n   rs.CloseAll();  \n  \n   CoUninitialize();  \n   return 0;  \n}  \n```  \n  \n## Remarks  \n Note that if you define a `HasBookmark` method, the `OpenAll` code sets the DBPROP_IRowsetLocate property; make sure you only do this if your provider supports that property.  \n  \n## OpenRowset  \n  \n```  \n// OLE DB Template version:   \nHRESULT OpenRowset(DBPROPSET* pPropSet = NULL)  \n// Attribute-injected version:  \nHRESULT OpenRowset(const CSession& session, LPCWSTR szCommand = NULL);  \n```  \n  \n **OpenAll** calls this method to open the rowset or rowsets in the consumer. Typically, you do not need to call `OpenRowset` unless you want to work with multiple data sources/sessions/rowsets. `OpenRowset` is declared in the command or table class header file:  \n  \n```  \n// OLE DB Template version:  \nHRESULT OpenRowset(DBPROPSET *pPropSet = NULL)  \n{  \n   HRESULT hr = Open(m_session, NULL, pPropSet);  \n   #ifdef _DEBUG  \n   if(FAILED(hr))  \n      AtlTraceErrorRecords(hr);  \n   #endif  \n   return hr;  \n}  \n```  \n  \n The attributes implement this method differently. This version takes a session object and a command string that defaults to the command string specified in db_command, although you can pass a different one. Note that if you define a `HasBookmark` method, the `OpenRowset` code sets the DBPROP_IRowsetLocate property; make sure you only do this if your provider supports that property.  \n  \n```  \n// Attribute-injected version:  \nHRESULT OpenRowset(const CSession& session, LPCWSTR szCommand=NULL)  \n{  \n  \n   DBPROPSET *pPropSet = NULL;  \n   CDBPropSet propset(DBPROPSET_ROWSET);  \n   __if_exists(HasBookmark)  \n  \n   {  \n      propset.AddProperty(DBPROP_IRowsetLocate, true);  \n      pPropSet= &propset;  \n      }  \n...  \n}  \n```  \n  \n## GetRowsetProperties  \n  \n```  \nvoid GetRowsetProperties(CDBPropSet* pPropSet);  \n```  \n  \n This method retrieves a pointer to the rowset's property set; you can use this pointer to set properties such as DBPROP_IRowsetChange. `GetRowsetProperties` is used in the user record class as follows. You can modify this code to set additional rowset properties:  \n  \n```  \nvoid GetRowsetProperties(CDBPropSet* pPropSet)  \n{  \n   pPropSet->AddProperty(DBPROP_CANFETCHBACKWARDS, true, DBPROPOPTIONS_OPTIONAL);  \n   pPropSet->AddProperty(DBPROP_CANSCROLLBACKWARDS, true, DBPROPOPTIONS_OPTIONAL);  \n   pPropSet->AddProperty(DBPROP_IRowsetChange, true, DBPROPOPTIONS_OPTIONAL);  \n   pPropSet->AddProperty(DBPROP_UPDATABILITY, DBPROPVAL_UP_CHANGE | DBPROPVAL_UP_INSERT | DBPROPVAL_UP_DELETE);  \n}  \n```  \n  \n## Remarks  \n You should not define a global `GetRowsetProperties` method because it could conflict with the one defined by the wizard. Note that this is a wizard-generated method that you get with templated and attributed projects; the attributes do not inject this code.  \n  \n## OpenDataSource and CloseDataSource  \n  \n```  \nHRESULT OpenDataSource();   \nvoid CloseDataSource();  \n```  \n  \n## Remarks  \n The wizard defines the methods `OpenDataSource` and `CloseDataSource`; `OpenDataSource` calls [CDataSource::OpenFromInitializationString](../../data/oledb/cdatasource-openfrominitializationstring.md).  \n  \n## See Also  \n [Creating an OLE DB Consumer Using a Wizard](../../data/oledb/creating-an-ole-db-consumer-using-a-wizard.md)"}