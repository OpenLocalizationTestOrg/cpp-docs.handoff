{"nodes":[{"pos":[12,85],"content":"Recordset: Adding, Updating, and Deleting Records (ODBC) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Recordset: Adding, Updating, and Deleting Records (ODBC) | Microsoft Docs","pos":[0,73]}]},{"content":"Recordset: Adding, Updating, and Deleting Records (ODBC)","pos":[1112,1168]},{"content":"This topic applies to the MFC ODBC classes.","pos":[1169,1212]},{"pos":[1220,1408],"content":"[!NOTE]\n You can now add records in bulk more efficiently. For more information, see [Recordset: Adding Records in Bulk (ODBC)](../../data/odbc/recordset-adding-records-in-bulk-odbc.md).","leadings":["","> "],"nodes":[{"content":" You can now add records in bulk more efficiently. For more information, see [Recordset: Adding Records in Bulk (ODBC)](../../data/odbc/recordset-adding-records-in-bulk-odbc.md).","pos":[8,186],"nodes":[{"content":"You can now add records in bulk more efficiently.","pos":[1,50]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Recordset: Adding Records in Bulk (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-adding-records-in-bulk-odbc.md)</ept>.","pos":[51,178],"source":" For more information, see [Recordset: Adding Records in Bulk (ODBC)](../../data/odbc/recordset-adding-records-in-bulk-odbc.md)."}]}]},{"pos":[1416,1681],"content":"[!NOTE]\n This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you are using bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","leadings":["","> "],"nodes":[{"content":" This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you are using bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","pos":[8,263],"nodes":[{"content":"This topic applies to objects derived from <ph id=\"ph1\">`CRecordset`</ph> in which bulk row fetching has not been implemented.","pos":[1,109],"source":" This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented."},{"content":"If you are using bulk row fetching, see <bpt id=\"p1\">[</bpt>Recordset: Fetching Records in Bulk (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)</ept>.","pos":[110,255],"source":" If you are using bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)."}]}]},{"content":"Updateable snapshots and dynasets allow you to add, edit (update), and delete records.","pos":[1688,1774]},{"content":"This topic explains:","pos":[1775,1795]},{"pos":[1805,1916],"content":"<bpt id=\"p1\">[</bpt>How to determine whether your recordset is updatable<ept id=\"p1\">](#_core_determining_whether_your_recordset_is_updatable)</ept>.","source":"[How to determine whether your recordset is updatable](#_core_determining_whether_your_recordset_is_updatable)."},{"pos":[1926,1991],"content":"<bpt id=\"p1\">[</bpt>How to add a new record<ept id=\"p1\">](#_core_adding_a_record_to_a_recordset)</ept>.","source":"[How to add a new record](#_core_adding_a_record_to_a_recordset)."},{"pos":[2001,2074],"content":"<bpt id=\"p1\">[</bpt>How to edit an existing record<ept id=\"p1\">](#_core_editing_a_record_in_a_recordset)</ept>.","source":"[How to edit an existing record](#_core_editing_a_record_in_a_recordset)."},{"pos":[2084,2152],"content":"<bpt id=\"p1\">[</bpt>How to delete a record<ept id=\"p1\">](#_core_deleting_a_record_from_a_recordset)</ept>.","source":"[How to delete a record](#_core_deleting_a_record_from_a_recordset)."},{"content":"For more information about how updates are carried out and how your updates appear to other users, see <bpt id=\"p1\">[</bpt>Recordset: How Recordsets Update Records (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)</ept>.","pos":[2159,2377],"source":"For more information about how updates are carried out and how your updates appear to other users, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)."},{"content":"Normally, when you add, edit, or delete a record, the recordset changes the data source immediately.","pos":[2378,2478]},{"content":"You can instead batch groups of related updates into transactions.","pos":[2479,2545]},{"content":"If a transaction is in progress, the update does not become final until you commit the transaction.","pos":[2546,2645]},{"content":"This allows you to take back or roll back the changes.","pos":[2646,2700]},{"content":"For information about transactions, see <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","pos":[2701,2799],"source":" For information about transactions, see [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"content":"The following table summarizes the options available for recordsets with different update characteristics.","pos":[2806,2912]},{"content":"Recordset Read/Update Options","pos":[2922,2951]},{"content":"Type","pos":[2958,2962]},{"content":"Read","pos":[2963,2967]},{"content":"Edit record","pos":[2968,2979]},{"content":"Delete record","pos":[2980,2993]},{"content":"Add new (append)","pos":[2994,3010]},{"content":"Read-only","pos":[3104,3113]},{"content":"Y","pos":[3114,3115]},{"content":"N","pos":[3116,3117]},{"content":"N","pos":[3118,3119]},{"content":"N","pos":[3120,3121]},{"content":"Append-only","pos":[3126,3137]},{"content":"Y","pos":[3138,3139]},{"content":"N","pos":[3140,3141]},{"content":"N","pos":[3142,3143]},{"content":"Y","pos":[3144,3145]},{"content":"Fully updatable","pos":[3150,3165]},{"content":"Y","pos":[3166,3167]},{"content":"Y","pos":[3168,3169]},{"content":"Y","pos":[3170,3171]},{"content":"Y","pos":[3172,3173]},{"pos":[3253,3301],"content":"Determining Whether Your Recordset is Updateable"},{"content":"A recordset object is updateable if the data source is updateable and you opened the recordset as updateable.","pos":[3305,3414]},{"content":"Its updateability also depends on the SQL statement you use, the capabilities of your ODBC driver, and whether the ODBC Cursor Library is in memory.","pos":[3415,3563]},{"content":"You cannot update a read-only recordset or data source.","pos":[3564,3619]},{"content":"To determine whether your recordset is updatable","pos":[3630,3678]},{"pos":[3688,3807],"content":"Call the recordset object's <bpt id=\"p1\">[</bpt>CanUpdate<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__canupdate)</ept> member function.","source":"Call the recordset object's [CanUpdate](../../mfc/reference/crecordset-class.md#crecordset__canupdate) member function."},{"pos":[3830,3885],"content":"returns a nonzero value if the recordset is updateable."},{"content":"By default, recordsets are fully updateable (you can perform <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, and <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept> operations).","pos":[3892,4000],"source":"By default, recordsets are fully updateable (you can perform `AddNew`, **Edit**, and **Delete** operations)."},{"content":"But you can also use the <bpt id=\"p1\">[</bpt>appendOnly<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__open)</ept> option to open updateable recordsets.","pos":[4001,4134],"source":" But you can also use the [appendOnly](../../mfc/reference/crecordset-class.md#crecordset__open) option to open updateable recordsets."},{"content":"A recordset opened this way allows only the addition of new records with <ph id=\"ph1\">`AddNew`</ph>.","pos":[4135,4217],"source":" A recordset opened this way allows only the addition of new records with `AddNew`."},{"content":"You cannot edit or delete existing records.","pos":[4218,4261]},{"content":"You can test whether a recordset is open only for appending by calling the <bpt id=\"p1\">[</bpt>CanAppend<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__canappend)</ept> member function.","pos":[4262,4428],"source":" You can test whether a recordset is open only for appending by calling the [CanAppend](../../mfc/reference/crecordset-class.md#crecordset__canappend) member function."},{"content":"returns a nonzero value if the recordset is either fully updateable or open only for appending.","pos":[4441,4536]},{"pos":[4543,4643],"content":"The following code shows how you might use <ph id=\"ph1\">`CanUpdate`</ph> for a recordset object called <ph id=\"ph2\">`rsStudentSet`</ph>:","source":"The following code shows how you might use `CanUpdate` for a recordset object called `rsStudentSet`:"},{"pos":[4839,5406],"content":"[!CAUTION]\n When you prepare to update a recordset by calling **Update**, take care that your recordset includes all columns making up the primary key of the table (or all of the columns of any unique index on the table). In some cases, the framework can use only the columns selected in your recordset to identify which record in your table to update. Without all the necessary columns, multiple records might be updated in the table, possibly damaging the referential integrity of the table. In this case, the framework throws exceptions when you call **Update**.","leadings":["","> "],"nodes":[{"content":" When you prepare to update a recordset by calling **Update**, take care that your recordset includes all columns making up the primary key of the table (or all of the columns of any unique index on the table). In some cases, the framework can use only the columns selected in your recordset to identify which record in your table to update. Without all the necessary columns, multiple records might be updated in the table, possibly damaging the referential integrity of the table. In this case, the framework throws exceptions when you call **Update**.","pos":[11,565],"nodes":[{"content":"When you prepare to update a recordset by calling <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>, take care that your recordset includes all columns making up the primary key of the table (or all of the columns of any unique index on the table).","pos":[1,210],"source":" When you prepare to update a recordset by calling **Update**, take care that your recordset includes all columns making up the primary key of the table (or all of the columns of any unique index on the table)."},{"content":"In some cases, the framework can use only the columns selected in your recordset to identify which record in your table to update.","pos":[211,341]},{"content":"Without all the necessary columns, multiple records might be updated in the table, possibly damaging the referential integrity of the table.","pos":[342,482]},{"content":"In this case, the framework throws exceptions when you call <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>.","pos":[483,554],"source":" In this case, the framework throws exceptions when you call **Update**."}]}]},{"pos":[5468,5498],"content":"Adding a Record to a Recordset"},{"pos":[5502,5663],"content":"You can add new records to a recordset if its <bpt id=\"p1\">[</bpt>CanAppend<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__canappend)</ept> member function returns a nonzero value.","source":"You can add new records to a recordset if its [CanAppend](../../mfc/reference/crecordset-class.md#crecordset__canappend) member function returns a nonzero value."},{"content":"To add a new record to a recordset","pos":[5674,5708]},{"content":"Make sure the recordset is appendable.","pos":[5718,5756]},{"pos":[5766,5879],"content":"Call the recordset object's <bpt id=\"p1\">[</bpt>AddNew<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__addnew)</ept> member function.","source":"Call the recordset object's [AddNew](../../mfc/reference/crecordset-class.md#crecordset__addnew) member function."},{"content":"prepares the recordset to act as an edit buffer.","pos":[5899,5947]},{"content":"All field data members are set to the special value Null and marked as unchanged so only changed (dirty) values are written to the data source when you call <bpt id=\"p1\">[</bpt>Update<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__update)</ept>.","pos":[5948,6174],"source":" All field data members are set to the special value Null and marked as unchanged so only changed (dirty) values are written to the data source when you call [Update](../../mfc/reference/crecordset-class.md#crecordset__update)."},{"content":"Set the values of the new record's field data members.","pos":[6184,6238]},{"content":"Assign values to the field data members.","pos":[6249,6289]},{"content":"Those you do not assign are not written to the data source.","pos":[6290,6349]},{"pos":[6359,6414],"content":"Call the recordset object's <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> member function.","source":"Call the recordset object's **Update** member function."},{"content":"<bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> completes the addition by writing the new record to the data source.","pos":[6425,6504],"source":"**Update** completes the addition by writing the new record to the data source."},{"content":"For information about happens if you fail to call <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>, see <bpt id=\"p2\">[</bpt>Recordset: How Recordsets Update Records (ODBC)<ept id=\"p2\">](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)</ept>.","pos":[6505,6686],"source":" For information about happens if you fail to call **Update**, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)."},{"pos":[6693,6925],"content":"For information about how adding records works and about when added records are visible in your recordset, see <bpt id=\"p1\">[</bpt>Recordset: How AddNew, Edit, and Delete Work (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-how-addnew-edit-and-delete-work-odbc.md)</ept>.","source":"For information about how adding records works and about when added records are visible in your recordset, see [Recordset: How AddNew, Edit, and Delete Work (ODBC)](../../data/odbc/recordset-how-addnew-edit-and-delete-work-odbc.md)."},{"content":"The following example shows how to add a new record:","pos":[6932,6984]},{"pos":[7408,7659],"content":"[!TIP]\n To cancel an `AddNew` or **Edit** call, simply make another call to `AddNew` or **Edit** or call **Move** with the **AFX_MOVE_REFRESH** parameter. Data members are reset to their previous values and you are still in **Edit** or **Add** mode.","leadings":["","> "],"nodes":[{"content":" To cancel an `AddNew` or **Edit** call, simply make another call to `AddNew` or **Edit** or call **Move** with the **AFX_MOVE_REFRESH** parameter. Data members are reset to their previous values and you are still in **Edit** or **Add** mode.","pos":[7,249],"nodes":[{"content":"To cancel an <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> call, simply make another call to <ph id=\"ph2\">`AddNew`</ph> or <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept> or call <bpt id=\"p3\">**</bpt>Move<ept id=\"p3\">**</ept> with the <bpt id=\"p4\">**</bpt>AFX_MOVE_REFRESH<ept id=\"p4\">**</ept> parameter.","pos":[1,147],"source":" To cancel an `AddNew` or **Edit** call, simply make another call to `AddNew` or **Edit** or call **Move** with the **AFX_MOVE_REFRESH** parameter."},{"content":"Data members are reset to their previous values and you are still in <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept> mode.","pos":[148,242],"source":" Data members are reset to their previous values and you are still in **Edit** or **Add** mode."}]}]},{"pos":[7722,7753],"content":"Editing a Record in a Recordset"},{"pos":[7757,7922],"content":"You can edit existing records if your recordset's <bpt id=\"p1\">[</bpt>CanUpdate<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__canupdate)</ept> member function returns a nonzero value.","source":"You can edit existing records if your recordset's [CanUpdate](../../mfc/reference/crecordset-class.md#crecordset__canupdate) member function returns a nonzero value."},{"content":"To edit an existing record in a recordset","pos":[7933,7974]},{"content":"Make sure the recordset is updateable.","pos":[7984,8022]},{"content":"Scroll to the record you want to update.","pos":[8032,8072]},{"pos":[8082,8191],"content":"Call the recordset object's <bpt id=\"p1\">[</bpt>Edit<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__edit)</ept> member function.","source":"Call the recordset object's [Edit](../../mfc/reference/crecordset-class.md#crecordset__edit) member function."},{"content":"<bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> prepares the recordset to act as an edit buffer.","pos":[8202,8259],"source":"**Edit** prepares the recordset to act as an edit buffer."},{"content":"All field data members are marked so that the recordset can tell later whether they were changed.","pos":[8260,8357]},{"content":"The new values for changed field data members are written to the data source when you call <bpt id=\"p1\">[</bpt>Update<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__update)</ept>.","pos":[8358,8518],"source":" The new values for changed field data members are written to the data source when you call [Update](../../mfc/reference/crecordset-class.md#crecordset__update)."},{"content":"Set the values of the new record's field data members.","pos":[8528,8582]},{"content":"Assign values to the field data members.","pos":[8593,8633]},{"content":"Those you do not assign values remain unchanged.","pos":[8634,8682]},{"pos":[8692,8747],"content":"Call the recordset object's <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> member function.","source":"Call the recordset object's **Update** member function."},{"content":"<bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> completes the edit by writing the changed record to the data source.","pos":[8758,8837],"source":"**Update** completes the edit by writing the changed record to the data source."},{"content":"For information about happens if you fail to call <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>, see <bpt id=\"p2\">[</bpt>Recordset: How Recordsets Update Records (ODBC)<ept id=\"p2\">](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)</ept>.","pos":[8838,9019],"source":" For information about happens if you fail to call **Update**, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)."},{"content":"After you edit a record, the edited record remains the current record.","pos":[9026,9096]},{"content":"The following example shows an <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> operation.","pos":[9103,9153],"source":"The following example shows an **Edit** operation."},{"content":"It assumes the user has moved to a record he or she wants to edit.","pos":[9154,9220]},{"pos":[9555,9806],"content":"[!TIP]\n To cancel an `AddNew` or **Edit** call, simply make another call to `AddNew` or **Edit** or call **Move** with the **AFX_MOVE_REFRESH** parameter. Data members are reset to their previous values and you are still in **Edit** or **Add** mode.","leadings":["","> "],"nodes":[{"content":" To cancel an `AddNew` or **Edit** call, simply make another call to `AddNew` or **Edit** or call **Move** with the **AFX_MOVE_REFRESH** parameter. Data members are reset to their previous values and you are still in **Edit** or **Add** mode.","pos":[7,249],"nodes":[{"content":"To cancel an <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> call, simply make another call to <ph id=\"ph2\">`AddNew`</ph> or <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept> or call <bpt id=\"p3\">**</bpt>Move<ept id=\"p3\">**</ept> with the <bpt id=\"p4\">**</bpt>AFX_MOVE_REFRESH<ept id=\"p4\">**</ept> parameter.","pos":[1,147],"source":" To cancel an `AddNew` or **Edit** call, simply make another call to `AddNew` or **Edit** or call **Move** with the **AFX_MOVE_REFRESH** parameter."},{"content":"Data members are reset to their previous values and you are still in <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept> mode.","pos":[148,242],"source":" Data members are reset to their previous values and you are still in **Edit** or **Add** mode."}]}]},{"pos":[9872,9906],"content":"Deleting a Record from a Recordset"},{"pos":[9910,10068],"content":"You can delete records if your recordset's <bpt id=\"p1\">[</bpt>CanUpdate<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__canupdate)</ept> member function returns a nonzero value.","source":"You can delete records if your recordset's [CanUpdate](../../mfc/reference/crecordset-class.md#crecordset__canupdate) member function returns a nonzero value."},{"content":"To delete a record","pos":[10079,10097]},{"content":"Make sure the recordset is updateable.","pos":[10107,10145]},{"content":"Scroll to the record you want to update.","pos":[10155,10195]},{"pos":[10205,10318],"content":"Call the recordset object's <bpt id=\"p1\">[</bpt>Delete<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__delete)</ept> member function.","source":"Call the recordset object's [Delete](../../mfc/reference/crecordset-class.md#crecordset__delete) member function."},{"pos":[10329,10426],"content":"<bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> immediately marks the record as deleted, both in the recordset and on the data source.","source":"**Delete** immediately marks the record as deleted, both in the recordset and on the data source."},{"pos":[10437,10515],"content":"Unlike <ph id=\"ph1\">`AddNew`</ph> and <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept> has no corresponding <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept> call.","source":"Unlike `AddNew` and **Edit**, **Delete** has no corresponding **Update** call."},{"content":"Scroll to another record.","pos":[10525,10550]},{"pos":[10562,10771],"content":"[!NOTE]\n When moving through the recordset, deleted records might not be skipped. For more information, see the [IsDeleted](../../mfc/reference/crecordset-class.md#crecordset__isdeleted) member function.","leadings":["","    > "],"nodes":[{"content":" When moving through the recordset, deleted records might not be skipped. For more information, see the [IsDeleted](../../mfc/reference/crecordset-class.md#crecordset__isdeleted) member function.","pos":[8,203],"nodes":[{"content":"When moving through the recordset, deleted records might not be skipped.","pos":[1,73]},{"content":"For more information, see the <bpt id=\"p1\">[</bpt>IsDeleted<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__isdeleted)</ept> member function.","pos":[74,195],"source":" For more information, see the [IsDeleted](../../mfc/reference/crecordset-class.md#crecordset__isdeleted) member function."}]}]},{"content":"The following example shows a <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> operation.","pos":[10778,10829],"source":"The following example shows a **Delete** operation."},{"content":"It assumes that the user has moved to a record that the user wants to delete.","pos":[10830,10907]},{"content":"After <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> is called, it is important to move to a new record.","pos":[10908,10976],"source":" After **Delete** is called, it is important to move to a new record."},{"pos":[11046,11264],"content":"For more information about the effects of the <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, and <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept> member functions, see <bpt id=\"p3\">[</bpt>Recordset: How Recordsets Update Records (ODBC)<ept id=\"p3\">](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)</ept>.","source":"For more information about the effects of the `AddNew`, **Edit**, and **Delete** member functions, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)."},{"content":"See Also","pos":[11273,11281]},{"content":"Recordset (ODBC)","pos":[11286,11302]},{"content":"Recordset: Locking Records (ODBC)","pos":[11344,11377]}],"content":"---\ntitle: \"Recordset: Adding, Updating, and Deleting Records (ODBC) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"records [C++], updating\"\n  - \"record editing [C++], in recordsets\"\n  - \"recordsets [C++], adding records\"\n  - \"records [C++], adding\"\n  - \"ODBC recordsets [C++], adding records\"\n  - \"recordsets [C++], editing records\"\n  - \"recordsets [C++], updating\"\n  - \"records [C++], deleting\"\n  - \"AddNew method\"\n  - \"ODBC recordsets [C++], deleting records\"\n  - \"data in recordsets [C++]\"\n  - \"record editing [C++]\"\n  - \"recordsets [C++], deleting records\"\n  - \"ODBC recordsets [C++], editing records\"\n  - \"records [C++], editing\"\nms.assetid: 760c8889-bec4-482b-a8f2-319792a6af98\ncaps.latest.revision: 9\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Recordset: Adding, Updating, and Deleting Records (ODBC)\nThis topic applies to the MFC ODBC classes.  \n  \n> [!NOTE]\n>  You can now add records in bulk more efficiently. For more information, see [Recordset: Adding Records in Bulk (ODBC)](../../data/odbc/recordset-adding-records-in-bulk-odbc.md).  \n  \n> [!NOTE]\n>  This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you are using bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  \n  \n Updateable snapshots and dynasets allow you to add, edit (update), and delete records. This topic explains:  \n  \n-   [How to determine whether your recordset is updatable](#_core_determining_whether_your_recordset_is_updatable).  \n  \n-   [How to add a new record](#_core_adding_a_record_to_a_recordset).  \n  \n-   [How to edit an existing record](#_core_editing_a_record_in_a_recordset).  \n  \n-   [How to delete a record](#_core_deleting_a_record_from_a_recordset).  \n  \n For more information about how updates are carried out and how your updates appear to other users, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md). Normally, when you add, edit, or delete a record, the recordset changes the data source immediately. You can instead batch groups of related updates into transactions. If a transaction is in progress, the update does not become final until you commit the transaction. This allows you to take back or roll back the changes. For information about transactions, see [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n The following table summarizes the options available for recordsets with different update characteristics.  \n  \n### Recordset Read/Update Options  \n  \n|Type|Read|Edit record|Delete record|Add new (append)|  \n|----------|----------|-----------------|-------------------|------------------------|  \n|Read-only|Y|N|N|N|  \n|Append-only|Y|N|N|Y|  \n|Fully updatable|Y|Y|Y|Y|  \n  \n##  <a name=\"_core_determining_whether_your_recordset_is_updatable\"></a> Determining Whether Your Recordset is Updateable  \n A recordset object is updateable if the data source is updateable and you opened the recordset as updateable. Its updateability also depends on the SQL statement you use, the capabilities of your ODBC driver, and whether the ODBC Cursor Library is in memory. You cannot update a read-only recordset or data source.  \n  \n#### To determine whether your recordset is updatable  \n  \n1.  Call the recordset object's [CanUpdate](../../mfc/reference/crecordset-class.md#crecordset__canupdate) member function.  \n  \n     `CanUpdate` returns a nonzero value if the recordset is updateable.  \n  \n By default, recordsets are fully updateable (you can perform `AddNew`, **Edit**, and **Delete** operations). But you can also use the [appendOnly](../../mfc/reference/crecordset-class.md#crecordset__open) option to open updateable recordsets. A recordset opened this way allows only the addition of new records with `AddNew`. You cannot edit or delete existing records. You can test whether a recordset is open only for appending by calling the [CanAppend](../../mfc/reference/crecordset-class.md#crecordset__canappend) member function. `CanAppend` returns a nonzero value if the recordset is either fully updateable or open only for appending.  \n  \n The following code shows how you might use `CanUpdate` for a recordset object called `rsStudentSet`:  \n  \n```  \nif( !rsStudentSet.Open( ) )  \n    return FALSE;  \nif( !rsStudentSet.CanUpdate( ) )  \n{  \n    AfxMessageBox( \"Unable to update the Student recordset.\" );  \n    return;  \n}  \n```  \n  \n> [!CAUTION]\n>  When you prepare to update a recordset by calling **Update**, take care that your recordset includes all columns making up the primary key of the table (or all of the columns of any unique index on the table). In some cases, the framework can use only the columns selected in your recordset to identify which record in your table to update. Without all the necessary columns, multiple records might be updated in the table, possibly damaging the referential integrity of the table. In this case, the framework throws exceptions when you call **Update**.  \n  \n##  <a name=\"_core_adding_a_record_to_a_recordset\"></a> Adding a Record to a Recordset  \n You can add new records to a recordset if its [CanAppend](../../mfc/reference/crecordset-class.md#crecordset__canappend) member function returns a nonzero value.  \n  \n#### To add a new record to a recordset  \n  \n1.  Make sure the recordset is appendable.  \n  \n2.  Call the recordset object's [AddNew](../../mfc/reference/crecordset-class.md#crecordset__addnew) member function.  \n  \n     `AddNew` prepares the recordset to act as an edit buffer. All field data members are set to the special value Null and marked as unchanged so only changed (dirty) values are written to the data source when you call [Update](../../mfc/reference/crecordset-class.md#crecordset__update).  \n  \n3.  Set the values of the new record's field data members.  \n  \n     Assign values to the field data members. Those you do not assign are not written to the data source.  \n  \n4.  Call the recordset object's **Update** member function.  \n  \n     **Update** completes the addition by writing the new record to the data source. For information about happens if you fail to call **Update**, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  \n  \n For information about how adding records works and about when added records are visible in your recordset, see [Recordset: How AddNew, Edit, and Delete Work (ODBC)](../../data/odbc/recordset-how-addnew-edit-and-delete-work-odbc.md).  \n  \n The following example shows how to add a new record:  \n  \n```  \nif( !rsStudent.Open( ) )  \n    return FALSE;  \nif( !rsStudent.CanAppend( ) )  \n    return FALSE;                      // no field values were set  \nrsStudent.AddNew( );  \nrsStudent.m_strName = strName;  \nrsStudent.m_strCity = strCity;  \nrsStudent.m_strStreet = strStreet;  \nif( !rsStudent.Update( ) )  \n{  \n    AfxMessageBox( \"Record not added; no field values were set.\" );  \n    return FALSE;  \n}  \n```  \n  \n> [!TIP]\n>  To cancel an `AddNew` or **Edit** call, simply make another call to `AddNew` or **Edit** or call **Move** with the **AFX_MOVE_REFRESH** parameter. Data members are reset to their previous values and you are still in **Edit** or **Add** mode.  \n  \n##  <a name=\"_core_editing_a_record_in_a_recordset\"></a> Editing a Record in a Recordset  \n You can edit existing records if your recordset's [CanUpdate](../../mfc/reference/crecordset-class.md#crecordset__canupdate) member function returns a nonzero value.  \n  \n#### To edit an existing record in a recordset  \n  \n1.  Make sure the recordset is updateable.  \n  \n2.  Scroll to the record you want to update.  \n  \n3.  Call the recordset object's [Edit](../../mfc/reference/crecordset-class.md#crecordset__edit) member function.  \n  \n     **Edit** prepares the recordset to act as an edit buffer. All field data members are marked so that the recordset can tell later whether they were changed. The new values for changed field data members are written to the data source when you call [Update](../../mfc/reference/crecordset-class.md#crecordset__update).  \n  \n4.  Set the values of the new record's field data members.  \n  \n     Assign values to the field data members. Those you do not assign values remain unchanged.  \n  \n5.  Call the recordset object's **Update** member function.  \n  \n     **Update** completes the edit by writing the changed record to the data source. For information about happens if you fail to call **Update**, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  \n  \n After you edit a record, the edited record remains the current record.  \n  \n The following example shows an **Edit** operation. It assumes the user has moved to a record he or she wants to edit.  \n  \n```  \nrsStudent.Edit( );  \nrsStudent.m_strStreet = strNewStreet;  \nrsStudent.m_strCity = strNewCity;  \nrsStudent.m_strState = strNewState;  \nrsStudent.m_strPostalCode = strNewPostalCode;  \nif( !rsStudent.Update( ) )  \n{  \n    AfxMessageBox( \"Record not updated; no field values were set.\" );  \n    return FALSE;  \n}  \n```  \n  \n> [!TIP]\n>  To cancel an `AddNew` or **Edit** call, simply make another call to `AddNew` or **Edit** or call **Move** with the **AFX_MOVE_REFRESH** parameter. Data members are reset to their previous values and you are still in **Edit** or **Add** mode.  \n  \n##  <a name=\"_core_deleting_a_record_from_a_recordset\"></a> Deleting a Record from a Recordset  \n You can delete records if your recordset's [CanUpdate](../../mfc/reference/crecordset-class.md#crecordset__canupdate) member function returns a nonzero value.  \n  \n#### To delete a record  \n  \n1.  Make sure the recordset is updateable.  \n  \n2.  Scroll to the record you want to update.  \n  \n3.  Call the recordset object's [Delete](../../mfc/reference/crecordset-class.md#crecordset__delete) member function.  \n  \n     **Delete** immediately marks the record as deleted, both in the recordset and on the data source.  \n  \n     Unlike `AddNew` and **Edit**, **Delete** has no corresponding **Update** call.  \n  \n4.  Scroll to another record.  \n  \n    > [!NOTE]\n    >  When moving through the recordset, deleted records might not be skipped. For more information, see the [IsDeleted](../../mfc/reference/crecordset-class.md#crecordset__isdeleted) member function.  \n  \n The following example shows a **Delete** operation. It assumes that the user has moved to a record that the user wants to delete. After **Delete** is called, it is important to move to a new record.  \n  \n```  \nrsStudent.Delete( );  \nrsStudent.MoveNext( );  \n```  \n  \n For more information about the effects of the `AddNew`, **Edit**, and **Delete** member functions, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).  \n  \n## See Also  \n [Recordset (ODBC)](../../data/odbc/recordset-odbc.md)   \n [Recordset: Locking Records (ODBC)](../../data/odbc/recordset-locking-records-odbc.md)"}