{"nodes":[{"pos":[12,57],"content":"Profile-Guided Optimizations | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Profile-Guided Optimizations | Microsoft Docs","pos":[0,45]}]},{"content":"Profile-Guided Optimizations","pos":[636,664]},{"content":"Profile-guided optimization lets you optimize an output file, where the optimizer uses data from test runs of the .exe or .dll file.","pos":[665,797]},{"content":"The data represents how the program is likely to perform in a production environment.","pos":[798,883]},{"content":"Profile-guided optimizations are only available for x86 or <ph id=\"ph1\">[!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)]</ph> native targets.","pos":[890,1031],"source":"Profile-guided optimizations are only available for x86 or [!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)] native targets."},{"content":"Profile-guided optimizations are not available for output files that will run on the common language runtime.","pos":[1032,1141]},{"content":"Even if you produce an assembly with mixed native and managed code (compile with <bpt id=\"p1\">**</bpt>/clr<ept id=\"p1\">**</ept>), you cannot use profile-guided optimization on just the native code.","pos":[1142,1301],"source":" Even if you produce an assembly with mixed native and managed code (compile with **/clr**), you cannot use profile-guided optimization on just the native code."},{"content":"If you attempt to build a project with these options set in the IDE, a build error will result.","pos":[1302,1397]},{"pos":[1405,1808],"content":"[!NOTE]\n Information that is gathered from profiling test runs will override optimizations that would otherwise be in effect if you specify **/Ob**, **/Os**, or **/Ot**. For more information, see [/Ob (Inline Function Expansion)](../../build/reference/ob-inline-function-expansion.md) and [/Os, /Ot (Favor Small Code, Favor Fast Code)](../../build/reference/os-ot-favor-small-code-favor-fast-code.md).","leadings":["","> "],"nodes":[{"content":" Information that is gathered from profiling test runs will override optimizations that would otherwise be in effect if you specify **/Ob**, **/Os**, or **/Ot**. For more information, see [/Ob (Inline Function Expansion)](../../build/reference/ob-inline-function-expansion.md) and [/Os, /Ot (Favor Small Code, Favor Fast Code)](../../build/reference/os-ot-favor-small-code-favor-fast-code.md).","pos":[8,401],"nodes":[{"content":"Information that is gathered from profiling test runs will override optimizations that would otherwise be in effect if you specify <bpt id=\"p1\">**</bpt>/Ob<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>/Os<ept id=\"p2\">**</ept>, or <bpt id=\"p3\">**</bpt>/Ot<ept id=\"p3\">**</ept>.","pos":[1,161],"source":" Information that is gathered from profiling test runs will override optimizations that would otherwise be in effect if you specify **/Ob**, **/Os**, or **/Ot**."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>/Ob (Inline Function Expansion)<ept id=\"p1\">](../../build/reference/ob-inline-function-expansion.md)</ept> and <bpt id=\"p2\">[</bpt>/Os, /Ot (Favor Small Code, Favor Fast Code)<ept id=\"p2\">](../../build/reference/os-ot-favor-small-code-favor-fast-code.md)</ept>.","pos":[162,393],"source":" For more information, see [/Ob (Inline Function Expansion)](../../build/reference/ob-inline-function-expansion.md) and [/Os, /Ot (Favor Small Code, Favor Fast Code)](../../build/reference/os-ot-favor-small-code-favor-fast-code.md)."}]}]},{"content":"You can use the automated Profile Guided Optimization for Visual C++ plug-in in the Performance and Diagnostics Hub to simplify and streamline the optimization process within Visual Studio, or you can perform the optimization steps manually in Visual Studio or on the command line.","pos":[1815,2096]},{"content":"We recommend the plug-in because it is easier to use.","pos":[2097,2150]},{"content":"For information on how to get the plug-in and use it to optimize your app, see <bpt id=\"p1\">[</bpt>Profile Guided Optimization Plug-In<ept id=\"p1\">](../../build/reference/profile-guided-optimization-in-the-performance-and-diagnostics-hub.md)</ept>.","pos":[2151,2361],"source":" For information on how to get the plug-in and use it to optimize your app, see [Profile Guided Optimization Plug-In](../../build/reference/profile-guided-optimization-in-the-performance-and-diagnostics-hub.md)."},{"content":"Both the Profile Guided Optimization plug-in and manual profile-guided optimization follow these steps to optimize your app:","pos":[2368,2492]},{"pos":[2502,2607],"content":"Compile one or more source code files with <bpt id=\"p1\">[</bpt>/GL<ept id=\"p1\">](../../build/reference/gl-whole-program-optimization.md)</ept>.","source":"Compile one or more source code files with [/GL](../../build/reference/gl-whole-program-optimization.md)."},{"content":"Each module built with /GL can be examined during profile-guided optimization test runs to capture run-time behavior.","pos":[2618,2735]},{"content":"Every module in a profile-guided optimization build does not have to be compiled with /GL.","pos":[2736,2826]},{"content":"However, only those modules compiled with /GL will be instrumented and later available for profile-guided optimizations.","pos":[2827,2947]},{"pos":[2957,3141],"content":"Link using <bpt id=\"p1\">[</bpt>/LTCG<ept id=\"p1\">](../../build/reference/ltcg-link-time-code-generation.md)</ept> and <bpt id=\"p2\">[</bpt>/GENPROFILE<ept id=\"p2\">](../../build/reference/genprofile-fastgenprofile-generate-profiling-instrumented-build.md)</ept>.","source":"Link using [/LTCG](../../build/reference/ltcg-link-time-code-generation.md) and [/GENPROFILE](../../build/reference/genprofile-fastgenprofile-generate-profiling-instrumented-build.md)."},{"content":"Using both /LTCG and /GENPROFILE creates an empty .pgd file.","pos":[3152,3212]},{"content":"After test-run data is added to the .pgd file, it can be used as input to the next link step (creating the optimized image).","pos":[3213,3337]},{"content":"When specifying /GENPROFILE, you can optionally add :PGD=<ph id=\"ph1\">`filename`</ph> to specify a nondefault name or location for the .pgd file.","pos":[3338,3465],"source":" When specifying /GENPROFILE, you can optionally add :PGD=`filename` to specify a nondefault name or location for the .pgd file."},{"content":"Profile the application.","pos":[3475,3499]},{"content":"Each time a profiled EXE session ends or a profiled DLL is unloaded, a <bpt id=\"p1\">*</bpt>appname<ept id=\"p1\">*</ept>!#.pgc file is created.","pos":[3510,3613],"source":"Each time a profiled EXE session ends or a profiled DLL is unloaded, a *appname*!#.pgc file is created."},{"content":"A .pgc file contains information about a particular application test run.","pos":[3614,3687]},{"content":"is a number starting with 1 that is incremented based on the number of other <bpt id=\"p1\">*</bpt>appname<ept id=\"p1\">*</ept>!#.pgc files in the directory.","pos":[3690,3806],"source":" # is a number starting with 1 that is incremented based on the number of other *appname*!#.pgc files in the directory."},{"content":"You can delete a .pgc file if the test run does not represent a scenario you want to optimize.","pos":[3807,3901]},{"pos":[3912,4175],"content":"During a test run, you can force closure of the currently open .pgc file and the creation of a new .pgc file with the <bpt id=\"p1\">[</bpt>pgosweep<ept id=\"p1\">](../../build/reference/pgosweep.md)</ept> utility (for example, when the end of a test scenario does not coincide with application shutdown).","source":"During a test run, you can force closure of the currently open .pgc file and the creation of a new .pgc file with the [pgosweep](../../build/reference/pgosweep.md) utility (for example, when the end of a test scenario does not coincide with application shutdown)."},{"content":"You can use the <ph id=\"ph1\">`PogoSafeMode`</ph> option when you profile your application.","pos":[4186,4258],"source":"You can use the `PogoSafeMode` option when you profile your application."},{"content":"This option enables you to specify whether you want to profile the application in safe mode or fast mode.","pos":[4259,4364]},{"content":"For more information about these modes, see <bpt id=\"p1\">[</bpt>PogoSafeMode<ept id=\"p1\">](../../build/reference/pogosafemode.md)</ept>.","pos":[4365,4463],"source":" For more information about these modes, see [PogoSafeMode](../../build/reference/pogosafemode.md)."},{"content":"Link using /LTCG and /USEPROFILE.","pos":[4473,4506]},{"content":"Using both /LTCG and /USEPROFILE creates the optimized image.","pos":[4517,4578]},{"content":"This step takes as input the .pgd file.","pos":[4579,4618]},{"content":"When specifying /USEPROFILE, you can optionally add :PGD=<ph id=\"ph1\">`filename`</ph> to specify a nondefault name or location for the .pgd file.","pos":[4619,4746],"source":" When specifying /USEPROFILE, you can optionally add :PGD=`filename` to specify a nondefault name or location for the .pgd file."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>/LTCG<ept id=\"p1\">](../../build/reference/ltcg-link-time-code-generation.md)</ept>.","pos":[4747,4838],"source":" For more information, see [/LTCG](../../build/reference/ltcg-link-time-code-generation.md)."},{"content":"It is even possible to create the optimized output file and later determine that additional profiling would be useful to create a more optimized image.","pos":[4845,4996]},{"content":"If the instrumented image and its .pgd file are available, you can do additional test runs and rebuilt the optimized image with the newer .pgd file.","pos":[4997,5145]},{"content":"The following is a list of the profile-guided optimizations:","pos":[5152,5212]},{"pos":[5222,5420],"content":"<bpt id=\"p1\">**</bpt>Inlining<ept id=\"p1\">**</ept> – For example, if there exists a function A that frequently calls function B, and function B is relatively small, then profile-guided optimizations will inline function B in function A.","source":"**Inlining** – For example, if there exists a function A that frequently calls function B, and function B is relatively small, then profile-guided optimizations will inline function B in function A."},{"pos":[5430,5711],"content":"<bpt id=\"p1\">**</bpt>Virtual Call Speculation<ept id=\"p1\">**</ept> – If a virtual call, or other call through a function pointer, frequently targets a certain function, a profile-guided optimization can insert a conditionally-executed direct call to the frequently-targeted function, and the direct call can be inlined.","source":"**Virtual Call Speculation** – If a virtual call, or other call through a function pointer, frequently targets a certain function, a profile-guided optimization can insert a conditionally-executed direct call to the frequently-targeted function, and the direct call can be inlined."},{"pos":[5721,5814],"content":"<bpt id=\"p1\">**</bpt>Register Allocation<ept id=\"p1\">**</ept> – Optimizing with profile data results in better register allocation.","source":"**Register Allocation** – Optimizing with profile data results in better register allocation."},{"content":"<bpt id=\"p1\">**</bpt>Basic Block Optimization<ept id=\"p1\">**</ept> – Basic block optimization allows commonly executed basic blocks that temporally execute within a given frame to be placed in the same set of pages (locality).","pos":[5824,6012],"source":"**Basic Block Optimization** – Basic block optimization allows commonly executed basic blocks that temporally execute within a given frame to be placed in the same set of pages (locality)."},{"content":"This minimizes the number of pages used, thus minimizing memory overhead.","pos":[6013,6086]},{"pos":[6096,6202],"content":"<bpt id=\"p1\">**</bpt>Size/Speed Optimization<ept id=\"p1\">**</ept> – Functions where the program spends a lot of time can be optimized for speed.","source":"**Size/Speed Optimization** – Functions where the program spends a lot of time can be optimized for speed."},{"pos":[6212,6382],"content":"<bpt id=\"p1\">**</bpt>Function Layout<ept id=\"p1\">**</ept> – Based on the call graph and profiled caller/callee behavior, functions that tend to be along the same execution path are placed in the same section.","source":"**Function Layout** – Based on the call graph and profiled caller/callee behavior, functions that tend to be along the same execution path are placed in the same section."},{"content":"<bpt id=\"p1\">**</bpt>Conditional Branch Optimization<ept id=\"p1\">**</ept> – With the value probes, profile-guided optimizations can find if a given value in a switch statement is used more often than other values.","pos":[6392,6567],"source":"**Conditional Branch Optimization** – With the value probes, profile-guided optimizations can find if a given value in a switch statement is used more often than other values."},{"content":"This value can then be pulled out of the switch statement.","pos":[6569,6627]},{"content":"The same can be done with if/else instructions where the optimizer can order the if/else so that either the if or else block is placed first depending on which block is more frequently true.","pos":[6629,6819]},{"content":"<bpt id=\"p1\">**</bpt>Dead Code Separation<ept id=\"p1\">**</ept> – Code that is not called during profiling is moved to a special section that is appended to the end of the set of sections.","pos":[6829,6978],"source":"**Dead Code Separation** – Code that is not called during profiling is moved to a special section that is appended to the end of the set of sections."},{"content":"This effectively keeps this section out of the often-used pages.","pos":[6979,7043]},{"pos":[7053,7267],"content":"<bpt id=\"p1\">**</bpt>EH Code Separation<ept id=\"p1\">**</ept> – The EH code, being exceptionally executed, can often be moved to a separate section when profile-guided optimizations can determine that the exceptions occur only on exceptional conditions.","source":"**EH Code Separation** – The EH code, being exceptionally executed, can often be moved to a separate section when profile-guided optimizations can determine that the exceptions occur only on exceptional conditions."},{"content":"<bpt id=\"p1\">**</bpt>Memory Intrinsics<ept id=\"p1\">**</ept> – The expansion of intrinsics can be decided better if it can be determined if an intrinsic is called frequently.","pos":[7277,7412],"source":"**Memory Intrinsics** – The expansion of intrinsics can be decided better if it can be determined if an intrinsic is called frequently."},{"content":"An intrinsic can also be optimized based on the block size of moves or copies.","pos":[7413,7491]},{"pos":[7498,7723],"content":"For more information on performing manual optimization in the IDE or on the command line, see <bpt id=\"p1\">[</bpt>Profile Guided Optimization Plug-In<ept id=\"p1\">](../../build/reference/profile-guided-optimization-in-the-performance-and-diagnostics-hub.md)</ept>.","source":"For more information on performing manual optimization in the IDE or on the command line, see [Profile Guided Optimization Plug-In](../../build/reference/profile-guided-optimization-in-the-performance-and-diagnostics-hub.md)."},{"content":"In This Section","pos":[7732,7747]},{"content":"Profile Guided Optimization Plug-In","pos":[7752,7787]},{"content":"Tools for Manual Profile-Guided Optimization","pos":[7889,7933]},{"content":"How to: Merge Multiple PGO Profiles into a Single Profile","pos":[8013,8070]},{"content":"See Also","pos":[8163,8171]},{"content":"C/C++ Build Tools","pos":[8176,8193]}],"content":"---\ntitle: \"Profile-Guided Optimizations | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"profile-guided optimizations\"\n  - \"optimization, profile-guided [C++]\"\nms.assetid: 2225c307-d3ae-42c1-8345-a5a959d132dc\ncaps.latest.revision: 26\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Profile-Guided Optimizations\nProfile-guided optimization lets you optimize an output file, where the optimizer uses data from test runs of the .exe or .dll file. The data represents how the program is likely to perform in a production environment.  \n  \n Profile-guided optimizations are only available for x86 or [!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)] native targets. Profile-guided optimizations are not available for output files that will run on the common language runtime. Even if you produce an assembly with mixed native and managed code (compile with **/clr**), you cannot use profile-guided optimization on just the native code. If you attempt to build a project with these options set in the IDE, a build error will result.  \n  \n> [!NOTE]\n>  Information that is gathered from profiling test runs will override optimizations that would otherwise be in effect if you specify **/Ob**, **/Os**, or **/Ot**. For more information, see [/Ob (Inline Function Expansion)](../../build/reference/ob-inline-function-expansion.md) and [/Os, /Ot (Favor Small Code, Favor Fast Code)](../../build/reference/os-ot-favor-small-code-favor-fast-code.md).  \n  \n You can use the automated Profile Guided Optimization for Visual C++ plug-in in the Performance and Diagnostics Hub to simplify and streamline the optimization process within Visual Studio, or you can perform the optimization steps manually in Visual Studio or on the command line. We recommend the plug-in because it is easier to use. For information on how to get the plug-in and use it to optimize your app, see [Profile Guided Optimization Plug-In](../../build/reference/profile-guided-optimization-in-the-performance-and-diagnostics-hub.md).  \n  \n Both the Profile Guided Optimization plug-in and manual profile-guided optimization follow these steps to optimize your app:  \n  \n-   Compile one or more source code files with [/GL](../../build/reference/gl-whole-program-optimization.md).  \n  \n     Each module built with /GL can be examined during profile-guided optimization test runs to capture run-time behavior. Every module in a profile-guided optimization build does not have to be compiled with /GL. However, only those modules compiled with /GL will be instrumented and later available for profile-guided optimizations.  \n  \n-   Link using [/LTCG](../../build/reference/ltcg-link-time-code-generation.md) and [/GENPROFILE](../../build/reference/genprofile-fastgenprofile-generate-profiling-instrumented-build.md).  \n  \n     Using both /LTCG and /GENPROFILE creates an empty .pgd file. After test-run data is added to the .pgd file, it can be used as input to the next link step (creating the optimized image). When specifying /GENPROFILE, you can optionally add :PGD=`filename` to specify a nondefault name or location for the .pgd file.  \n  \n-   Profile the application.  \n  \n     Each time a profiled EXE session ends or a profiled DLL is unloaded, a *appname*!#.pgc file is created. A .pgc file contains information about a particular application test run. # is a number starting with 1 that is incremented based on the number of other *appname*!#.pgc files in the directory. You can delete a .pgc file if the test run does not represent a scenario you want to optimize.  \n  \n     During a test run, you can force closure of the currently open .pgc file and the creation of a new .pgc file with the [pgosweep](../../build/reference/pgosweep.md) utility (for example, when the end of a test scenario does not coincide with application shutdown).  \n  \n     You can use the `PogoSafeMode` option when you profile your application. This option enables you to specify whether you want to profile the application in safe mode or fast mode. For more information about these modes, see [PogoSafeMode](../../build/reference/pogosafemode.md).  \n  \n-   Link using /LTCG and /USEPROFILE.  \n  \n     Using both /LTCG and /USEPROFILE creates the optimized image. This step takes as input the .pgd file. When specifying /USEPROFILE, you can optionally add :PGD=`filename` to specify a nondefault name or location for the .pgd file. For more information, see [/LTCG](../../build/reference/ltcg-link-time-code-generation.md).  \n  \n It is even possible to create the optimized output file and later determine that additional profiling would be useful to create a more optimized image. If the instrumented image and its .pgd file are available, you can do additional test runs and rebuilt the optimized image with the newer .pgd file.  \n  \n The following is a list of the profile-guided optimizations:  \n  \n-   **Inlining** – For example, if there exists a function A that frequently calls function B, and function B is relatively small, then profile-guided optimizations will inline function B in function A.  \n  \n-   **Virtual Call Speculation** – If a virtual call, or other call through a function pointer, frequently targets a certain function, a profile-guided optimization can insert a conditionally-executed direct call to the frequently-targeted function, and the direct call can be inlined.  \n  \n-   **Register Allocation** – Optimizing with profile data results in better register allocation.  \n  \n-   **Basic Block Optimization** – Basic block optimization allows commonly executed basic blocks that temporally execute within a given frame to be placed in the same set of pages (locality). This minimizes the number of pages used, thus minimizing memory overhead.  \n  \n-   **Size/Speed Optimization** – Functions where the program spends a lot of time can be optimized for speed.  \n  \n-   **Function Layout** – Based on the call graph and profiled caller/callee behavior, functions that tend to be along the same execution path are placed in the same section.  \n  \n-   **Conditional Branch Optimization** – With the value probes, profile-guided optimizations can find if a given value in a switch statement is used more often than other values.  This value can then be pulled out of the switch statement.  The same can be done with if/else instructions where the optimizer can order the if/else so that either the if or else block is placed first depending on which block is more frequently true.  \n  \n-   **Dead Code Separation** – Code that is not called during profiling is moved to a special section that is appended to the end of the set of sections. This effectively keeps this section out of the often-used pages.  \n  \n-   **EH Code Separation** – The EH code, being exceptionally executed, can often be moved to a separate section when profile-guided optimizations can determine that the exceptions occur only on exceptional conditions.  \n  \n-   **Memory Intrinsics** – The expansion of intrinsics can be decided better if it can be determined if an intrinsic is called frequently. An intrinsic can also be optimized based on the block size of moves or copies.  \n  \n For more information on performing manual optimization in the IDE or on the command line, see [Profile Guided Optimization Plug-In](../../build/reference/profile-guided-optimization-in-the-performance-and-diagnostics-hub.md).  \n  \n## In This Section  \n [Profile Guided Optimization Plug-In](../../build/reference/profile-guided-optimization-in-the-performance-and-diagnostics-hub.md)  \n  \n [Tools for Manual Profile-Guided Optimization](../../build/reference/tools-for-manual-profile-guided-optimization.md)  \n  \n [How to: Merge Multiple PGO Profiles into a Single Profile](../../build/reference/how-to-merge-multiple-pgo-profiles-into-a-single-profile.md)  \n  \n## See Also  \n [C/C++ Build Tools](../../build/reference/c-cpp-build-tools.md)"}