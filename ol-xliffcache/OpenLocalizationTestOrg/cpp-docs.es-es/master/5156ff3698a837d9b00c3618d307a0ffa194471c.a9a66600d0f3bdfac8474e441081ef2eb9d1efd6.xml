{"nodes":[{"pos":[12,85],"content":"Hosting a Windows Form User Control as an MFC Dialog Box | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Hosting a Windows Form User Control as an MFC Dialog Box | Microsoft Docs","pos":[0,73]}]},{"content":"Hosting a Windows Form User Control as an MFC Dialog Box","pos":[718,774]},{"content":"MFC provides the template class <bpt id=\"p1\">[</bpt>CWinFormsDialog<ept id=\"p1\">](../mfc/reference/cwinformsdialog-class.md)</ept> so that you can host a Windows Forms user control (&lt;xref:System.Windows.Forms.UserControl&gt;) in a modal or modeless MFC dialog box.","pos":[775,998],"source":"MFC provides the template class [CWinFormsDialog](../mfc/reference/cwinformsdialog-class.md) so that you can host a Windows Forms user control (<xref:System.Windows.Forms.UserControl>) in a modal or modeless MFC dialog box."},{"content":"is derived from the MFC class <bpt id=\"p1\">[</bpt>CDialog<ept id=\"p1\">](../mfc/reference/cdialog-class.md)</ept>, so the dialog box can be launched as modal or modeless.","pos":[1017,1148],"source":" is derived from the MFC class [CDialog](../mfc/reference/cdialog-class.md), so the dialog box can be launched as modal or modeless."},{"content":"The process that <ph id=\"ph1\">`CWinFormsDialog`</ph> uses to host the user control is the similar to that described in <bpt id=\"p1\">[</bpt>Hosting a Windows Form User Control in an MFC Dialog Box<ept id=\"p1\">](../dotnet/hosting-a-windows-form-user-control-in-an-mfc-dialog-box.md)</ept>.","pos":[1155,1386],"source":"The process that `CWinFormsDialog` uses to host the user control is the similar to that described in [Hosting a Windows Form User Control in an MFC Dialog Box](../dotnet/hosting-a-windows-form-user-control-in-an-mfc-dialog-box.md)."},{"content":"However, <ph id=\"ph1\">`CWinFormsDialog`</ph> manages the initialization and hosting of the user control so that it does not have to be programmed manually.","pos":[1387,1524],"source":" However, `CWinFormsDialog` manages the initialization and hosting of the user control so that it does not have to be programmed manually."},{"pos":[1531,1746],"content":"For a sample application that shows Windows Forms used with MFC, see <bpt id=\"p1\">[</bpt>MFC and Windows Forms Integration<ept id=\"p1\">](http://www.microsoft.com/downloads/details.aspx?FamilyID=987021bc-e575-4fe3-baa9-15aa50b0f599&amp;displaylang=en)</ept>.","source":"For a sample application that shows Windows Forms used with MFC, see [MFC and Windows Forms Integration](http://www.microsoft.com/downloads/details.aspx?FamilyID=987021bc-e575-4fe3-baa9-15aa50b0f599&displaylang=en)."},{"content":"To create the MFC host application","pos":[1756,1790]},{"content":"Create an MFC Application project.","pos":[1800,1834]},{"content":"On the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, select <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>.","pos":[1845,1910],"source":"On the **File** menu, select **New**, and then click **Project**."},{"content":"In the <bpt id=\"p1\">**</bpt>Visual C++<ept id=\"p1\">**</ept> folder, select <bpt id=\"p2\">**</bpt>MFC Application<ept id=\"p2\">**</ept>.","pos":[1911,1968],"source":" In the **Visual C++** folder, select **MFC Application**."},{"pos":[1979,2082],"content":"In the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> box, enter <ph id=\"ph1\">`MFC03`</ph> and change the Solution setting to <bpt id=\"p2\">**</bpt>Add to Solution<ept id=\"p2\">**</ept>.Click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>.","source":"In the **Name** box, enter `MFC03` and change the Solution setting to **Add to Solution**.Click **OK**."},{"content":"In the <bpt id=\"p1\">**</bpt>MFC Application Wizard<ept id=\"p1\">**</ept>, accept all the defaults, and then click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept>.","pos":[2093,2179],"source":"In the **MFC Application Wizard**, accept all the defaults, and then click **Finish**."},{"content":"This creates an MFC application with a Multiple Document Interface.","pos":[2180,2247]},{"content":"Configure the project.","pos":[2257,2279]},{"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>MFC03<ept id=\"p2\">**</ept> project node, and choose <bpt id=\"p3\">**</bpt>Properties<ept id=\"p3\">**</ept>.","pos":[2290,2382],"source":"In **Solution Explorer**, right-click the **MFC03** project node, and choose **Properties**."},{"content":"The <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box appears.","pos":[2383,2425],"source":" The **Property Pages** dialog box appears."},{"content":"In the <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box, in the <bpt id=\"p2\">**</bpt>Configuration Properties<ept id=\"p2\">**</ept> tree control, select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>, then in the <bpt id=\"p4\">**</bpt>Project Defaults<ept id=\"p4\">**</ept> section, set <bpt id=\"p5\">**</bpt>Common Language Runtime support<ept id=\"p5\">**</ept> to <bpt id=\"p6\">**</bpt>Common Language Runtime Support (/clr)<ept id=\"p6\">**</ept>.","pos":[2436,2672],"source":"In the **Property Pages** dialog box, in the **Configuration Properties** tree control, select **General**, then in the **Project Defaults** section, set **Common Language Runtime support** to **Common Language Runtime Support (/clr)**."},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[2673,2686],"source":" Click **OK**."},{"content":"Add a reference to the .NET control.","pos":[2696,2732]},{"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>MFC03<ept id=\"p2\">**</ept> project node and choose <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>References<ept id=\"p4\">**</ept>.","pos":[2743,2843],"source":"In **Solution Explorer**, right-click the **MFC03** project node and choose **Add**, **References**."},{"content":"In the <bpt id=\"p1\">**</bpt>Property Page<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Add New Reference<ept id=\"p2\">**</ept>, select WindowsControlLibrary1 (under the <bpt id=\"p3\">**</bpt>Projects<ept id=\"p3\">**</ept> tab), and click <bpt id=\"p4\">**</bpt>OK<ept id=\"p4\">**</ept>.","pos":[2844,2976],"source":" In the **Property Page**, click **Add New Reference**, select WindowsControlLibrary1 (under the **Projects** tab), and click **OK**."},{"content":"This adds a reference in the form of a <bpt id=\"p1\">[</bpt>/FU<ept id=\"p1\">](../build/reference/fu-name-forced-hash-using-file.md)</ept> compiler option so that the program will compile; it also copies WindowsControlLibrary1.dll into the <ph id=\"ph1\">`MFC03`</ph> project directory so that the program will run.","pos":[2977,3232],"source":" This adds a reference in the form of a [/FU](../build/reference/fu-name-forced-hash-using-file.md) compiler option so that the program will compile; it also copies WindowsControlLibrary1.dll into the `MFC03` project directory so that the program will run."},{"pos":[3242,3335],"content":"Add <ph id=\"ph1\">`#include &lt;afxwinforms.h&gt;`</ph> to stdafx.h, at the end of the existing <ph id=\"ph2\">`#include`</ph> statements.","source":"Add `#include <afxwinforms.h>` to stdafx.h, at the end of the existing `#include` statements."},{"pos":[3345,3387],"content":"Add a new class that subclasses <ph id=\"ph1\">`CDialog`</ph>.","source":"Add a new class that subclasses `CDialog`."},{"content":"Right click on project name and add an MFC class (called CHostForWinForm) that subclasses <ph id=\"ph1\">`CDialog`</ph>.","pos":[3398,3498],"source":"Right click on project name and add an MFC class (called CHostForWinForm) that subclasses `CDialog`."},{"content":"Since you do not need the dialog box resource, you can delete the resource ID (select the Resource View, expand the Dialog folder and delete IDD_HOSTFORWINFORM resource.","pos":[3499,3668]},{"content":"Then, remove any references to the ID in code.).","pos":[3670,3718]},{"pos":[3728,3858],"content":"Replace <ph id=\"ph1\">`CDialog`</ph> in CHostForWinForm.h and CHostForWinForm.cpp files with <ph id=\"ph2\">`CWinFormsDialog&lt;WindowsControlLibrary1::UserControl1&gt;`</ph>.","source":"Replace `CDialog` in CHostForWinForm.h and CHostForWinForm.cpp files with `CWinFormsDialog<WindowsControlLibrary1::UserControl1>`."},{"content":"Call DoModal on the CHostForWinForm class.","pos":[3868,3910]},{"pos":[3921,3969],"content":"In MFC03.cpp, add <ph id=\"ph1\">`#include \"HostForWinForm.h\"`</ph>.","source":"In MFC03.cpp, add `#include \"HostForWinForm.h\"`."},{"content":"Before the return statement in the definition of CMFC03App::InitInstance, add:","pos":[3980,4058]},{"content":"Build and run the project.","pos":[4154,4180]},{"pos":[4191,4239],"content":"On the <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Build Solution<ept id=\"p2\">**</ept>.","source":"On the **Build** menu, click **Build Solution**."},{"pos":[4250,4307],"content":"On the <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Start without debugging<ept id=\"p2\">**</ept>.","source":"On the **Debug** menu, click **Start without debugging**."},{"content":"Next you will add code to monitor the state of a control on the Windows Forms from the MFC application.","pos":[4318,4421]},{"content":"Add a handler for OnInitDialog.","pos":[4430,4461]},{"content":"Display the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window (F4).","pos":[4472,4511],"source":"Display the **Properties** window (F4)."},{"content":"In <bpt id=\"p1\">**</bpt>Class View<ept id=\"p1\">**</ept>, select CHostForWinForm.","pos":[4512,4554],"source":" In **Class View**, select CHostForWinForm."},{"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, select overrides and in the row for OnInitDialog, click in the left hand column and select <ph id=\"ph1\">\\&lt;</ph> Add &gt;.","pos":[4555,4685],"source":" In the **Properties** window, select overrides and in the row for OnInitDialog, click in the left hand column and select \\< Add >."},{"content":"This adds the following line to CHostForWinForm.h:","pos":[4686,4736]},{"content":"Define OnInitDialog (in CHostForWinForm.cpp) as follows:","pos":[4804,4860]},{"content":"Next add the OnButton1 handler.","pos":[5137,5168]},{"content":"Add the following lines to the public section of the CHostForWinForm class in CHostForWinForm.h:","pos":[5169,5265]},{"content":"In CHostForWinForm.cpp, add this definition:","pos":[5530,5574]},{"content":"Build and run the project.","pos":[5769,5795]},{"content":"When you click the button, which is on the Windows Form, code in the MFC application will run.","pos":[5796,5890]},{"content":"Next you will add code to display from the MFC code the value in the text box on the Windows Form.","pos":[5901,5999]},{"content":"In the public section of the CHostForWinForm class in CHostForWinForm.h, add the following declaration:","pos":[6009,6112]},{"content":"In the definition of DoDataExchange in CHostForWinForm.cpp, add the following three lines to the end of the function:","pos":[6180,6297]},{"content":"In the definition of OnButton1 in CHostForWinForm.cpp, add the following three lines to the end of the function:","pos":[6530,6642]},{"content":"Build and run the project.","pos":[6826,6852]},{"content":"See Also","pos":[6861,6869]},{"content":"&lt;xref:System.Windows.Forms.UserControl?displayProperty=fullName&gt;","pos":[6873,6937],"source":"<xref:System.Windows.Forms.UserControl?displayProperty=fullName> "},{"content":"Using a Windows Form User Control in MFC","pos":[6943,6983]}],"content":"---\ntitle: \"Hosting a Windows Form User Control as an MFC Dialog Box | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MFC [C++], Windows Forms support\"\n  - \"Windows Forms [C++], hosting as MFC Dialog\"\n  - \"hosting Windows Forms control [C++]\"\nms.assetid: 0434a9d7-8b14-48e6-ad69-9ba9a684677a\ncaps.latest.revision: 16\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Hosting a Windows Form User Control as an MFC Dialog Box\nMFC provides the template class [CWinFormsDialog](../mfc/reference/cwinformsdialog-class.md) so that you can host a Windows Forms user control (<xref:System.Windows.Forms.UserControl>) in a modal or modeless MFC dialog box. `CWinFormsDialog` is derived from the MFC class [CDialog](../mfc/reference/cdialog-class.md), so the dialog box can be launched as modal or modeless.  \n  \n The process that `CWinFormsDialog` uses to host the user control is the similar to that described in [Hosting a Windows Form User Control in an MFC Dialog Box](../dotnet/hosting-a-windows-form-user-control-in-an-mfc-dialog-box.md). However, `CWinFormsDialog` manages the initialization and hosting of the user control so that it does not have to be programmed manually.  \n  \n For a sample application that shows Windows Forms used with MFC, see [MFC and Windows Forms Integration](http://www.microsoft.com/downloads/details.aspx?FamilyID=987021bc-e575-4fe3-baa9-15aa50b0f599&displaylang=en).  \n  \n### To create the MFC host application  \n  \n1.  Create an MFC Application project.  \n  \n     On the **File** menu, select **New**, and then click **Project**. In the **Visual C++** folder, select **MFC Application**.  \n  \n     In the **Name** box, enter `MFC03` and change the Solution setting to **Add to Solution**.Click **OK**.  \n  \n     In the **MFC Application Wizard**, accept all the defaults, and then click **Finish**. This creates an MFC application with a Multiple Document Interface.  \n  \n2.  Configure the project.  \n  \n     In **Solution Explorer**, right-click the **MFC03** project node, and choose **Properties**. The **Property Pages** dialog box appears.  \n  \n     In the **Property Pages** dialog box, in the **Configuration Properties** tree control, select **General**, then in the **Project Defaults** section, set **Common Language Runtime support** to **Common Language Runtime Support (/clr)**. Click **OK**.  \n  \n3.  Add a reference to the .NET control.  \n  \n     In **Solution Explorer**, right-click the **MFC03** project node and choose **Add**, **References**. In the **Property Page**, click **Add New Reference**, select WindowsControlLibrary1 (under the **Projects** tab), and click **OK**. This adds a reference in the form of a [/FU](../build/reference/fu-name-forced-hash-using-file.md) compiler option so that the program will compile; it also copies WindowsControlLibrary1.dll into the `MFC03` project directory so that the program will run.  \n  \n4.  Add `#include <afxwinforms.h>` to stdafx.h, at the end of the existing `#include` statements.  \n  \n5.  Add a new class that subclasses `CDialog`.  \n  \n     Right click on project name and add an MFC class (called CHostForWinForm) that subclasses `CDialog`. Since you do not need the dialog box resource, you can delete the resource ID (select the Resource View, expand the Dialog folder and delete IDD_HOSTFORWINFORM resource.  Then, remove any references to the ID in code.).  \n  \n6.  Replace `CDialog` in CHostForWinForm.h and CHostForWinForm.cpp files with `CWinFormsDialog<WindowsControlLibrary1::UserControl1>`.  \n  \n7.  Call DoModal on the CHostForWinForm class.  \n  \n     In MFC03.cpp, add `#include \"HostForWinForm.h\"`.  \n  \n     Before the return statement in the definition of CMFC03App::InitInstance, add:  \n  \n     `CHostForWinForm m_HostForWinForm;`  \n  \n     `m_HostForWinForm.DoModal();`  \n  \n8.  Build and run the project.  \n  \n     On the **Build** menu, click **Build Solution**.  \n  \n     On the **Debug** menu, click **Start without debugging**.  \n  \n     Next you will add code to monitor the state of a control on the Windows Forms from the MFC application.  \n  \n9. Add a handler for OnInitDialog.  \n  \n     Display the **Properties** window (F4). In **Class View**, select CHostForWinForm. In the **Properties** window, select overrides and in the row for OnInitDialog, click in the left hand column and select \\< Add >. This adds the following line to CHostForWinForm.h:  \n  \n    ```  \n    virtual BOOL OnInitDialog();  \n    ```  \n  \n10. Define OnInitDialog (in CHostForWinForm.cpp) as follows:  \n  \n    ```  \n    BOOL CHostForWinForm::OnInitDialog() {  \n       CWinFormsDialog<WindowsControlLibrary1::UserControl1>::OnInitDialog();  \n       GetControl()->button1->Click += MAKE_DELEGATE(System::EventHandler, OnButton1);  \n       return TRUE;  \n    }  \n    ```  \n  \n11. Next add the OnButton1 handler. Add the following lines to the public section of the CHostForWinForm class in CHostForWinForm.h:  \n  \n    ```  \n    virtual void OnButton1( System::Object^ sender, System::EventArgs^ e );  \n  \n    BEGIN_DELEGATE_MAP( CHostForWinForm )  \n       EVENT_DELEGATE_ENTRY( OnButton1, System::Object^, System::EventArgs^ );  \n    END_DELEGATE_MAP()  \n    ```  \n  \n     In CHostForWinForm.cpp, add this definition:  \n  \n    ```  \n    void CHostForWinForm::OnButton1( System::Object^ sender, System::EventArgs^ e )   \n    {  \n       System::Windows::Forms::MessageBox::Show(\"test\");  \n    }  \n    ```  \n  \n12. Build and run the project. When you click the button, which is on the Windows Form, code in the MFC application will run.  \n  \n     Next you will add code to display from the MFC code the value in the text box on the Windows Form.  \n  \n13. In the public section of the CHostForWinForm class in CHostForWinForm.h, add the following declaration:  \n  \n    ```  \n    CString m_sEditBoxOnWinForm;  \n    ```  \n  \n14. In the definition of DoDataExchange in CHostForWinForm.cpp, add the following three lines to the end of the function:  \n  \n    ```  \n    if (pDX->m_bSaveAndValidate)  \n       m_sEditBoxOnWinForm = CString( GetControl()->textBox1->Text);  \n    else  \n       GetControl()->textBox1->Text = gcnew System::String(m_sEditBoxOnWinForm);  \n    ```  \n  \n15. In the definition of OnButton1 in CHostForWinForm.cpp, add the following three lines to the end of the function:  \n  \n    ```  \n    this->UpdateData(TRUE);  \n    System::String ^ z = gcnew System::String(m_sEditBoxOnWinForm);  \n    System::Windows::Forms::MessageBox::Show(z);  \n    ```  \n  \n16. Build and run the project.  \n  \n## See Also  \n <xref:System.Windows.Forms.UserControl?displayProperty=fullName>   \n [Using a Windows Form User Control in MFC](../dotnet/using-a-windows-form-user-control-in-mfc.md)"}