{"nodes":[{"pos":[12,62],"content":"MFC ActiveX Controls: Serializing | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"MFC ActiveX Controls: Serializing | Microsoft Docs","pos":[0,50]}]},{"content":"MFC ActiveX Controls: Serializing","pos":[897,930]},{"content":"This article discusses how to serialize an ActiveX control.","pos":[931,990]},{"content":"Serialization is the process of reading from or writing to a persistent storage medium, such as a disk file.","pos":[991,1099]},{"content":"The Microsoft Foundation Class (MFC) Library provides built-in support for serialization in class <ph id=\"ph1\">`CObject`</ph>.","pos":[1100,1208],"source":" The Microsoft Foundation Class (MFC) Library provides built-in support for serialization in class `CObject`."},{"content":"extends this support to ActiveX controls through the use of a property exchange mechanism.","pos":[1223,1313]},{"content":"Serialization for ActiveX controls is implemented by overriding <bpt id=\"p1\">[</bpt>COleControl::DoPropExchange<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange)</ept>.","pos":[1320,1481],"source":"Serialization for ActiveX controls is implemented by overriding [COleControl::DoPropExchange](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange)."},{"content":"This function, called during the loading and saving of the control object, stores all properties implemented with a member variable or a member variable with change notification.","pos":[1482,1660]},{"content":"The following topics cover the main issues related to serializing an ActiveX control:","pos":[1667,1752]},{"pos":[1762,1833],"content":"Implementing <ph id=\"ph1\">`DoPropExchange`</ph> function to serialize your control object","source":"Implementing `DoPropExchange` function to serialize your control object"},{"content":"Customizing the Serialization Process","pos":[1844,1881]},{"content":"Implementing Version Support","pos":[1952,1980]},{"pos":[2090,2130],"content":"Implementing the DoPropExchange Function"},{"content":"When you use the ActiveX Control Wizard to generate the control project, several default handler functions are automatically added to the control class, including the default implementation of <bpt id=\"p1\">[</bpt>COleControl::DoPropExchange<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange)</ept>.","pos":[2134,2424],"source":"When you use the ActiveX Control Wizard to generate the control project, several default handler functions are automatically added to the control class, including the default implementation of [COleControl::DoPropExchange](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange)."},{"content":"The following example shows the code added to classes created with the ActiveX Control Wizard:","pos":[2425,2519]},{"pos":[2537,2552],"content":"NVC_MFC_AxUI#43"},{"content":"If you want to make a property persistent, modify <ph id=\"ph1\">`DoPropExchange`</ph> by adding a call to the property exchange function.","pos":[2624,2742],"source":"If you want to make a property persistent, modify `DoPropExchange` by adding a call to the property exchange function."},{"content":"The following example demonstrates the serialization of a custom Boolean CircleShape property, where the CircleShape property has a default value of <bpt id=\"p1\">**</bpt>TRUE<ept id=\"p1\">**</ept>:","pos":[2743,2901],"source":" The following example demonstrates the serialization of a custom Boolean CircleShape property, where the CircleShape property has a default value of **TRUE**:"},{"content":"NVC_MFC_AxSer#1","pos":[2919,2934]},{"content":"NVC_MFC_AxSer#2","pos":[3013,3028]},{"content":"The following table lists the possible property exchange functions you can use to serialize the control's properties:","pos":[3100,3217]},{"content":"Property exchange functions","pos":[3224,3251]},{"content":"Purpose","pos":[3252,3259]},{"content":"PX_Blob( )","pos":[3318,3328]},{"content":"Serializes a type Binary Large Object (BLOB) data property.","pos":[3331,3390]},{"content":"PX_Bool( )","pos":[3397,3407]},{"content":"Serializes a type Boolean property.","pos":[3410,3445]},{"content":"PX_Color( )","pos":[3452,3463]},{"content":"Serializes a type color property.","pos":[3466,3499]},{"content":"PX_Currency( )","pos":[3506,3520]},{"pos":[3523,3568],"content":"Serializes a type <bpt id=\"p1\">**</bpt>CY<ept id=\"p1\">**</ept> (currency) property.","source":"Serializes a type **CY** (currency) property."},{"content":"PX_Double( )","pos":[3575,3587]},{"pos":[3590,3628],"content":"Serializes a type <bpt id=\"p1\">**</bpt>double<ept id=\"p1\">**</ept> property.","source":"Serializes a type **double** property."},{"content":"PX_Font( )","pos":[3635,3645]},{"content":"Serializes a Font type property.","pos":[3648,3680]},{"content":"PX_Float( )","pos":[3687,3698]},{"pos":[3701,3738],"content":"Serializes a type <bpt id=\"p1\">**</bpt>float<ept id=\"p1\">**</ept> property.","source":"Serializes a type **float** property."},{"content":"PX_IUnknown( )","pos":[3745,3759]},{"pos":[3762,3804],"content":"Serializes a property of type <ph id=\"ph1\">`LPUNKNOWN`</ph>.","source":"Serializes a property of type `LPUNKNOWN`."},{"content":"PX_Long( )","pos":[3811,3821]},{"pos":[3824,3860],"content":"Serializes a type <bpt id=\"p1\">**</bpt>long<ept id=\"p1\">**</ept> property.","source":"Serializes a type **long** property."},{"content":"PX_Picture( )","pos":[3867,3880]},{"content":"Serializes a type Picture property.","pos":[3883,3918]},{"content":"PX_Short( )","pos":[3925,3936]},{"pos":[3939,3976],"content":"Serializes a type <bpt id=\"p1\">**</bpt>short<ept id=\"p1\">**</ept> property.","source":"Serializes a type **short** property."},{"content":"PXstring( )","pos":[3983,3994]},{"pos":[3997,4034],"content":"Serializes a type <ph id=\"ph1\">`CString`</ph> property.","source":"Serializes a type `CString` property."},{"content":"PX_ULong( )","pos":[4041,4052]},{"pos":[4055,4092],"content":"Serializes a type <bpt id=\"p1\">**</bpt>ULONG<ept id=\"p1\">**</ept> property.","source":"Serializes a type **ULONG** property."},{"content":"PX_UShort( )","pos":[4099,4111]},{"pos":[4114,4152],"content":"Serializes a type <bpt id=\"p1\">**</bpt>USHORT<ept id=\"p1\">**</ept> property.","source":"Serializes a type **USHORT** property."},{"pos":[4160,4325],"content":"For more information on these property exchange functions, see <bpt id=\"p1\">[</bpt>Persistence of OLE Controls<ept id=\"p1\">](../mfc/reference/persistence-of-ole-controls.md)</ept> in the <bpt id=\"p2\">*</bpt>MFC Reference<ept id=\"p2\">*</ept>.","source":"For more information on these property exchange functions, see [Persistence of OLE Controls](../mfc/reference/persistence-of-ole-controls.md) in the *MFC Reference*."},{"pos":[4407,4457],"content":"Customizing the Default Behavior of DoPropExchange"},{"content":"The default implementation of <bpt id=\"p1\">**</bpt>DoPropertyExchange<ept id=\"p1\">**</ept> (as shown in the previous topic) makes a call to base class <ph id=\"ph1\">`COleControl`</ph>.","pos":[4461,4588],"source":"The default implementation of **DoPropertyExchange** (as shown in the previous topic) makes a call to base class `COleControl`."},{"content":"This serializes the set of properties automatically supported by <ph id=\"ph1\">`COleControl`</ph>, which uses more storage space than serializing only the custom properties of the control.","pos":[4589,4758],"source":" This serializes the set of properties automatically supported by `COleControl`, which uses more storage space than serializing only the custom properties of the control."},{"content":"Removing this call allows your object to serialize only those properties you consider important.","pos":[4759,4855]},{"content":"Any stock property states the control has implemented will not be serialized when saving or loading the control object unless you explicitly add <bpt id=\"p1\">**</bpt>PX_<ept id=\"p1\">**</ept> calls for them.","pos":[4856,5024],"source":" Any stock property states the control has implemented will not be serialized when saving or loading the control object unless you explicitly add **PX_** calls for them."},{"pos":[5084,5112],"content":"Implementing Version Support"},{"content":"Version support enables a revised ActiveX control to add new persistent properties, and still be able to detect and load the persistent state created by an earlier version of the control.","pos":[5116,5303]},{"content":"To make a control's version available as part of its persistent data, call <bpt id=\"p1\">[</bpt>COleControl::ExchangeVersion<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__exchangeversion)</ept> in the control's <ph id=\"ph1\">`DoPropExchange`</ph> function.","pos":[5304,5521],"source":" To make a control's version available as part of its persistent data, call [COleControl::ExchangeVersion](../mfc/reference/colecontrol-class.md#colecontrol__exchangeversion) in the control's `DoPropExchange` function."},{"content":"This call is automatically inserted if the ActiveX control was created using the ActiveX Control Wizard.","pos":[5522,5626]},{"content":"It can be removed if version support is not needed.","pos":[5627,5678]},{"content":"However, the cost in control size is very small (4 bytes) for the added flexibility that version support provides.","pos":[5679,5793]},{"pos":[5800,6043],"content":"If the control was not created with the ActiveX Control Wizard, add a call to <ph id=\"ph1\">`COleControl::ExchangeVersion`</ph> by inserting the following line at the beginning of your <ph id=\"ph2\">`DoPropExchange`</ph> function (before the call to <ph id=\"ph3\">`COleControl::DoPropExchange`</ph>):","source":"If the control was not created with the ActiveX Control Wizard, add a call to `COleControl::ExchangeVersion` by inserting the following line at the beginning of your `DoPropExchange` function (before the call to `COleControl::DoPropExchange`):"},{"content":"NVC_MFC_AxSer#1","pos":[6061,6076]},{"content":"NVC_MFC_AxSer#3","pos":[6155,6170]},{"content":"You can use any <ph id=\"ph1\">`DWORD`</ph> as the version number.","pos":[6242,6288],"source":"You can use any `DWORD` as the version number."},{"content":"Projects generated by the ActiveX Control Wizard use <bpt id=\"p1\">**</bpt>_wVerMinor<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>_wVerMajor<ept id=\"p2\">**</ept> as the default.","pos":[6289,6391],"source":" Projects generated by the ActiveX Control Wizard use **_wVerMinor** and **_wVerMajor** as the default."},{"content":"These are global constants defined in the implementation file of the project's ActiveX control class.","pos":[6392,6493]},{"content":"Within the remainder of your <ph id=\"ph1\">`DoPropExchange`</ph> function, you can call <bpt id=\"p1\">[</bpt>CPropExchange::GetVersion<ept id=\"p1\">](../mfc/reference/cpropexchange-class.md#cpropexchange__getversion)</ept> at any time to retrieve the version you are saving or retrieving.","pos":[6494,6723],"source":" Within the remainder of your `DoPropExchange` function, you can call [CPropExchange::GetVersion](../mfc/reference/cpropexchange-class.md#cpropexchange__getversion) at any time to retrieve the version you are saving or retrieving."},{"content":"In the following example, version 1 of this sample control has only a \"ReleaseDate\" property.","pos":[6730,6823]},{"content":"Version 2 adds an \"OriginalDate\" property.","pos":[6824,6866]},{"content":"If the control is instructed to load the persistent state from the old version, it initializes the member variable for the new property to a default value.","pos":[6867,7022]},{"content":"NVC_MFC_AxSer#4","pos":[7040,7055]},{"content":"NVC_MFC_AxSer#3","pos":[7134,7149]},{"content":"By default, a control \"converts\" old data to the latest format.","pos":[7221,7284]},{"content":"For example, if version 2 of a control loads data that was saved by version 1, it will write the version 2 format when it is saved again.","pos":[7285,7422]},{"content":"If you want the control to save data in the format last read, pass <bpt id=\"p1\">**</bpt>FALSE<ept id=\"p1\">**</ept> as a third parameter when calling <ph id=\"ph1\">`ExchangeVersion`</ph>.","pos":[7423,7552],"source":" If you want the control to save data in the format last read, pass **FALSE** as a third parameter when calling `ExchangeVersion`."},{"content":"This third parameter is optional and is <bpt id=\"p1\">**</bpt>TRUE<ept id=\"p1\">**</ept> by default.","pos":[7553,7613],"source":" This third parameter is optional and is **TRUE** by default."},{"content":"See Also","pos":[7622,7630]},{"content":"MFC ActiveX Controls","pos":[7635,7655]}],"content":"---\ntitle: \"MFC ActiveX Controls: Serializing | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"_wVerMinor\"\n  - \"DoPropExchange\"\n  - \"_wVerMajor\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MFC ActiveX controls, version support\"\n  - \"wVerMinor global constant\"\n  - \"GetVersion method\"\n  - \"ExchangeVersion method\"\n  - \"MFC ActiveX controls, serializing\"\n  - \"DoPropExchange method\"\n  - \"versioning ActiveX controls\"\n  - \"wVerMajor global constant\"\nms.assetid: 9d57c290-dd8c-4853-b552-6f17f15ebedd\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# MFC ActiveX Controls: Serializing\nThis article discusses how to serialize an ActiveX control. Serialization is the process of reading from or writing to a persistent storage medium, such as a disk file. The Microsoft Foundation Class (MFC) Library provides built-in support for serialization in class `CObject`. `COleControl` extends this support to ActiveX controls through the use of a property exchange mechanism.  \n  \n Serialization for ActiveX controls is implemented by overriding [COleControl::DoPropExchange](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange). This function, called during the loading and saving of the control object, stores all properties implemented with a member variable or a member variable with change notification.  \n  \n The following topics cover the main issues related to serializing an ActiveX control:  \n  \n-   Implementing `DoPropExchange` function to serialize your control object  \n  \n-   [Customizing the Serialization Process](#_core_customizing_the_default_behavior_of_dopropexchange)  \n  \n-   [Implementing Version Support](#_core_implementing_version_support)  \n  \n##  <a name=\"_core_implementing_the_dopropexchange_function\"></a> Implementing the DoPropExchange Function  \n When you use the ActiveX Control Wizard to generate the control project, several default handler functions are automatically added to the control class, including the default implementation of [COleControl::DoPropExchange](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange). The following example shows the code added to classes created with the ActiveX Control Wizard:  \n  \n [!code-cpp[NVC_MFC_AxUI#43](../mfc/codesnippet/cpp/mfc-activex-controls-serializing_1.cpp)]  \n  \n If you want to make a property persistent, modify `DoPropExchange` by adding a call to the property exchange function. The following example demonstrates the serialization of a custom Boolean CircleShape property, where the CircleShape property has a default value of **TRUE**:  \n  \n [!code-cpp[NVC_MFC_AxSer#1](../mfc/codesnippet/cpp/mfc-activex-controls-serializing_2.cpp)]  \n[!code-cpp[NVC_MFC_AxSer#2](../mfc/codesnippet/cpp/mfc-activex-controls-serializing_3.cpp)]  \n  \n The following table lists the possible property exchange functions you can use to serialize the control's properties:  \n  \n|Property exchange functions|Purpose|  \n|---------------------------------|-------------|  \n|**PX_Blob( )**|Serializes a type Binary Large Object (BLOB) data property.|  \n|**PX_Bool( )**|Serializes a type Boolean property.|  \n|**PX_Color( )**|Serializes a type color property.|  \n|**PX_Currency( )**|Serializes a type **CY** (currency) property.|  \n|**PX_Double( )**|Serializes a type **double** property.|  \n|**PX_Font( )**|Serializes a Font type property.|  \n|**PX_Float( )**|Serializes a type **float** property.|  \n|**PX_IUnknown( )**|Serializes a property of type `LPUNKNOWN`.|  \n|**PX_Long( )**|Serializes a type **long** property.|  \n|**PX_Picture( )**|Serializes a type Picture property.|  \n|**PX_Short( )**|Serializes a type **short** property.|  \n|**PXstring( )**|Serializes a type `CString` property.|  \n|**PX_ULong( )**|Serializes a type **ULONG** property.|  \n|**PX_UShort( )**|Serializes a type **USHORT** property.|  \n  \n For more information on these property exchange functions, see [Persistence of OLE Controls](../mfc/reference/persistence-of-ole-controls.md) in the *MFC Reference*.  \n  \n##  <a name=\"_core_customizing_the_default_behavior_of_dopropexchange\"></a> Customizing the Default Behavior of DoPropExchange  \n The default implementation of **DoPropertyExchange** (as shown in the previous topic) makes a call to base class `COleControl`. This serializes the set of properties automatically supported by `COleControl`, which uses more storage space than serializing only the custom properties of the control. Removing this call allows your object to serialize only those properties you consider important. Any stock property states the control has implemented will not be serialized when saving or loading the control object unless you explicitly add **PX_** calls for them.  \n  \n##  <a name=\"_core_implementing_version_support\"></a> Implementing Version Support  \n Version support enables a revised ActiveX control to add new persistent properties, and still be able to detect and load the persistent state created by an earlier version of the control. To make a control's version available as part of its persistent data, call [COleControl::ExchangeVersion](../mfc/reference/colecontrol-class.md#colecontrol__exchangeversion) in the control's `DoPropExchange` function. This call is automatically inserted if the ActiveX control was created using the ActiveX Control Wizard. It can be removed if version support is not needed. However, the cost in control size is very small (4 bytes) for the added flexibility that version support provides.  \n  \n If the control was not created with the ActiveX Control Wizard, add a call to `COleControl::ExchangeVersion` by inserting the following line at the beginning of your `DoPropExchange` function (before the call to `COleControl::DoPropExchange`):  \n  \n [!code-cpp[NVC_MFC_AxSer#1](../mfc/codesnippet/cpp/mfc-activex-controls-serializing_2.cpp)]  \n[!code-cpp[NVC_MFC_AxSer#3](../mfc/codesnippet/cpp/mfc-activex-controls-serializing_4.cpp)]  \n  \n You can use any `DWORD` as the version number. Projects generated by the ActiveX Control Wizard use **_wVerMinor** and **_wVerMajor** as the default. These are global constants defined in the implementation file of the project's ActiveX control class. Within the remainder of your `DoPropExchange` function, you can call [CPropExchange::GetVersion](../mfc/reference/cpropexchange-class.md#cpropexchange__getversion) at any time to retrieve the version you are saving or retrieving.  \n  \n In the following example, version 1 of this sample control has only a \"ReleaseDate\" property. Version 2 adds an \"OriginalDate\" property. If the control is instructed to load the persistent state from the old version, it initializes the member variable for the new property to a default value.  \n  \n [!code-cpp[NVC_MFC_AxSer#4](../mfc/codesnippet/cpp/mfc-activex-controls-serializing_5.cpp)]  \n[!code-cpp[NVC_MFC_AxSer#3](../mfc/codesnippet/cpp/mfc-activex-controls-serializing_4.cpp)]  \n  \n By default, a control \"converts\" old data to the latest format. For example, if version 2 of a control loads data that was saved by version 1, it will write the version 2 format when it is saved again. If you want the control to save data in the format last read, pass **FALSE** as a third parameter when calling `ExchangeVersion`. This third parameter is optional and is **TRUE** by default.  \n  \n## See Also  \n [MFC ActiveX Controls](../mfc/mfc-activex-controls.md)\n\n"}