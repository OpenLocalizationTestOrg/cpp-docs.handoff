{"nodes":[{"pos":[12,80],"content":"MFC ActiveX Controls: Subclassing a Windows Control | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"MFC ActiveX Controls: Subclassing a Windows Control | Microsoft Docs","pos":[0,68]}]},{"content":"MFC ActiveX Controls: Subclassing a Windows Control","pos":[998,1049]},{"content":"This article describes the process for subclassing a common Windows control to create an ActiveX control.","pos":[1050,1155]},{"content":"Subclassing an existing Windows control is a quick way to develop an ActiveX control.","pos":[1156,1241]},{"content":"The new control will have the abilities of the subclassed Windows control, such as painting and responding to mouse clicks.","pos":[1242,1365]},{"content":"The MFC ActiveX controls sample <bpt id=\"p1\">[</bpt>BUTTON<ept id=\"p1\">](../visual-cpp-samples.md)</ept> is an example of subclassing a Windows control.","pos":[1366,1480],"source":" The MFC ActiveX controls sample [BUTTON](../visual-cpp-samples.md) is an example of subclassing a Windows control."},{"content":"To subclass a Windows control, complete the following tasks:","pos":[1487,1547]},{"content":"Override the IsSubclassedControl and PreCreateWindow member functions of COleControl","pos":[1558,1642]},{"content":"Modify the OnDraw member function","pos":[1713,1746]},{"content":"Handle any ActiveX control messages (OCM) reflected to the control","pos":[1803,1869]},{"pos":[1925,2132],"content":"[!NOTE]\n Much of this work is done for you by the ActiveX Control Wizard if you select control to be subclassed using the **Select Parent Window Class** drop-down list on the **Control Settings** page.","leadings":["","    > "],"nodes":[{"content":"Much of this work is done for you by the ActiveX Control Wizard if you select control to be subclassed using the <bpt id=\"p1\">**</bpt>Select Parent Window Class<ept id=\"p1\">**</ept> drop-down list on the <bpt id=\"p2\">**</bpt>Control Settings<ept id=\"p2\">**</ept> page.","pos":[9,201],"source":" Much of this work is done for you by the ActiveX Control Wizard if you select control to be subclassed using the **Select Parent Window Class** drop-down list on the **Control Settings** page."}]},{"content":"See Knowledge Base article Q243454 for more information on subclassing a control.","pos":[2139,2220]},{"pos":[2302,2352],"content":"Overriding IsSubclassedControl and PreCreateWindow"},{"pos":[2356,2505],"content":"To override <ph id=\"ph1\">`PreCreateWindow`</ph> and <ph id=\"ph2\">`IsSubclassedControl`</ph>, add the following lines of code to the <ph id=\"ph3\">`protected`</ph> section of the control class declaration:","source":"To override `PreCreateWindow` and `IsSubclassedControl`, add the following lines of code to the `protected` section of the control class declaration:"},{"pos":[2523,2538],"content":"NVC_MFC_AxSub#1"},{"content":"In the control implementation file (.CPP), add the following lines of code to implement the two overridden functions:","pos":[2626,2743]},{"pos":[2761,2776],"content":"NVC_MFC_AxSub#2"},{"content":"Notice that, in this example, the Windows button control is specified in <ph id=\"ph1\">`PreCreateWindow`</ph>.","pos":[2866,2957],"source":"Notice that, in this example, the Windows button control is specified in `PreCreateWindow`."},{"content":"However, any standard Windows controls can be subclassed.","pos":[2958,3015]},{"content":"For more information on standard Windows controls, see <bpt id=\"p1\">[</bpt>Controls<ept id=\"p1\">](../mfc/controls-mfc.md)</ept>.","pos":[3016,3106],"source":" For more information on standard Windows controls, see [Controls](../mfc/controls-mfc.md)."},{"content":"When subclassing a Windows control, you may want to specify particular window style (<bpt id=\"p1\">**</bpt>WS_<ept id=\"p1\">**</ept>) or extended window style (<bpt id=\"p2\">**</bpt>WS_EX_<ept id=\"p2\">**</ept>) flags to be used in creating the control's window.","pos":[3113,3295],"source":"When subclassing a Windows control, you may want to specify particular window style (**WS_**) or extended window style (**WS_EX_**) flags to be used in creating the control's window."},{"content":"You can set values for these parameters in the <ph id=\"ph1\">`PreCreateWindow`</ph> member function by modifying the <bpt id=\"p1\">**</bpt>cs.style<ept id=\"p1\">**</ept> and the <bpt id=\"p2\">**</bpt>cs.dwExStyle<ept id=\"p2\">**</ept> structure fields.","pos":[3296,3449],"source":" You can set values for these parameters in the `PreCreateWindow` member function by modifying the **cs.style** and the **cs.dwExStyle** structure fields."},{"content":"Modifications to these fields should be made using an <ph id=\"ph1\">`OR`</ph> operation, to preserve the default flags that are set by class <ph id=\"ph2\">`COleControl`</ph>.","pos":[3450,3586],"source":" Modifications to these fields should be made using an `OR` operation, to preserve the default flags that are set by class `COleControl`."},{"content":"For example, if the control is subclassing the BUTTON control and you want the control to appear as a check box, insert the following line of code into the implementation of <ph id=\"ph1\">`CSampleCtrl::PreCreateWindow`</ph>, before the return statement:","pos":[3587,3821],"source":" For example, if the control is subclassing the BUTTON control and you want the control to appear as a check box, insert the following line of code into the implementation of `CSampleCtrl::PreCreateWindow`, before the return statement:"},{"pos":[3839,3854],"content":"NVC_MFC_AxSub#3"},{"pos":[3944,4078],"content":"This operation adds the <bpt id=\"p1\">**</bpt>BS_CHECKBOX<ept id=\"p1\">**</ept> style flag, while leaving the default style flag (<bpt id=\"p2\">**</bpt>WS_CHILD<ept id=\"p2\">**</ept>) of class <ph id=\"ph1\">`COleControl`</ph> intact.","source":"This operation adds the **BS_CHECKBOX** style flag, while leaving the default style flag (**WS_CHILD**) of class `COleControl` intact."},{"pos":[4146,4182],"content":"Modifying the OnDraw Member Function"},{"pos":[4186,4432],"content":"If you want your subclassed control to keep the same appearance as the corresponding Windows control, the <ph id=\"ph1\">`OnDraw`</ph> member function for the control should contain only a call to the <ph id=\"ph2\">`DoSuperclassPaint`</ph> member function, as in the following example:","source":"If you want your subclassed control to keep the same appearance as the corresponding Windows control, the `OnDraw` member function for the control should contain only a call to the `DoSuperclassPaint` member function, as in the following example:"},{"pos":[4450,4465],"content":"NVC_MFC_AxSub#4"},{"content":"The <ph id=\"ph1\">`DoSuperclassPaint`</ph> member function, implemented by <ph id=\"ph2\">`COleControl`</ph>, uses the window procedure of the Windows control to draw the control in the specified device context, within the bounding rectangle.","pos":[4555,4758],"source":"The `DoSuperclassPaint` member function, implemented by `COleControl`, uses the window procedure of the Windows control to draw the control in the specified device context, within the bounding rectangle."},{"content":"This makes the control visible even when it is not active.","pos":[4759,4817]},{"pos":[4825,5247],"content":"[!NOTE]\n The `DoSuperclassPaint` member function will work only with those control types that allow a device context to be passed as the **wParam** of a `WM_PAINT` message. This includes some of the standard Windows controls, such as **SCROLLBAR** and **BUTTON**, and all the common controls. For controls that do not support this behavior, you will have to provide your own code to properly display an inactive control.","leadings":["","> "],"nodes":[{"content":" The `DoSuperclassPaint` member function will work only with those control types that allow a device context to be passed as the **wParam** of a `WM_PAINT` message. This includes some of the standard Windows controls, such as **SCROLLBAR** and **BUTTON**, and all the common controls. For controls that do not support this behavior, you will have to provide your own code to properly display an inactive control.","pos":[8,420],"nodes":[{"content":"The <ph id=\"ph1\">`DoSuperclassPaint`</ph> member function will work only with those control types that allow a device context to be passed as the <bpt id=\"p1\">**</bpt>wParam<ept id=\"p1\">**</ept> of a <ph id=\"ph2\">`WM_PAINT`</ph> message.","pos":[1,164],"source":" The `DoSuperclassPaint` member function will work only with those control types that allow a device context to be passed as the **wParam** of a `WM_PAINT` message."},{"content":"This includes some of the standard Windows controls, such as <bpt id=\"p1\">**</bpt>SCROLLBAR<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>BUTTON<ept id=\"p2\">**</ept>, and all the common controls.","pos":[165,284],"source":" This includes some of the standard Windows controls, such as **SCROLLBAR** and **BUTTON**, and all the common controls."},{"content":"For controls that do not support this behavior, you will have to provide your own code to properly display an inactive control.","pos":[285,412]}]}]},{"pos":[5313,5347],"content":"Handling Reflected Window Messages"},{"content":"Windows controls typically send certain window messages to their parent window.","pos":[5351,5430]},{"content":"Some of these messages, such as <bpt id=\"p1\">**</bpt>WM_COMMAND<ept id=\"p1\">**</ept>, provide notification of an action by the user.","pos":[5431,5525],"source":" Some of these messages, such as **WM_COMMAND**, provide notification of an action by the user."},{"content":"Others, such as <ph id=\"ph1\">`WM_CTLCOLOR`</ph>, are used to obtain information from the parent window.","pos":[5526,5611],"source":" Others, such as `WM_CTLCOLOR`, are used to obtain information from the parent window."},{"content":"An ActiveX control usually communicates with the parent window by other means.","pos":[5612,5690]},{"content":"Notifications are communicated by firing events (sending event notifications), and information about the control container is obtained by accessing the container's ambient properties.","pos":[5691,5874]},{"content":"Because these communication techniques exist, ActiveX control containers are not expected to process any window messages sent by the control.","pos":[5875,6016]},{"content":"To prevent the container from receiving the window messages sent by a subclassed Windows control, <ph id=\"ph1\">`COleControl`</ph> creates an extra window to serve as the control's parent.","pos":[6023,6192],"source":"To prevent the container from receiving the window messages sent by a subclassed Windows control, `COleControl` creates an extra window to serve as the control's parent."},{"content":"This extra window, called a \"reflector,\" is created only for an ActiveX control that subclasses a Windows control and has the same size and position as the control window.","pos":[6193,6364]},{"content":"The reflector window intercepts certain window messages and sends them back to the control.","pos":[6365,6456]},{"content":"The control, in its window procedure, can then process these reflected messages by taking actions appropriate for an ActiveX control (for example, firing an event).","pos":[6457,6621]},{"content":"See <bpt id=\"p1\">[</bpt>Reflected Window Message IDs<ept id=\"p1\">](../mfc/reflected-window-message-ids.md)</ept> for a list of intercepted windows messages and their corresponding reflected messages.","pos":[6622,6783],"source":" See [Reflected Window Message IDs](../mfc/reflected-window-message-ids.md) for a list of intercepted windows messages and their corresponding reflected messages."},{"content":"An ActiveX control container may be designed to perform message reflection itself, eliminating the need for <ph id=\"ph1\">`COleControl`</ph> to create the reflector window and reducing the run-time overhead for a subclassed Windows control.","pos":[6790,7011],"source":"An ActiveX control container may be designed to perform message reflection itself, eliminating the need for `COleControl` to create the reflector window and reducing the run-time overhead for a subclassed Windows control."},{"content":"detects whether the container supports this capability by checking for a MessageReflect ambient property with a value of <bpt id=\"p1\">**</bpt>TRUE<ept id=\"p1\">**</ept>.","pos":[7026,7156],"source":" detects whether the container supports this capability by checking for a MessageReflect ambient property with a value of **TRUE**."},{"content":"To handle a reflected window message, add an entry to the control message map and implement a handler function.","pos":[7163,7274]},{"content":"Because reflected messages are not part of the standard set of messages defined by Windows, Class View does not support adding such message handlers.","pos":[7275,7424]},{"content":"However, it is not difficult to add a handler manually.","pos":[7425,7480]},{"content":"To add a message handler for a reflected window message manually do the following:","pos":[7487,7569]},{"content":"In the control class .H file, declare a handler function.","pos":[7579,7636]},{"content":"The function should have a return type of <bpt id=\"p1\">**</bpt>LRESULT<ept id=\"p1\">**</ept> and two parameters, with types <bpt id=\"p2\">**</bpt>WPARAM<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>LPARAM<ept id=\"p3\">**</ept>, respectively.","pos":[7637,7762],"source":" The function should have a return type of **LRESULT** and two parameters, with types **WPARAM** and **LPARAM**, respectively."},{"content":"For example:","pos":[7763,7775]},{"pos":[7786,8007],"content":"[!code-cpp[NVC_MFC_AxSub#5](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_5.h)]  \n[!code-cpp[NVC_MFC_AxSub#6](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_6.h)]","leadings":["","    "],"nodes":[{"content":"NVC_MFC_AxSub#5","pos":[11,26]},{"content":"NVC_MFC_AxSub#6","pos":[121,136]}]},{"content":"In the control class .CPP file, add an <ph id=\"ph1\">`ON_MESSAGE`</ph> entry to the message map.","pos":[8017,8094],"source":"In the control class .CPP file, add an `ON_MESSAGE` entry to the message map."},{"content":"The parameters of this entry should be the message identifier and the name of the handler function.","pos":[8095,8194]},{"content":"For example:","pos":[8195,8207]},{"pos":[8229,8244],"content":"NVC_MFC_AxSub#7"},{"content":"Also in the .CPP file, implement the <bpt id=\"p1\">**</bpt>OnOcmCommand<ept id=\"p1\">**</ept> member function to process the reflected message.","pos":[8337,8440],"source":"Also in the .CPP file, implement the **OnOcmCommand** member function to process the reflected message."},{"content":"The <bpt id=\"p1\">**</bpt>wParam<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>lParam<ept id=\"p2\">**</ept> parameters are the same as those of the original window message.","pos":[8441,8535],"source":" The **wParam** and **lParam** parameters are the same as those of the original window message."},{"content":"For an example of how reflected messages are processed, refer to the MFC ActiveX controls sample <bpt id=\"p1\">[</bpt>BUTTON<ept id=\"p1\">](../visual-cpp-samples.md)</ept>.","pos":[8542,8674],"source":"For an example of how reflected messages are processed, refer to the MFC ActiveX controls sample [BUTTON](../visual-cpp-samples.md)."},{"content":"It demonstrates an <bpt id=\"p1\">**</bpt>OnOcmCommand<ept id=\"p1\">**</ept> handler that detects the <bpt id=\"p2\">**</bpt>BN_CLICKED<ept id=\"p2\">**</ept> notification code and responds by firing (sending) a Click event.","pos":[8675,8816],"source":" It demonstrates an **OnOcmCommand** handler that detects the **BN_CLICKED** notification code and responds by firing (sending) a Click event."},{"content":"See Also","pos":[8825,8833]},{"content":"MFC ActiveX Controls","pos":[8838,8858]}],"content":"---\ntitle: \"MFC ActiveX Controls: Subclassing a Windows Control | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"precreatewindow\"\n  - \"IsSubclassed\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"OnDraw method, MFC ActiveX controls\"\n  - \"subclassing\"\n  - \"DoSuperclassPaint method\"\n  - \"subclassing Windows controls\"\n  - \"subclassing, Windows controls\"\n  - \"reflected messages, in ActiveX controls\"\n  - \"PreCreateWindow method, overriding\"\n  - \"MFC ActiveX controls, subclassed controls\"\n  - \"MFC ActiveX controls, creating\"\n  - \"IsSubclassed method\"\nms.assetid: 3236d4de-401f-49b7-918d-c84559ecc426\ncaps.latest.revision: 11\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# MFC ActiveX Controls: Subclassing a Windows Control\nThis article describes the process for subclassing a common Windows control to create an ActiveX control. Subclassing an existing Windows control is a quick way to develop an ActiveX control. The new control will have the abilities of the subclassed Windows control, such as painting and responding to mouse clicks. The MFC ActiveX controls sample [BUTTON](../visual-cpp-samples.md) is an example of subclassing a Windows control.  \n  \n To subclass a Windows control, complete the following tasks:  \n  \n-   [Override the IsSubclassedControl and PreCreateWindow member functions of COleControl](#_core_overriding_issubclassedcontrol_and_precreatewindow)  \n  \n-   [Modify the OnDraw member function](#_core_modifying_the_ondraw_member_function)  \n  \n-   [Handle any ActiveX control messages (OCM) reflected to the control](#_core_handling_reflected_window_messages)  \n  \n    > [!NOTE]\n    >  Much of this work is done for you by the ActiveX Control Wizard if you select control to be subclassed using the **Select Parent Window Class** drop-down list on the **Control Settings** page.  \n  \n See Knowledge Base article Q243454 for more information on subclassing a control.  \n  \n##  <a name=\"_core_overriding_issubclassedcontrol_and_precreatewindow\"></a> Overriding IsSubclassedControl and PreCreateWindow  \n To override `PreCreateWindow` and `IsSubclassedControl`, add the following lines of code to the `protected` section of the control class declaration:  \n  \n [!code-cpp[NVC_MFC_AxSub#1](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_1.h)]  \n  \n In the control implementation file (.CPP), add the following lines of code to implement the two overridden functions:  \n  \n [!code-cpp[NVC_MFC_AxSub#2](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_2.cpp)]  \n  \n Notice that, in this example, the Windows button control is specified in `PreCreateWindow`. However, any standard Windows controls can be subclassed. For more information on standard Windows controls, see [Controls](../mfc/controls-mfc.md).  \n  \n When subclassing a Windows control, you may want to specify particular window style (**WS_**) or extended window style (**WS_EX_**) flags to be used in creating the control's window. You can set values for these parameters in the `PreCreateWindow` member function by modifying the **cs.style** and the **cs.dwExStyle** structure fields. Modifications to these fields should be made using an `OR` operation, to preserve the default flags that are set by class `COleControl`. For example, if the control is subclassing the BUTTON control and you want the control to appear as a check box, insert the following line of code into the implementation of `CSampleCtrl::PreCreateWindow`, before the return statement:  \n  \n [!code-cpp[NVC_MFC_AxSub#3](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_3.cpp)]  \n  \n This operation adds the **BS_CHECKBOX** style flag, while leaving the default style flag (**WS_CHILD**) of class `COleControl` intact.  \n  \n##  <a name=\"_core_modifying_the_ondraw_member_function\"></a> Modifying the OnDraw Member Function  \n If you want your subclassed control to keep the same appearance as the corresponding Windows control, the `OnDraw` member function for the control should contain only a call to the `DoSuperclassPaint` member function, as in the following example:  \n  \n [!code-cpp[NVC_MFC_AxSub#4](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_4.cpp)]  \n  \n The `DoSuperclassPaint` member function, implemented by `COleControl`, uses the window procedure of the Windows control to draw the control in the specified device context, within the bounding rectangle. This makes the control visible even when it is not active.  \n  \n> [!NOTE]\n>  The `DoSuperclassPaint` member function will work only with those control types that allow a device context to be passed as the **wParam** of a `WM_PAINT` message. This includes some of the standard Windows controls, such as **SCROLLBAR** and **BUTTON**, and all the common controls. For controls that do not support this behavior, you will have to provide your own code to properly display an inactive control.  \n  \n##  <a name=\"_core_handling_reflected_window_messages\"></a> Handling Reflected Window Messages  \n Windows controls typically send certain window messages to their parent window. Some of these messages, such as **WM_COMMAND**, provide notification of an action by the user. Others, such as `WM_CTLCOLOR`, are used to obtain information from the parent window. An ActiveX control usually communicates with the parent window by other means. Notifications are communicated by firing events (sending event notifications), and information about the control container is obtained by accessing the container's ambient properties. Because these communication techniques exist, ActiveX control containers are not expected to process any window messages sent by the control.  \n  \n To prevent the container from receiving the window messages sent by a subclassed Windows control, `COleControl` creates an extra window to serve as the control's parent. This extra window, called a \"reflector,\" is created only for an ActiveX control that subclasses a Windows control and has the same size and position as the control window. The reflector window intercepts certain window messages and sends them back to the control. The control, in its window procedure, can then process these reflected messages by taking actions appropriate for an ActiveX control (for example, firing an event). See [Reflected Window Message IDs](../mfc/reflected-window-message-ids.md) for a list of intercepted windows messages and their corresponding reflected messages.  \n  \n An ActiveX control container may be designed to perform message reflection itself, eliminating the need for `COleControl` to create the reflector window and reducing the run-time overhead for a subclassed Windows control. `COleControl` detects whether the container supports this capability by checking for a MessageReflect ambient property with a value of **TRUE**.  \n  \n To handle a reflected window message, add an entry to the control message map and implement a handler function. Because reflected messages are not part of the standard set of messages defined by Windows, Class View does not support adding such message handlers. However, it is not difficult to add a handler manually.  \n  \n To add a message handler for a reflected window message manually do the following:  \n  \n-   In the control class .H file, declare a handler function. The function should have a return type of **LRESULT** and two parameters, with types **WPARAM** and **LPARAM**, respectively. For example:  \n  \n     [!code-cpp[NVC_MFC_AxSub#5](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_5.h)]  \n    [!code-cpp[NVC_MFC_AxSub#6](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_6.h)]  \n  \n-   In the control class .CPP file, add an `ON_MESSAGE` entry to the message map. The parameters of this entry should be the message identifier and the name of the handler function. For example:  \n  \n     [!code-cpp[NVC_MFC_AxSub#7](../mfc/codesnippet/cpp/mfc-activex-controls-subclassing-a-windows-control_7.cpp)]  \n  \n-   Also in the .CPP file, implement the **OnOcmCommand** member function to process the reflected message. The **wParam** and **lParam** parameters are the same as those of the original window message.  \n  \n For an example of how reflected messages are processed, refer to the MFC ActiveX controls sample [BUTTON](../visual-cpp-samples.md). It demonstrates an **OnOcmCommand** handler that detects the **BN_CLICKED** notification code and responds by firing (sending) a Click event.  \n  \n## See Also  \n [MFC ActiveX Controls](../mfc/mfc-activex-controls.md)\n\n"}