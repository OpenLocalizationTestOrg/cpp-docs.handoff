{"nodes":[{"pos":[12,81],"content":"How to: Implement Various Producer-Consumer Patterns | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Implement Various Producer-Consumer Patterns | Microsoft Docs","pos":[0,69]}]},{"content":"How to: Implement Various Producer-Consumer Patterns","pos":[747,799]},{"content":"This topic describes how to implement the producer-consumer pattern in your application.","pos":[800,888]},{"content":"In this pattern, the <bpt id=\"p1\">*</bpt>producer<ept id=\"p1\">*</ept> sends messages to a message block, and the <bpt id=\"p2\">*</bpt>consumer<ept id=\"p2\">*</ept> reads messages from that block.","pos":[889,1006],"source":" In this pattern, the *producer* sends messages to a message block, and the *consumer* reads messages from that block."},{"content":"The topic demonstrates two scenarios.","pos":[1013,1050]},{"content":"In the first scenario, the consumer must receive each message that the producer sends.","pos":[1051,1137]},{"content":"In the second scenario, the consumer periodically polls for data, and therefore does not have to receive each message.","pos":[1138,1256]},{"content":"Both examples in this topic use agents, message blocks, and message-passing functions to transmit messages from the producer to the consumer.","pos":[1263,1404]},{"content":"The producer agent uses the <bpt id=\"p1\">[</bpt>concurrency::send<ept id=\"p1\">](reference/concurrency-namespace-functions.md#send)</ept> function to write messages to a <bpt id=\"p2\">[</bpt>concurrency::ITarget<ept id=\"p2\">](../../parallel/concrt/reference/itarget-class.md)</ept> object.","pos":[1405,1616],"source":" The producer agent uses the [concurrency::send](reference/concurrency-namespace-functions.md#send) function to write messages to a [concurrency::ITarget](../../parallel/concrt/reference/itarget-class.md) object."},{"content":"The consumer agent uses the <bpt id=\"p1\">[</bpt>concurrency::receive<ept id=\"p1\">](reference/concurrency-namespace-functions.md#receive)</ept> function to read messages from a <bpt id=\"p2\">[</bpt>concurrency::ISource<ept id=\"p2\">](../../parallel/concrt/reference/isource-class.md)</ept> object.","pos":[1617,1835],"source":" The consumer agent uses the [concurrency::receive](reference/concurrency-namespace-functions.md#receive) function to read messages from a [concurrency::ISource](../../parallel/concrt/reference/isource-class.md) object."},{"content":"Both agents hold a sentinel value to coordinate the end of processing.","pos":[1836,1906]},{"content":"For more information about asynchronous agents, see <bpt id=\"p1\">[</bpt>Asynchronous Agents<ept id=\"p1\">](../../parallel/concrt/asynchronous-agents.md)</ept>.","pos":[1913,2033],"source":"For more information about asynchronous agents, see [Asynchronous Agents](../../parallel/concrt/asynchronous-agents.md)."},{"content":"For more information about message blocks and message-passing functions, see <bpt id=\"p1\">[</bpt>Asynchronous Message Blocks<ept id=\"p1\">](../../parallel/concrt/asynchronous-message-blocks.md)</ept> and <bpt id=\"p2\">[</bpt>Message Passing Functions<ept id=\"p2\">](../../parallel/concrt/message-passing-functions.md)</ept>.","pos":[2034,2279],"source":" For more information about message blocks and message-passing functions, see [Asynchronous Message Blocks](../../parallel/concrt/asynchronous-message-blocks.md) and [Message Passing Functions](../../parallel/concrt/message-passing-functions.md)."},{"content":"Example","pos":[2288,2295]},{"content":"In this example, the producer agent sends a series of numbers to the consumer agent.","pos":[2299,2383]},{"content":"The consumer receives each of these numbers and computes their average.","pos":[2384,2455]},{"content":"The application writes the average to the console.","pos":[2456,2506]},{"content":"This example uses a <bpt id=\"p1\">[</bpt>concurrency::unbounded_buffer<ept id=\"p1\">](reference/unbounded-buffer-class.md)</ept> object to enable the producer to queue messages.","pos":[2513,2650],"source":"This example uses a [concurrency::unbounded_buffer](reference/unbounded-buffer-class.md) object to enable the producer to queue messages."},{"content":"The <ph id=\"ph1\">`unbounded_buffer`</ph> class implements <ph id=\"ph2\">`ITarget`</ph> and <ph id=\"ph3\">`ISource`</ph> so that the producer and the consumer can send and receive messages to and from a shared buffer.","pos":[2651,2811],"source":" The `unbounded_buffer` class implements `ITarget` and `ISource` so that the producer and the consumer can send and receive messages to and from a shared buffer."},{"content":"The <ph id=\"ph1\">`send`</ph> and <ph id=\"ph2\">`receive`</ph> functions coordinate the task of propagating the data from the producer to the consumer.","pos":[2812,2925],"source":" The `send` and `receive` functions coordinate the task of propagating the data from the producer to the consumer."},{"pos":[2943,2977],"content":"concrt-producer-consumer-average#1"},{"content":"This example produces the following output.","pos":[3083,3126]},{"content":"Example","pos":[3177,3184]},{"content":"In this example, the producer agent sends a series of stock quotes to the consumer agent.","pos":[3188,3277]},{"content":"The consumer agent periodically reads the current quote and prints it to the console.","pos":[3278,3363]},{"content":"This example resembles the previous one, except that it uses a <bpt id=\"p1\">[</bpt>concurrency::overwrite_buffer<ept id=\"p1\">](../../parallel/concrt/reference/overwrite-buffer-class.md)</ept> object to enable the producer to share one message with the consumer.","pos":[3370,3593],"source":"This example resembles the previous one, except that it uses a [concurrency::overwrite_buffer](../../parallel/concrt/reference/overwrite-buffer-class.md) object to enable the producer to share one message with the consumer."},{"content":"As in the previous example, <ph id=\"ph1\">`overwrite_buffer`</ph> class implements <ph id=\"ph2\">`ITarget`</ph> and <ph id=\"ph3\">`ISource`</ph> so that the producer and the consumer can act on a shared message buffer.","pos":[3594,3755],"source":" As in the previous example, `overwrite_buffer` class implements `ITarget` and `ISource` so that the producer and the consumer can act on a shared message buffer."},{"pos":[3773,3806],"content":"concrt-producer-consumer-quotes#1"},{"content":"This example produces the following sample output.","pos":[3912,3962]},{"content":"Unlike with an <ph id=\"ph1\">`unbounded_buffer`</ph> object, the <ph id=\"ph2\">`receive`</ph> function does not remove the message from the <ph id=\"ph3\">`overwrite_buffer`</ph> object.","pos":[4172,4300],"source":"Unlike with an `unbounded_buffer` object, the `receive` function does not remove the message from the `overwrite_buffer` object."},{"content":"If the consumer reads from the message buffer more than one time before the producer overwrites that message, the receiver obtains the same message every time.","pos":[4301,4460]},{"content":"Compiling the Code","pos":[4469,4487]},{"pos":[4491,4690],"content":"Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named <ph id=\"ph1\">`producer-consumer.cpp`</ph> and then run the following command in a Visual Studio Command Prompt window.","source":"Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `producer-consumer.cpp` and then run the following command in a Visual Studio Command Prompt window."},{"content":"cl.exe /EHsc producer-consumer.cpp","pos":[4699,4733]},{"content":"See Also","pos":[4744,4752]},{"content":"Asynchronous Agents Library","pos":[4757,4784]},{"content":"Asynchronous Agents","pos":[4845,4864]},{"content":"Asynchronous Message Blocks","pos":[4917,4944]},{"content":"Message Passing Functions","pos":[5005,5030]}],"content":"---\ntitle: \"How to: Implement Various Producer-Consumer Patterns | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"producer-consumer patterns, implementing [Concurrency Runtime]\"\n  - \"implementing producer-consumer patterns [Concurrency Runtime]\"\nms.assetid: 75f2c7cc-5399-49ea-98eb-847fe6747169\ncaps.latest.revision: 17\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"ru-ru\"\n  - \"zh-cn\"\n  - \"zh-tw\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# How to: Implement Various Producer-Consumer Patterns\nThis topic describes how to implement the producer-consumer pattern in your application. In this pattern, the *producer* sends messages to a message block, and the *consumer* reads messages from that block.  \n  \n The topic demonstrates two scenarios. In the first scenario, the consumer must receive each message that the producer sends. In the second scenario, the consumer periodically polls for data, and therefore does not have to receive each message.  \n  \n Both examples in this topic use agents, message blocks, and message-passing functions to transmit messages from the producer to the consumer. The producer agent uses the [concurrency::send](reference/concurrency-namespace-functions.md#send) function to write messages to a [concurrency::ITarget](../../parallel/concrt/reference/itarget-class.md) object. The consumer agent uses the [concurrency::receive](reference/concurrency-namespace-functions.md#receive) function to read messages from a [concurrency::ISource](../../parallel/concrt/reference/isource-class.md) object. Both agents hold a sentinel value to coordinate the end of processing.  \n  \n For more information about asynchronous agents, see [Asynchronous Agents](../../parallel/concrt/asynchronous-agents.md). For more information about message blocks and message-passing functions, see [Asynchronous Message Blocks](../../parallel/concrt/asynchronous-message-blocks.md) and [Message Passing Functions](../../parallel/concrt/message-passing-functions.md).  \n  \n## Example  \n In this example, the producer agent sends a series of numbers to the consumer agent. The consumer receives each of these numbers and computes their average. The application writes the average to the console.  \n  \n This example uses a [concurrency::unbounded_buffer](reference/unbounded-buffer-class.md) object to enable the producer to queue messages. The `unbounded_buffer` class implements `ITarget` and `ISource` so that the producer and the consumer can send and receive messages to and from a shared buffer. The `send` and `receive` functions coordinate the task of propagating the data from the producer to the consumer.  \n  \n [!code-cpp[concrt-producer-consumer-average#1](../../parallel/concrt/codesnippet/cpp/how-to-implement-various-producer-consumer-patterns_1.cpp)]  \n  \n This example produces the following output.  \n  \n```Output  \nThe average is 50.  \n```  \n  \n## Example  \n In this example, the producer agent sends a series of stock quotes to the consumer agent. The consumer agent periodically reads the current quote and prints it to the console.  \n  \n This example resembles the previous one, except that it uses a [concurrency::overwrite_buffer](../../parallel/concrt/reference/overwrite-buffer-class.md) object to enable the producer to share one message with the consumer. As in the previous example, `overwrite_buffer` class implements `ITarget` and `ISource` so that the producer and the consumer can act on a shared message buffer.  \n  \n [!code-cpp[concrt-producer-consumer-quotes#1](../../parallel/concrt/codesnippet/cpp/how-to-implement-various-producer-consumer-patterns_2.cpp)]  \n  \n This example produces the following sample output.  \n  \n```Output  \nCurrent quote is 24.44.  \nCurrent quote is 24.44.  \nCurrent quote is 24.65.  \nCurrent quote is 24.99.  \nCurrent quote is 23.76.  \nCurrent quote is 22.30.  \nCurrent quote is 25.89.  \n```  \n  \n Unlike with an `unbounded_buffer` object, the `receive` function does not remove the message from the `overwrite_buffer` object. If the consumer reads from the message buffer more than one time before the producer overwrites that message, the receiver obtains the same message every time.  \n  \n## Compiling the Code  \n Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `producer-consumer.cpp` and then run the following command in a Visual Studio Command Prompt window.  \n  \n **cl.exe /EHsc producer-consumer.cpp**  \n  \n## See Also  \n [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md)   \n [Asynchronous Agents](../../parallel/concrt/asynchronous-agents.md)   \n [Asynchronous Message Blocks](../../parallel/concrt/asynchronous-message-blocks.md)   \n [Message Passing Functions](../../parallel/concrt/message-passing-functions.md)\n"}