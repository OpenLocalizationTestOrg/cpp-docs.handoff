{"nodes":[{"pos":[12,64],"content":"ATL and the Free Threaded Marshaler | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"ATL and the Free Threaded Marshaler | Microsoft Docs","pos":[0,52]}]},{"content":"ATL and the Free Threaded Marshaler","pos":[736,771]},{"content":"The ATL Simple Object Wizard's Attributes page provides an option that allows your class to aggregate the free threaded marshaler (FTM).","pos":[772,908]},{"content":"The wizard generates code to create an instance of the free threaded marshaler in <ph id=\"ph1\">`FinalConstruct`</ph> and release that instance in <ph id=\"ph2\">`FinalRelease`</ph>.","pos":[915,1058],"source":"The wizard generates code to create an instance of the free threaded marshaler in `FinalConstruct` and release that instance in `FinalRelease`."},{"content":"A <ph id=\"ph1\">`COM_INTERFACE_ENTRY_AGGREGATE`</ph> macro is automatically added to the COM map to ensure that <ph id=\"ph2\">`QueryInterface`</ph> requests for <bpt id=\"p1\">[</bpt>IMarshal<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd542707)</ept> are handled by the free threaded marshaler.","pos":[1059,1296],"source":" A `COM_INTERFACE_ENTRY_AGGREGATE` macro is automatically added to the COM map to ensure that `QueryInterface` requests for [IMarshal](http://msdn.microsoft.com/library/windows/desktop/dd542707) are handled by the free threaded marshaler."},{"content":"The free threaded marshaler allows direct access to interfaces on your object from any thread in the same process, speeding up cross-apartment calls.","pos":[1303,1452]},{"content":"This option is intended for classes that use the Both threading model.","pos":[1453,1523]},{"content":"When using this option, classes must take responsibility for the thread-safety of their data.","pos":[1530,1623]},{"content":"In addition, objects that aggregate the free threaded marshaler and need to use interface pointers obtained from other objects must take extra steps to ensure that the interfaces are correctly marshaled.","pos":[1624,1827]},{"content":"Typically this involves storing the interface pointers in the global interface table (GIT) and getting the pointer from the GIT each time it is used.","pos":[1828,1977]},{"content":"ATL provides the class <bpt id=\"p1\">[</bpt>CComGITPtr<ept id=\"p1\">](../atl/reference/ccomgitptr-class.md)</ept> to help you use interface pointers stored in the GIT.","pos":[1978,2105],"source":" ATL provides the class [CComGITPtr](../atl/reference/ccomgitptr-class.md) to help you use interface pointers stored in the GIT."},{"content":"See Also","pos":[2114,2122]},{"content":"Concepts","pos":[2127,2135]},{"content":"CoCreateFreeThreadedMarshaler","pos":[2190,2219]},{"content":"IMarshal","pos":[2286,2294]},{"content":"When to Use the Global Interface Table","pos":[2361,2399]},{"content":"In-Process Server Threading Issues","pos":[2466,2500]}],"content":"---\ntitle: \"ATL and the Free Threaded Marshaler | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"ATL, free threaded marshaler\"\n  - \"free threaded marshaler\"\n  - \"threading [C++], marshaler in ATL\"\n  - \"threading [ATL], free threaded marshaler\"\n  - \"FTM in ATL\"\nms.assetid: 2db88a13-2217-4ebc-aa7e-432d5da902eb\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# ATL and the Free Threaded Marshaler\nThe ATL Simple Object Wizard's Attributes page provides an option that allows your class to aggregate the free threaded marshaler (FTM).  \n  \n The wizard generates code to create an instance of the free threaded marshaler in `FinalConstruct` and release that instance in `FinalRelease`. A `COM_INTERFACE_ENTRY_AGGREGATE` macro is automatically added to the COM map to ensure that `QueryInterface` requests for [IMarshal](http://msdn.microsoft.com/library/windows/desktop/dd542707) are handled by the free threaded marshaler.  \n  \n The free threaded marshaler allows direct access to interfaces on your object from any thread in the same process, speeding up cross-apartment calls. This option is intended for classes that use the Both threading model.  \n  \n When using this option, classes must take responsibility for the thread-safety of their data. In addition, objects that aggregate the free threaded marshaler and need to use interface pointers obtained from other objects must take extra steps to ensure that the interfaces are correctly marshaled. Typically this involves storing the interface pointers in the global interface table (GIT) and getting the pointer from the GIT each time it is used. ATL provides the class [CComGITPtr](../atl/reference/ccomgitptr-class.md) to help you use interface pointers stored in the GIT.  \n  \n## See Also  \n [Concepts](../atl/active-template-library-atl-concepts.md)   \n [CoCreateFreeThreadedMarshaler](http://msdn.microsoft.com/library/windows/desktop/ms694500)   \n [IMarshal](http://msdn.microsoft.com/library/windows/desktop/dd542707)   \n [When to Use the Global Interface Table](http://msdn.microsoft.com/library/windows/desktop/ms693729)   \n [In-Process Server Threading Issues](http://msdn.microsoft.com/library/windows/desktop/ms687205)\n\n"}