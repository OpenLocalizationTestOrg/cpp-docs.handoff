{"nodes":[{"pos":[12,49],"content":"IScheduler Structure | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"IScheduler Structure | Microsoft Docs","pos":[0,37]}]},{"pos":[632,652],"content":"IScheduler Structure","linkify":"IScheduler Structure","nodes":[{"content":"IScheduler Structure","pos":[0,20]}]},{"content":"An interface to an abstraction of a work scheduler.","pos":[653,704]},{"content":"The Concurrency Runtime's Resource Manager uses this interface to communicate with work schedulers.","pos":[705,804]},{"pos":[813,819],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[860,867],"content":"Members","linkify":"Members","nodes":[{"content":"Members","pos":[0,7]}]},{"pos":[877,891],"content":"Public Methods","linkify":"Public Methods","nodes":[{"content":"Public Methods","pos":[0,14]}]},{"content":"Name","pos":[898,902]},{"content":"Description","pos":[903,914]},{"pos":[952,1016],"content":"<bpt id=\"p1\">[</bpt>IScheduler::AddVirtualProcessors Method<ept id=\"p1\">](#addvirtualprocessors)</ept>","source":"[IScheduler::AddVirtualProcessors Method](#addvirtualprocessors)"},{"content":"Provides a scheduler with a set of virtual processor roots for its use.","pos":[1017,1088]},{"content":"Each <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interface represents the right to execute a single thread that can perform work on behalf of the scheduler.","pos":[1089,1225],"source":" Each `IVirtualProcessorRoot` interface represents the right to execute a single thread that can perform work on behalf of the scheduler."},{"pos":[1230,1264],"content":"<bpt id=\"p1\">[</bpt>IScheduler::GetId Method<ept id=\"p1\">](#getid)</ept>","source":"[IScheduler::GetId Method](#getid)"},{"content":"Returns a unique identifier for the scheduler.","pos":[1265,1311]},{"pos":[1316,1358],"content":"<bpt id=\"p1\">[</bpt>IScheduler::GetPolicy Method<ept id=\"p1\">](#getpolicy)</ept>","source":"[IScheduler::GetPolicy Method](#getpolicy)"},{"content":"Returns a copy of the scheduler's policy.","pos":[1359,1400]},{"content":"For more information on scheduler policies, see <bpt id=\"p1\">[</bpt>SchedulerPolicy<ept id=\"p1\">](schedulerpolicy-class.md)</ept>.","pos":[1401,1493],"source":" For more information on scheduler policies, see [SchedulerPolicy](schedulerpolicy-class.md)."},{"pos":[1498,1580],"content":"<bpt id=\"p1\">[</bpt>IScheduler::NotifyResourcesExternallyBusy Method<ept id=\"p1\">](#notifyresourcesexternallybusy)</ept>","source":"[IScheduler::NotifyResourcesExternallyBusy Method](#notifyresourcesexternallybusy)"},{"pos":[1581,1759],"content":"Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array <ph id=\"ph1\">`ppVirtualProcessorRoots`</ph> are now being used by other schedulers.","source":"Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array `ppVirtualProcessorRoots` are now being used by other schedulers."},{"pos":[1764,1846],"content":"<bpt id=\"p1\">[</bpt>IScheduler::NotifyResourcesExternallyIdle Method<ept id=\"p1\">](#notifyresourcesexternallyidle)</ept>","source":"[IScheduler::NotifyResourcesExternallyIdle Method](#notifyresourcesexternallyidle)"},{"pos":[1847,2025],"content":"Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array <ph id=\"ph1\">`ppVirtualProcessorRoots`</ph> are not being used by other schedulers.","source":"Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array `ppVirtualProcessorRoots` are not being used by other schedulers."},{"pos":[2030,2100],"content":"<bpt id=\"p1\">[</bpt>IScheduler::RemoveVirtualProcessors Method<ept id=\"p1\">](#removevirtualprocessors)</ept>","source":"[IScheduler::RemoveVirtualProcessors Method](#removevirtualprocessors)"},{"content":"Initiates the removal of virtual processor roots that were previously allocated to this scheduler.","pos":[2101,2199]},{"pos":[2204,2248],"content":"<bpt id=\"p1\">[</bpt>IScheduler::Statistics Method<ept id=\"p1\">](#statistics)</ept>","source":"[IScheduler::Statistics Method](#statistics)"},{"content":"Provides information related to task arrival and completion rates, and change in queue length for a scheduler.","pos":[2249,2359]},{"pos":[2369,2376],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"If you are implementing a custom scheduler that communicates with the Resource Manager, you should provide an implementation of the <ph id=\"ph1\">`IScheduler`</ph> interface.","pos":[2380,2535],"source":"If you are implementing a custom scheduler that communicates with the Resource Manager, you should provide an implementation of the `IScheduler` interface."},{"content":"This interface is one end of a two-way channel of communication between a scheduler and the Resource Manager.","pos":[2536,2645]},{"content":"The other end is represented by the <ph id=\"ph1\">`IResourceManager`</ph> and <ph id=\"ph2\">`ISchedulerProxy`</ph> interfaces which are implemented by the Resource Manager.","pos":[2646,2780],"source":" The other end is represented by the `IResourceManager` and `ISchedulerProxy` interfaces which are implemented by the Resource Manager."},{"pos":[2789,2810],"content":"Inheritance Hierarchy","linkify":"Inheritance Hierarchy","nodes":[{"content":"Inheritance Hierarchy","pos":[0,21]}]},{"pos":[2835,2847],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[2851,2873],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> concrtrm.h","source":"**Header:** concrtrm.h"},{"pos":[2880,2906],"content":"<bpt id=\"p1\">**</bpt>Namespace:<ept id=\"p1\">**</ept> concurrency","source":"**Namespace:** concurrency"},{"pos":[2916,2992],"content":"<bpt id=\"p1\">&lt;a name=\"addvirtualprocessors\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  IScheduler::AddVirtualProcessors Method","linkify":"<a name=\"addvirtualprocessors\"></a>  IScheduler::AddVirtualProcessors Method","source":"<a name=\"addvirtualprocessors\"></a>  IScheduler::AddVirtualProcessors Method"},{"content":"Provides a scheduler with a set of virtual processor roots for its use.","pos":[2996,3067]},{"content":"Each <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interface represents the right to execute a single thread that can perform work on behalf of the scheduler.","pos":[3068,3204],"source":" Each `IVirtualProcessorRoot` interface represents the right to execute a single thread that can perform work on behalf of the scheduler."},{"pos":[3362,3372],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"An array of <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interfaces representing the virtual processor roots being added to the scheduler.","pos":[3405,3522],"source":" An array of `IVirtualProcessorRoot` interfaces representing the virtual processor roots being added to the scheduler."},{"content":"The number of <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interfaces in the array.","pos":[3540,3602],"source":" The number of `IVirtualProcessorRoot` interfaces in the array."},{"pos":[3612,3619],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"The Resource Manager invokes the <ph id=\"ph1\">`AddVirtualProcessor`</ph> method to grant an initial set of virtual processor roots to a scheduler.","pos":[3623,3751],"source":"The Resource Manager invokes the `AddVirtualProcessor` method to grant an initial set of virtual processor roots to a scheduler."},{"content":"It could also invoke the method to add virtual processor roots to the scheduler when it rebalances resources among schedulers.","pos":[3752,3878]},{"pos":[3888,3934],"content":"<bpt id=\"p1\">&lt;a name=\"getid\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  IScheduler::GetId Method","linkify":"<a name=\"getid\"></a>  IScheduler::GetId Method","source":"<a name=\"getid\"></a>  IScheduler::GetId Method"},{"content":"Returns a unique identifier for the scheduler.","pos":[3938,3984]},{"pos":[4047,4059],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"content":"A unique integer identifier.","pos":[4063,4091]},{"pos":[4101,4108],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"You should use the <bpt id=\"p1\">[</bpt>GetSchedulerId<ept id=\"p1\">](concurrency-namespace-functions.md)</ept> function to obtain a unique identifier for the object that implements the <ph id=\"ph1\">`IScheduler`</ph> interface, before you use the interface as a parameter to methods supplied by the Resource Manager.","pos":[4112,4370],"source":"You should use the [GetSchedulerId](concurrency-namespace-functions.md) function to obtain a unique identifier for the object that implements the `IScheduler` interface, before you use the interface as a parameter to methods supplied by the Resource Manager."},{"content":"You are expected to return the same identifier when the <ph id=\"ph1\">`GetId`</ph> function is invoked.","pos":[4371,4455],"source":" You are expected to return the same identifier when the `GetId` function is invoked."},{"content":"An identifier obtained from a different source could result in undefined behavior.","pos":[4462,4544]},{"pos":[4554,4608],"content":"<bpt id=\"p1\">&lt;a name=\"getpolicy\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  IScheduler::GetPolicy Method","linkify":"<a name=\"getpolicy\"></a>  IScheduler::GetPolicy Method","source":"<a name=\"getpolicy\"></a>  IScheduler::GetPolicy Method"},{"content":"Returns a copy of the scheduler's policy.","pos":[4612,4653]},{"content":"For more information on scheduler policies, see <bpt id=\"p1\">[</bpt>SchedulerPolicy<ept id=\"p1\">](schedulerpolicy-class.md)</ept>.","pos":[4654,4746],"source":" For more information on scheduler policies, see [SchedulerPolicy](schedulerpolicy-class.md)."},{"pos":[4816,4828],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"content":"A copy of the scheduler's policy.","pos":[4832,4865]},{"pos":[4875,4969],"content":"<bpt id=\"p1\">&lt;a name=\"notifyresourcesexternallybusy\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  IScheduler::NotifyResourcesExternallyBusy Method","linkify":"<a name=\"notifyresourcesexternallybusy\"></a>  IScheduler::NotifyResourcesExternallyBusy Method","source":"<a name=\"notifyresourcesexternallybusy\"></a>  IScheduler::NotifyResourcesExternallyBusy Method"},{"pos":[4973,5151],"content":"Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array <ph id=\"ph1\">`ppVirtualProcessorRoots`</ph> are now being used by other schedulers.","source":"Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array `ppVirtualProcessorRoots` are now being used by other schedulers."},{"pos":[5318,5328],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"An array of <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interfaces associated with the hardware threads on which other schedulers have become busy.","pos":[5361,5488],"source":" An array of `IVirtualProcessorRoot` interfaces associated with the hardware threads on which other schedulers have become busy."},{"content":"The number of <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interfaces in the array.","pos":[5506,5568],"source":" The number of `IVirtualProcessorRoot` interfaces in the array."},{"pos":[5578,5585],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"It is possible for a particular hardware thread to be assigned to multiple schedulers at the same time.","pos":[5589,5692]},{"content":"One reason for this could be that there are not enough hardware threads on the system to satisfy the minimum concurrency for all schedulers, without sharing resources.","pos":[5693,5860]},{"content":"Another possibility is that resources are temporarily assigned to other schedulers when the owning scheduler is not using them, by way of all its virtual processor roots on that hardware thread being deactivated.","pos":[5861,6073]},{"content":"The subscription level of a hardware thread is denoted by the number of subscribed threads and activated virtual processor roots associated with that hardware thread.","pos":[6080,6246]},{"content":"From a particular scheduler's point of view, the external subscription level of a hardware thread is the portion of the subscription other schedulers contribute to.","pos":[6247,6411]},{"content":"Notifications that resources are externally busy are sent to a scheduler when the external subscription level for a hardware thread moves from zero into positive territory.","pos":[6412,6584]},{"content":"Notifications via this method are only sent to schedulers that have a policy where the value for the <ph id=\"ph1\">`MinConcurrency`</ph> policy key is equal to the value for the <ph id=\"ph2\">`MaxConcurrency`</ph> policy key.","pos":[6591,6778],"source":"Notifications via this method are only sent to schedulers that have a policy where the value for the `MinConcurrency` policy key is equal to the value for the `MaxConcurrency` policy key."},{"content":"For more information on scheduler policies, see <bpt id=\"p1\">[</bpt>SchedulerPolicy<ept id=\"p1\">](schedulerpolicy-class.md)</ept>.","pos":[6779,6871],"source":" For more information on scheduler policies, see [SchedulerPolicy](schedulerpolicy-class.md)."},{"content":"A scheduler that qualifies for notifications gets a set of initial notifications when it is created, informing it whether the resources it was just assigned are externally busy or idle.","pos":[6878,7063]},{"pos":[7073,7167],"content":"<bpt id=\"p1\">&lt;a name=\"notifyresourcesexternallyidle\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  IScheduler::NotifyResourcesExternallyIdle Method","linkify":"<a name=\"notifyresourcesexternallyidle\"></a>  IScheduler::NotifyResourcesExternallyIdle Method","source":"<a name=\"notifyresourcesexternallyidle\"></a>  IScheduler::NotifyResourcesExternallyIdle Method"},{"pos":[7171,7349],"content":"Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array <ph id=\"ph1\">`ppVirtualProcessorRoots`</ph> are not being used by other schedulers.","source":"Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array `ppVirtualProcessorRoots` are not being used by other schedulers."},{"pos":[7516,7526],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"An array of <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interfaces associated with hardware threads on which other schedulers have become idle.","pos":[7559,7682],"source":" An array of `IVirtualProcessorRoot` interfaces associated with hardware threads on which other schedulers have become idle."},{"content":"The number of <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interfaces in the array.","pos":[7700,7762],"source":" The number of `IVirtualProcessorRoot` interfaces in the array."},{"pos":[7772,7779],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"It is possible for a particular hardware thread to be assigned to multiple schedulers at the same time.","pos":[7783,7886]},{"content":"One reason for this could be that there are not enough hardware threads on the system to satisfy the minimum concurrency for all schedulers, without sharing resources.","pos":[7887,8054]},{"content":"Another possibility is that resources are temporarily assigned to other schedulers when the owning scheduler is not using them, by way of all its virtual processor roots on that hardware thread being deactivated.","pos":[8055,8267]},{"content":"The subscription level of a hardware thread is denoted by the number of subscribed threads and activated virtual processor roots associated with that hardware thread.","pos":[8274,8440]},{"content":"From a particular scheduler's point of view, the external subscription level of a hardware thread is the portion of the subscription other schedulers contribute to.","pos":[8441,8605]},{"content":"Notifications that resources are externally busy are sent to a scheduler when the external subscription level for a hardware thread falls to zero from a previous positive value.","pos":[8606,8783]},{"content":"Notifications via this method are only sent to schedulers that have a policy where the value for the <ph id=\"ph1\">`MinConcurrency`</ph> policy key is equal to the value for the <ph id=\"ph2\">`MaxConcurrency`</ph> policy key.","pos":[8790,8977],"source":"Notifications via this method are only sent to schedulers that have a policy where the value for the `MinConcurrency` policy key is equal to the value for the `MaxConcurrency` policy key."},{"content":"For more information on scheduler policies, see <bpt id=\"p1\">[</bpt>SchedulerPolicy<ept id=\"p1\">](schedulerpolicy-class.md)</ept>.","pos":[8978,9070],"source":" For more information on scheduler policies, see [SchedulerPolicy](schedulerpolicy-class.md)."},{"content":"A scheduler that qualifies for notifications gets a set of initial notifications when it is created, informing it whether the resources it was just assigned are externally busy or idle.","pos":[9077,9262]},{"pos":[9272,9354],"content":"<bpt id=\"p1\">&lt;a name=\"removevirtualprocessors\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  IScheduler::RemoveVirtualProcessors Method","linkify":"<a name=\"removevirtualprocessors\"></a>  IScheduler::RemoveVirtualProcessors Method","source":"<a name=\"removevirtualprocessors\"></a>  IScheduler::RemoveVirtualProcessors Method"},{"content":"Initiates the removal of virtual processor roots that were previously allocated to this scheduler.","pos":[9358,9456]},{"pos":[9617,9627],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"An array of <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interfaces representing the virtual processor roots to be removed.","pos":[9660,9762],"source":" An array of `IVirtualProcessorRoot` interfaces representing the virtual processor roots to be removed."},{"content":"The number of <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interfaces in the array.","pos":[9780,9842],"source":" The number of `IVirtualProcessorRoot` interfaces in the array."},{"pos":[9852,9859],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"The Resource Manager invokes the <ph id=\"ph1\">`RemoveVirtualProcessors`</ph> method to take back a set of virtual processor roots from a scheduler.","pos":[9863,9992],"source":"The Resource Manager invokes the `RemoveVirtualProcessors` method to take back a set of virtual processor roots from a scheduler."},{"content":"The scheduler is expected to invoke the <bpt id=\"p1\">[</bpt>Remove<ept id=\"p1\">](iexecutionresource-structure.md#remove)</ept> method on each interface when it is done with the virtual processor roots.","pos":[9993,10156],"source":" The scheduler is expected to invoke the [Remove](iexecutionresource-structure.md#remove) method on each interface when it is done with the virtual processor roots."},{"content":"Do not use an <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interface once you have invoked the <ph id=\"ph2\">`Remove`</ph> method on it.","pos":[10157,10253],"source":" Do not use an `IVirtualProcessorRoot` interface once you have invoked the `Remove` method on it."},{"content":"The parameter <ph id=\"ph1\">`ppVirtualProcessorRoots`</ph> points to an array of interfaces.","pos":[10260,10333],"source":"The parameter `ppVirtualProcessorRoots` points to an array of interfaces."},{"content":"Among the set of virtual processor roots to be removed, the roots have never been activated can be returned immediately using the <ph id=\"ph1\">`Remove`</ph> method.","pos":[10334,10480],"source":" Among the set of virtual processor roots to be removed, the roots have never been activated can be returned immediately using the `Remove` method."},{"content":"The roots that have been activated and are either executing work, or have been deactivated and are waiting for work to arrive, should be returned asynchronously.","pos":[10481,10642]},{"content":"The scheduler must make every attempt to remove the virtual processor root as quickly as possible.","pos":[10643,10741]},{"content":"Delaying removal of the virtual processor roots may result in unintentional oversubscription within the scheduler.","pos":[10742,10856]},{"pos":[10866,10922],"content":"<bpt id=\"p1\">&lt;a name=\"statistics\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  IScheduler::Statistics Method","linkify":"<a name=\"statistics\"></a>  IScheduler::Statistics Method","source":"<a name=\"statistics\"></a>  IScheduler::Statistics Method"},{"content":"Provides information related to task arrival and completion rates, and change in queue length for a scheduler.","pos":[10926,11036]},{"pos":[11224,11234],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"The number of tasks that have been completed by the scheduler since the last call to this method.","pos":[11263,11360]},{"content":"The number of tasks that have arrived in the scheduler since the last call to this method.","pos":[11389,11479]},{"content":"The total number of tasks in all scheduler queues.","pos":[11514,11564]},{"pos":[11574,11581],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"This method is invoked by the Resource Manager in order to gather statistics for a scheduler.","pos":[11585,11678]},{"content":"The statistics gathered here will be used to drive dynamic feedback algorithms to determine when it is appropriate to assign more resources to the scheduler and when to take resources away.","pos":[11679,11868]},{"content":"The values provided by the scheduler can be optimistic and do not necessarily have to reflect the current count accurately.","pos":[11869,11992]},{"content":"You should implement this method if you want the Resource Manager to use feedback about such things as task arrival to determine how to balance resource between your scheduler and other schedulers registered with the Resource Manager.","pos":[11999,12233]},{"content":"If you choose not to gather statistics, you can set the policy key <ph id=\"ph1\">`DynamicProgressFeedback`</ph> to the value <ph id=\"ph2\">`DynamicProgressFeedbackDisabled`</ph> in your scheduler's policy, and the Resource Manager will not invoke this method on your scheduler.","pos":[12234,12473],"source":" If you choose not to gather statistics, you can set the policy key `DynamicProgressFeedback` to the value `DynamicProgressFeedbackDisabled` in your scheduler's policy, and the Resource Manager will not invoke this method on your scheduler."},{"content":"In the absence of statistical information, the Resource Manager will use hardware thread subscription levels to make resource allocation and migration decisions.","pos":[12480,12641]},{"content":"For more information on subscription levels, see <bpt id=\"p1\">[</bpt>IExecutionResource::CurrentSubscriptionLevel<ept id=\"p1\">](iexecutionresource-structure.md#currentsubscriptionlevel)</ept>.","pos":[12642,12796],"source":" For more information on subscription levels, see [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel)."},{"pos":[12805,12813],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>concurrency Namespace<ept id=\"p1\">](concurrency-namespace.md)</ept><ph id=\"ph1\"> </ph>","pos":[12817,12867],"source":"[concurrency Namespace](concurrency-namespace.md) "},{"content":"<bpt id=\"p1\"> [</bpt>PolicyElementKey Enumeration<ept id=\"p1\">](concurrency-namespace-enums.md)</ept><ph id=\"ph1\"> </ph>","pos":[12870,12934],"source":" [PolicyElementKey Enumeration](concurrency-namespace-enums.md) "},{"content":"<bpt id=\"p1\"> [</bpt>SchedulerPolicy Class<ept id=\"p1\">](schedulerpolicy-class.md)</ept><ph id=\"ph1\"> </ph>","pos":[12937,12988],"source":" [SchedulerPolicy Class](schedulerpolicy-class.md) "},{"content":"<bpt id=\"p1\"> [</bpt>IExecutionContext Structure<ept id=\"p1\">](iexecutioncontext-structure.md)</ept><ph id=\"ph1\"> </ph>","pos":[12991,13054],"source":" [IExecutionContext Structure](iexecutioncontext-structure.md) "},{"content":"<bpt id=\"p1\"> [</bpt>IThreadProxy Structure<ept id=\"p1\">](ithreadproxy-structure.md)</ept><ph id=\"ph1\"> </ph>","pos":[13057,13110],"source":" [IThreadProxy Structure](ithreadproxy-structure.md) "},{"content":"<bpt id=\"p1\"> [</bpt>IVirtualProcessorRoot Structure<ept id=\"p1\">](ivirtualprocessorroot-structure.md)</ept><ph id=\"ph1\"> </ph>","pos":[13113,13184],"source":" [IVirtualProcessorRoot Structure](ivirtualprocessorroot-structure.md) "},{"content":"<bpt id=\"p1\"> [</bpt>IResourceManager Structure<ept id=\"p1\">](iresourcemanager-structure.md)</ept>","pos":[13187,13247],"source":" [IResourceManager Structure](iresourcemanager-structure.md)"}],"content":"---\ntitle: \"IScheduler Structure | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"concrtrm/concurrency::IScheduler\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"IScheduler structure\"\nms.assetid: 471de85a-2b1a-4b6d-ab81-2eff2737161e\ncaps.latest.revision: 18\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# IScheduler Structure\nAn interface to an abstraction of a work scheduler. The Concurrency Runtime's Resource Manager uses this interface to communicate with work schedulers.  \n  \n## Syntax  \n  \n```\nstruct IScheduler;\n```  \n  \n## Members  \n  \n### Public Methods  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[IScheduler::AddVirtualProcessors Method](#addvirtualprocessors)|Provides a scheduler with a set of virtual processor roots for its use. Each `IVirtualProcessorRoot` interface represents the right to execute a single thread that can perform work on behalf of the scheduler.|  \n|[IScheduler::GetId Method](#getid)|Returns a unique identifier for the scheduler.|  \n|[IScheduler::GetPolicy Method](#getpolicy)|Returns a copy of the scheduler's policy. For more information on scheduler policies, see [SchedulerPolicy](schedulerpolicy-class.md).|  \n|[IScheduler::NotifyResourcesExternallyBusy Method](#notifyresourcesexternallybusy)|Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array `ppVirtualProcessorRoots` are now being used by other schedulers.|  \n|[IScheduler::NotifyResourcesExternallyIdle Method](#notifyresourcesexternallyidle)|Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array `ppVirtualProcessorRoots` are not being used by other schedulers.|  \n|[IScheduler::RemoveVirtualProcessors Method](#removevirtualprocessors)|Initiates the removal of virtual processor roots that were previously allocated to this scheduler.|  \n|[IScheduler::Statistics Method](#statistics)|Provides information related to task arrival and completion rates, and change in queue length for a scheduler.|  \n  \n## Remarks  \n If you are implementing a custom scheduler that communicates with the Resource Manager, you should provide an implementation of the `IScheduler` interface. This interface is one end of a two-way channel of communication between a scheduler and the Resource Manager. The other end is represented by the `IResourceManager` and `ISchedulerProxy` interfaces which are implemented by the Resource Manager.  \n  \n## Inheritance Hierarchy  \n `IScheduler`  \n  \n## Requirements  \n **Header:** concrtrm.h  \n  \n **Namespace:** concurrency  \n  \n##  <a name=\"addvirtualprocessors\"></a>  IScheduler::AddVirtualProcessors Method  \n Provides a scheduler with a set of virtual processor roots for its use. Each `IVirtualProcessorRoot` interface represents the right to execute a single thread that can perform work on behalf of the scheduler.  \n  \n```\nvirtual void AddVirtualProcessors(\n    _In_reads_(count) IVirtualProcessorRoot** ppVirtualProcessorRoots,\n    unsigned int count) = 0;\n```  \n  \n### Parameters  \n `ppVirtualProcessorRoots`  \n An array of `IVirtualProcessorRoot` interfaces representing the virtual processor roots being added to the scheduler.  \n  \n `count`  \n The number of `IVirtualProcessorRoot` interfaces in the array.  \n  \n### Remarks  \n The Resource Manager invokes the `AddVirtualProcessor` method to grant an initial set of virtual processor roots to a scheduler. It could also invoke the method to add virtual processor roots to the scheduler when it rebalances resources among schedulers.  \n  \n##  <a name=\"getid\"></a>  IScheduler::GetId Method  \n Returns a unique identifier for the scheduler.  \n  \n```\nvirtual unsigned int GetId() const = 0;\n```  \n  \n### Return Value  \n A unique integer identifier.  \n  \n### Remarks  \n You should use the [GetSchedulerId](concurrency-namespace-functions.md) function to obtain a unique identifier for the object that implements the `IScheduler` interface, before you use the interface as a parameter to methods supplied by the Resource Manager. You are expected to return the same identifier when the `GetId` function is invoked.  \n  \n An identifier obtained from a different source could result in undefined behavior.  \n  \n##  <a name=\"getpolicy\"></a>  IScheduler::GetPolicy Method  \n Returns a copy of the scheduler's policy. For more information on scheduler policies, see [SchedulerPolicy](schedulerpolicy-class.md).  \n  \n```\nvirtual SchedulerPolicy GetPolicy() const = 0;\n```  \n  \n### Return Value  \n A copy of the scheduler's policy.  \n  \n##  <a name=\"notifyresourcesexternallybusy\"></a>  IScheduler::NotifyResourcesExternallyBusy Method  \n Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array `ppVirtualProcessorRoots` are now being used by other schedulers.  \n  \n```\nvirtual void NotifyResourcesExternallyBusy(\n    _In_reads_(count) IVirtualProcessorRoot** ppVirtualProcessorRoots,\n    unsigned int count) = 0;\n```  \n  \n### Parameters  \n `ppVirtualProcessorRoots`  \n An array of `IVirtualProcessorRoot` interfaces associated with the hardware threads on which other schedulers have become busy.  \n  \n `count`  \n The number of `IVirtualProcessorRoot` interfaces in the array.  \n  \n### Remarks  \n It is possible for a particular hardware thread to be assigned to multiple schedulers at the same time. One reason for this could be that there are not enough hardware threads on the system to satisfy the minimum concurrency for all schedulers, without sharing resources. Another possibility is that resources are temporarily assigned to other schedulers when the owning scheduler is not using them, by way of all its virtual processor roots on that hardware thread being deactivated.  \n  \n The subscription level of a hardware thread is denoted by the number of subscribed threads and activated virtual processor roots associated with that hardware thread. From a particular scheduler's point of view, the external subscription level of a hardware thread is the portion of the subscription other schedulers contribute to. Notifications that resources are externally busy are sent to a scheduler when the external subscription level for a hardware thread moves from zero into positive territory.  \n  \n Notifications via this method are only sent to schedulers that have a policy where the value for the `MinConcurrency` policy key is equal to the value for the `MaxConcurrency` policy key. For more information on scheduler policies, see [SchedulerPolicy](schedulerpolicy-class.md).  \n  \n A scheduler that qualifies for notifications gets a set of initial notifications when it is created, informing it whether the resources it was just assigned are externally busy or idle.  \n  \n##  <a name=\"notifyresourcesexternallyidle\"></a>  IScheduler::NotifyResourcesExternallyIdle Method  \n Notifies this scheduler that the hardware threads represented by the set of virtual processor roots in the array `ppVirtualProcessorRoots` are not being used by other schedulers.  \n  \n```\nvirtual void NotifyResourcesExternallyIdle(\n    _In_reads_(count) IVirtualProcessorRoot** ppVirtualProcessorRoots,\n    unsigned int count) = 0;\n```  \n  \n### Parameters  \n `ppVirtualProcessorRoots`  \n An array of `IVirtualProcessorRoot` interfaces associated with hardware threads on which other schedulers have become idle.  \n  \n `count`  \n The number of `IVirtualProcessorRoot` interfaces in the array.  \n  \n### Remarks  \n It is possible for a particular hardware thread to be assigned to multiple schedulers at the same time. One reason for this could be that there are not enough hardware threads on the system to satisfy the minimum concurrency for all schedulers, without sharing resources. Another possibility is that resources are temporarily assigned to other schedulers when the owning scheduler is not using them, by way of all its virtual processor roots on that hardware thread being deactivated.  \n  \n The subscription level of a hardware thread is denoted by the number of subscribed threads and activated virtual processor roots associated with that hardware thread. From a particular scheduler's point of view, the external subscription level of a hardware thread is the portion of the subscription other schedulers contribute to. Notifications that resources are externally busy are sent to a scheduler when the external subscription level for a hardware thread falls to zero from a previous positive value.  \n  \n Notifications via this method are only sent to schedulers that have a policy where the value for the `MinConcurrency` policy key is equal to the value for the `MaxConcurrency` policy key. For more information on scheduler policies, see [SchedulerPolicy](schedulerpolicy-class.md).  \n  \n A scheduler that qualifies for notifications gets a set of initial notifications when it is created, informing it whether the resources it was just assigned are externally busy or idle.  \n  \n##  <a name=\"removevirtualprocessors\"></a>  IScheduler::RemoveVirtualProcessors Method  \n Initiates the removal of virtual processor roots that were previously allocated to this scheduler.  \n  \n```\nvirtual void RemoveVirtualProcessors(\n    _In_reads_(count) IVirtualProcessorRoot** ppVirtualProcessorRoots,\n    unsigned int count) = 0;\n```  \n  \n### Parameters  \n `ppVirtualProcessorRoots`  \n An array of `IVirtualProcessorRoot` interfaces representing the virtual processor roots to be removed.  \n  \n `count`  \n The number of `IVirtualProcessorRoot` interfaces in the array.  \n  \n### Remarks  \n The Resource Manager invokes the `RemoveVirtualProcessors` method to take back a set of virtual processor roots from a scheduler. The scheduler is expected to invoke the [Remove](iexecutionresource-structure.md#remove) method on each interface when it is done with the virtual processor roots. Do not use an `IVirtualProcessorRoot` interface once you have invoked the `Remove` method on it.  \n  \n The parameter `ppVirtualProcessorRoots` points to an array of interfaces. Among the set of virtual processor roots to be removed, the roots have never been activated can be returned immediately using the `Remove` method. The roots that have been activated and are either executing work, or have been deactivated and are waiting for work to arrive, should be returned asynchronously. The scheduler must make every attempt to remove the virtual processor root as quickly as possible. Delaying removal of the virtual processor roots may result in unintentional oversubscription within the scheduler.  \n  \n##  <a name=\"statistics\"></a>  IScheduler::Statistics Method  \n Provides information related to task arrival and completion rates, and change in queue length for a scheduler.  \n  \n```\nvirtual void Statistics(\n    _Out_ unsigned int* pTaskCompletionRate,\n    _Out_ unsigned int* pTaskArrivalRate,\n    _Out_ unsigned int* pNumberOfTasksEnqueued) = 0;\n```  \n  \n### Parameters  \n `pTaskCompletionRate`  \n The number of tasks that have been completed by the scheduler since the last call to this method.  \n  \n `pTaskArrivalRate`  \n The number of tasks that have arrived in the scheduler since the last call to this method.  \n  \n `pNumberOfTasksEnqueued`  \n The total number of tasks in all scheduler queues.  \n  \n### Remarks  \n This method is invoked by the Resource Manager in order to gather statistics for a scheduler. The statistics gathered here will be used to drive dynamic feedback algorithms to determine when it is appropriate to assign more resources to the scheduler and when to take resources away. The values provided by the scheduler can be optimistic and do not necessarily have to reflect the current count accurately.  \n  \n You should implement this method if you want the Resource Manager to use feedback about such things as task arrival to determine how to balance resource between your scheduler and other schedulers registered with the Resource Manager. If you choose not to gather statistics, you can set the policy key `DynamicProgressFeedback` to the value `DynamicProgressFeedbackDisabled` in your scheduler's policy, and the Resource Manager will not invoke this method on your scheduler.  \n  \n In the absence of statistical information, the Resource Manager will use hardware thread subscription levels to make resource allocation and migration decisions. For more information on subscription levels, see [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).  \n  \n## See Also  \n [concurrency Namespace](concurrency-namespace.md)   \n [PolicyElementKey Enumeration](concurrency-namespace-enums.md)   \n [SchedulerPolicy Class](schedulerpolicy-class.md)   \n [IExecutionContext Structure](iexecutioncontext-structure.md)   \n [IThreadProxy Structure](ithreadproxy-structure.md)   \n [IVirtualProcessorRoot Structure](ivirtualprocessorroot-structure.md)   \n [IResourceManager Structure](iresourcemanager-structure.md)\n"}