{"nodes":[{"pos":[12,53],"content":"Special CWinApp Services | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Special CWinApp Services | Microsoft Docs","pos":[0,41]}]},{"content":"Special CWinApp Services","pos":[1491,1515]},{"pos":[1516,1709],"content":"Besides running the message loop and giving you an opportunity to initialize the application and clean up after it, <bpt id=\"p1\">[</bpt>CWinApp<ept id=\"p1\">](../mfc/reference/cwinapp-class.md)</ept> provides several other services.","source":"Besides running the message loop and giving you an opportunity to initialize the application and clean up after it, [CWinApp](../mfc/reference/cwinapp-class.md) provides several other services."},{"pos":[1759,1777],"content":"Shell Registration"},{"content":"By default, the MFC Application Wizard makes it possible for the user to open data files that your application has created by double-clicking them in File Explorer or File Manager.","pos":[1781,1961]},{"content":"If your application is an MDI application and you specify an extension for the files your application creates, the MFC Application Wizard adds calls to the <bpt id=\"p1\">[</bpt>RegisterShellFileTypes<ept id=\"p1\">](../mfc/reference/cwinapp-class.md#cwinapp__registershellfiletypes)</ept> and <bpt id=\"p2\">[</bpt>EnableShellOpen<ept id=\"p2\">](../mfc/reference/cwinapp-class.md#cwinapp__enableshellopen)</ept> member functions of <bpt id=\"p3\">[</bpt>CWinApp<ept id=\"p3\">](../mfc/reference/cwinapp-class.md)</ept> to the <ph id=\"ph1\">`InitInstance`</ph> override that it writes for you.","pos":[1962,2411],"source":" If your application is an MDI application and you specify an extension for the files your application creates, the MFC Application Wizard adds calls to the [RegisterShellFileTypes](../mfc/reference/cwinapp-class.md#cwinapp__registershellfiletypes) and [EnableShellOpen](../mfc/reference/cwinapp-class.md#cwinapp__enableshellopen) member functions of [CWinApp](../mfc/reference/cwinapp-class.md) to the `InitInstance` override that it writes for you."},{"content":"registers your application's document types with File Explorer or File Manager.","pos":[2443,2522]},{"content":"The function adds entries to the registration database that Windows maintains.","pos":[2523,2601]},{"content":"The entries register each document type, associate a file extension with the file type, specify a command line to open the application, and specify a dynamic data exchange (DDE) command to open a document of that type.","pos":[2602,2820]},{"pos":[2845,2991],"content":"completes the process by allowing your application to receive DDE commands from File Explorer or File Manager to open the file chosen by the user."},{"pos":[2998,3144],"content":"This automatic registration support in <ph id=\"ph1\">`CWinApp`</ph> eliminates the need to ship a .reg file with your application or to do special installation work.","source":"This automatic registration support in `CWinApp` eliminates the need to ship a .reg file with your application or to do special installation work."},{"pos":[3151,3435],"content":"If you want to initialize GDI+ for your application (by calling [GdiplusStartup]--brokenlink--(<bpt id=\"p1\">_</bpt>gdiplus_FUNC_GdiplusStartup_token_input_output<ept id=\"p1\">_</ept>) in your <bpt id=\"p2\">[</bpt>InitInstance<ept id=\"p2\">](../mfc/reference/cwinapp-class.md#cwinapp__initinstance)</ept> function), you have to suppress the GDI+ background thread.","source":"If you want to initialize GDI+ for your application (by calling [GdiplusStartup]--brokenlink--(_gdiplus_FUNC_GdiplusStartup_token_input_output_) in your [InitInstance](../mfc/reference/cwinapp-class.md#cwinapp__initinstance) function), you have to suppress the GDI+ background thread."},{"content":"You can do this by setting the <bpt id=\"p1\">**</bpt>SuppressBackgroundThread<ept id=\"p1\">**</ept> member of the [GdiplusStartupInput]--brokenlink--(_gdiplus_STRUC_GdiplusStartupInput) structure to <bpt id=\"p2\">**</bpt>TRUE<ept id=\"p2\">**</ept>.","pos":[3442,3610],"source":"You can do this by setting the **SuppressBackgroundThread** member of the [GdiplusStartupInput]--brokenlink--(_gdiplus_STRUC_GdiplusStartupInput) structure to **TRUE**."},{"content":"When suppressing the GDI+ background thread, the <bpt id=\"p1\">**</bpt>NotificationHook<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>NotificationUnhook<ept id=\"p2\">**</ept> calls (see [GdiplusStartupOutput]--brokenlink--(_gdiplus_STRUC_GdiplusStartupOutput)) should be made just prior to entering and exiting the application's message loop.","pos":[3611,3875],"source":" When suppressing the GDI+ background thread, the **NotificationHook** and **NotificationUnhook** calls (see [GdiplusStartupOutput]--brokenlink--(_gdiplus_STRUC_GdiplusStartupOutput)) should be made just prior to entering and exiting the application's message loop."},{"content":"Therefore, a good place to call <bpt id=\"p1\">**</bpt>GdiplusStartup<ept id=\"p1\">**</ept> and the hook notification functions would be in an override of the virtual function <bpt id=\"p2\">[</bpt>CWinApp::Run<ept id=\"p2\">](../mfc/reference/cwinapp-class.md#cwinapp__run)</ept>, as shown below:","pos":[3876,4090],"source":" Therefore, a good place to call **GdiplusStartup** and the hook notification functions would be in an override of the virtual function [CWinApp::Run](../mfc/reference/cwinapp-class.md#cwinapp__run), as shown below:"},{"pos":[4108,4124],"content":"NVC_MFCDocView#6"},{"content":"If you do not suppress the background GDI+ thread, DDE commands can be prematurely issued to the application before its main window has been created.","pos":[4188,4337]},{"content":"The DDE commands issued by the shell can be prematurely aborted, resulting in error messages.","pos":[4338,4431]},{"pos":[4489,4515],"content":"File Manager Drag and Drop"},{"content":"Files can be dragged from the file view window in File Manager or File Explorer to a window in your application.","pos":[4519,4631]},{"content":"You might, for example, enable one or more files to be dragged to an MDI application's main window, where the application could retrieve the file names and open MDI child windows for those files.","pos":[4632,4827]},{"content":"To enable file drag and drop in your application, the MFC Application Wizard writes a call to the <bpt id=\"p1\">[</bpt>CWnd<ept id=\"p1\">](../mfc/reference/cwnd-class.md)</ept> member function <bpt id=\"p2\">[</bpt>DragAcceptFiles<ept id=\"p2\">](../mfc/reference/cwnd-class.md#cwnd__dragacceptfiles)</ept> for your main frame window in your <ph id=\"ph1\">`InitInstance`</ph>.","pos":[4834,5109],"source":"To enable file drag and drop in your application, the MFC Application Wizard writes a call to the [CWnd](../mfc/reference/cwnd-class.md) member function [DragAcceptFiles](../mfc/reference/cwnd-class.md#cwnd__dragacceptfiles) for your main frame window in your `InitInstance`."},{"content":"You can remove that call if you do not want to implement the drag-and-drop feature.","pos":[5110,5193]},{"pos":[5201,5411],"content":"[!NOTE]\n You can also implement more general drag-and-drop capabilities—dragging data between or within documents—with OLE. For information, see the article [Drag and Drop (OLE)](../mfc/drag-and-drop-ole.md).","leadings":["","> "],"nodes":[{"content":" You can also implement more general drag-and-drop capabilities—dragging data between or within documents—with OLE. For information, see the article [Drag and Drop (OLE)](../mfc/drag-and-drop-ole.md).","pos":[8,208],"nodes":[{"content":"You can also implement more general drag-and-drop capabilities—dragging data between or within documents—with OLE.","pos":[1,115]},{"content":"For information, see the article <bpt id=\"p1\">[</bpt>Drag and Drop (OLE)<ept id=\"p1\">](../mfc/drag-and-drop-ole.md)</ept>.","pos":[116,200],"source":" For information, see the article [Drag and Drop (OLE)](../mfc/drag-and-drop-ole.md)."}]}]},{"pos":[5492,5541],"content":"Keeping Track of the Most Recently Used Documents"},{"content":"As the user opens and closes files, the application object keeps track of the four most recently used files.","pos":[5545,5653]},{"content":"The names of these files are added to the File menu and updated when they change.","pos":[5654,5735]},{"content":"The framework stores these file names in either the registry or in the .ini file, with the same name as your project and reads them from the file when your application starts up.","pos":[5736,5914]},{"content":"The <ph id=\"ph1\">`InitInstance`</ph> override that the MFC Application Wizard creates for you includes a call to the <bpt id=\"p1\">[</bpt>CWinApp<ept id=\"p1\">](../mfc/reference/cwinapp-class.md)</ept> member function <bpt id=\"p2\">[</bpt>LoadStdProfileSettings<ept id=\"p2\">](../mfc/reference/cwinapp-class.md#cwinapp__loadstdprofilesettings)</ept>, which loads information from the registry or .ini file, including the most recently used file names.","pos":[5915,6268],"source":" The `InitInstance` override that the MFC Application Wizard creates for you includes a call to the [CWinApp](../mfc/reference/cwinapp-class.md) member function [LoadStdProfileSettings](../mfc/reference/cwinapp-class.md#cwinapp__loadstdprofilesettings), which loads information from the registry or .ini file, including the most recently used file names."},{"content":"These entries are stored as follows:","pos":[6275,6311]},{"content":"In Windows NT, Windows 2000, and later, the value is stored to a registry key.","pos":[6321,6399]},{"content":"In Windows 3.x, the value is stored in the WIN.INI file.","pos":[6409,6465]},{"content":"In Windows 95 and later, the value is stored in a cached version of WIN.INI.","pos":[6475,6551]},{"content":"See Also","pos":[6560,6568]},{"content":"CWinApp: The Application Class","pos":[6573,6603]}],"content":"---\ntitle: \"Special CWinApp Services | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"LoadStdProfileSettings\"\n  - \"EnableShellOpen\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"files [C++], most recently used\"\n  - \"DragAcceptFiles method\"\n  - \"MRU lists\"\n  - \"GDI+, initializing for MFC\"\n  - \"GDI+, suppressing background thread [MFC]\"\n  - \"CWinApp class, shell registration\"\n  - \"application objects [C++], services\"\n  - \"CWinApp class, initializing GDI+\"\n  - \"MFC [C++], shell registration\"\n  - \"CWinApp class, File Manager drag and drop\"\n  - \"LoadStdProfileSettings method\"\n  - \"MFC [C++], most-recently-used file list\"\n  - \"RegisterShellFileTypes method\"\n  - \"drag and drop [C++], files\"\n  - \"registering file types\"\n  - \"Shell, registering file types\"\n  - \"services, provided by CWinApp\"\n  - \"CWinApp class, recently used documents\"\n  - \"CWinApp class, services\"\n  - \"files [C++], drag and drop\"\n  - \"EnableShellOpen method\"\n  - \"registry [C++], most recently used files\"\n  - \"MFC [C++], file operations\"\n  - \"registration [C++], shell\"\nms.assetid: 0480cd01-f629-4249-b221-93432d95b431\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Special CWinApp Services\nBesides running the message loop and giving you an opportunity to initialize the application and clean up after it, [CWinApp](../mfc/reference/cwinapp-class.md) provides several other services.  \n  \n##  <a name=\"_core_shell_registration\"></a> Shell Registration  \n By default, the MFC Application Wizard makes it possible for the user to open data files that your application has created by double-clicking them in File Explorer or File Manager. If your application is an MDI application and you specify an extension for the files your application creates, the MFC Application Wizard adds calls to the [RegisterShellFileTypes](../mfc/reference/cwinapp-class.md#cwinapp__registershellfiletypes) and [EnableShellOpen](../mfc/reference/cwinapp-class.md#cwinapp__enableshellopen) member functions of [CWinApp](../mfc/reference/cwinapp-class.md) to the `InitInstance` override that it writes for you.  \n  \n `RegisterShellFileTypes` registers your application's document types with File Explorer or File Manager. The function adds entries to the registration database that Windows maintains. The entries register each document type, associate a file extension with the file type, specify a command line to open the application, and specify a dynamic data exchange (DDE) command to open a document of that type.  \n  \n `EnableShellOpen` completes the process by allowing your application to receive DDE commands from File Explorer or File Manager to open the file chosen by the user.  \n  \n This automatic registration support in `CWinApp` eliminates the need to ship a .reg file with your application or to do special installation work.  \n  \n If you want to initialize GDI+ for your application (by calling [GdiplusStartup]--brokenlink--(_gdiplus_FUNC_GdiplusStartup_token_input_output_) in your [InitInstance](../mfc/reference/cwinapp-class.md#cwinapp__initinstance) function), you have to suppress the GDI+ background thread.  \n  \n You can do this by setting the **SuppressBackgroundThread** member of the [GdiplusStartupInput]--brokenlink--(_gdiplus_STRUC_GdiplusStartupInput) structure to **TRUE**. When suppressing the GDI+ background thread, the **NotificationHook** and **NotificationUnhook** calls (see [GdiplusStartupOutput]--brokenlink--(_gdiplus_STRUC_GdiplusStartupOutput)) should be made just prior to entering and exiting the application's message loop. Therefore, a good place to call **GdiplusStartup** and the hook notification functions would be in an override of the virtual function [CWinApp::Run](../mfc/reference/cwinapp-class.md#cwinapp__run), as shown below:  \n  \n [!code-cpp[NVC_MFCDocView#6](../mfc/codesnippet/cpp/special-cwinapp-services_1.cpp)]  \n  \n If you do not suppress the background GDI+ thread, DDE commands can be prematurely issued to the application before its main window has been created. The DDE commands issued by the shell can be prematurely aborted, resulting in error messages.  \n  \n##  <a name=\"_core_file_manager_drag_and_drop\"></a> File Manager Drag and Drop  \n Files can be dragged from the file view window in File Manager or File Explorer to a window in your application. You might, for example, enable one or more files to be dragged to an MDI application's main window, where the application could retrieve the file names and open MDI child windows for those files.  \n  \n To enable file drag and drop in your application, the MFC Application Wizard writes a call to the [CWnd](../mfc/reference/cwnd-class.md) member function [DragAcceptFiles](../mfc/reference/cwnd-class.md#cwnd__dragacceptfiles) for your main frame window in your `InitInstance`. You can remove that call if you do not want to implement the drag-and-drop feature.  \n  \n> [!NOTE]\n>  You can also implement more general drag-and-drop capabilities—dragging data between or within documents—with OLE. For information, see the article [Drag and Drop (OLE)](../mfc/drag-and-drop-ole.md).  \n  \n##  <a name=\"_core_keeping_track_of_the_most_recently_used_documents\"></a> Keeping Track of the Most Recently Used Documents  \n As the user opens and closes files, the application object keeps track of the four most recently used files. The names of these files are added to the File menu and updated when they change. The framework stores these file names in either the registry or in the .ini file, with the same name as your project and reads them from the file when your application starts up. The `InitInstance` override that the MFC Application Wizard creates for you includes a call to the [CWinApp](../mfc/reference/cwinapp-class.md) member function [LoadStdProfileSettings](../mfc/reference/cwinapp-class.md#cwinapp__loadstdprofilesettings), which loads information from the registry or .ini file, including the most recently used file names.  \n  \n These entries are stored as follows:  \n  \n-   In Windows NT, Windows 2000, and later, the value is stored to a registry key.  \n  \n-   In Windows 3.x, the value is stored in the WIN.INI file.  \n  \n-   In Windows 95 and later, the value is stored in a cached version of WIN.INI.  \n  \n## See Also  \n [CWinApp: The Application Class](../mfc/cwinapp-the-application-class.md)"}