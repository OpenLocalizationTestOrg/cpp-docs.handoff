{"nodes":[{"pos":[12,68],"content":"_CrtSetReportHook2, _CrtSetReportHookW2 | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"_CrtSetReportHook2, _CrtSetReportHookW2 | Microsoft Docs","pos":[0,56]}]},{"content":"_CrtSetReportHook2, _CrtSetReportHookW2","pos":[1161,1200]},{"content":"Installs or uninstalls a client-defined reporting function by hooking it into the C run-time debug reporting process (debug version only).","pos":[1201,1339]},{"content":"Syntax","pos":[1348,1354]},{"content":"Parameters","pos":[1549,1559]},{"content":"The action to take: <ph id=\"ph1\">`_CRT_RPTHOOK_INSTALL`</ph> or <ph id=\"ph2\">`_CRT_RPTHOOK_REMOVE`</ph>.","pos":[1573,1641],"source":" The action to take: `_CRT_RPTHOOK_INSTALL` or `_CRT_RPTHOOK_REMOVE`."},{"content":"Report hook to install or remove in the narrow-character version of this function.","pos":[1664,1746]},{"content":"Report hook to install or remove in the wide-character version of this function.","pos":[1769,1849]},{"content":"Return Value","pos":[1858,1870]},{"pos":[1874,2006],"content":"-1 if an error was encountered, with <ph id=\"ph1\">`EINVAL`</ph> or <ph id=\"ph2\">`ENOMEM`</ph> set; otherwise returns the reference count of <ph id=\"ph3\">`pfnNewHook`</ph> after the call.","source":"-1 if an error was encountered, with `EINVAL` or `ENOMEM` set; otherwise returns the reference count of `pfnNewHook` after the call."},{"content":"Remarks","pos":[2015,2022]},{"pos":[2047,2221],"content":"and <ph id=\"ph1\">`_CrtSetReportHookW2`</ph> let you hook or unhook a function, whereas <bpt id=\"p1\">[</bpt>_CrtSetReportHook<ept id=\"p1\">](../../c-runtime-library/reference/crtsetreporthook.md)</ept> only lets you hook a function.","source":" and `_CrtSetReportHookW2` let you hook or unhook a function, whereas [_CrtSetReportHook](../../c-runtime-library/reference/crtsetreporthook.md) only lets you hook a function."},{"content":"or <ph id=\"ph1\">`_CrtSetReportHookW2`</ph> should be used instead of <ph id=\"ph2\">`_CrtSetReportHook`</ph> when the hook call is made in a DLL and when multiple DLLs might be loaded and setting their own hook functions.","pos":[2249,2432],"source":" or `_CrtSetReportHookW2` should be used instead of `_CrtSetReportHook` when the hook call is made in a DLL and when multiple DLLs might be loaded and setting their own hook functions."},{"content":"In such a situation, DLLs can be unloaded in a different order than they were loaded and the hook function can be left pointing at an unloaded DLL.","pos":[2433,2580]},{"content":"Any debug output crashes the process if the hook functions were added with <ph id=\"ph1\">`_CrtSetReportHook`</ph>.","pos":[2581,2676],"source":" Any debug output crashes the process if the hook functions were added with `_CrtSetReportHook`."},{"pos":[2683,2930],"content":"Any hook functions added with <ph id=\"ph1\">`_CrtSetReportHook`</ph> are called if there are no hook functions added with <ph id=\"ph2\">`_CrtSetReportHook2`</ph> or <ph id=\"ph3\">`_CrtSetReportHookW2`</ph> or if all hook functions added with <ph id=\"ph4\">`_CrtSetReportHook2`</ph> and <ph id=\"ph5\">`_CrtSetReportHookW2`</ph> return <ph id=\"ph6\">`FALSE`</ph>.","source":"Any hook functions added with `_CrtSetReportHook` are called if there are no hook functions added with `_CrtSetReportHook2` or `_CrtSetReportHookW2` or if all hook functions added with `_CrtSetReportHook2` and `_CrtSetReportHookW2` return `FALSE`."},{"content":"The wide-character version of this function is available.","pos":[2937,2994]},{"content":"The report hook functions take a string whose type (wide or narrow characters) must match the version of this function used.","pos":[2995,3119]},{"content":"Use the following function prototype for the report hooks used with the wide-character version of this function:","pos":[3120,3232]},{"content":"Use the following prototype for the narrow-character report hooks:","pos":[3330,3396]},{"content":"These functions validate their parameters.","pos":[3491,3533]},{"content":"If <ph id=\"ph1\">`mode`</ph> or <ph id=\"ph2\">`pfnNewNook`</ph> is invalid, these functions invoke the invalid parameter handler, as described in <bpt id=\"p1\">[</bpt>Parameter Validation<ept id=\"p1\">](../../c-runtime-library/parameter-validation.md)</ept>.","pos":[3534,3714],"source":" If `mode` or `pfnNewNook` is invalid, these functions invoke the invalid parameter handler, as described in [Parameter Validation](../../c-runtime-library/parameter-validation.md)."},{"content":"If execution is allowed to continue, these functions set <ph id=\"ph1\">`errno`</ph> to <ph id=\"ph2\">`EINVAL`</ph> and return -1.","pos":[3715,3806],"source":" If execution is allowed to continue, these functions set `errno` to `EINVAL` and return -1."},{"pos":[3814,4027],"content":"[!NOTE]\n If your application is compiled with `/clr` and the reporting function is called after the application has exited main, the CLR will throw an exception if the reporting function calls any CRT functions.","leadings":["","> "],"nodes":[{"content":"If your application is compiled with <ph id=\"ph1\">`/clr`</ph> and the reporting function is called after the application has exited main, the CLR will throw an exception if the reporting function calls any CRT functions.","pos":[9,211],"source":" If your application is compiled with `/clr` and the reporting function is called after the application has exited main, the CLR will throw an exception if the reporting function calls any CRT functions."}]},{"content":"Requirements","pos":[4036,4048]},{"content":"Routine","pos":[4055,4062]},{"content":"Required header","pos":[4063,4078]},{"content":"Optional header","pos":[4079,4094]},{"content":"crtdbg.h&gt;","pos":[4184,4193],"source":"crtdbg.h>"},{"content":"errno.h&gt;","pos":[4196,4204],"source":"errno.h>"},{"content":"crtdbg.h&gt;","pos":[4233,4242],"source":"crtdbg.h>"},{"content":"errno.h&gt;","pos":[4245,4253],"source":"errno.h>"},{"pos":[4261,4379],"content":"For more compatibility information, see <bpt id=\"p1\">[</bpt>Compatibility<ept id=\"p1\">](../../c-runtime-library/compatibility.md)</ept> in the Introduction.","source":"For more compatibility information, see [Compatibility](../../c-runtime-library/compatibility.md) in the Introduction."},{"content":"Libraries","pos":[4388,4397]},{"pos":[4401,4496],"content":"Debug versions of <bpt id=\"p1\">[</bpt>C run-time libraries<ept id=\"p1\">](../../c-runtime-library/crt-library-features.md)</ept> only.","source":"Debug versions of [C run-time libraries](../../c-runtime-library/crt-library-features.md) only."},{"content":"Example","pos":[4505,4512]},{"content":"Output","pos":[7939,7945]},{"content":"See Also","pos":[8549,8557]},{"content":"Debug Routines","pos":[8562,8576]}],"content":"---\ntitle: \"_CrtSetReportHook2, _CrtSetReportHookW2 | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\napiname: \n  - \"_CrtSetReportHook2\"\n  - \"_CrtSetReportHookW2\"\napilocation: \n  - \"msvcrt.dll\"\n  - \"msvcr80.dll\"\n  - \"msvcr90.dll\"\n  - \"msvcr100.dll\"\n  - \"msvcr100_clr0400.dll\"\n  - \"msvcr110.dll\"\n  - \"msvcr110_clr0400.dll\"\n  - \"msvcr120.dll\"\n  - \"msvcr120_clr0400.dll\"\n  - \"ucrtbase.dll\"\napitype: \"DLLExport\"\nf1_keywords: \n  - \"CrtSetReportHookW2\"\n  - \"CrtSetReportHook2\"\n  - \"_CrtSetReportHookW2\"\n  - \"_CrtSetReportHook2\"\ndev_langs: \n  - \"C++\"\n  - \"C\"\nhelpviewer_keywords: \n  - \"CrtSetReportHook2 function\"\n  - \"_CrtSetReportHook2 function\"\n  - \"_CrtSetReportHookW2 function\"\n  - \"CrtSetReportHookW2 function\"\nms.assetid: 12e5f68d-c8a7-4b1a-9a75-72ba4a8592d0\ncaps.latest.revision: 14\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"ru-ru\"\n  - \"zh-cn\"\n  - \"zh-tw\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# _CrtSetReportHook2, _CrtSetReportHookW2\nInstalls or uninstalls a client-defined reporting function by hooking it into the C run-time debug reporting process (debug version only).  \n  \n## Syntax  \n  \n```  \n  \n      int _CrtSetReportHook2(  \n   int mode,  \n   _CRT_REPORT_HOOK pfnNewHook  \n);  \nint _CrtSetReportHookW2(  \n   int mode,  \n   _CRT_REPORT_HOOKW pfnNewHook  \n);  \n```  \n  \n#### Parameters  \n `mode`  \n The action to take: `_CRT_RPTHOOK_INSTALL` or `_CRT_RPTHOOK_REMOVE`.  \n  \n `pfnNewHook`  \n Report hook to install or remove in the narrow-character version of this function.  \n  \n `pfnNewHook`  \n Report hook to install or remove in the wide-character version of this function.  \n  \n## Return Value  \n -1 if an error was encountered, with `EINVAL` or `ENOMEM` set; otherwise returns the reference count of `pfnNewHook` after the call.  \n  \n## Remarks  \n `_CrtSetReportHook2` and `_CrtSetReportHookW2` let you hook or unhook a function, whereas [_CrtSetReportHook](../../c-runtime-library/reference/crtsetreporthook.md) only lets you hook a function.  \n  \n `_CrtSetReportHook2` or `_CrtSetReportHookW2` should be used instead of `_CrtSetReportHook` when the hook call is made in a DLL and when multiple DLLs might be loaded and setting their own hook functions. In such a situation, DLLs can be unloaded in a different order than they were loaded and the hook function can be left pointing at an unloaded DLL. Any debug output crashes the process if the hook functions were added with `_CrtSetReportHook`.  \n  \n Any hook functions added with `_CrtSetReportHook` are called if there are no hook functions added with `_CrtSetReportHook2` or `_CrtSetReportHookW2` or if all hook functions added with `_CrtSetReportHook2` and `_CrtSetReportHookW2` return `FALSE`.  \n  \n The wide-character version of this function is available. The report hook functions take a string whose type (wide or narrow characters) must match the version of this function used. Use the following function prototype for the report hooks used with the wide-character version of this function:  \n  \n```  \nint YourReportHook( int reportType, wchar_t *message, int *returnValue );  \n```  \n  \n Use the following prototype for the narrow-character report hooks:  \n  \n```  \nint YourReportHook( int reportType, char *message, int *returnValue );  \n```  \n  \n These functions validate their parameters. If `mode` or `pfnNewNook` is invalid, these functions invoke the invalid parameter handler, as described in [Parameter Validation](../../c-runtime-library/parameter-validation.md). If execution is allowed to continue, these functions set `errno` to `EINVAL` and return -1.  \n  \n> [!NOTE]\n>  If your application is compiled with `/clr` and the reporting function is called after the application has exited main, the CLR will throw an exception if the reporting function calls any CRT functions.  \n  \n## Requirements  \n  \n|Routine|Required header|Optional header|  \n|-------------|---------------------|---------------------|  \n|`_CrtSetReportHook2`|\\<crtdbg.h>|\\<errno.h>|  \n|`_CrtSetReportHookW2`|\\<crtdbg.h>|\\<errno.h>|  \n  \n For more compatibility information, see [Compatibility](../../c-runtime-library/compatibility.md) in the Introduction.  \n  \n## Libraries  \n Debug versions of [C run-time libraries](../../c-runtime-library/crt-library-features.md) only.  \n  \n## Example  \n  \n```  \n// crt_setreporthook2.c  \n#include <windows.h>  \n#include <stdio.h>  \n#include <crtdbg.h>  \n#include <assert.h>  \n  \nint __cdecl TestHook1(int nReportType, char* szMsg, int* pnRet)  \n{  \n   int nRet = FALSE;  \n  \n   printf(\"CRT report hook 1.\\n\");  \n   printf(\"CRT report type is \\\"\");  \n   switch (nReportType)  \n   {  \n      case _CRT_ASSERT:  \n      {  \n         printf(\"_CRT_ASSERT\");  \n         // nRet = TRUE;   // Always stop for this type of report  \n         break;  \n      }  \n  \n      case _CRT_WARN:  \n      {  \n         printf(\"_CRT_WARN\");  \n         break;  \n      }  \n  \n      case _CRT_ERROR:  \n      {  \n         printf(\"_CRT_ERROR\");  \n         break;  \n      }  \n  \n      default:  \n      {  \n         printf(\"???Unknown???\");  \n         break;  \n      }  \n   }  \n  \n   printf(\"\\\".\\nCRT report message is:\\n\\t\");  \n   printf(szMsg);  \n  \n   if   (pnRet)  \n      *pnRet = 0;  \n  \n   return   nRet;  \n}  \n  \nint __cdecl   TestHook2(int nReportType, char* szMsg, int* pnRet)  \n{  \n   int   nRet = FALSE;  \n  \n   printf(\"CRT report hook 2.\\n\");  \n   printf(\"CRT report type is \\\"\");  \n   switch   (nReportType)  \n   {  \n      case _CRT_WARN:  \n      {  \n         printf(\"_CRT_WARN\");  \n         break;  \n      }  \n  \n      case _CRT_ERROR:  \n      {  \n         printf(\"_CRT_ERROR\");  \n         break;  \n      }  \n  \n      case _CRT_ASSERT:  \n      {  \n         printf(\"_CRT_ASSERT\");  \n         nRet = TRUE;   // Always stop for this type of report  \n         break;  \n      }  \n  \n      default:  \n      {  \n         printf(\"???Unknown???\");  \n         break;  \n      }  \n   }  \n  \n   printf(\"\\\".\\nCRT report message is: \\t\");  \n   printf(szMsg);  \n  \n   if   (pnRet)  \n      *pnRet = 0;  \n   // printf(\"CRT report code is %d.\\n\", *pnRet);  \n   return   nRet;  \n}  \n  \nint   main(int argc, char* argv[])  \n{  \n   int   nRet = 0;  \n  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook1);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook1)\"  \n          \" returned %d\\n\", nRet);  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook2);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook2)\"  \n          \" returned %d\\n\", nRet);  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook2);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook2)\"  \n          \" returned %d\\n\", nRet);  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook1);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook1)\"  \n          \" returned %d\\n\", nRet);  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook1);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook1)\"  \n          \" returned %d\\n\", nRet);  \n  \n   _ASSERT(0);  \n  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2)\"  \n          \" returned %d\\n\", nRet);  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2)\"  \n          \" returned %d\\n\", nRet);  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2)\"  \n          \" returned %d\\n\", nRet);  \n   nRet = _CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook1);  \n   printf(\"_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook1)\"  \n          \" returned %d\\n\", nRet);  \n  \n   return   nRet;  \n}  \n```  \n  \n## Output  \n  \n```  \n_CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook1) returned 0  \n_CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook2) returned 0  \n_CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook2) returned 0  \n_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook1) returned 0  \n_CrtSetReportHook2(_CRT_RPTHOOK_INSTALL, TestHook1) returned 0  \n_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2) returned 0  \n_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2) returned 0  \n_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook2) returned 0  \n_CrtSetReportHook2(_CRT_RPTHOOK_REMOVE, TestHook1) returned 0  \n```  \n  \n## See Also  \n [Debug Routines](../../c-runtime-library/debug-routines.md)"}