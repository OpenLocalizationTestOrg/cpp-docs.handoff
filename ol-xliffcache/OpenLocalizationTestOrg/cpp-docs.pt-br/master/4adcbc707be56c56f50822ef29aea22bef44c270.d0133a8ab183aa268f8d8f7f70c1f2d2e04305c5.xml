{"nodes":[{"pos":[12,46],"content":"Help Menu Merging | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Help Menu Merging | Microsoft Docs","pos":[0,34]}]},{"content":"Help Menu Merging","pos":[638,655]},{"content":"When an object is active within a container, the menu merging protocol of OLE Documents gives the object complete control of the <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu.","pos":[656,799],"source":"When an object is active within a container, the menu merging protocol of OLE Documents gives the object complete control of the **Help** menu."},{"content":"As a result, the container's Help topics are not available unless the user deactivates the object.","pos":[800,898]},{"content":"The active document containment architecture expands on the rules for in-place menu merging to allow both the container and an active document that is active to share the menu.","pos":[899,1075]},{"content":"The new rules are simply additional conventions about what component owns what part of the menu and how the shared menu is constructed.","pos":[1076,1211]},{"content":"The new convention is simple.","pos":[1218,1247]},{"content":"In active documents, the <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu has two top-level menu items organized as follows:","pos":[1248,1337],"source":" In active documents, the **Help** menu has two top-level menu items organized as follows:"},{"pos":[1407,1519],"content":"For example, when a Word section is active in the Office Binder, then the <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu would appear as follows:","source":"For example, when a Word section is active in the Office Binder, then the **Help** menu would appear as follows:"},{"content":"Both menu items are cascading menus under which any additional menu items specific to the container and the object are provided to the user.","pos":[1583,1723]},{"content":"What items appear here will vary with the container and objects involved.","pos":[1724,1797]},{"content":"To construct this merged <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu, the active document containment architecture modifies the normal OLE Documents procedure.","pos":[1804,1933],"source":"To construct this merged **Help** menu, the active document containment architecture modifies the normal OLE Documents procedure."},{"content":"According to OLE Documents, the merged menu bar can have six groups of menus, namely <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Container<ept id=\"p3\">**</ept>, <ph id=\"ph1\">`Object`</ph>, <bpt id=\"p4\">**</bpt>Window<ept id=\"p4\">**</ept>, <bpt id=\"p5\">**</bpt>Help<ept id=\"p5\">**</ept>, in that order.","pos":[1934,2100],"source":" According to OLE Documents, the merged menu bar can have six groups of menus, namely **File**, **Edit**, **Container**, `Object`, **Window**, **Help**, in that order."},{"content":"In each group, there can be zero or more menus.","pos":[2101,2148]},{"content":"The groups <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Container<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Window<ept id=\"p3\">**</ept> belong to the container and the groups <bpt id=\"p4\">**</bpt>Edit<ept id=\"p4\">**</ept>, <bpt id=\"p5\">**</bpt>Object,<ept id=\"p5\">**</ept> and <bpt id=\"p6\">**</bpt>Help<ept id=\"p6\">**</ept> belong to the object.","pos":[2149,2295],"source":" The groups **File**, **Container**, and **Window** belong to the container and the groups **Edit**, **Object,** and **Help** belong to the object."},{"content":"When the object wants to do menu merging, it creates a blank menu bar and passes it to the container.","pos":[2296,2397]},{"content":"The container then inserts its menus, by calling <bpt id=\"p1\">**</bpt>IOleInPlaceFrame::InsertMenus<ept id=\"p1\">**</ept>.","pos":[2398,2481],"source":" The container then inserts its menus, by calling **IOleInPlaceFrame::InsertMenus**."},{"content":"The object also passes a structure that is an array of six LONG values (<bpt id=\"p1\">**</bpt>OLEMENUGROUPWIDTHS<ept id=\"p1\">**</ept>).","pos":[2482,2578],"source":" The object also passes a structure that is an array of six LONG values (**OLEMENUGROUPWIDTHS**)."},{"content":"After inserting the menus, the container marks how many menus it added in each one of its groups, and then returns.","pos":[2579,2694]},{"content":"Then the object inserts its menus, paying attention to the count of menus in each container group.","pos":[2695,2793]},{"content":"Finally, the object passes the merged menu bar and the array (which contains the count of menus in each group) to OLE, which returns an opaque \"menu descriptor\" handle.","pos":[2794,2962]},{"content":"Later the object passes that handle and the merged menu bar to the container, via <bpt id=\"p1\">**</bpt>IOleInPlaceFrame::SetMenu<ept id=\"p1\">**</ept>.","pos":[2963,3075],"source":" Later the object passes that handle and the merged menu bar to the container, via **IOleInPlaceFrame::SetMenu**."},{"content":"At this time, the container displays the merged menu bar and also passes the handle to OLE, so that OLE can do proper dispatching of menu messages.","pos":[3076,3223]},{"content":"In the modified active document procedure, the object must first initialize the <bpt id=\"p1\">**</bpt>OLEMENUGROUPWIDTHS<ept id=\"p1\">**</ept> elements to zero before passing it to the container.","pos":[3230,3385],"source":"In the modified active document procedure, the object must first initialize the **OLEMENUGROUPWIDTHS** elements to zero before passing it to the container."},{"content":"Then the container performs a normal menu insertion with one exception: The container inserts a <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu as the last item and stores a value of 1 in the last (sixth) entry of the <bpt id=\"p2\">**</bpt>OLEMENUGROUPWIDTHS<ept id=\"p2\">**</ept> array (that is, width[5], which belongs to the object's Help group).","pos":[3386,3661],"source":" Then the container performs a normal menu insertion with one exception: The container inserts a **Help** menu as the last item and stores a value of 1 in the last (sixth) entry of the **OLEMENUGROUPWIDTHS** array (that is, width[5], which belongs to the object's Help group)."},{"content":"This <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu will have only one item which is a submenu, the \"<bpt id=\"p2\">**</bpt>Container Help<ept id=\"p2\">**</ept> &gt;\" cascade menu as previously described.","pos":[3662,3789],"source":" This **Help** menu will have only one item which is a submenu, the \"**Container Help** >\" cascade menu as previously described."},{"content":"The object then executes its normal menu insertion code, except that before inserting its <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu, it checks the sixth entry of the <bpt id=\"p2\">**</bpt>OLEMENUGROUPWIDTHS<ept id=\"p2\">**</ept> array.","pos":[3796,3963],"source":"The object then executes its normal menu insertion code, except that before inserting its **Help** menu, it checks the sixth entry of the **OLEMENUGROUPWIDTHS** array."},{"content":"If the value is 1 and the name of the last menu is <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> (or the appropriate localized string), then the object inserts its <bpt id=\"p2\">**</bpt>Help<ept id=\"p2\">**</ept> menu as submenu of the container's <bpt id=\"p3\">**</bpt>Help<ept id=\"p3\">**</ept> menu.","pos":[3964,4149],"source":" If the value is 1 and the name of the last menu is **Help** (or the appropriate localized string), then the object inserts its **Help** menu as submenu of the container's **Help** menu."},{"content":"The object then sets the sixth element of <bpt id=\"p1\">**</bpt>OLEMENUGROUPWIDTHS<ept id=\"p1\">**</ept> to zero and increments the fifth element by one.","pos":[4156,4269],"source":"The object then sets the sixth element of **OLEMENUGROUPWIDTHS** to zero and increments the fifth element by one."},{"content":"This lets OLE know that the <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu belongs to the container and the menu messages corresponding to that menu (and its submenus) should be routed to the container.","pos":[4270,4439],"source":" This lets OLE know that the **Help** menu belongs to the container and the menu messages corresponding to that menu (and its submenus) should be routed to the container."},{"content":"It is then the container's responsibility to forward <ph id=\"ph1\">`WM_INITMENUPOPUP`</ph>, <bpt id=\"p1\">**</bpt>WM_SELECT<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>WM_COMMAND<ept id=\"p2\">**</ept>, and other menu-related messages that belong to the object's portion of the <bpt id=\"p3\">**</bpt>Help<ept id=\"p3\">**</ept> menu.","pos":[4440,4633],"source":" It is then the container's responsibility to forward `WM_INITMENUPOPUP`, **WM_SELECT**, **WM_COMMAND**, and other menu-related messages that belong to the object's portion of the **Help** menu."},{"content":"This is accomplished by using <ph id=\"ph1\">`WM_INITMENU`</ph> to clear a flag that tells the container whether the user has navigated into the object's <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu.","pos":[4634,4782],"source":" This is accomplished by using `WM_INITMENU` to clear a flag that tells the container whether the user has navigated into the object's **Help** menu."},{"content":"The container then watches <ph id=\"ph1\">`WM_MENUSELECT`</ph> for entry into or exit from any item on the <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu that the container did not add itself.","pos":[4783,4922],"source":" The container then watches `WM_MENUSELECT` for entry into or exit from any item on the **Help** menu that the container did not add itself."},{"content":"On entry, it means the user has navigated into an object menu, so the container sets the \"in object Help menu\" flag and uses the state of that flag to forward any <ph id=\"ph1\">`WM_MENUSELECT`</ph>, <ph id=\"ph2\">`WM_INITMENUPOPUP`</ph>, and <bpt id=\"p1\">**</bpt>WM_COMMAND<ept id=\"p1\">**</ept> messages, as a minimum, to the object window.","pos":[4923,5187],"source":" On entry, it means the user has navigated into an object menu, so the container sets the \"in object Help menu\" flag and uses the state of that flag to forward any `WM_MENUSELECT`, `WM_INITMENUPOPUP`, and **WM_COMMAND** messages, as a minimum, to the object window."},{"content":"(On exit, the container clears the flag and then processes these same messages itself.) The container should use the window returned from the object's <bpt id=\"p1\">**</bpt>IOleInPlaceActiveObejct::GetWindow<ept id=\"p1\">**</ept> function as the destination for these messages.","pos":[5188,5425],"source":" (On exit, the container clears the flag and then processes these same messages itself.) The container should use the window returned from the object's **IOleInPlaceActiveObejct::GetWindow** function as the destination for these messages."},{"content":"If the object detects a zero in the sixth element of <bpt id=\"p1\">**</bpt>OLEMENUGROUPWIDTHS<ept id=\"p1\">**</ept>, it proceeds according to the normal OLE Documents rules.","pos":[5432,5565],"source":"If the object detects a zero in the sixth element of **OLEMENUGROUPWIDTHS**, it proceeds according to the normal OLE Documents rules."},{"content":"This procedure covers containers that do participate in <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu merging as well as those that do not.","pos":[5566,5673],"source":" This procedure covers containers that do participate in **Help** menu merging as well as those that do not."},{"content":"When the object calls <bpt id=\"p1\">**</bpt>IOleInPlaceFrame::SetMenu<ept id=\"p1\">**</ept>, before displaying the merged menu bar, the container checks whether the <bpt id=\"p2\">**</bpt>Help<ept id=\"p2\">**</ept> menu has an additional submenu, in addition to what the container has inserted.","pos":[5680,5893],"source":"When the object calls **IOleInPlaceFrame::SetMenu**, before displaying the merged menu bar, the container checks whether the **Help** menu has an additional submenu, in addition to what the container has inserted."},{"content":"If so, the container leaves its <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu in the merged menu bar.","pos":[5894,5963],"source":" If so, the container leaves its **Help** menu in the merged menu bar."},{"content":"If the <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu does not have an additional submenu, the container will remove its <bpt id=\"p2\">**</bpt>Help<ept id=\"p2\">**</ept> menu from the merged menu bar.","pos":[5964,6091],"source":" If the **Help** menu does not have an additional submenu, the container will remove its **Help** menu from the merged menu bar."},{"content":"This procedure covers objects that participate in <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu merging as well as those that do not.","pos":[6092,6193],"source":" This procedure covers objects that participate in **Help** menu merging as well as those that do not."},{"content":"Finally, when it is time to disassemble the menu, the object removes the inserted <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu in addition to removing the other inserted menus.","pos":[6200,6345],"source":"Finally, when it is time to disassemble the menu, the object removes the inserted **Help** menu in addition to removing the other inserted menus."},{"content":"When the container removes its menus, it will remove its <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> menu in addition to the other menus that it has inserted.","pos":[6346,6469],"source":" When the container removes its menus, it will remove its **Help** menu in addition to the other menus that it has inserted."},{"content":"See Also","pos":[6478,6486]},{"content":"Active Document Containers","pos":[6491,6517]}],"content":"---\ntitle: \"Help Menu Merging | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"menus, merging\"\n  - \"merging Help menus\"\n  - \"Help, for active document containers\"\nms.assetid: 9d615999-79ba-471a-9288-718f0c903d49\ncaps.latest.revision: 11\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Help Menu Merging\nWhen an object is active within a container, the menu merging protocol of OLE Documents gives the object complete control of the **Help** menu. As a result, the container's Help topics are not available unless the user deactivates the object. The active document containment architecture expands on the rules for in-place menu merging to allow both the container and an active document that is active to share the menu. The new rules are simply additional conventions about what component owns what part of the menu and how the shared menu is constructed.  \n  \n The new convention is simple. In active documents, the **Help** menu has two top-level menu items organized as follows:  \n  \n `Help`  \n  \n `Container Help >`  \n  \n `Object Help    >`  \n  \n For example, when a Word section is active in the Office Binder, then the **Help** menu would appear as follows:  \n  \n `Help`  \n  \n `Binder Help >`  \n  \n `Word Help   >`  \n  \n Both menu items are cascading menus under which any additional menu items specific to the container and the object are provided to the user. What items appear here will vary with the container and objects involved.  \n  \n To construct this merged **Help** menu, the active document containment architecture modifies the normal OLE Documents procedure. According to OLE Documents, the merged menu bar can have six groups of menus, namely **File**, **Edit**, **Container**, `Object`, **Window**, **Help**, in that order. In each group, there can be zero or more menus. The groups **File**, **Container**, and **Window** belong to the container and the groups **Edit**, **Object,** and **Help** belong to the object. When the object wants to do menu merging, it creates a blank menu bar and passes it to the container. The container then inserts its menus, by calling **IOleInPlaceFrame::InsertMenus**. The object also passes a structure that is an array of six LONG values (**OLEMENUGROUPWIDTHS**). After inserting the menus, the container marks how many menus it added in each one of its groups, and then returns. Then the object inserts its menus, paying attention to the count of menus in each container group. Finally, the object passes the merged menu bar and the array (which contains the count of menus in each group) to OLE, which returns an opaque \"menu descriptor\" handle. Later the object passes that handle and the merged menu bar to the container, via **IOleInPlaceFrame::SetMenu**. At this time, the container displays the merged menu bar and also passes the handle to OLE, so that OLE can do proper dispatching of menu messages.  \n  \n In the modified active document procedure, the object must first initialize the **OLEMENUGROUPWIDTHS** elements to zero before passing it to the container. Then the container performs a normal menu insertion with one exception: The container inserts a **Help** menu as the last item and stores a value of 1 in the last (sixth) entry of the **OLEMENUGROUPWIDTHS** array (that is, width[5], which belongs to the object's Help group). This **Help** menu will have only one item which is a submenu, the \"**Container Help** >\" cascade menu as previously described.  \n  \n The object then executes its normal menu insertion code, except that before inserting its **Help** menu, it checks the sixth entry of the **OLEMENUGROUPWIDTHS** array. If the value is 1 and the name of the last menu is **Help** (or the appropriate localized string), then the object inserts its **Help** menu as submenu of the container's **Help** menu.  \n  \n The object then sets the sixth element of **OLEMENUGROUPWIDTHS** to zero and increments the fifth element by one. This lets OLE know that the **Help** menu belongs to the container and the menu messages corresponding to that menu (and its submenus) should be routed to the container. It is then the container's responsibility to forward `WM_INITMENUPOPUP`, **WM_SELECT**, **WM_COMMAND**, and other menu-related messages that belong to the object's portion of the **Help** menu. This is accomplished by using `WM_INITMENU` to clear a flag that tells the container whether the user has navigated into the object's **Help** menu. The container then watches `WM_MENUSELECT` for entry into or exit from any item on the **Help** menu that the container did not add itself. On entry, it means the user has navigated into an object menu, so the container sets the \"in object Help menu\" flag and uses the state of that flag to forward any `WM_MENUSELECT`, `WM_INITMENUPOPUP`, and **WM_COMMAND** messages, as a minimum, to the object window. (On exit, the container clears the flag and then processes these same messages itself.) The container should use the window returned from the object's **IOleInPlaceActiveObejct::GetWindow** function as the destination for these messages.  \n  \n If the object detects a zero in the sixth element of **OLEMENUGROUPWIDTHS**, it proceeds according to the normal OLE Documents rules. This procedure covers containers that do participate in **Help** menu merging as well as those that do not.  \n  \n When the object calls **IOleInPlaceFrame::SetMenu**, before displaying the merged menu bar, the container checks whether the **Help** menu has an additional submenu, in addition to what the container has inserted. If so, the container leaves its **Help** menu in the merged menu bar. If the **Help** menu does not have an additional submenu, the container will remove its **Help** menu from the merged menu bar. This procedure covers objects that participate in **Help** menu merging as well as those that do not.  \n  \n Finally, when it is time to disassemble the menu, the object removes the inserted **Help** menu in addition to removing the other inserted menus. When the container removes its menus, it will remove its **Help** menu in addition to the other menus that it has inserted.  \n  \n## See Also  \n [Active Document Containers](../mfc/active-document-containers.md)\n\n"}