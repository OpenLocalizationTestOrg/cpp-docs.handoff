{"nodes":[{"pos":[12,80],"content":"MFC ActiveX Controls: Distributing ActiveX Controls | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"MFC ActiveX Controls: Distributing ActiveX Controls | Microsoft Docs","pos":[0,68]}]},{"content":"MFC ActiveX Controls: Distributing ActiveX Controls","pos":[1312,1363]},{"content":"This article discusses several issues related to redistributing ActiveX controls:","pos":[1364,1445]},{"content":"ANSI or Unicode Control Versions","pos":[1456,1488]},{"content":"Installing ActiveX Controls and Redistributable DLLs","pos":[1541,1593]},{"content":"Registering Controls","pos":[1666,1686]},{"pos":[1728,1880],"content":"[!NOTE]\n For additional information on redistributing ActiveX controls, see [Redistributing Controls](../data/ado-rdo/redistributing-controls.md).","leadings":["","    > "],"nodes":[{"content":"For additional information on redistributing ActiveX controls, see <bpt id=\"p1\">[</bpt>Redistributing Controls<ept id=\"p1\">](../data/ado-rdo/redistributing-controls.md)</ept>.","pos":[9,146],"source":" For additional information on redistributing ActiveX controls, see [Redistributing Controls](../data/ado-rdo/redistributing-controls.md)."}]},{"pos":[1944,1976],"content":"ANSI or Unicode Control Versions"},{"content":"You must decide whether to ship an ANSI or Unicode version of the control, or both.","pos":[1980,2063]},{"content":"This decision is based on portability factors inherent in ANSI and Unicode character sets.","pos":[2064,2154]},{"content":"ANSI controls, which work on all Win32 operating systems, allow for maximum portability between the various Win32 operating systems.","pos":[2161,2293]},{"content":"Unicode controls work on only Windows NT (version 3.51 or later), but not on Windows 95 or Windows 98.","pos":[2294,2396]},{"content":"If portability is your primary concern, ship ANSI controls.","pos":[2397,2456]},{"content":"If your controls will run only on Windows NT, you can ship Unicode controls.","pos":[2457,2533]},{"content":"You could also choose to ship both and have your application install the version most appropriate for the user's operating system.","pos":[2534,2664]},{"pos":[2748,2800],"content":"Installing ActiveX Controls and Redistributable DLLs"},{"content":"The setup program you provide with your ActiveX controls should create a special subdirectory of the Windows directory and install the controls' .OCX files in it.","pos":[2804,2966]},{"pos":[2974,3182],"content":"[!NOTE]\n Use the Windows **GetWindowsDirectory** API in your setup program to obtain the name of the Windows directory. You may want to derive the subdirectory name from the name of your company or product.","leadings":["","> "],"nodes":[{"content":" Use the Windows **GetWindowsDirectory** API in your setup program to obtain the name of the Windows directory. You may want to derive the subdirectory name from the name of your company or product.","pos":[8,206],"nodes":[{"content":"Use the Windows <bpt id=\"p1\">**</bpt>GetWindowsDirectory<ept id=\"p1\">**</ept> API in your setup program to obtain the name of the Windows directory.","pos":[1,111],"source":" Use the Windows **GetWindowsDirectory** API in your setup program to obtain the name of the Windows directory."},{"content":"You may want to derive the subdirectory name from the name of your company or product.","pos":[112,198]}]}]},{"content":"The setup program must install the necessary redistributable DLL files in the Windows system directory.","pos":[3189,3292]},{"content":"If any of the DLLs are already present on the user's machine, the setup program should compare their versions with the versions you are installing.","pos":[3293,3440]},{"content":"Reinstall a file only if its version number is higher than the file already installed.","pos":[3441,3527]},{"content":"Because ActiveX controls can be used only in OLE container applications, there is no need to distribute the full set of OLE DLLs with your controls.","pos":[3534,3682]},{"content":"You can assume that the containing application (or the operating system itself) has the standard OLE DLLs installed.","pos":[3683,3799]},{"pos":[3851,3871],"content":"Registering Controls"},{"content":"Before a control can be used, appropriate entries must be created for it in the Windows registration database.","pos":[3875,3985]},{"content":"Some ActiveX control containers provide a menu item for users to register new controls, but this feature may not be available in all containers.","pos":[3986,4130]},{"content":"Therefore, you may want your setup program to register the controls when they are installed.","pos":[4131,4223]},{"content":"If you prefer, you can write your setup program to register the control directly instead.","pos":[4230,4319]},{"content":"Use the <bpt id=\"p1\">**</bpt>LoadLibrary<ept id=\"p1\">**</ept> Windows API to load the control DLL.","pos":[4326,4386],"source":"Use the **LoadLibrary** Windows API to load the control DLL."},{"content":"Next, use <bpt id=\"p1\">**</bpt>GetProcAddress<ept id=\"p1\">**</ept> to obtain the address of the \"DllRegisterServer\" function.","pos":[4387,4474],"source":" Next, use **GetProcAddress** to obtain the address of the \"DllRegisterServer\" function."},{"content":"Finally, call the <ph id=\"ph1\">`DllRegisterServer`</ph> function.","pos":[4475,4522],"source":" Finally, call the `DllRegisterServer` function."},{"content":"The following code sample demonstrates one possible method, where <ph id=\"ph1\">`hLib`</ph> stores the handle of the control library, and <ph id=\"ph2\">`lpDllEntryPoint`</ph> stores the address of the \"DllRegisterServer\" function.","pos":[4523,4715],"source":" The following code sample demonstrates one possible method, where `hLib` stores the handle of the control library, and `lpDllEntryPoint` stores the address of the \"DllRegisterServer\" function."},{"pos":[4733,4750],"content":"NVC_MFC_AxCont#16"},{"content":"The advantage of registering the control directly is that you do not need to invoke and load a separate process (namely, REGSVR32), reducing installation time.","pos":[4840,4999]},{"content":"In addition, because registration is an internal process, the setup program can handle errors and unforeseen situations better than an external process can.","pos":[5000,5156]},{"pos":[5164,5422],"content":"[!NOTE]\n Before your setup program installs an ActiveX control, it should call **OleInitialize**. When your setup program is finished, call **OleUnitialize**. This ensures that the OLE system DLLs are in the proper state for registering an ActiveX control.","leadings":["","> "],"nodes":[{"content":" Before your setup program installs an ActiveX control, it should call **OleInitialize**. When your setup program is finished, call **OleUnitialize**. This ensures that the OLE system DLLs are in the proper state for registering an ActiveX control.","pos":[8,256],"nodes":[{"content":"Before your setup program installs an ActiveX control, it should call <bpt id=\"p1\">**</bpt>OleInitialize<ept id=\"p1\">**</ept>.","pos":[1,89],"source":" Before your setup program installs an ActiveX control, it should call **OleInitialize**."},{"content":"When your setup program is finished, call <bpt id=\"p1\">**</bpt>OleUnitialize<ept id=\"p1\">**</ept>.","pos":[90,150],"source":" When your setup program is finished, call **OleUnitialize**."},{"content":"This ensures that the OLE system DLLs are in the proper state for registering an ActiveX control.","pos":[151,248]}]}]},{"content":"You should register MFCx0.DLL.","pos":[5429,5459]},{"content":"See Also","pos":[5468,5476]},{"content":"MFC ActiveX Controls","pos":[5481,5501]}],"content":"---\ntitle: \"MFC ActiveX Controls: Distributing ActiveX Controls | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"GetWindowsDirectory\"\n  - \"GetSystemDirectory\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MFC ActiveX controls, ANSI or Unicode versions\"\n  - \"RegSvr32.exe\"\n  - \"MFC ActiveX controls, distributing\"\n  - \"distributing MFC ActiveX controls\"\n  - \"redistributable files, MFC ActiveX controls\"\n  - \"GetSystemDirectory method\"\n  - \"registering ActiveX controls\"\n  - \"MSVCRT40.dll\"\n  - \"registry, registering controls\"\n  - \"LoadLibrary method, registering ActiveX controls\"\n  - \"MFC40U.DLL\"\n  - \"MFC40.DLL\"\n  - \"GetWindowsDirectory method\"\n  - \"installing ActiveX controls\"\n  - \"GetProcAddress method, registering ActiveX controls\"\n  - \"MFC ActiveX controls, installing\"\n  - \"MFC ActiveX controls, registering\"\n  - \"registering controls\"\n  - \"OLEPRO32.DLL\"\nms.assetid: cd70ac9b-f613-4879-9e81-6381fdfda2a1\ncaps.latest.revision: 11\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# MFC ActiveX Controls: Distributing ActiveX Controls\nThis article discusses several issues related to redistributing ActiveX controls:  \n  \n-   [ANSI or Unicode Control Versions](#_core_ansi_or_unicode_control_versions)  \n  \n-   [Installing ActiveX Controls and Redistributable DLLs](#_core_installing_activex_controls_and_redistributable_dlls)  \n  \n-   [Registering Controls](#_core_registering_controls)  \n  \n    > [!NOTE]\n    >  For additional information on redistributing ActiveX controls, see [Redistributing Controls](../data/ado-rdo/redistributing-controls.md).  \n  \n##  <a name=\"_core_ansi_or_unicode_control_versions\"></a> ANSI or Unicode Control Versions  \n You must decide whether to ship an ANSI or Unicode version of the control, or both. This decision is based on portability factors inherent in ANSI and Unicode character sets.  \n  \n ANSI controls, which work on all Win32 operating systems, allow for maximum portability between the various Win32 operating systems. Unicode controls work on only Windows NT (version 3.51 or later), but not on Windows 95 or Windows 98. If portability is your primary concern, ship ANSI controls. If your controls will run only on Windows NT, you can ship Unicode controls. You could also choose to ship both and have your application install the version most appropriate for the user's operating system.  \n  \n##  <a name=\"_core_installing_activex_controls_and_redistributable_dlls\"></a> Installing ActiveX Controls and Redistributable DLLs  \n The setup program you provide with your ActiveX controls should create a special subdirectory of the Windows directory and install the controls' .OCX files in it.  \n  \n> [!NOTE]\n>  Use the Windows **GetWindowsDirectory** API in your setup program to obtain the name of the Windows directory. You may want to derive the subdirectory name from the name of your company or product.  \n  \n The setup program must install the necessary redistributable DLL files in the Windows system directory. If any of the DLLs are already present on the user's machine, the setup program should compare their versions with the versions you are installing. Reinstall a file only if its version number is higher than the file already installed.  \n  \n Because ActiveX controls can be used only in OLE container applications, there is no need to distribute the full set of OLE DLLs with your controls. You can assume that the containing application (or the operating system itself) has the standard OLE DLLs installed.  \n  \n##  <a name=\"_core_registering_controls\"></a> Registering Controls  \n Before a control can be used, appropriate entries must be created for it in the Windows registration database. Some ActiveX control containers provide a menu item for users to register new controls, but this feature may not be available in all containers. Therefore, you may want your setup program to register the controls when they are installed.  \n  \n If you prefer, you can write your setup program to register the control directly instead.  \n  \n Use the **LoadLibrary** Windows API to load the control DLL. Next, use **GetProcAddress** to obtain the address of the \"DllRegisterServer\" function. Finally, call the `DllRegisterServer` function. The following code sample demonstrates one possible method, where `hLib` stores the handle of the control library, and `lpDllEntryPoint` stores the address of the \"DllRegisterServer\" function.  \n  \n [!code-cpp[NVC_MFC_AxCont#16](../mfc/codesnippet/cpp/mfc-activex-controls-distributing-activex-controls_1.cpp)]  \n  \n The advantage of registering the control directly is that you do not need to invoke and load a separate process (namely, REGSVR32), reducing installation time. In addition, because registration is an internal process, the setup program can handle errors and unforeseen situations better than an external process can.  \n  \n> [!NOTE]\n>  Before your setup program installs an ActiveX control, it should call **OleInitialize**. When your setup program is finished, call **OleUnitialize**. This ensures that the OLE system DLLs are in the proper state for registering an ActiveX control.  \n  \n You should register MFCx0.DLL.  \n  \n## See Also  \n [MFC ActiveX Controls](../mfc/mfc-activex-controls.md)\n\n"}