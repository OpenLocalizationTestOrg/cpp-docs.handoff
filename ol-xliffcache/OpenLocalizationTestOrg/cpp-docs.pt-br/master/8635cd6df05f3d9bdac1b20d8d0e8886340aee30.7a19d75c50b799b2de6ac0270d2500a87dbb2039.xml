{"nodes":[{"pos":[12,66],"content":"Example: Implementing a Property Page | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Example: Implementing a Property Page | Microsoft Docs","pos":[0,54]}]},{"content":"Example: Implementing a Property Page","pos":[604,641]},{"content":"This example shows how to build a property page that displays (and allows you to change) properties of the <bpt id=\"p1\">[</bpt>Document Classes<ept id=\"p1\">](../mfc/document-classes.md)</ept> interface.","pos":[642,806],"source":"This example shows how to build a property page that displays (and allows you to change) properties of the [Document Classes](../mfc/document-classes.md) interface."},{"content":"This interface is exposed by documents in Visual Studio's <bpt id=\"p1\">[</bpt>Common Environment Object Model Examples<ept id=\"p1\">](http://msdn.microsoft.com/library/919cdb58-9f6d-45e6-a0f1-9ca8f6e7051f)</ept> (although the property page that you'll create won't care where the objects it manipulates come from as long as they support the correct interface).","pos":[807,1128],"source":" This interface is exposed by documents in Visual Studio's [Common Environment Object Model Examples](http://msdn.microsoft.com/library/919cdb58-9f6d-45e6-a0f1-9ca8f6e7051f) (although the property page that you'll create won't care where the objects it manipulates come from as long as they support the correct interface)."},{"pos":[1135,1207],"content":"The example is based on the <bpt id=\"p1\">[</bpt>ATLPages sample<ept id=\"p1\">](../visual-cpp-samples.md)</ept>.","source":"The example is based on the [ATLPages sample](../visual-cpp-samples.md)."},{"content":"To complete this example, you will:","pos":[1214,1249]},{"pos":[1257,1390],"content":"<bpt id=\"p1\">[</bpt>Add the ATL property page class<ept id=\"p1\">](#vcconusing_the_atl_object_wizard)</ept> using the Add Class dialog box and the ATL Property Page Wizard.","source":"[Add the ATL property page class](#vcconusing_the_atl_object_wizard) using the Add Class dialog box and the ATL Property Page Wizard."},{"pos":[1398,1544],"content":"<bpt id=\"p1\">[</bpt>Edit the dialog resource<ept id=\"p1\">](#vcconediting_the_dialog_resource)</ept> by adding new controls for the interesting properties of the <bpt id=\"p2\">**</bpt>Document<ept id=\"p2\">**</ept> interface.","source":"[Edit the dialog resource](#vcconediting_the_dialog_resource) by adding new controls for the interesting properties of the **Document** interface."},{"pos":[1552,1674],"content":"<bpt id=\"p1\">[</bpt>Add message handlers<ept id=\"p1\">](#vcconadding_message_handlers)</ept> to keep the property page site informed of changes made by the user.","source":"[Add message handlers](#vcconadding_message_handlers) to keep the property page site informed of changes made by the user."},{"pos":[1684,1778],"content":"Add some <ph id=\"ph1\">`#import`</ph> statements and a typedef in the <bpt id=\"p1\">[</bpt>Housekeeping<ept id=\"p1\">](#vcconhousekeeping)</ept> section.","source":"Add some `#import` statements and a typedef in the [Housekeeping](#vcconhousekeeping) section."},{"pos":[1786,1932],"content":"<bpt id=\"p1\">[</bpt>Override IPropertyPageImpl::SetObjects<ept id=\"p1\">](#vcconoverriding_ipropertypageimpl_setobjects)</ept> to validate the objects being passed to the property page.","source":"[Override IPropertyPageImpl::SetObjects](#vcconoverriding_ipropertypageimpl_setobjects) to validate the objects being passed to the property page."},{"pos":[1940,2068],"content":"<bpt id=\"p1\">[</bpt>Override IPropertyPageImpl::Activate<ept id=\"p1\">](#vcconoverriding_ipropertypageimpl_activate)</ept> to initialize the property page's interface.","source":"[Override IPropertyPageImpl::Activate](#vcconoverriding_ipropertypageimpl_activate) to initialize the property page's interface."},{"pos":[2076,2205],"content":"<bpt id=\"p1\">[</bpt>Override IPropertyPageImpl::Apply<ept id=\"p1\">](#vcconoverride_ipropertypageimpl_apply)</ept> to update the object with the latest property values.","source":"[Override IPropertyPageImpl::Apply](#vcconoverride_ipropertypageimpl_apply) to update the object with the latest property values."},{"pos":[2213,2309],"content":"<bpt id=\"p1\">[</bpt>Display the property page<ept id=\"p1\">](#vccontesting_the_property_page)</ept> by creating a simple helper object.","source":"[Display the property page](#vccontesting_the_property_page) by creating a simple helper object."},{"pos":[2317,2391],"content":"<bpt id=\"p1\">[</bpt>Create a macro<ept id=\"p1\">](#vcconcreating_a_macro)</ept> that will test the property page.","source":"[Create a macro](#vcconcreating_a_macro) that will test the property page."},{"pos":[2449,2483],"content":"Adding the ATL Property Page Class"},{"content":"First, create a new ATL project for a DLL server called <ph id=\"ph1\">`ATLPages7`</ph>.","pos":[2487,2555],"source":"First, create a new ATL project for a DLL server called `ATLPages7`."},{"content":"Now use the <bpt id=\"p1\">[</bpt>ATL Property Page Wizard<ept id=\"p1\">](../atl/reference/atl-property-page-wizard.md)</ept> to generate a property page.","pos":[2556,2669],"source":" Now use the [ATL Property Page Wizard](../atl/reference/atl-property-page-wizard.md) to generate a property page."},{"content":"Give the property page a <bpt id=\"p1\">**</bpt>Short Name<ept id=\"p1\">**</ept> of <bpt id=\"p2\">**</bpt>DocProperties<ept id=\"p2\">**</ept> then switch to the <bpt id=\"p3\">**</bpt>Strings<ept id=\"p3\">**</ept> page to set property-page-specific items as shown in the table below.","pos":[2670,2831],"source":" Give the property page a **Short Name** of **DocProperties** then switch to the **Strings** page to set property-page-specific items as shown in the table below."},{"content":"Item","pos":[2838,2842]},{"content":"Value","pos":[2843,2848]},{"content":"Title","pos":[2880,2885]},{"content":"TextDocument","pos":[2886,2898]},{"content":"Doc String","pos":[2903,2913]},{"content":"VCUE TextDocument Properties","pos":[2914,2942]},{"content":"Helpfile","pos":[2947,2955]},{"content":"blank&gt;","pos":[2959,2965],"source":"blank>"},{"content":"The values that you set on this page of the wizard will be returned to the property page container when it calls <bpt id=\"p1\">**</bpt>IPropertyPage::GetPageInfo<ept id=\"p1\">**</ept>.","pos":[2974,3118],"source":"The values that you set on this page of the wizard will be returned to the property page container when it calls **IPropertyPage::GetPageInfo**."},{"content":"What happens to the strings after that is dependent on the container, but typically they will be used to identify your page to the user.","pos":[3119,3255]},{"content":"The Title will usually appear in a tab above your page and the Doc String may be displayed in a status bar or ToolTip (although the standard property frame doesn't use this string at all).","pos":[3256,3444]},{"pos":[3452,3702],"content":"[!NOTE]\n The strings that you set here are stored as string resources in your project by the wizard. You can easily edit these strings using the resource editor if you need to change this information after the code for your page has been generated.","leadings":["","> "],"nodes":[{"content":" The strings that you set here are stored as string resources in your project by the wizard. You can easily edit these strings using the resource editor if you need to change this information after the code for your page has been generated.","pos":[8,248],"nodes":[{"content":"The strings that you set here are stored as string resources in your project by the wizard.","pos":[1,92]},{"content":"You can easily edit these strings using the resource editor if you need to change this information after the code for your page has been generated.","pos":[93,240]}]}]},{"pos":[3709,3769],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to have the wizard generate your property page.","source":"Click **OK** to have the wizard generate your property page."},{"pos":[3827,3854],"content":"Editing the Dialog Resource"},{"content":"Now that your property page has been generated, you'll need to add a few controls to the dialog resource representing your page.","pos":[3858,3986]},{"content":"Add an edit box, a static text control, and a check box and set their IDs as shown below:","pos":[3987,4076]},{"content":"Editing a dialog resource","pos":[4085,4110]},{"content":"These controls will be used to display the file name of the document and its read-only status.","pos":[4176,4270]},{"pos":[4278,4590],"content":"[!NOTE]\n The dialog resource does not include a frame or command buttons, nor does it have the tabbed look that you might have expected. These features are provided by a property page frame such as the one created by calling [OleCreatePropertyFrame](http://msdn.microsoft.com/library/windows/desktop/ms678437).","leadings":["","> "],"nodes":[{"content":" The dialog resource does not include a frame or command buttons, nor does it have the tabbed look that you might have expected. These features are provided by a property page frame such as the one created by calling [OleCreatePropertyFrame](http://msdn.microsoft.com/library/windows/desktop/ms678437).","pos":[8,310],"nodes":[{"content":"The dialog resource does not include a frame or command buttons, nor does it have the tabbed look that you might have expected.","pos":[1,128]},{"content":"These features are provided by a property page frame such as the one created by calling <bpt id=\"p1\">[</bpt>OleCreatePropertyFrame<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms678437)</ept>.","pos":[129,302],"source":" These features are provided by a property page frame such as the one created by calling [OleCreatePropertyFrame](http://msdn.microsoft.com/library/windows/desktop/ms678437)."}]}]},{"pos":[4644,4667],"content":"Adding Message Handlers"},{"content":"With the controls in place, you can add message handlers to update the dirty status of the page when the value of either of the controls changes:","pos":[4671,4816]},{"pos":[4834,4854],"content":"NVC_ATL_Windowing#73"},{"content":"This code responds to changes made to the edit control or check box by calling <bpt id=\"p1\">[</bpt>IPropertyPageImpl::SetDirty<ept id=\"p1\">](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__setdirty)</ept>, which informs the page site that the page has changed.","pos":[4928,5165],"source":"This code responds to changes made to the edit control or check box by calling [IPropertyPageImpl::SetDirty](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__setdirty), which informs the page site that the page has changed."},{"content":"Typically the page site will respond by enabling or disabling an <bpt id=\"p1\">**</bpt>Apply<ept id=\"p1\">**</ept> button on the property page frame.","pos":[5166,5275],"source":" Typically the page site will respond by enabling or disabling an **Apply** button on the property page frame."},{"pos":[5283,5654],"content":"[!NOTE]\n In your own property pages, you might need to keep track of precisely which properties have been altered by the user so that you can avoid updating properties that haven't been changed. This example implements that code by keeping track of the original property values and comparing them with the current values from the UI when it's time to apply the changes.","leadings":["","> "],"nodes":[{"content":" In your own property pages, you might need to keep track of precisely which properties have been altered by the user so that you can avoid updating properties that haven't been changed. This example implements that code by keeping track of the original property values and comparing them with the current values from the UI when it's time to apply the changes.","pos":[8,369],"nodes":[{"content":"In your own property pages, you might need to keep track of precisely which properties have been altered by the user so that you can avoid updating properties that haven't been changed.","pos":[1,186]},{"content":"This example implements that code by keeping track of the original property values and comparing them with the current values from the UI when it's time to apply the changes.","pos":[187,361]}]}]},{"pos":[5697,5709],"content":"Housekeeping"},{"pos":[5713,5833],"content":"Now add a couple of <ph id=\"ph1\">`#import`</ph> statements to DocProperties.h so that the compiler knows about the <bpt id=\"p1\">**</bpt>Document<ept id=\"p1\">**</ept> interface:","source":"Now add a couple of `#import` statements to DocProperties.h so that the compiler knows about the **Document** interface:"},{"pos":[5851,5871],"content":"NVC_ATL_Windowing#74"},{"pos":[5945,6070],"content":"You'll also need to refer to the <ph id=\"ph1\">`IPropertyPageImpl`</ph> base class; add the following <ph id=\"ph2\">`typedef`</ph> to the <bpt id=\"p1\">**</bpt>CDocProperties<ept id=\"p1\">**</ept> class:","source":"You'll also need to refer to the `IPropertyPageImpl` base class; add the following `typedef` to the **CDocProperties** class:"},{"pos":[6088,6108],"content":"NVC_ATL_Windowing#75"},{"pos":[6245,6285],"content":"Overriding IPropertyPageImpl::SetObjects"},{"content":"The first <ph id=\"ph1\">`IPropertyPageImpl`</ph> method that you need to override is <bpt id=\"p1\">[</bpt>SetObjects<ept id=\"p1\">](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__setobjects)</ept>.","pos":[6289,6443],"source":"The first `IPropertyPageImpl` method that you need to override is [SetObjects](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__setobjects)."},{"content":"Here you'll add code to check that only a single object has been passed and that it supports the <bpt id=\"p1\">**</bpt>Document<ept id=\"p1\">**</ept> interface that you're expecting:","pos":[6444,6586],"source":" Here you'll add code to check that only a single object has been passed and that it supports the **Document** interface that you're expecting:"},{"pos":[6604,6624],"content":"NVC_ATL_Windowing#76"},{"pos":[6699,6884],"content":"[!NOTE]\n It makes sense to support only a single object for this page because you will allow the user to set the file name of the object — only one file can exist at any one location.","leadings":["","> "],"nodes":[{"content":"It makes sense to support only a single object for this page because you will allow the user to set the file name of the object — only one file can exist at any one location.","pos":[9,183]}]},{"pos":[6952,6990],"content":"Overriding IPropertyPageImpl::Activate"},{"content":"The next step is to initialize the property page with the property values of the underlying object when the page is first created.","pos":[6994,7124]},{"content":"In this case you should add the following members to the class since you'll also use the initial property values for comparison when users of the page apply their changes:","pos":[7131,7302]},{"pos":[7320,7340],"content":"NVC_ATL_Windowing#77"},{"pos":[7414,7696],"content":"The base class implementation of the <bpt id=\"p1\">[</bpt>Activate<ept id=\"p1\">](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__activate)</ept> method is responsible for creating the dialog box and its controls, so you can override this method and add your own initialization after calling the base class:","source":"The base class implementation of the [Activate](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__activate) method is responsible for creating the dialog box and its controls, so you can override this method and add your own initialization after calling the base class:"},{"pos":[7714,7734],"content":"NVC_ATL_Windowing#78"},{"content":"This code uses the COM methods of the <bpt id=\"p1\">**</bpt>Document<ept id=\"p1\">**</ept> interface to get the properties that you're interested in.","pos":[7808,7917],"source":"This code uses the COM methods of the **Document** interface to get the properties that you're interested in."},{"content":"It then uses the Win32 API wrappers provided by <bpt id=\"p1\">[</bpt>CDialogImpl<ept id=\"p1\">](../atl/reference/cdialogimpl-class.md)</ept> and its base classes to display the property values to the user.","pos":[7918,8083],"source":" It then uses the Win32 API wrappers provided by [CDialogImpl](../atl/reference/cdialogimpl-class.md) and its base classes to display the property values to the user."},{"pos":[8146,8181],"content":"Overriding IPropertyPageImpl::Apply"},{"content":"When users want to apply their changes to the objects, the property page site will call the <bpt id=\"p1\">[</bpt>Apply<ept id=\"p1\">](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__apply)</ept> method.","pos":[8185,8362],"source":"When users want to apply their changes to the objects, the property page site will call the [Apply](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__apply) method."},{"content":"This is the place to do the reverse of the code in <bpt id=\"p1\">**</bpt>Activate<ept id=\"p1\">**</ept> — whereas <bpt id=\"p2\">**</bpt>Activate<ept id=\"p2\">**</ept> took values from the object and pushed them into the controls on the property page, <bpt id=\"p3\">**</bpt>Apply<ept id=\"p3\">**</ept> takes values from the controls on the property page and pushes them into the object.","pos":[8363,8628],"source":" This is the place to do the reverse of the code in **Activate** — whereas **Activate** took values from the object and pushed them into the controls on the property page, **Apply** takes values from the controls on the property page and pushes them into the object."},{"pos":[8646,8666],"content":"NVC_ATL_Windowing#79"},{"pos":[8741,9127],"content":"[!NOTE]\n The check against [m_bDirty](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__m_bdirty) at the beginning of this implementation is an initial check to avoid unnecessary updates of the objects if **Apply** is called more than once. There are also checks against each of the property values to ensure that only changes result in a method call to the **Document**.","leadings":["","> "],"nodes":[{"content":" The check against [m_bDirty](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__m_bdirty) at the beginning of this implementation is an initial check to avoid unnecessary updates of the objects if **Apply** is called more than once. There are also checks against each of the property values to ensure that only changes result in a method call to the **Document**.","pos":[8,384],"nodes":[{"content":"The check against <bpt id=\"p1\">[</bpt>m_bDirty<ept id=\"p1\">](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__m_bdirty)</ept> at the beginning of this implementation is an initial check to avoid unnecessary updates of the objects if <bpt id=\"p2\">**</bpt>Apply<ept id=\"p2\">**</ept> is called more than once.","pos":[1,245],"source":" The check against [m_bDirty](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__m_bdirty) at the beginning of this implementation is an initial check to avoid unnecessary updates of the objects if **Apply** is called more than once."},{"content":"There are also checks against each of the property values to ensure that only changes result in a method call to the <bpt id=\"p1\">**</bpt>Document<ept id=\"p1\">**</ept>.","pos":[246,376],"source":" There are also checks against each of the property values to ensure that only changes result in a method call to the **Document**."}]}]},{"pos":[9135,9460],"content":"[!NOTE]\n**Document** exposes **FullName** as a read-only property. To update the file name of the document based on changes made to the property page, you have to use the **Save** method to save the file with a different name. Thus, the code in a property page doesn't have to limit itself to getting or setting properties.","leadings":["","> "],"nodes":[{"content":"**Document** exposes **FullName** as a read-only property. To update the file name of the document based on changes made to the property page, you have to use the **Save** method to save the file with a different name. Thus, the code in a property page doesn't have to limit itself to getting or setting properties.","pos":[8,323],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>Document<ept id=\"p1\">**</ept> exposes <bpt id=\"p2\">**</bpt>FullName<ept id=\"p2\">**</ept> as a read-only property.","pos":[0,58],"source":"**Document** exposes **FullName** as a read-only property."},{"content":"To update the file name of the document based on changes made to the property page, you have to use the <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept> method to save the file with a different name.","pos":[59,218],"source":" To update the file name of the document based on changes made to the property page, you have to use the **Save** method to save the file with a different name."},{"content":"Thus, the code in a property page doesn't have to limit itself to getting or setting properties.","pos":[219,315]}]}]},{"pos":[9516,9544],"content":"Displaying the Property Page"},{"content":"To display this page, you need to create a simple helper object.","pos":[9548,9612]},{"content":"The helper object will provide a method that simplifies the <bpt id=\"p1\">**</bpt>OleCreatePropertyFrame<ept id=\"p1\">**</ept> API for displaying a single page connected to a single object.","pos":[9613,9762],"source":" The helper object will provide a method that simplifies the **OleCreatePropertyFrame** API for displaying a single page connected to a single object."},{"content":"This helper will be designed so that it can be used from Visual Basic.","pos":[9763,9833]},{"content":"Use the <bpt id=\"p1\">[</bpt>Add Class dialog box<ept id=\"p1\">](../ide/add-class-dialog-box.md)</ept> and the <bpt id=\"p2\">[</bpt>ATL Simple Object Wizard<ept id=\"p2\">](../atl/reference/atl-simple-object-wizard.md)</ept> to generate a new class and use <ph id=\"ph1\">`Helper`</ph> as its short name.","pos":[9840,10043],"source":"Use the [Add Class dialog box](../ide/add-class-dialog-box.md) and the [ATL Simple Object Wizard](../atl/reference/atl-simple-object-wizard.md) to generate a new class and use `Helper` as its short name."},{"content":"Once created, add a method as shown in the table below.","pos":[10044,10099]},{"content":"Item","pos":[10106,10110]},{"content":"Value","pos":[10111,10116]},{"content":"Method Name","pos":[10148,10159]},{"content":"Parameters","pos":[10175,10185]},{"content":"The <ph id=\"ph1\">`bstrCaption`</ph> parameter is the caption to be displayed as the title of the dialog box.","pos":[10256,10346],"source":"The `bstrCaption` parameter is the caption to be displayed as the title of the dialog box."},{"content":"The <ph id=\"ph1\">`bstrID`</ph> parameter is a string representing either a CLSID or a ProgID of the property page to display.","pos":[10347,10454],"source":" The `bstrID` parameter is a string representing either a CLSID or a ProgID of the property page to display."},{"content":"The <ph id=\"ph1\">`pUnk`</ph> parameter will be the <ph id=\"ph2\">`IUnknown`</ph> pointer of the object whose properties will be configured by the property page.","pos":[10455,10578],"source":" The `pUnk` parameter will be the `IUnknown` pointer of the object whose properties will be configured by the property page."},{"content":"Implement the method as shown below:","pos":[10585,10621]},{"pos":[10639,10659],"content":"NVC_ATL_Windowing#80"},{"pos":[10775,10791],"content":"Creating a Macro"},{"content":"Once you've built the project, you can test the property page and the helper object using a simple macro that you can create and run in the Visual Studio development environment.","pos":[10795,10973]},{"content":"This macro will create a helper object, then call its <bpt id=\"p1\">**</bpt>ShowPage<ept id=\"p1\">**</ept> method using the ProgID of the <bpt id=\"p2\">**</bpt>DocProperties<ept id=\"p2\">**</ept> property page and the <bpt id=\"p3\">**</bpt>IUnknown<ept id=\"p3\">**</ept> pointer of the document currently active in the Visual Studio editor.","pos":[10974,11194],"source":" This macro will create a helper object, then call its **ShowPage** method using the ProgID of the **DocProperties** property page and the **IUnknown** pointer of the document currently active in the Visual Studio editor."},{"content":"The code you need for this macro is shown below:","pos":[11195,11243]},{"content":"When you run this macro, the property page will be displayed showing the file name and read-only status of the currently active text document.","pos":[11617,11759]},{"content":"The read-only state of the document only reflects the ability to write to the document in the development environment; it doesn't affect the read-only attribute of the file on disk.","pos":[11760,11941]},{"content":"See Also","pos":[11950,11958]},{"content":"Property Pages","pos":[11963,11977]},{"content":"ATLPages Sample","pos":[12018,12033]}],"content":"---\ntitle: \"Example: Implementing a Property Page | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"property pages, implementing\"\nms.assetid: c30b67fe-ce08-4249-ae29-f3060fa8d61e\ncaps.latest.revision: 14\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Example: Implementing a Property Page\nThis example shows how to build a property page that displays (and allows you to change) properties of the [Document Classes](../mfc/document-classes.md) interface. This interface is exposed by documents in Visual Studio's [Common Environment Object Model Examples](http://msdn.microsoft.com/library/919cdb58-9f6d-45e6-a0f1-9ca8f6e7051f) (although the property page that you'll create won't care where the objects it manipulates come from as long as they support the correct interface).  \n  \n The example is based on the [ATLPages sample](../visual-cpp-samples.md).  \n  \n To complete this example, you will:  \n  \n- [Add the ATL property page class](#vcconusing_the_atl_object_wizard) using the Add Class dialog box and the ATL Property Page Wizard.  \n  \n- [Edit the dialog resource](#vcconediting_the_dialog_resource) by adding new controls for the interesting properties of the **Document** interface.  \n  \n- [Add message handlers](#vcconadding_message_handlers) to keep the property page site informed of changes made by the user.  \n  \n-   Add some `#import` statements and a typedef in the [Housekeeping](#vcconhousekeeping) section.  \n  \n- [Override IPropertyPageImpl::SetObjects](#vcconoverriding_ipropertypageimpl_setobjects) to validate the objects being passed to the property page.  \n  \n- [Override IPropertyPageImpl::Activate](#vcconoverriding_ipropertypageimpl_activate) to initialize the property page's interface.  \n  \n- [Override IPropertyPageImpl::Apply](#vcconoverride_ipropertypageimpl_apply) to update the object with the latest property values.  \n  \n- [Display the property page](#vccontesting_the_property_page) by creating a simple helper object.  \n  \n- [Create a macro](#vcconcreating_a_macro) that will test the property page.  \n  \n##  <a name=\"vcconusing_the_atl_object_wizard\"></a> Adding the ATL Property Page Class  \n First, create a new ATL project for a DLL server called `ATLPages7`. Now use the [ATL Property Page Wizard](../atl/reference/atl-property-page-wizard.md) to generate a property page. Give the property page a **Short Name** of **DocProperties** then switch to the **Strings** page to set property-page-specific items as shown in the table below.  \n  \n|Item|Value|  \n|----------|-----------|  \n|Title|TextDocument|  \n|Doc String|VCUE TextDocument Properties|  \n|Helpfile|*\\<blank>*|  \n  \n The values that you set on this page of the wizard will be returned to the property page container when it calls **IPropertyPage::GetPageInfo**. What happens to the strings after that is dependent on the container, but typically they will be used to identify your page to the user. The Title will usually appear in a tab above your page and the Doc String may be displayed in a status bar or ToolTip (although the standard property frame doesn't use this string at all).  \n  \n> [!NOTE]\n>  The strings that you set here are stored as string resources in your project by the wizard. You can easily edit these strings using the resource editor if you need to change this information after the code for your page has been generated.  \n  \n Click **OK** to have the wizard generate your property page.  \n  \n##  <a name=\"vcconediting_the_dialog_resource\"></a> Editing the Dialog Resource  \n Now that your property page has been generated, you'll need to add a few controls to the dialog resource representing your page. Add an edit box, a static text control, and a check box and set their IDs as shown below:  \n  \n ![Editing a dialog resource](../atl/media/ppgresourcelabeled.gif \"ppgresourcelabeled\")  \n  \n These controls will be used to display the file name of the document and its read-only status.  \n  \n> [!NOTE]\n>  The dialog resource does not include a frame or command buttons, nor does it have the tabbed look that you might have expected. These features are provided by a property page frame such as the one created by calling [OleCreatePropertyFrame](http://msdn.microsoft.com/library/windows/desktop/ms678437).  \n  \n##  <a name=\"vcconadding_message_handlers\"></a> Adding Message Handlers  \n With the controls in place, you can add message handlers to update the dirty status of the page when the value of either of the controls changes:  \n  \n [!code-cpp[NVC_ATL_Windowing#73](../atl/codesnippet/cpp/example-implementing-a-property-page_1.h)]  \n  \n This code responds to changes made to the edit control or check box by calling [IPropertyPageImpl::SetDirty](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__setdirty), which informs the page site that the page has changed. Typically the page site will respond by enabling or disabling an **Apply** button on the property page frame.  \n  \n> [!NOTE]\n>  In your own property pages, you might need to keep track of precisely which properties have been altered by the user so that you can avoid updating properties that haven't been changed. This example implements that code by keeping track of the original property values and comparing them with the current values from the UI when it's time to apply the changes.  \n  \n##  <a name=\"vcconhousekeeping\"></a> Housekeeping  \n Now add a couple of `#import` statements to DocProperties.h so that the compiler knows about the **Document** interface:  \n  \n [!code-cpp[NVC_ATL_Windowing#74](../atl/codesnippet/cpp/example-implementing-a-property-page_2.h)]  \n  \n You'll also need to refer to the `IPropertyPageImpl` base class; add the following `typedef` to the **CDocProperties** class:  \n  \n [!code-cpp[NVC_ATL_Windowing#75](../atl/codesnippet/cpp/example-implementing-a-property-page_3.h)]  \n  \n##  <a name=\"vcconoverriding_ipropertypageimpl_setobjects\"></a> Overriding IPropertyPageImpl::SetObjects  \n The first `IPropertyPageImpl` method that you need to override is [SetObjects](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__setobjects). Here you'll add code to check that only a single object has been passed and that it supports the **Document** interface that you're expecting:  \n  \n [!code-cpp[NVC_ATL_Windowing#76](../atl/codesnippet/cpp/example-implementing-a-property-page_4.h)]  \n  \n> [!NOTE]\n>  It makes sense to support only a single object for this page because you will allow the user to set the file name of the object — only one file can exist at any one location.  \n  \n##  <a name=\"vcconoverriding_ipropertypageimpl_activate\"></a> Overriding IPropertyPageImpl::Activate  \n The next step is to initialize the property page with the property values of the underlying object when the page is first created.  \n  \n In this case you should add the following members to the class since you'll also use the initial property values for comparison when users of the page apply their changes:  \n  \n [!code-cpp[NVC_ATL_Windowing#77](../atl/codesnippet/cpp/example-implementing-a-property-page_5.h)]  \n  \n The base class implementation of the [Activate](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__activate) method is responsible for creating the dialog box and its controls, so you can override this method and add your own initialization after calling the base class:  \n  \n [!code-cpp[NVC_ATL_Windowing#78](../atl/codesnippet/cpp/example-implementing-a-property-page_6.h)]  \n  \n This code uses the COM methods of the **Document** interface to get the properties that you're interested in. It then uses the Win32 API wrappers provided by [CDialogImpl](../atl/reference/cdialogimpl-class.md) and its base classes to display the property values to the user.  \n  \n##  <a name=\"vcconoverride_ipropertypageimpl_apply\"></a> Overriding IPropertyPageImpl::Apply  \n When users want to apply their changes to the objects, the property page site will call the [Apply](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__apply) method. This is the place to do the reverse of the code in **Activate** — whereas **Activate** took values from the object and pushed them into the controls on the property page, **Apply** takes values from the controls on the property page and pushes them into the object.  \n  \n [!code-cpp[NVC_ATL_Windowing#79](../atl/codesnippet/cpp/example-implementing-a-property-page_7.h)]  \n  \n> [!NOTE]\n>  The check against [m_bDirty](../atl/reference/ipropertypageimpl-class.md#ipropertypageimpl__m_bdirty) at the beginning of this implementation is an initial check to avoid unnecessary updates of the objects if **Apply** is called more than once. There are also checks against each of the property values to ensure that only changes result in a method call to the **Document**.  \n  \n> [!NOTE]\n> **Document** exposes **FullName** as a read-only property. To update the file name of the document based on changes made to the property page, you have to use the **Save** method to save the file with a different name. Thus, the code in a property page doesn't have to limit itself to getting or setting properties.  \n  \n##  <a name=\"vccontesting_the_property_page\"></a> Displaying the Property Page  \n To display this page, you need to create a simple helper object. The helper object will provide a method that simplifies the **OleCreatePropertyFrame** API for displaying a single page connected to a single object. This helper will be designed so that it can be used from Visual Basic.  \n  \n Use the [Add Class dialog box](../ide/add-class-dialog-box.md) and the [ATL Simple Object Wizard](../atl/reference/atl-simple-object-wizard.md) to generate a new class and use `Helper` as its short name. Once created, add a method as shown in the table below.  \n  \n|Item|Value|  \n|----------|-----------|  \n|Method Name|`ShowPage`|  \n|Parameters|`[in] BSTR bstrCaption, [in] BSTR bstrID, [in] IUnknown* pUnk`|  \n  \n The `bstrCaption` parameter is the caption to be displayed as the title of the dialog box. The `bstrID` parameter is a string representing either a CLSID or a ProgID of the property page to display. The `pUnk` parameter will be the `IUnknown` pointer of the object whose properties will be configured by the property page.  \n  \n Implement the method as shown below:  \n  \n [!code-cpp[NVC_ATL_Windowing#80](../atl/codesnippet/cpp/example-implementing-a-property-page_8.cpp)]  \n  \n##  <a name=\"vcconcreating_a_macro\"></a> Creating a Macro  \n Once you've built the project, you can test the property page and the helper object using a simple macro that you can create and run in the Visual Studio development environment. This macro will create a helper object, then call its **ShowPage** method using the ProgID of the **DocProperties** property page and the **IUnknown** pointer of the document currently active in the Visual Studio editor. The code you need for this macro is shown below:  \n  \n```  \nImports EnvDTE  \nImports System.Diagnostics  \n \nPublic Module AtlPages  \n \n    Public Sub Test()  \n    Dim Helper  \n    Helper = CreateObject(\"ATLPages7.Helper.1\")  \n \n    On Error Resume Next  \n    Helper.ShowPage(_ \n    ActiveDocument.Name,\n    _ \n \"ATLPages7Lib.DocumentProperties.1\",\n    _ \n    DTE.ActiveDocument _)  \n    End Sub  \n \nEnd Module  \n```  \n  \n When you run this macro, the property page will be displayed showing the file name and read-only status of the currently active text document. The read-only state of the document only reflects the ability to write to the document in the development environment; it doesn't affect the read-only attribute of the file on disk.  \n  \n## See Also  \n [Property Pages](../atl/atl-com-property-pages.md)   \n [ATLPages Sample](../visual-cpp-samples.md)\n\n"}