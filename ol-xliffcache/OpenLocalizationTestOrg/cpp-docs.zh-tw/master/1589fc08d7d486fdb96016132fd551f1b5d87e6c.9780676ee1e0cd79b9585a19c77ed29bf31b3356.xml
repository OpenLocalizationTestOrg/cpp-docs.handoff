{"nodes":[{"pos":[12,64],"content":"-kernel (Create Kernel Mode Binary) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"-kernel (Create Kernel Mode Binary) | Microsoft Docs","pos":[0,52]}]},{"content":"/kernel (Create Kernel Mode Binary)","pos":[588,623]},{"content":"Creates a binary that can be executed in the Windows kernel.","pos":[624,684]},{"content":"Syntax","pos":[693,699]},{"content":"Arguments","pos":[736,745]},{"content":"/kernel","pos":[751,758]},{"content":"The code in the current project is compiled and linked by using a set of C++ language rules that are specific to code that will run in kernel mode.","pos":[764,911]},{"content":"/kernel-","pos":[920,928]},{"content":"The code in the current project is compiled and linked without using the C++ language rules that are specific to code that will run in kernel mode.","pos":[934,1081]},{"content":"Remarks","pos":[1090,1097]},{"pos":[1101,1157],"content":"There is no <ph id=\"ph1\">`#pragma`</ph> equivalent to control this option.","source":"There is no `#pragma` equivalent to control this option."},{"content":"Specifying the <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> option tells the compiler and linker to arbitrate which language features are permissible in kernel mode and to make sure that that you have sufficient expressive power to avoid runtime instability that is unique to kernel mode C++.","pos":[1164,1423],"source":"Specifying the **/kernel** option tells the compiler and linker to arbitrate which language features are permissible in kernel mode and to make sure that that you have sufficient expressive power to avoid runtime instability that is unique to kernel mode C++."},{"content":"This is accomplished by prohibiting the use of C++ language features that are disruptive in kernel mode and by providing warnings for C++ language features that are potentially disruptive but cannot be disabled.","pos":[1424,1635]},{"content":"The <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> option applies to both the compiler and linker phases of a build and is set at the project level.","pos":[1642,1755],"source":"The **/kernel** option applies to both the compiler and linker phases of a build and is set at the project level."},{"content":"Pass the <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> switch to indicate to the compiler that the resulting binary, after linking, should be loaded into the Windows kernel.","pos":[1756,1895],"source":" Pass the **/kernel** switch to indicate to the compiler that the resulting binary, after linking, should be loaded into the Windows kernel."},{"content":"The compiler will narrow the spectrum of C++ language features to a subset that is compatible with the kernel.","pos":[1896,2006]},{"pos":[2013,2098],"content":"The following table lists changes in compiler behavior when <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> is specified.","source":"The following table lists changes in compiler behavior when **/kernel** is specified."},{"content":"Behavior Type","pos":[2105,2118]},{"pos":[2119,2139],"content":"<bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> Behavior","source":"**/kernel** Behavior"},{"content":"C++ Exception Handling","pos":[2196,2218]},{"content":"Disabled.","pos":[2219,2228]},{"content":"All instances of the <ph id=\"ph1\">`throw`</ph> and <ph id=\"ph2\">`try`</ph> keywords emit a compiler error (except for the exception specification <ph id=\"ph3\">`throw()`</ph>).","pos":[2229,2350],"source":" All instances of the `throw` and `try` keywords emit a compiler error (except for the exception specification `throw()`)."},{"content":"No <bpt id=\"p1\">**</bpt>/EH<ept id=\"p1\">**</ept> options are compatible with <bpt id=\"p2\">**</bpt>/kernel<ept id=\"p2\">**</ept>, except for <bpt id=\"p3\">**</bpt>/EH-<ept id=\"p3\">**</ept>.","pos":[2351,2423],"source":" No **/EH** options are compatible with **/kernel**, except for **/EH-**."},{"content":"RTTI","pos":[2428,2432]},{"content":"Disabled.","pos":[2433,2442]},{"content":"All instances of the <ph id=\"ph1\">`dynamic_cast`</ph> and <ph id=\"ph2\">`typeid`</ph> keywords emit a compiler error, unless <ph id=\"ph3\">`dynamic_cast`</ph> is used statically.","pos":[2443,2565],"source":" All instances of the `dynamic_cast` and `typeid` keywords emit a compiler error, unless `dynamic_cast` is used statically."},{"pos":[2576,2579],"content":"and"},{"pos":[2589,2722],"content":"You must explicitly define the <ph id=\"ph1\">`new()`</ph> or <ph id=\"ph2\">`delete()`</ph> operator; neither the compiler nor the runtime will supply a default definition.","source":"You must explicitly define the `new()` or `delete()` operator; neither the compiler nor the runtime will supply a default definition."},{"content":"Custom calling conventions, the <bpt id=\"p1\">[</bpt>/GS<ept id=\"p1\">](../../build/reference/gs-buffer-security-check.md)</ept> build option, and all optimizations are permitted when you use the <bpt id=\"p2\">**</bpt>/kernel<ept id=\"p2\">**</ept> option.","pos":[2730,2905],"source":"Custom calling conventions, the [/GS](../../build/reference/gs-buffer-security-check.md) build option, and all optimizations are permitted when you use the **/kernel** option."},{"content":"Inlining is largely not affected by <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept>, with the same semantics honored by the compiler.","pos":[2906,3003],"source":" Inlining is largely not affected by **/kernel**, with the same semantics honored by the compiler."},{"content":"If you want to make sure that the <ph id=\"ph1\">`__forceinline`</ph> inlining qualifier is honored, you must make sure that warning <bpt id=\"p1\">[</bpt>C4714<ept id=\"p1\">](../../error-messages/compiler-warnings/compiler-warning-level-4-c4714.md)</ept> is enabled so that you know when a particular <ph id=\"ph2\">`__forceinline`</ph> function is not inlined.","pos":[3004,3285],"source":" If you want to make sure that the `__forceinline` inlining qualifier is honored, you must make sure that warning [C4714](../../error-messages/compiler-warnings/compiler-warning-level-4-c4714.md) is enabled so that you know when a particular `__forceinline` function is not inlined."},{"content":"When the compiler is passed the <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> switch, it predefines a preprocessor macro that's named <ph id=\"ph1\">`_KERNEL_MODE`</ph> and has the value <bpt id=\"p2\">**</bpt>1<ept id=\"p2\">**</ept>.","pos":[3292,3431],"source":"When the compiler is passed the **/kernel** switch, it predefines a preprocessor macro that's named `_KERNEL_MODE` and has the value **1**."},{"content":"You can use this to conditionally compile code based on whether the execution environment is in user mode or kernel mode.","pos":[3432,3553]},{"content":"For example, the following code specifies that the class should be in a non-pageable memory segment when it is compiled for kernel mode execution.","pos":[3554,3700]},{"pos":[3914,4047],"content":"Some the following combinations of target architecture and the <bpt id=\"p1\">**</bpt>/arch<ept id=\"p1\">**</ept> option produce an error when they are used with <bpt id=\"p2\">**</bpt>/kernel<ept id=\"p2\">**</ept>:","source":"Some the following combinations of target architecture and the **/arch** option produce an error when they are used with **/kernel**:"},{"content":"<bpt id=\"p1\">**</bpt>/arch:{SSE&amp;#124;SSE2&amp;#124;AVX}<ept id=\"p1\">**</ept> are not supported on x86.","pos":[4057,4117],"source":"**/arch:{SSE&#124;SSE2&#124;AVX}** are not supported on x86."},{"content":"Only <bpt id=\"p1\">**</bpt>/arch:IA32<ept id=\"p1\">**</ept> is supported with <bpt id=\"p2\">**</bpt>/kernel<ept id=\"p2\">**</ept> on x86.","pos":[4118,4175],"source":" Only **/arch:IA32** is supported with **/kernel** on x86."},{"pos":[4185,4240],"content":"<bpt id=\"p1\">**</bpt>/arch:AVX<ept id=\"p1\">**</ept> is not supported with <bpt id=\"p2\">**</bpt>/kernel<ept id=\"p2\">**</ept> on x64.","source":"**/arch:AVX** is not supported with **/kernel** on x64."},{"content":"Building with <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> also passes <bpt id=\"p2\">**</bpt>/kernel<ept id=\"p2\">**</ept> to the linker.","pos":[4247,4311],"source":"Building with **/kernel** also passes **/kernel** to the linker."},{"content":"Her's how this affects linker behavior:","pos":[4312,4351]},{"content":"Incremental linking is disabled.","pos":[4361,4393]},{"content":"If you add <bpt id=\"p1\">**</bpt>/incremental<ept id=\"p1\">**</ept> to the command line, the linker emits this fatal error:","pos":[4394,4477],"source":" If you add **/incremental** to the command line, the linker emits this fatal error:"},{"content":"LINK : fatal error LNK1295: '/INCREMENTAL' not compatible with '/KERNEL' specification; link without '/INCREMENTAL'","pos":[4490,4605]},{"content":"The linker inspects each object file (or any included archive member from static libraries) to see whether it could have been compiled by using the <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> option but was not.","pos":[4617,4796],"source":"The linker inspects each object file (or any included archive member from static libraries) to see whether it could have been compiled by using the **/kernel** option but was not."},{"content":"If any instances meet this criterion, the linker still successfully links but might issue a warning, as shown in the following table.","pos":[4797,4930]},{"pos":[4942,4957],"content":"<bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> obj","source":"**/kernel** obj"},{"pos":[4958,4997],"content":"<bpt id=\"p1\">**</bpt>/kernel-<ept id=\"p1\">**</ept> obj, MASM obj, or cvtresed","source":"**/kernel-** obj, MASM obj, or cvtresed"},{"pos":[4998,5038],"content":"Mix of <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>/kernel-<ept id=\"p2\">**</ept> objs","source":"Mix of **/kernel** and **/kernel-** objs"},{"content":"link /kernel","pos":[5180,5192]},{"content":"Yes","pos":[5195,5198]},{"content":"Yes","pos":[5199,5202]},{"content":"Yes with warning LNK4257","pos":[5203,5227]},{"content":"link","pos":[5238,5242]},{"content":"Yes","pos":[5245,5248]},{"content":"Yes","pos":[5249,5252]},{"content":"Yes","pos":[5253,5256]},{"content":"LNK4257 linking object not compiled with /KERNEL ; image may not run","pos":[5270,5338]},{"pos":[5347,5449],"content":"The <bpt id=\"p1\">**</bpt>/kernel<ept id=\"p1\">**</ept> option and the <bpt id=\"p2\">**</bpt>/driver<ept id=\"p2\">**</ept> option operate independently and neither affects the other.","source":"The **/kernel** option and the **/driver** option operate independently and neither affects the other."},{"content":"To set the /kernel compiler option in Visual Studio","pos":[5459,5510]},{"content":"Open the <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box for the project.","pos":[5520,5575],"source":"Open the **Property Pages** dialog box for the project."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Working with Project Properties<ept id=\"p1\">](../../ide/working-with-project-properties.md)</ept>.","pos":[5576,5682],"source":" For more information, see [Working with Project Properties](../../ide/working-with-project-properties.md)."},{"pos":[5692,5720],"content":"Select the <bpt id=\"p1\">**</bpt>C/C++<ept id=\"p1\">**</ept> folder.","source":"Select the **C/C++** folder."},{"pos":[5730,5772],"content":"Select the <bpt id=\"p1\">**</bpt>Command Line<ept id=\"p1\">**</ept> property page.","source":"Select the **Command Line** property page."},{"pos":[5782,5845],"content":"In the <bpt id=\"p1\">**</bpt>Additional options<ept id=\"p1\">**</ept> box, add <ph id=\"ph1\">`/kernel`</ph> or <ph id=\"ph2\">`/kernel-`</ph>.","source":"In the **Additional options** box, add `/kernel` or `/kernel-`."},{"content":"See Also","pos":[5854,5862]},{"content":"Compiler Options","pos":[5867,5883]},{"content":"Setting Compiler Options","pos":[5933,5957]}],"content":"---\ntitle: \"-kernel (Create Kernel Mode Binary) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"/kernel\"\n  - \"/kernel-\"\ndev_langs: \n  - \"C++\"\nms.assetid: 6d7fdff0-c3d1-4b78-9367-4da588ce8b05\ncaps.latest.revision: 11\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# /kernel (Create Kernel Mode Binary)\nCreates a binary that can be executed in the Windows kernel.  \n  \n## Syntax  \n  \n```  \n/kernel[-]  \n```  \n  \n## Arguments  \n **/kernel**  \n The code in the current project is compiled and linked by using a set of C++ language rules that are specific to code that will run in kernel mode.  \n  \n **/kernel-**  \n The code in the current project is compiled and linked without using the C++ language rules that are specific to code that will run in kernel mode.  \n  \n## Remarks  \n There is no `#pragma` equivalent to control this option.  \n  \n Specifying the **/kernel** option tells the compiler and linker to arbitrate which language features are permissible in kernel mode and to make sure that that you have sufficient expressive power to avoid runtime instability that is unique to kernel mode C++. This is accomplished by prohibiting the use of C++ language features that are disruptive in kernel mode and by providing warnings for C++ language features that are potentially disruptive but cannot be disabled.  \n  \n The **/kernel** option applies to both the compiler and linker phases of a build and is set at the project level. Pass the **/kernel** switch to indicate to the compiler that the resulting binary, after linking, should be loaded into the Windows kernel. The compiler will narrow the spectrum of C++ language features to a subset that is compatible with the kernel.  \n  \n The following table lists changes in compiler behavior when **/kernel** is specified.  \n  \n|Behavior Type|**/kernel** Behavior|  \n|-------------------|---------------------------|  \n|C++ Exception Handling|Disabled. All instances of the `throw` and `try` keywords emit a compiler error (except for the exception specification `throw()`). No **/EH** options are compatible with **/kernel**, except for **/EH-**.|  \n|RTTI|Disabled. All instances of the `dynamic_cast` and `typeid` keywords emit a compiler error, unless `dynamic_cast` is used statically.|  \n|`new` and `delete`|You must explicitly define the `new()` or `delete()` operator; neither the compiler nor the runtime will supply a default definition.|  \n  \n Custom calling conventions, the [/GS](../../build/reference/gs-buffer-security-check.md) build option, and all optimizations are permitted when you use the **/kernel** option. Inlining is largely not affected by **/kernel**, with the same semantics honored by the compiler. If you want to make sure that the `__forceinline` inlining qualifier is honored, you must make sure that warning [C4714](../../error-messages/compiler-warnings/compiler-warning-level-4-c4714.md) is enabled so that you know when a particular `__forceinline` function is not inlined.  \n  \n When the compiler is passed the **/kernel** switch, it predefines a preprocessor macro that's named `_KERNEL_MODE` and has the value **1**. You can use this to conditionally compile code based on whether the execution environment is in user mode or kernel mode. For example, the following code specifies that the class should be in a non-pageable memory segment when it is compiled for kernel mode execution.  \n  \n```cpp  \n  \n      #ifdef _KERNEL_MODE  \n#define NONPAGESECTION __declspec(code_seg(\"$kerneltext$\"))  \n#else  \n#define NONPAGESECTION  \n#endif  \n  \nclass NONPAGESECTION MyNonPagedClass  \n{  \n  \n};  \n```  \n  \n Some the following combinations of target architecture and the **/arch** option produce an error when they are used with **/kernel**:  \n  \n-   **/arch:{SSE&#124;SSE2&#124;AVX}** are not supported on x86. Only **/arch:IA32** is supported with **/kernel** on x86.  \n  \n-   **/arch:AVX** is not supported with **/kernel** on x64.  \n  \n Building with **/kernel** also passes **/kernel** to the linker. Her's how this affects linker behavior:  \n  \n-   Incremental linking is disabled. If you add **/incremental** to the command line, the linker emits this fatal error:  \n  \n     **LINK : fatal error LNK1295: '/INCREMENTAL' not compatible with '/KERNEL' specification; link without '/INCREMENTAL'**  \n  \n-   The linker inspects each object file (or any included archive member from static libraries) to see whether it could have been compiled by using the **/kernel** option but was not. If any instances meet this criterion, the linker still successfully links but might issue a warning, as shown in the following table.  \n  \n    ||**/kernel** obj|**/kernel-** obj, MASM obj, or cvtresed|Mix of **/kernel** and **/kernel-** objs|  \n    |-|----------------------|-----------------------------------------------|-------------------------------------------------|  \n    |**link /kernel**|Yes|Yes|Yes with warning LNK4257|  \n    |**link**|Yes|Yes|Yes|  \n  \n     **LNK4257 linking object not compiled with /KERNEL ; image may not run**  \n  \n The **/kernel** option and the **/driver** option operate independently and neither affects the other.  \n  \n### To set the /kernel compiler option in Visual Studio  \n  \n1.  Open the **Property Pages** dialog box for the project. For more information, see [Working with Project Properties](../../ide/working-with-project-properties.md).  \n  \n2.  Select the **C/C++** folder.  \n  \n3.  Select the **Command Line** property page.  \n  \n4.  In the **Additional options** box, add `/kernel` or `/kernel-`.  \n  \n## See Also  \n [Compiler Options](../../build/reference/compiler-options.md)   \n [Setting Compiler Options](../../build/reference/setting-compiler-options.md)"}