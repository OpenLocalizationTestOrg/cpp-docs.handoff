{"nodes":[{"pos":[12,77],"content":"Changing the Drawing Code (ATL Tutorial, Part 4) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Changing the Drawing Code (ATL Tutorial, Part 4) | Microsoft Docs","pos":[0,65]}]},{"content":"Changing the Drawing Code (ATL Tutorial, Part 4)","pos":[617,665]},{"content":"By default, the control's drawing code displays a square and the text <bpt id=\"p1\">**</bpt>PolyCtl<ept id=\"p1\">**</ept>.","pos":[666,748],"source":"By default, the control's drawing code displays a square and the text **PolyCtl**."},{"content":"In this step, you will change the code to display something more interesting.","pos":[749,826]},{"content":"The following tasks are involved:","pos":[827,860]},{"content":"Modifying the Header File","pos":[870,895]},{"pos":[905,936],"content":"Modifying the <ph id=\"ph1\">`OnDraw`</ph> Function","source":"Modifying the `OnDraw` Function"},{"content":"Adding a Method to Calculate the Polygon Points","pos":[946,993]},{"content":"Initializing the Fill Color","pos":[1003,1030]},{"content":"Modifying the Header File","pos":[1039,1064]},{"pos":[1068,1225],"content":"Start by adding support for the math functions <ph id=\"ph1\">`sin`</ph> and <ph id=\"ph2\">`cos`</ph>, which will be used calculate the polygon points, and by creating an array to store positions.","source":"Start by adding support for the math functions `sin` and `cos`, which will be used calculate the polygon points, and by creating an array to store positions."},{"content":"To modify the header file","pos":[1236,1261]},{"content":"Add the line <ph id=\"ph1\">`#include &lt;math.h&gt;`</ph> to the top of PolyCtl.h.","pos":[1271,1328],"source":"Add the line `#include <math.h>` to the top of PolyCtl.h."},{"content":"The top of the file should look like this:","pos":[1329,1371]},{"pos":[1393,1413],"content":"NVC_ATL_Windowing#47"},{"pos":[1501,1655],"content":"Once the polygon points are calculated, they will be stored in an array of type <ph id=\"ph1\">`POINT`</ph>, so add the array after the definition of <ph id=\"ph2\">`m_nSides`</ph> in PolyCtl.h:","source":"Once the polygon points are calculated, they will be stored in an array of type `POINT`, so add the array after the definition of `m_nSides` in PolyCtl.h:"},{"pos":[1677,1697],"content":"NVC_ATL_Windowing#48"},{"content":"Modifying the OnDraw Method","pos":[1782,1809]},{"content":"Now you should modify the <ph id=\"ph1\">`OnDraw`</ph> method in PolyCtl.h.","pos":[1813,1868],"source":"Now you should modify the `OnDraw` method in PolyCtl.h."},{"content":"The code you will add creates a new pen and brush with which to draw your polygon, and then calls the <ph id=\"ph1\">`Ellipse`</ph> and <ph id=\"ph2\">`Polygon`</ph> Win32 API functions to perform the actual drawing.","pos":[1869,2045],"source":" The code you will add creates a new pen and brush with which to draw your polygon, and then calls the `Ellipse` and `Polygon` Win32 API functions to perform the actual drawing."},{"content":"To modify the OnDraw function","pos":[2056,2085]},{"pos":[2095,2169],"content":"Replace the existing <ph id=\"ph1\">`OnDraw`</ph> method in PolyCtl.h with the following code:","source":"Replace the existing `OnDraw` method in PolyCtl.h with the following code:"},{"pos":[2191,2211],"content":"NVC_ATL_Windowing#49"},{"content":"Adding a Method to Calculate the Polygon Points","pos":[2298,2345]},{"content":"Add a method, called <ph id=\"ph1\">`CalcPoints`</ph>, that will calculate the coordinates of the points that make up the perimeter of the polygon.","pos":[2349,2476],"source":"Add a method, called `CalcPoints`, that will calculate the coordinates of the points that make up the perimeter of the polygon."},{"content":"These calculations will be based on the RECT variable that is passed into the function.","pos":[2477,2564]},{"content":"To add the CalcPoints method","pos":[2575,2603]},{"pos":[2613,2719],"content":"Add the declaration of <ph id=\"ph1\">`CalcPoints`</ph> to the <ph id=\"ph2\">`IPolyCtl`</ph> public section of the <ph id=\"ph3\">`CPolyCtl`</ph> class in PolyCtl.h:","source":"Add the declaration of `CalcPoints` to the `IPolyCtl` public section of the `CPolyCtl` class in PolyCtl.h:"},{"pos":[2741,2761],"content":"NVC_ATL_Windowing#50"},{"pos":[2848,2928],"content":"The last part of the public section of the <ph id=\"ph1\">`CPolyCtl`</ph> class will look like this:","source":"The last part of the public section of the `CPolyCtl` class will look like this:"},{"pos":[2950,2970],"content":"NVC_ATL_Windowing#51"},{"pos":[3056,3135],"content":"Add this implementation of the <ph id=\"ph1\">`CalcPoints`</ph> function to the end of PolyCtl.cpp:","source":"Add this implementation of the `CalcPoints` function to the end of PolyCtl.cpp:"},{"pos":[3157,3177],"content":"NVC_ATL_Windowing#52"},{"content":"Initializing the Fill Color","pos":[3264,3291]},{"pos":[3295,3344],"content":"Initialize <ph id=\"ph1\">`m_clrFillColor`</ph> with a default color.","source":"Initialize `m_clrFillColor` with a default color."},{"content":"To initialize the fill color","pos":[3355,3383]},{"pos":[3393,3487],"content":"Use green as the default color by adding this line to the <ph id=\"ph1\">`CPolyCtl`</ph> constructor in PolyCtl.h:","source":"Use green as the default color by adding this line to the `CPolyCtl` constructor in PolyCtl.h:"},{"pos":[3509,3529],"content":"NVC_ATL_Windowing#53"},{"content":"The constructor now looks like this:","pos":[3612,3648]},{"pos":[3666,3686],"content":"NVC_ATL_Windowing#54"},{"content":"Building and Testing the Control","pos":[3771,3803]},{"content":"Rebuild the control.","pos":[3807,3827]},{"content":"Make sure the PolyCtl.htm file is closed if it is still open, and then click <bpt id=\"p1\">**</bpt>Build Polygon<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>Build<ept id=\"p2\">**</ept> menu.","pos":[3828,3945],"source":" Make sure the PolyCtl.htm file is closed if it is still open, and then click **Build Polygon** on the **Build** menu."},{"content":"You could view the control once again from the PolyCtl.htm page, but this time use the ActiveX Control Test Container.","pos":[3946,4064]},{"content":"To use the ActiveX Control Test Container","pos":[4075,4116]},{"content":"Build and start the ActiveX Control Test Container.","pos":[4126,4177]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>TSTCON Sample: ActiveX Control Test Container<ept id=\"p1\">](../visual-cpp-samples.md)</ept>.","pos":[4178,4278],"source":" For more information, see [TSTCON Sample: ActiveX Control Test Container](../visual-cpp-samples.md)."},{"pos":[4288,4358],"content":"In Test Container, on the <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Insert New Control<ept id=\"p2\">**</ept>.","source":"In Test Container, on the **Edit** menu, click **Insert New Control**."},{"content":"Locate your control, which will be called <ph id=\"ph1\">`PolyCtl Class`</ph>, and click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[4368,4444],"source":"Locate your control, which will be called `PolyCtl Class`, and click **OK**."},{"content":"You will see a green triangle within a circle.","pos":[4445,4491]},{"content":"Try changing the number of sides by following the next procedure.","pos":[4498,4563]},{"content":"To modify properties on a dual interface from within Test Container, use <bpt id=\"p1\">**</bpt>Invoke Methods<ept id=\"p1\">**</ept>.","pos":[4564,4656],"source":" To modify properties on a dual interface from within Test Container, use **Invoke Methods**."},{"content":"To modify a control's property from within the Test Container","pos":[4667,4728]},{"pos":[4738,4806],"content":"In Test Container, click <bpt id=\"p1\">**</bpt>Invoke Methods<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>Control<ept id=\"p2\">**</ept> menu.","source":"In Test Container, click **Invoke Methods** on the **Control** menu."},{"pos":[4817,4863],"content":"The <bpt id=\"p1\">**</bpt>Invoke Method<ept id=\"p1\">**</ept> dialog box is displayed.","source":"The **Invoke Method** dialog box is displayed."},{"pos":[4873,4974],"content":"Select the <bpt id=\"p1\">**</bpt>PropPut<ept id=\"p1\">**</ept> version of the <bpt id=\"p2\">**</bpt>Sides<ept id=\"p2\">**</ept> property from the <bpt id=\"p3\">**</bpt>Method Name<ept id=\"p3\">**</ept> drop-down list box.","source":"Select the **PropPut** version of the **Sides** property from the **Method Name** drop-down list box."},{"pos":[4984,5067],"content":"Type <ph id=\"ph1\">`5`</ph> in the <bpt id=\"p1\">**</bpt>Parameter Value<ept id=\"p1\">**</ept> box, click <bpt id=\"p2\">**</bpt>Set Value<ept id=\"p2\">**</ept>, and click <bpt id=\"p3\">**</bpt>Invoke<ept id=\"p3\">**</ept>.","source":"Type `5` in the **Parameter Value** box, click **Set Value**, and click **Invoke**."},{"content":"Note that the control does not change.","pos":[5074,5112]},{"content":"Although you changed the number of sides internally by setting the <ph id=\"ph1\">`m_nSides`</ph> variable, this did not cause the control to repaint.","pos":[5113,5243],"source":" Although you changed the number of sides internally by setting the `m_nSides` variable, this did not cause the control to repaint."},{"content":"If you switch to another application and then switch back to Test Container, you will find that the control has repainted and has the correct number of sides.","pos":[5244,5402]},{"content":"To correct this problem, add a call to the <ph id=\"ph1\">`FireViewChange`</ph> function, defined in <ph id=\"ph2\">`IViewObjectExImpl`</ph>, after you set the number of sides.","pos":[5409,5545],"source":"To correct this problem, add a call to the `FireViewChange` function, defined in `IViewObjectExImpl`, after you set the number of sides."},{"content":"If the control is running in its own window, <ph id=\"ph1\">`FireViewChange`</ph> will call the <ph id=\"ph2\">`InvalidateRect`</ph> method directly.","pos":[5546,5655],"source":" If the control is running in its own window, `FireViewChange` will call the `InvalidateRect` method directly."},{"content":"If the control is running windowless, the <ph id=\"ph1\">`InvalidateRect`</ph> method will be called on the container's site interface.","pos":[5656,5771],"source":" If the control is running windowless, the `InvalidateRect` method will be called on the container's site interface."},{"content":"This forces the control to repaint itself.","pos":[5772,5814]},{"content":"To add a call to FireViewChange","pos":[5825,5856]},{"content":"Update PolyCtl.cpp by adding the call to <ph id=\"ph1\">`FireViewChange`</ph> to the <ph id=\"ph2\">`put_Sides`</ph> method.","pos":[5866,5950],"source":"Update PolyCtl.cpp by adding the call to `FireViewChange` to the `put_Sides` method."},{"content":"When you have finished, the <ph id=\"ph1\">`put_Sides`</ph> method should look like this:","pos":[5951,6020],"source":" When you have finished, the `put_Sides` method should look like this:"},{"pos":[6042,6062],"content":"NVC_ATL_Windowing#55"},{"content":"After adding <ph id=\"ph1\">`FireViewChange`</ph>, rebuild and try the control again in the ActiveX Control Test Container.","pos":[6147,6250],"source":"After adding `FireViewChange`, rebuild and try the control again in the ActiveX Control Test Container."},{"content":"This time when you change the number of sides and click <ph id=\"ph1\">`Invoke`</ph>, you should see the control change immediately.","pos":[6251,6363],"source":" This time when you change the number of sides and click `Invoke`, you should see the control change immediately."},{"content":"In the next step, you will add an event.","pos":[6370,6410]},{"pos":[6417,6566],"content":"<bpt id=\"p1\">[</bpt>Back to Step 3<ept id=\"p1\">](../atl/adding-a-property-to-the-control-atl-tutorial-part-3.md)</ept> &amp;#124; <bpt id=\"p2\">[</bpt>On to Step 5<ept id=\"p2\">](../atl/adding-an-event-atl-tutorial-part-5.md)</ept>","source":"[Back to Step 3](../atl/adding-a-property-to-the-control-atl-tutorial-part-3.md) &#124; [On to Step 5](../atl/adding-an-event-atl-tutorial-part-5.md)"},{"content":"See Also","pos":[6575,6583]},{"content":"Tutorial","pos":[6588,6596]},{"content":"Testing Properties and Events with Test Container","pos":[6651,6700]}],"content":"---\ntitle: \"Changing the Drawing Code (ATL Tutorial, Part 4) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"get-started-article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"_ATL_MIN_CRT macro\"\nms.assetid: 08ff14e8-aa49-4139-a110-5d071939cf1e\ncaps.latest.revision: 18\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Changing the Drawing Code (ATL Tutorial, Part 4)\nBy default, the control's drawing code displays a square and the text **PolyCtl**. In this step, you will change the code to display something more interesting. The following tasks are involved:  \n  \n-   Modifying the Header File  \n  \n-   Modifying the `OnDraw` Function  \n  \n-   Adding a Method to Calculate the Polygon Points  \n  \n-   Initializing the Fill Color  \n  \n## Modifying the Header File  \n Start by adding support for the math functions `sin` and `cos`, which will be used calculate the polygon points, and by creating an array to store positions.  \n  \n#### To modify the header file  \n  \n1.  Add the line `#include <math.h>` to the top of PolyCtl.h. The top of the file should look like this:  \n  \n     [!code-cpp[NVC_ATL_Windowing#47](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_1.cpp)]  \n  \n2.  Once the polygon points are calculated, they will be stored in an array of type `POINT`, so add the array after the definition of `m_nSides` in PolyCtl.h:  \n  \n     [!code-cpp[NVC_ATL_Windowing#48](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_2.h)]  \n  \n## Modifying the OnDraw Method  \n Now you should modify the `OnDraw` method in PolyCtl.h. The code you will add creates a new pen and brush with which to draw your polygon, and then calls the `Ellipse` and `Polygon` Win32 API functions to perform the actual drawing.  \n  \n#### To modify the OnDraw function  \n  \n1.  Replace the existing `OnDraw` method in PolyCtl.h with the following code:  \n  \n     [!code-cpp[NVC_ATL_Windowing#49](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_3.cpp)]  \n  \n## Adding a Method to Calculate the Polygon Points  \n Add a method, called `CalcPoints`, that will calculate the coordinates of the points that make up the perimeter of the polygon. These calculations will be based on the RECT variable that is passed into the function.  \n  \n#### To add the CalcPoints method  \n  \n1.  Add the declaration of `CalcPoints` to the `IPolyCtl` public section of the `CPolyCtl` class in PolyCtl.h:  \n  \n     [!code-cpp[NVC_ATL_Windowing#50](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_4.h)]  \n  \n     The last part of the public section of the `CPolyCtl` class will look like this:  \n  \n     [!code-cpp[NVC_ATL_Windowing#51](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_5.h)]  \n  \n2.  Add this implementation of the `CalcPoints` function to the end of PolyCtl.cpp:  \n  \n     [!code-cpp[NVC_ATL_Windowing#52](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_6.cpp)]  \n  \n## Initializing the Fill Color  \n Initialize `m_clrFillColor` with a default color.  \n  \n#### To initialize the fill color  \n  \n1.  Use green as the default color by adding this line to the `CPolyCtl` constructor in PolyCtl.h:  \n  \n     [!code-cpp[NVC_ATL_Windowing#53](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_7.h)]  \n  \n The constructor now looks like this:  \n  \n [!code-cpp[NVC_ATL_Windowing#54](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_8.h)]  \n  \n## Building and Testing the Control  \n Rebuild the control. Make sure the PolyCtl.htm file is closed if it is still open, and then click **Build Polygon** on the **Build** menu. You could view the control once again from the PolyCtl.htm page, but this time use the ActiveX Control Test Container.  \n  \n#### To use the ActiveX Control Test Container  \n  \n1.  Build and start the ActiveX Control Test Container. For more information, see [TSTCON Sample: ActiveX Control Test Container](../visual-cpp-samples.md).  \n  \n2.  In Test Container, on the **Edit** menu, click **Insert New Control**.  \n  \n3.  Locate your control, which will be called `PolyCtl Class`, and click **OK**. You will see a green triangle within a circle.  \n  \n Try changing the number of sides by following the next procedure. To modify properties on a dual interface from within Test Container, use **Invoke Methods**.  \n  \n#### To modify a control's property from within the Test Container  \n  \n1.  In Test Container, click **Invoke Methods** on the **Control** menu.  \n  \n     The **Invoke Method** dialog box is displayed.  \n  \n2.  Select the **PropPut** version of the **Sides** property from the **Method Name** drop-down list box.  \n  \n3.  Type `5` in the **Parameter Value** box, click **Set Value**, and click **Invoke**.  \n  \n Note that the control does not change. Although you changed the number of sides internally by setting the `m_nSides` variable, this did not cause the control to repaint. If you switch to another application and then switch back to Test Container, you will find that the control has repainted and has the correct number of sides.  \n  \n To correct this problem, add a call to the `FireViewChange` function, defined in `IViewObjectExImpl`, after you set the number of sides. If the control is running in its own window, `FireViewChange` will call the `InvalidateRect` method directly. If the control is running windowless, the `InvalidateRect` method will be called on the container's site interface. This forces the control to repaint itself.  \n  \n#### To add a call to FireViewChange  \n  \n1.  Update PolyCtl.cpp by adding the call to `FireViewChange` to the `put_Sides` method. When you have finished, the `put_Sides` method should look like this:  \n  \n     [!code-cpp[NVC_ATL_Windowing#55](../atl/codesnippet/cpp/changing-the-drawing-code-atl-tutorial-part-4_9.cpp)]  \n  \n After adding `FireViewChange`, rebuild and try the control again in the ActiveX Control Test Container. This time when you change the number of sides and click `Invoke`, you should see the control change immediately.  \n  \n In the next step, you will add an event.  \n  \n [Back to Step 3](../atl/adding-a-property-to-the-control-atl-tutorial-part-3.md) &#124; [On to Step 5](../atl/adding-an-event-atl-tutorial-part-5.md)  \n  \n## See Also  \n [Tutorial](../atl/active-template-library-atl-tutorial.md)   \n [Testing Properties and Events with Test Container](../mfc/testing-properties-and-events-with-test-container.md)\n\n"}