{"nodes":[{"pos":[12,82],"content":"Using Verifiable Assemblies with SQL Server (C++-CLI) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Using Verifiable Assemblies with SQL Server (C++-CLI) | Microsoft Docs","pos":[0,70]}]},{"content":"Using Verifiable Assemblies with SQL Server (C++/CLI)","pos":[662,715]},{"content":"Extended stored procedures, packaged as dynamic-link libraries (DLLs), provide a way to extend SQL Server functionality through functions developed with <ph id=\"ph1\">[!INCLUDE[vcprvc](../build/includes/vcprvc_md.md)]</ph>.","pos":[716,920],"source":"Extended stored procedures, packaged as dynamic-link libraries (DLLs), provide a way to extend SQL Server functionality through functions developed with [!INCLUDE[vcprvc](../build/includes/vcprvc_md.md)]."},{"content":"Extended stored procedures are implemented as functions inside DLLs.","pos":[921,989]},{"content":"In addition to functions, extended stored procedures can also define <bpt id=\"p1\">[</bpt>user-defined types<ept id=\"p1\">](../cpp/classes-and-structs-cpp.md)</ept> and <bpt id=\"p2\">[</bpt>aggregate functions<ept id=\"p2\">](http://msdn.microsoft.com/en-us/de255454-f45e-4281-81f9-bc61893ac5da)</ept> (such as SUM or AVG).","pos":[990,1232],"source":" In addition to functions, extended stored procedures can also define [user-defined types](../cpp/classes-and-structs-cpp.md) and [aggregate functions](http://msdn.microsoft.com/en-us/de255454-f45e-4281-81f9-bc61893ac5da) (such as SUM or AVG)."},{"content":"When a client executes an extended stored procedure, SQL Server searches for the DLL associated with the extended stored procedure and loads the DLL.","pos":[1239,1388]},{"content":"SQL Server calls the requested extended stored procedure and executes it under a specified security context.","pos":[1389,1497]},{"content":"The extended stored procedure then passes result sets and returns parameters back to the server.","pos":[1498,1594]},{"content":"provides extensions to Transact-SQL (T-SQL) to allow you to install verifiable assemblies into SQL Server.","pos":[1661,1767]},{"content":"The SQL Server permission set specifies the security context, with the following levels of security:","pos":[1768,1868]},{"content":"Unrestricted mode: Run code at your own risk; code does not have to be verifiably type-safe.","pos":[1878,1970]},{"content":"Safe mode: Run verifiably typesafe code; compiled with /clr:safe.","pos":[1980,2045]},{"content":"Safe mode requires the executed assemblies to be verifiably typesafe.","pos":[2052,2121]},{"content":"To create and load a verifiable assembly into SQL Server, use the Transact-SQL commands CREATE ASSEMBLY and DROP ASSEMBLY as follows:","pos":[2128,2261]},{"content":"The PERMISSION_SET command specifies the security context, and can have the values UNRESTRICTED, SAFE, or EXTENDED.","pos":[2413,2528]},{"content":"In addition, you can use the CREATE FUNCTION command to bind to method names in a class:","pos":[2535,2623]},{"content":"Example","pos":[2784,2791]},{"content":"The following SQL script (for example, named \"MyScript.sql\") loads an assembly into SQL Server and makes a method of a class available:","pos":[2795,2930]},{"content":"SQL scripts can be executed interactively in SQL Query Analyzer or at the command line with the sqlcmd.exe utility.","pos":[3392,3507]},{"content":"The following command line connects to MyServer, uses the default database, uses a trusted connection, inputs MyScript.sql, and outputs MyResult.txt.","pos":[3508,3657]},{"content":"See Also","pos":[3737,3745]},{"content":"How to: Migrate to /clr:safe (C++/CLI)","pos":[3750,3788]},{"content":"Classes and Structs","pos":[3844,3863]}],"content":"---\ntitle: \"Using Verifiable Assemblies with SQL Server (C++-CLI) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"verifiable assemblies [C++], with SQL Server\"\nms.assetid: 5248a60d-aa88-4ff3-b30a-b791c3ea2de9\ncaps.latest.revision: 21\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"ru-ru\"\n  - \"zh-cn\"\n  - \"zh-tw\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# Using Verifiable Assemblies with SQL Server (C++/CLI)\nExtended stored procedures, packaged as dynamic-link libraries (DLLs), provide a way to extend SQL Server functionality through functions developed with [!INCLUDE[vcprvc](../build/includes/vcprvc_md.md)]. Extended stored procedures are implemented as functions inside DLLs. In addition to functions, extended stored procedures can also define [user-defined types](../cpp/classes-and-structs-cpp.md) and [aggregate functions](http://msdn.microsoft.com/en-us/de255454-f45e-4281-81f9-bc61893ac5da) (such as SUM or AVG).  \n  \n When a client executes an extended stored procedure, SQL Server searches for the DLL associated with the extended stored procedure and loads the DLL. SQL Server calls the requested extended stored procedure and executes it under a specified security context. The extended stored procedure then passes result sets and returns parameters back to the server.  \n  \n [!INCLUDE[sqprsqlong](../dotnet/includes/sqprsqlong_md.md)] provides extensions to Transact-SQL (T-SQL) to allow you to install verifiable assemblies into SQL Server. The SQL Server permission set specifies the security context, with the following levels of security:  \n  \n-   Unrestricted mode: Run code at your own risk; code does not have to be verifiably type-safe.  \n  \n-   Safe mode: Run verifiably typesafe code; compiled with /clr:safe.  \n  \n Safe mode requires the executed assemblies to be verifiably typesafe.  \n  \n To create and load a verifiable assembly into SQL Server, use the Transact-SQL commands CREATE ASSEMBLY and DROP ASSEMBLY as follows:  \n  \n```  \nCREATE ASSEMBLY <assemblyName> FROM <'Assembly UNC Path'> WITH   \n  PERMISSION_SET <permissions>  \nDROP ASSEMBLY <assemblyName>  \n```  \n  \n The PERMISSION_SET command specifies the security context, and can have the values UNRESTRICTED, SAFE, or EXTENDED.  \n  \n In addition, you can use the CREATE FUNCTION command to bind to method names in a class:  \n  \n```  \nCREATE FUNCTION <FunctionName>(<FunctionParams>)  \nRETURNS returnType  \n[EXTERNAL NAME <AssemblyName>:<ClassName>::<StaticMethodName>]  \n```  \n  \n## Example  \n The following SQL script (for example, named \"MyScript.sql\") loads an assembly into SQL Server and makes a method of a class available:  \n  \n```  \n-- Create assembly without external access  \ndrop assembly stockNoEA  \ngo  \ncreate assembly stockNoEA  \nfrom   \n'c:\\stockNoEA.dll'  \nwith permission_set safe  \n  \n-- Create function on assembly with no external access  \ndrop function GetQuoteNoEA  \ngo  \ncreate function GetQuoteNoEA(@sym nvarchar(10))  \nreturns real  \nexternal name stockNoEA:StockQuotes::GetQuote  \ngo  \n  \n-- To call the function  \nselect dbo.GetQuoteNoEA('MSFT')  \ngo  \n```  \n  \n SQL scripts can be executed interactively in SQL Query Analyzer or at the command line with the sqlcmd.exe utility. The following command line connects to MyServer, uses the default database, uses a trusted connection, inputs MyScript.sql, and outputs MyResult.txt.  \n  \n```  \nsqlcmd –S MyServer -E –i myScript.sql –o myResult.txt  \n```  \n  \n## See Also  \n [How to: Migrate to /clr:safe (C++/CLI)](../dotnet/how-to-migrate-to-clr-safe-cpp-cli.md)   \n [Classes and Structs](../cpp/classes-and-structs-cpp.md)"}