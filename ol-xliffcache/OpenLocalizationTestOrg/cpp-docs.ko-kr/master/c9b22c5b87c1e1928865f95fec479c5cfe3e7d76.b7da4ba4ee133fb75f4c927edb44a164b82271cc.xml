{"nodes":[{"pos":[12,73],"content":"Walkthrough: Debugging a C++ AMP Application | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Walkthrough: Debugging a C++ AMP Application | Microsoft Docs","pos":[0,61]}]},{"content":"Walkthrough: Debugging a C++ AMP Application","pos":[758,802]},{"content":"This topic demonstrates how to debug an application that uses C++ Accelerated Massive Parallelism (C++ AMP) to take advantage of the graphics processing unit (GPU).","pos":[803,967]},{"content":"It uses a parallel-reduction program that sums up a large array of integers.","pos":[968,1044]},{"content":"This walkthrough illustrates the following tasks:","pos":[1045,1094]},{"content":"Launching the GPU debugger.","pos":[1104,1131]},{"content":"Inspecting GPU threads in the GPU Threads window.","pos":[1141,1190]},{"content":"Using the Parallel Stacks window to simultaneously observe the call stacks of multiple GPU threads.","pos":[1200,1299]},{"content":"Using the Parallel Watch window to inspect values of a single expression across multiple threads at the same time.","pos":[1309,1423]},{"content":"Flagging, freezing, thawing, and grouping GPU threads.","pos":[1433,1487]},{"content":"Executing all the threads of a tile to a specific location in code.","pos":[1497,1564]},{"content":"Prerequisites","pos":[1573,1586]},{"content":"Before you start this walkthrough:","pos":[1590,1624]},{"pos":[1634,1698],"content":"Read <bpt id=\"p1\">[</bpt>C++ AMP Overview<ept id=\"p1\">](../../parallel/amp/cpp-amp-overview.md)</ept>.","source":"Read [C++ AMP Overview](../../parallel/amp/cpp-amp-overview.md)."},{"content":"Make sure that line numbers are displayed in the text editor.","pos":[1708,1769]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Display Line Numbers in the Editor<ept id=\"p1\">](http://msdn.microsoft.com/library/40b38559-b8de-4041-91f2-68986767c976)</ept>.","pos":[1770,1913],"source":" For more information, see [How to: Display Line Numbers in the Editor](http://msdn.microsoft.com/library/40b38559-b8de-4041-91f2-68986767c976)."},{"pos":[1923,2130],"content":"Make sure you are running <ph id=\"ph1\">[!INCLUDE[win8](../../build/reference/includes/win8_md.md)]</ph> or <ph id=\"ph2\">[!INCLUDE[winserver8](../../build/reference/includes/winserver8_md.md)]</ph> to support debugging on the software emulator.","source":"Make sure you are running [!INCLUDE[win8](../../build/reference/includes/win8_md.md)] or [!INCLUDE[winserver8](../../build/reference/includes/winserver8_md.md)] to support debugging on the software emulator."},{"content":"To create the sample project","pos":[2228,2256]},{"content":"Start Visual Studio.","pos":[2266,2286]},{"pos":[2296,2351],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>.","source":"On the menu bar, choose **File**, **New**, **Project**."},{"pos":[2361,2426],"content":"Under <bpt id=\"p1\">**</bpt>Installed<ept id=\"p1\">**</ept> in the templates pane, choose <bpt id=\"p2\">**</bpt>Visual C++<ept id=\"p2\">**</ept>.","source":"Under **Installed** in the templates pane, choose **Visual C++**."},{"pos":[2436,2549],"content":"Choose <bpt id=\"p1\">**</bpt>Win32 Console Application<ept id=\"p1\">**</ept>, type <ph id=\"ph1\">`AMPMapReduce`</ph> in the <bpt id=\"p2\">**</bpt>Name<ept id=\"p2\">**</ept> box, and then choose the <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept> button.","source":"Choose **Win32 Console Application**, type `AMPMapReduce` in the **Name** box, and then choose the **OK** button."},{"pos":[2559,2586],"content":"Choose the <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> button.","source":"Choose the **Next** button."},{"pos":[2596,2678],"content":"Clear the <bpt id=\"p1\">**</bpt>Precompiled header<ept id=\"p1\">**</ept> check box, and then choose the <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept> button.","source":"Clear the **Precompiled header** check box, and then choose the **Finish** button."},{"pos":[2688,2776],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, delete stdafx.h, targetver.h, and stdafx.cpp from the project.","source":"In **Solution Explorer**, delete stdafx.h, targetver.h, and stdafx.cpp from the project."},{"content":"Open AMPMapReduce.cpp and replace its content with the following code.","pos":[2786,2856]},{"pos":[6390,6437],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Save All<ept id=\"p2\">**</ept>.","source":"On the menu bar, choose **File**, **Save All**."},{"pos":[6447,6549],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the shortcut menu for <bpt id=\"p2\">**</bpt>AMPMapReduce<ept id=\"p2\">**</ept>, and then choose <bpt id=\"p3\">**</bpt>Properties<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, open the shortcut menu for **AMPMapReduce**, and then choose **Properties**."},{"pos":[6559,6675],"content":"In the <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box, under <bpt id=\"p2\">**</bpt>Configuration Properties<ept id=\"p2\">**</ept>, choose <bpt id=\"p3\">**</bpt>C/C++<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Precompiled Headers<ept id=\"p4\">**</ept>.","source":"In the **Property Pages** dialog box, under **Configuration Properties**, choose **C/C++**, **Precompiled Headers**."},{"pos":[6685,6802],"content":"For the <bpt id=\"p1\">**</bpt>Precompiled Header<ept id=\"p1\">**</ept> property, select <bpt id=\"p2\">**</bpt>Not Using Precompiled Headers<ept id=\"p2\">**</ept>, and then choose the <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept> button.","source":"For the **Precompiled Header** property, select **Not Using Precompiled Headers**, and then choose the **OK** button."},{"pos":[6812,6866],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Build Solution<ept id=\"p2\">**</ept>.","source":"On the menu bar, choose **Build**, **Build Solution**."},{"content":"Debugging the CPU Code","pos":[6875,6897]},{"content":"In this procedure, you will use the Local Windows Debugger to make sure that the CPU code in this application is correct.","pos":[6901,7022]},{"content":"The segment of the CPU code in this application that is especially interesting is the <ph id=\"ph1\">`for`</ph> loop in the <ph id=\"ph2\">`reduction_sum_gpu_kernel`</ph> function.","pos":[7023,7163],"source":" The segment of the CPU code in this application that is especially interesting is the `for` loop in the `reduction_sum_gpu_kernel` function."},{"content":"It controls the tree-based parallel reduction that is run on the GPU.","pos":[7164,7233]},{"content":"To debug the CPU code","pos":[7243,7264]},{"pos":[7274,7376],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the shortcut menu for <bpt id=\"p2\">**</bpt>AMPMapReduce<ept id=\"p2\">**</ept>, and then choose <bpt id=\"p3\">**</bpt>Properties<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, open the shortcut menu for **AMPMapReduce**, and then choose **Properties**."},{"content":"In the <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box, under <bpt id=\"p2\">**</bpt>Configuration Properties<ept id=\"p2\">**</ept>, choose <bpt id=\"p3\">**</bpt>Debugging<ept id=\"p3\">**</ept>.","pos":[7386,7481],"source":"In the **Property Pages** dialog box, under **Configuration Properties**, choose **Debugging**."},{"content":"Verify that <bpt id=\"p1\">**</bpt>Local Windows Debugger<ept id=\"p1\">**</ept> is selected in the <bpt id=\"p2\">**</bpt>Debugger to launch<ept id=\"p2\">**</ept> list.","pos":[7482,7568],"source":" Verify that **Local Windows Debugger** is selected in the **Debugger to launch** list."},{"content":"Return to the Code Editor.","pos":[7578,7604]},{"content":"Set breakpoints on the lines of code shown in the following illustration (approximately lines 67 line 70).","pos":[7614,7720]},{"content":"CPU breakpoints","pos":[7733,7748]},{"content":"CPU breakpoints","pos":[7822,7837]},{"pos":[7847,7902],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Start Debugging<ept id=\"p2\">**</ept>.","source":"On the menu bar, choose **Debug**, **Start Debugging**."},{"pos":[7912,8017],"content":"In the <bpt id=\"p1\">**</bpt>Locals<ept id=\"p1\">**</ept> window, observe the value for <ph id=\"ph1\">`stride_size`</ph> until the breakpoint at line 70 is reached.","source":"In the **Locals** window, observe the value for `stride_size` until the breakpoint at line 70 is reached."},{"pos":[8027,8081],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Stop Debugging<ept id=\"p2\">**</ept>.","source":"On the menu bar, choose **Debug**, **Stop Debugging**."},{"content":"Debugging the GPU Code","pos":[8090,8112]},{"content":"This section shows how to debug the GPU code, which is the code contained in the <ph id=\"ph1\">`sum_kernel_tiled`</ph> function.","pos":[8116,8225],"source":"This section shows how to debug the GPU code, which is the code contained in the `sum_kernel_tiled` function."},{"content":"The GPU code computes the sum of integers for each \"block\" in parallel.","pos":[8226,8297]},{"content":"To debug the GPU code","pos":[8307,8328]},{"pos":[8338,8440],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the shortcut menu for <bpt id=\"p2\">**</bpt>AMPMapReduce<ept id=\"p2\">**</ept>, and then choose <bpt id=\"p3\">**</bpt>Properties<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, open the shortcut menu for **AMPMapReduce**, and then choose **Properties**."},{"pos":[8450,8545],"content":"In the <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box, under <bpt id=\"p2\">**</bpt>Configuration Properties<ept id=\"p2\">**</ept>, choose <bpt id=\"p3\">**</bpt>Debugging<ept id=\"p3\">**</ept>.","source":"In the **Property Pages** dialog box, under **Configuration Properties**, choose **Debugging**."},{"pos":[8555,8625],"content":"In the <bpt id=\"p1\">**</bpt>Debugger to launch<ept id=\"p1\">**</ept> list, select <bpt id=\"p2\">**</bpt>Local Windows Debugger<ept id=\"p2\">**</ept>.","source":"In the **Debugger to launch** list, select **Local Windows Debugger**."},{"pos":[8635,8686],"content":"In the <bpt id=\"p1\">**</bpt>Debugger Type<ept id=\"p1\">**</ept> list, select <bpt id=\"p2\">**</bpt>GPU Only<ept id=\"p2\">**</ept>.","source":"In the **Debugger Type** list, select **GPU Only**."},{"pos":[8696,8721],"content":"Choose the <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> button.","source":"Choose the **OK** button."},{"content":"Set a breakpoint at line 30, as shown in the following illustration.","pos":[8731,8799]},{"content":"GPU breakpoints","pos":[8812,8827]},{"content":"GPU breakpoint","pos":[8901,8915]},{"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Start Debugging<ept id=\"p2\">**</ept>.","pos":[8925,8980],"source":"On the menu bar, choose **Debug**, **Start Debugging**."},{"content":"The breakpoints in the CPU code at lines 67 and 70 are not executed during GPU debugging because those lines of code are executed on the CPU.","pos":[8981,9122]},{"content":"To use the GPU Threads window","pos":[9132,9161]},{"pos":[9171,9267],"content":"To open the GPU Threads window, on the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Windows<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>GPU Threads<ept id=\"p3\">**</ept>.","source":"To open the GPU Threads window, on the menu bar, choose **Debug**, **Windows**, **GPU Threads**."},{"content":"You can inspect the state the GPU threads in the GPU Threads window that appears.","pos":[9278,9359]},{"content":"Dock the GPU Threads window at the bottom of Visual Studio.","pos":[9369,9428]},{"content":"Choose the <bpt id=\"p1\">**</bpt>Expand Thread Switch<ept id=\"p1\">**</ept> button to display the tile and thread text boxes.","pos":[9429,9514],"source":" Choose the **Expand Thread Switch** button to display the tile and thread text boxes."},{"content":"The GPU Threads window shows the total number of active and blocked GPU threads, as shown in the following illustration.","pos":[9515,9635]},{"content":"GPU Threads window with 4 active threads","pos":[9648,9688]},{"content":"GPU Threads window","pos":[9736,9754]},{"content":"There are 313 tiles allocated for this computation.","pos":[9765,9816]},{"content":"Each tile contains 32 threads.","pos":[9817,9847]},{"content":"Because local GPU debugging occurs on a software emulator, there are four active GPU threads.","pos":[9848,9941]},{"content":"The four threads execute the instructions simultaneously and then move on together to the next instruction.","pos":[9942,10049]},{"content":"In the GPU threads window, there are four GPU threads active and 28 GPU threads blocked at the <bpt id=\"p1\">[</bpt>tile_barrier::wait<ept id=\"p1\">](reference/tile-barrier-class.md#wait)</ept> statement defined at about line 21 (<ph id=\"ph1\">`t_idx.barrier.wait();`</ph>).","pos":[10060,10275],"source":"In the GPU threads window, there are four GPU threads active and 28 GPU threads blocked at the [tile_barrier::wait](reference/tile-barrier-class.md#wait) statement defined at about line 21 (`t_idx.barrier.wait();`)."},{"content":"All 32 GPU threads belong to the first tile, <ph id=\"ph1\">`tile[0]`</ph>.","pos":[10276,10331],"source":" All 32 GPU threads belong to the first tile, `tile[0]`."},{"content":"An arrow points to the row that includes the current thread.","pos":[10332,10392]},{"content":"To switch to a different thread, use one of the following methods:","pos":[10393,10459]},{"content":"In the row for the thread to switch to in the GPU Threads window, open the shortcut menu and choose <bpt id=\"p1\">**</bpt>Switch To Thread<ept id=\"p1\">**</ept>.","pos":[10474,10595],"source":"In the row for the thread to switch to in the GPU Threads window, open the shortcut menu and choose **Switch To Thread**."},{"content":"If the row represents more than one thread, you will switch to the first thread according to the thread coordinates.","pos":[10596,10712]},{"pos":[10726,10850],"content":"Enter the tile and thread values of the thread in the corresponding text boxes and then choose the <bpt id=\"p1\">**</bpt>Switch Thread<ept id=\"p1\">**</ept> button.","source":"Enter the tile and thread values of the thread in the corresponding text boxes and then choose the **Switch Thread** button."},{"content":"The Call Stack window displays the call stack of the current GPU thread.","pos":[10861,10933]},{"content":"To use the Parallel Stacks window","pos":[10943,10976]},{"pos":[10986,11090],"content":"To open the Parallel Stacks window, on the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Windows<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Parallel Stacks<ept id=\"p3\">**</ept>.","source":"To open the Parallel Stacks window, on the menu bar, choose **Debug**, **Windows**, **Parallel Stacks**."},{"content":"You can use the Parallel Stacks window to simultaneously inspect the stack frames of multiple GPU threads.","pos":[11101,11207]},{"content":"Dock the Parallel Stacks window at the bottom of Visual Studio.","pos":[11217,11280]},{"content":"Make sure that <bpt id=\"p1\">**</bpt>Threads<ept id=\"p1\">**</ept> is selected in the list in the upper-left corner.","pos":[11290,11366],"source":"Make sure that **Threads** is selected in the list in the upper-left corner."},{"content":"In the following illustration, the Parallel Stacks window shows a call-stack focused view of the GPU threads that you saw in the GPU Threads window.","pos":[11367,11515]},{"content":"Parallel Stacks window with 4 active threads","pos":[11528,11572]},{"content":"Parallel Stacks window","pos":[11620,11642]},{"content":"32 threads went from <ph id=\"ph1\">`_kernel_stub`</ph> to the lambda statement in the <ph id=\"ph2\">`parallel_for_each`</ph> function call and then to the <ph id=\"ph3\">`sum_kernel_tiled`</ph> function, where the parallel reduction occurs.","pos":[11653,11835],"source":"32 threads went from `_kernel_stub` to the lambda statement in the `parallel_for_each` function call and then to the `sum_kernel_tiled` function, where the parallel reduction occurs."},{"content":"28 out of the 32 threads have progressed to the <bpt id=\"p1\">[</bpt>tile_barrier::wait<ept id=\"p1\">](reference/tile-barrier-class.md#wait)</ept> statement and remain blocked at line 22, whereas the other 4 threads remain active in the <ph id=\"ph1\">`sum_kernel_tiled`</ph> function at line 30.","pos":[11836,12072],"source":" 28 out of the 32 threads have progressed to the [tile_barrier::wait](reference/tile-barrier-class.md#wait) statement and remain blocked at line 22, whereas the other 4 threads remain active in the `sum_kernel_tiled` function at line 30."},{"content":"You can inspect the properties of a GPU thread that are available in the GPU Threads window in the rich DataTip of the Parallel Stacks window.","pos":[12084,12226]},{"content":"To do this, rest the mouse pointer on the stack frame of <bpt id=\"p1\">**</bpt>sum_kernel_tiled<ept id=\"p1\">**</ept>.","pos":[12227,12305],"source":" To do this, rest the mouse pointer on the stack frame of **sum_kernel_tiled**."},{"content":"The following illustration shows the DataTip.","pos":[12306,12351]},{"content":"DataTip for Parallel Stacks window","pos":[12364,12398]},{"content":"GPU thread DataTip","pos":[12446,12464]},{"pos":[12475,12626],"content":"For more information about the Parallel Stacks window, see <bpt id=\"p1\">[</bpt>Using the Parallel Stacks Window<ept id=\"p1\">](/visualstudio/debugger/using-the-parallel-stacks-window)</ept>.","source":"For more information about the Parallel Stacks window, see [Using the Parallel Stacks Window](/visualstudio/debugger/using-the-parallel-stacks-window)."},{"content":"To use the Parallel Watch window","pos":[12636,12668]},{"pos":[12678,12802],"content":"To open the Parallel Watch window, on the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Windows<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Parallel Watch<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Parallel Watch 1<ept id=\"p4\">**</ept>.","source":"To open the Parallel Watch window, on the menu bar, choose **Debug**, **Windows**, **Parallel Watch**, **Parallel Watch 1**."},{"content":"You can use the Parallel Watch window to inspect the values of an expression across multiple threads.","pos":[12813,12914]},{"content":"Dock the Parallel Watch 1 window to the bottom of Visual Studio.","pos":[12924,12988]},{"content":"There are 32 rows in the table of the Parallel Watch window.","pos":[12989,13049]},{"content":"Each corresponds to a GPU thread that appeared in both the GPU Threads window and the Parallel Stacks window.","pos":[13050,13159]},{"content":"Now, you can enter expressions whose values you want to inspect across all 32 GPU threads.","pos":[13160,13250]},{"pos":[13260,13348],"content":"Select the <bpt id=\"p1\">**</bpt>Add Watch<ept id=\"p1\">**</ept> column header, enter <ph id=\"ph1\">`localIdx`</ph>, and then choose the Enter key.","source":"Select the **Add Watch** column header, enter `localIdx`, and then choose the Enter key."},{"pos":[13358,13452],"content":"Select the <bpt id=\"p1\">**</bpt>Add Watch<ept id=\"p1\">**</ept> column header again, type <ph id=\"ph1\">`globalIdx`</ph>, and then choose the Enter key.","source":"Select the **Add Watch** column header again, type `globalIdx`, and then choose the Enter key."},{"pos":[13462,13566],"content":"Select the <bpt id=\"p1\">**</bpt>Add Watch<ept id=\"p1\">**</ept> column header again, type <ph id=\"ph1\">`localA[localIdx[0]]`</ph>, and then choose the Enter key.","source":"Select the **Add Watch** column header again, type `localA[localIdx[0]]`, and then choose the Enter key."},{"content":"You can sort by a specified expression by selecting its corresponding column header.","pos":[13577,13661]},{"content":"Select the <bpt id=\"p1\">**</bpt>localA[localIdx[0]]<ept id=\"p1\">**</ept> column header to sort the column.","pos":[13672,13740],"source":"Select the **localA[localIdx[0]]** column header to sort the column."},{"content":"The following illustration shows the results of sorting by <bpt id=\"p1\">**</bpt>localA[localIdx[0]]<ept id=\"p1\">**</ept>.","pos":[13741,13824],"source":" The following illustration shows the results of sorting by **localA[localIdx[0]]**."},{"pos":[13835,13942],"content":"![Parallel Watch window with sorted results](../../parallel/amp/media/campf.png \"campf\")  \nResults of sort","leadings":[""," "],"nodes":[{"content":"Parallel Watch window with sorted results","pos":[2,43]},{"content":"Results of sort","pos":[91,106]}]},{"content":"You can export the content in the Parallel Watch window to Excel by choosing the Excel button and then choosing <bpt id=\"p1\">**</bpt>Open in Excel<ept id=\"p1\">**</ept>.","pos":[13953,14083],"source":"You can export the content in the Parallel Watch window to Excel by choosing the Excel button and then choosing **Open in Excel**."},{"content":"If you have Excel installed on your development computer, this opens an Excel worksheet that contains the content.","pos":[14084,14198]},{"content":"In the upper-right corner of the Parallel Watch window, there's a filter control that you can use to filter the content by using Boolean expressions.","pos":[14208,14357]},{"content":"Enter <ph id=\"ph1\">`localA[localIdx[0]] &gt; 20000`</ph> in the filter control text box and then choose the Enter key.","pos":[14358,14455],"source":" Enter `localA[localIdx[0]] > 20000` in the filter control text box and then choose the Enter key."},{"content":"The window now contains only threads on which the <ph id=\"ph1\">`localA[localIdx[0]]`</ph> value is greater than 20000.","pos":[14466,14566],"source":"The window now contains only threads on which the `localA[localIdx[0]]` value is greater than 20000."},{"content":"The content is still sorted by the <ph id=\"ph1\">`localA[localIdx[0]]`</ph> column, which is the sorting action you performed earlier.","pos":[14567,14682],"source":" The content is still sorted by the `localA[localIdx[0]]` column, which is the sorting action you performed earlier."},{"content":"Flagging GPU Threads","pos":[14691,14711]},{"content":"You can mark specific GPU threads by flagging them in the GPU Threads window, the Parallel Watch window, or the DataTip in the Parallel Stacks window.","pos":[14715,14865]},{"content":"If a row in the GPU Threads window contains more than one thread, flagging that row flags all threads that are contained in the row.","pos":[14866,14998]},{"content":"To flag GPU threads","pos":[15008,15027]},{"pos":[15037,15145],"content":"Select the <bpt id=\"p1\">**</bpt>[Thread]<ept id=\"p1\">**</ept> column header in the Parallel Watch 1 window to sort by tile index and thread index.","source":"Select the **[Thread]** column header in the Parallel Watch 1 window to sort by tile index and thread index."},{"pos":[15155,15324],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Continue<ept id=\"p2\">**</ept>, which causes the four threads that were active to progress to the next barrier (defined at line 32 of AMPMapReduce.cpp).","source":"On the menu bar, choose **Debug**, **Continue**, which causes the four threads that were active to progress to the next barrier (defined at line 32 of AMPMapReduce.cpp)."},{"content":"Choose the flag symbol on the left side of the row that contains the four threads that are now active.","pos":[15334,15436]},{"content":"The following illustration shows the four active flagged threads in the GPU Threads window.","pos":[15447,15538]},{"content":"GPU Threads window with flagged threads","pos":[15551,15590]},{"content":"Active threads in the GPU Threads window","pos":[15638,15678]},{"content":"The Parallel Watch window and the DataTip of the Parallel stacks window both indicate the flagged threads.","pos":[15689,15795]},{"content":"If you want to focus on the four threads that you flagged, you can choose to show, in the GPU Threads, Parallel Watch, and Parallel Stacks windows, only the flagged threads.","pos":[15805,15978]},{"content":"Choose the Show Flagged Only button on any of the windows or on the <bpt id=\"p1\">**</bpt>Debug Location<ept id=\"p1\">**</ept> toolbar.","pos":[15989,16084],"source":"Choose the Show Flagged Only button on any of the windows or on the **Debug Location** toolbar."},{"content":"The following illustration shows the Show Flagged Only button on the <bpt id=\"p1\">**</bpt>Debug Location<ept id=\"p1\">**</ept> toolbar.","pos":[16085,16181],"source":" The following illustration shows the Show Flagged Only button on the **Debug Location** toolbar."},{"content":"Debug Location toolbar with Show Only Flagged icon","pos":[16194,16244]},{"content":"Show Flagged Only button","pos":[16292,16316]},{"content":"Now the GPU Threads, Parallel Watch, and Parallel Stacks windows display only the flagged threads.","pos":[16327,16425]},{"content":"Freezing and Thawing GPU Threads","pos":[16434,16466]},{"content":"You can freeze (suspend) and thaw (resume) GPU threads from either the GPU Threads window or the Parallel Watch window.","pos":[16470,16589]},{"content":"You can freeze and thaw CPU threads the same way; for information, see <bpt id=\"p1\">[</bpt>How to: Use the Threads Window<ept id=\"p1\">](http://msdn.microsoft.com/library/adfbe002-3d7b-42a9-b42a-5ac0903dfc25)</ept>.","pos":[16590,16766],"source":" You can freeze and thaw CPU threads the same way; for information, see [How to: Use the Threads Window](http://msdn.microsoft.com/library/adfbe002-3d7b-42a9-b42a-5ac0903dfc25)."},{"content":"To freeze and thaw GPU threads","pos":[16776,16806]},{"pos":[16816,16883],"content":"Choose the <bpt id=\"p1\">**</bpt>Show Flagged Only<ept id=\"p1\">**</ept> button to display all the threads.","source":"Choose the **Show Flagged Only** button to display all the threads."},{"pos":[16893,16941],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Continue<ept id=\"p2\">**</ept>.","source":"On the menu bar, choose **Debug**, **Continue**."},{"pos":[16951,17020],"content":"Open the shortcut menu for the active row and then choose <bpt id=\"p1\">**</bpt>Freeze<ept id=\"p1\">**</ept>.","source":"Open the shortcut menu for the active row and then choose **Freeze**."},{"content":"The following illustration of the GPU Threads window shows that all four threads are frozen.","pos":[17031,17123]},{"content":"GPU Threads windows showing frozen threads","pos":[17136,17178]},{"content":"Frozen threads in the GPU Threads window","pos":[17226,17266]},{"content":"Similarly, the Parallel Watch window shows that all four threads are frozen.","pos":[17277,17353]},{"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Continue<ept id=\"p2\">**</ept> to allow the next four GPU threads to progress past the barrier at line 22 and to reach the breakpoint at line 30.","pos":[17363,17525],"source":"On the menu bar, choose **Debug**, **Continue** to allow the next four GPU threads to progress past the barrier at line 22 and to reach the breakpoint at line 30."},{"content":"The GPU Threads window shows that the four previously frozen threads remain frozen and in the active state.","pos":[17526,17633]},{"pos":[17643,17691],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Continue<ept id=\"p2\">**</ept>.","source":"On the menu bar, choose **Debug**, **Continue**."},{"content":"From the Parallel Watch window, you can also thaw individual or multiple GPU threads.","pos":[17701,17786]},{"content":"To group GPU threads","pos":[17796,17816]},{"pos":[17826,17934],"content":"On the shortcut menu for one of the threads in the <bpt id=\"p1\">**</bpt>GPU Threads<ept id=\"p1\">**</ept> window, choose <bpt id=\"p2\">**</bpt>Group By<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Address<ept id=\"p3\">**</ept>.","source":"On the shortcut menu for one of the threads in the **GPU Threads** window, choose **Group By**, **Address**."},{"content":"The threads in the GPU Threads window are grouped by address.","pos":[17945,18006]},{"content":"The address corresponds to the instruction in disassembly where each group of threads is located.","pos":[18007,18104]},{"content":"24 threads are at line 22 where the <bpt id=\"p1\">[</bpt>tile_barrier::wait Method<ept id=\"p1\">](reference/tile-barrier-class.md#wait)</ept> is executed.","pos":[18105,18219],"source":" 24 threads are at line 22 where the [tile_barrier::wait Method](reference/tile-barrier-class.md#wait) is executed."},{"content":"12 threads are at the instruction for the barrier at line 32.","pos":[18220,18281]},{"content":"Four of these threads are flagged.","pos":[18282,18316]},{"content":"Eight threads are at the breakpoint at line 30.","pos":[18317,18364]},{"content":"Four of these threads are frozen.","pos":[18365,18398]},{"content":"The following illustration shows the grouped threads in the GPU Threads window.","pos":[18399,18478]},{"content":"GPU Threads window with threads grouped by Address","pos":[18492,18542]},{"content":"Grouped threads in the GPU Threads window","pos":[18590,18631]},{"pos":[18641,18875],"content":"You can also perform the <bpt id=\"p1\">**</bpt>Group By<ept id=\"p1\">**</ept> operation by opening the shortcut menu for the data grid of the Parallel Watch window, choosing <bpt id=\"p2\">**</bpt>Group By<ept id=\"p2\">**</ept>, and then choosing the menu item that corresponds to how you want to group the threads.","source":"You can also perform the **Group By** operation by opening the shortcut menu for the data grid of the Parallel Watch window, choosing **Group By**, and then choosing the menu item that corresponds to how you want to group the threads."},{"content":"Running All Threads to a Specific Location in Code","pos":[18884,18934]},{"pos":[18938,19055],"content":"You run all the threads in a given tile to the line that contains the cursor by using <bpt id=\"p1\">**</bpt>Run Current Tile To Cursor<ept id=\"p1\">**</ept>.","source":"You run all the threads in a given tile to the line that contains the cursor by using **Run Current Tile To Cursor**."},{"content":"To run all threads to the location marked by the cursor","pos":[19065,19120]},{"pos":[19130,19191],"content":"On the shortcut menu for the frozen threads, choose <bpt id=\"p1\">**</bpt>Thaw<ept id=\"p1\">**</ept>.","source":"On the shortcut menu for the frozen threads, choose **Thaw**."},{"content":"In the Code Editor, put the cursor in line 30.","pos":[19201,19247]},{"pos":[19257,19337],"content":"On the shortcut menu for the Code Editor, choose <bpt id=\"p1\">**</bpt>Run Current Tile To Cursor<ept id=\"p1\">**</ept>.","source":"On the shortcut menu for the Code Editor, choose **Run Current Tile To Cursor**."},{"content":"The 24 threads that were previously blocked at the barrier at line 21 have progressed to line 32.","pos":[19348,19445]},{"content":"This is shown in the <bpt id=\"p1\">**</bpt>GPU Threads<ept id=\"p1\">**</ept> window.","pos":[19446,19490],"source":" This is shown in the **GPU Threads** window."},{"content":"See Also","pos":[19499,19507]},{"content":"C++ AMP Overview","pos":[19512,19528]},{"content":"Debugging GPU Code","pos":[19575,19593]},{"content":"How to: Use the GPU Threads Window","pos":[19643,19677]},{"content":"How to: Use the Parallel Watch Window","pos":[19756,19793]},{"content":"Analyzing C++ AMP Code with the Concurrency Visualizer","pos":[19872,19926]}],"content":"---\ntitle: \"Walkthrough: Debugging a C++ AMP Application | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"debugging, C++ Accelerated Massive Parallelism\"\n  - \"C++ AMP, debugging\"\n  - \"C++ Accelerated Massive Parallelism, debugging\"\n  - \"debugging, C++ AMP\"\nms.assetid: 40e92ecc-f6ba-411c-960c-b3047b854fb5\ncaps.latest.revision: 35\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"ru-ru\"\n  - \"zh-cn\"\n  - \"zh-tw\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# Walkthrough: Debugging a C++ AMP Application\nThis topic demonstrates how to debug an application that uses C++ Accelerated Massive Parallelism (C++ AMP) to take advantage of the graphics processing unit (GPU). It uses a parallel-reduction program that sums up a large array of integers. This walkthrough illustrates the following tasks:  \n  \n-   Launching the GPU debugger.  \n  \n-   Inspecting GPU threads in the GPU Threads window.  \n  \n-   Using the Parallel Stacks window to simultaneously observe the call stacks of multiple GPU threads.  \n  \n-   Using the Parallel Watch window to inspect values of a single expression across multiple threads at the same time.  \n  \n-   Flagging, freezing, thawing, and grouping GPU threads.  \n  \n-   Executing all the threads of a tile to a specific location in code.  \n  \n## Prerequisites  \n Before you start this walkthrough:  \n  \n-   Read [C++ AMP Overview](../../parallel/amp/cpp-amp-overview.md).  \n  \n-   Make sure that line numbers are displayed in the text editor. For more information, see [How to: Display Line Numbers in the Editor](http://msdn.microsoft.com/library/40b38559-b8de-4041-91f2-68986767c976).  \n  \n-   Make sure you are running [!INCLUDE[win8](../../build/reference/includes/win8_md.md)] or [!INCLUDE[winserver8](../../build/reference/includes/winserver8_md.md)] to support debugging on the software emulator.  \n  \n [!INCLUDE[note_settings_general](../../mfc/includes/note_settings_general_md.md)]  \n  \n### To create the sample project  \n  \n1.  Start Visual Studio.  \n  \n2.  On the menu bar, choose **File**, **New**, **Project**.  \n  \n3.  Under **Installed** in the templates pane, choose **Visual C++**.  \n  \n4.  Choose **Win32 Console Application**, type `AMPMapReduce` in the **Name** box, and then choose the **OK** button.  \n  \n5.  Choose the **Next** button.  \n  \n6.  Clear the **Precompiled header** check box, and then choose the **Finish** button.  \n  \n7.  In **Solution Explorer**, delete stdafx.h, targetver.h, and stdafx.cpp from the project.  \n  \n8.  Open AMPMapReduce.cpp and replace its content with the following code.  \n  \n ```cpp  \n  \n    // AMPMapReduce.cpp defines the entry point for the program.  \n    // The program performs a parallel-sum reduction that computes the sum of an array of integers.   \n  \n    #include <stdio.h>  \n    #include <tchar.h>  \n    #include <amp.h>  \n  \n    const int BLOCK_DIM = 32;  \n  \n    using namespace concurrency;  \n  \n    void sum_kernel_tiled(tiled_index<BLOCK_DIM> t_idx, array<int, 1> &A, int stride_size) restrict(amp)  \n    {  \n        tile_static int localA[BLOCK_DIM];  \n  \n        index<1> globalIdx = t_idx.global * stride_size;  \n        index<1> localIdx = t_idx.local;  \n  \n        localA[localIdx[0]] =  A[globalIdx];  \n  \n        t_idx.barrier.wait();  \n  \n        // Aggregate all elements in one tile into the first element.  \n        for (int i = BLOCK_DIM / 2; i > 0; i /= 2)   \n        {  \n            if (localIdx[0] < i)   \n            {  \n  \n                localA[localIdx[0]] += localA[localIdx[0] + i];  \n            }  \n  \n            t_idx.barrier.wait();  \n        }  \n  \n        if (localIdx[0] == 0)  \n        {  \n            A[globalIdx] = localA[0];  \n        }  \n    }  \n  \n    int size_after_padding(int n)  \n    {  \n        // The extent might have to be slightly bigger than num_stride to   \n        // be evenly divisible by BLOCK_DIM. You can do this by padding with zeros.  \n        // The calculation to do this is BLOCK_DIM * ceil(n / BLOCK_DIM)  \n        return ((n - 1) / BLOCK_DIM + 1) * BLOCK_DIM;  \n    }  \n  \n    int reduction_sum_gpu_kernel(array<int, 1> input)   \n    {  \n        int len = input.extent[0];  \n  \n        //Tree-based reduction control that uses the CPU.  \n        for (int stride_size = 1; stride_size < len; stride_size *= BLOCK_DIM)   \n        {  \n            // Number of useful values in the array, given the current  \n            // stride size.  \n            int num_strides = len / stride_size;    \n  \n            extent<1> e(size_after_padding(num_strides));  \n  \n            // The sum kernel that uses the GPU.  \n            parallel_for_each(extent<1>(e).tile<BLOCK_DIM>(), [&input, stride_size] (tiled_index<BLOCK_DIM> idx) restrict(amp)  \n            {  \n                sum_kernel_tiled(idx, input, stride_size);  \n            });  \n        }  \n  \n        array_view<int, 1> output = input.section(extent<1>(1));  \n        return output[0];  \n    }  \n  \n    int cpu_sum(const std::vector<int> &arr) {  \n        int sum = 0;  \n        for (size_t i = 0; i < arr.size(); i++) {  \n            sum += arr[i];  \n        }  \n        return sum;  \n    }  \n  \n    std::vector<int> rand_vector(unsigned int size) {  \n        srand(2011);  \n  \n        std::vector<int> vec(size);  \n        for (size_t i = 0; i < size; i++) {  \n            vec[i] = rand();  \n        }  \n        return vec;  \n    }  \n  \n    array<int, 1> vector_to_array(const std::vector<int> &vec) {  \n        array<int, 1> arr(vec.size());  \n        copy(vec.begin(), vec.end(), arr);  \n        return arr;  \n    }  \n  \n    int _tmain(int argc, _TCHAR* argv[])  \n    {  \n        std::vector<int> vec = rand_vector(10000);  \n        array<int, 1> arr = vector_to_array(vec);  \n  \n        int expected = cpu_sum(vec);  \n        int actual = reduction_sum_gpu_kernel(arr);  \n  \n        bool passed = (expected == actual);  \n        if (!passed) {  \n            printf(\"Actual (GPU): %d, Expected (CPU): %d\", actual, expected);  \n        }  \n        printf(\"sum: %s\\n\", passed  \"Passed!\" : \"Failed!\");   \n  \n        getchar();  \n  \n        return 0;  \n    }  \n  \n ```  \n  \n9. On the menu bar, choose **File**, **Save All**.  \n  \n10. In **Solution Explorer**, open the shortcut menu for **AMPMapReduce**, and then choose **Properties**.  \n  \n11. In the **Property Pages** dialog box, under **Configuration Properties**, choose **C/C++**, **Precompiled Headers**.  \n  \n12. For the **Precompiled Header** property, select **Not Using Precompiled Headers**, and then choose the **OK** button.  \n  \n13. On the menu bar, choose **Build**, **Build Solution**.  \n  \n## Debugging the CPU Code  \n In this procedure, you will use the Local Windows Debugger to make sure that the CPU code in this application is correct. The segment of the CPU code in this application that is especially interesting is the `for` loop in the `reduction_sum_gpu_kernel` function. It controls the tree-based parallel reduction that is run on the GPU.  \n  \n### To debug the CPU code  \n  \n1.  In **Solution Explorer**, open the shortcut menu for **AMPMapReduce**, and then choose **Properties**.  \n  \n2.  In the **Property Pages** dialog box, under **Configuration Properties**, choose **Debugging**. Verify that **Local Windows Debugger** is selected in the **Debugger to launch** list.  \n  \n3.  Return to the Code Editor.  \n  \n4.  Set breakpoints on the lines of code shown in the following illustration (approximately lines 67 line 70).  \n  \n     ![CPU breakpoints](../../parallel/amp/media/campcpubreakpoints.png \"campcpubreakpoints\")  \nCPU breakpoints  \n  \n5.  On the menu bar, choose **Debug**, **Start Debugging**.  \n  \n6.  In the **Locals** window, observe the value for `stride_size` until the breakpoint at line 70 is reached.  \n  \n7.  On the menu bar, choose **Debug**, **Stop Debugging**.  \n  \n## Debugging the GPU Code  \n This section shows how to debug the GPU code, which is the code contained in the `sum_kernel_tiled` function. The GPU code computes the sum of integers for each \"block\" in parallel.  \n  \n### To debug the GPU code  \n  \n1.  In **Solution Explorer**, open the shortcut menu for **AMPMapReduce**, and then choose **Properties**.  \n  \n2.  In the **Property Pages** dialog box, under **Configuration Properties**, choose **Debugging**.  \n  \n3.  In the **Debugger to launch** list, select **Local Windows Debugger**.  \n  \n4.  In the **Debugger Type** list, select **GPU Only**.  \n  \n5.  Choose the **OK** button.  \n  \n6.  Set a breakpoint at line 30, as shown in the following illustration.  \n  \n     ![GPU breakpoints](../../parallel/amp/media/campgpubreakpoints.png \"campgpubreakpoints\")  \nGPU breakpoint  \n  \n7.  On the menu bar, choose **Debug**, **Start Debugging**. The breakpoints in the CPU code at lines 67 and 70 are not executed during GPU debugging because those lines of code are executed on the CPU.  \n  \n### To use the GPU Threads window  \n  \n1.  To open the GPU Threads window, on the menu bar, choose **Debug**, **Windows**, **GPU Threads**.  \n  \n     You can inspect the state the GPU threads in the GPU Threads window that appears.  \n  \n2.  Dock the GPU Threads window at the bottom of Visual Studio. Choose the **Expand Thread Switch** button to display the tile and thread text boxes. The GPU Threads window shows the total number of active and blocked GPU threads, as shown in the following illustration.  \n  \n     ![GPU Threads window with 4 active threads](../../parallel/amp/media/campc.png \"campc\")  \nGPU Threads window  \n  \n     There are 313 tiles allocated for this computation. Each tile contains 32 threads. Because local GPU debugging occurs on a software emulator, there are four active GPU threads. The four threads execute the instructions simultaneously and then move on together to the next instruction.  \n  \n     In the GPU threads window, there are four GPU threads active and 28 GPU threads blocked at the [tile_barrier::wait](reference/tile-barrier-class.md#wait) statement defined at about line 21 (`t_idx.barrier.wait();`). All 32 GPU threads belong to the first tile, `tile[0]`. An arrow points to the row that includes the current thread. To switch to a different thread, use one of the following methods:  \n\n  \n    -   In the row for the thread to switch to in the GPU Threads window, open the shortcut menu and choose **Switch To Thread**. If the row represents more than one thread, you will switch to the first thread according to the thread coordinates.  \n  \n    -   Enter the tile and thread values of the thread in the corresponding text boxes and then choose the **Switch Thread** button.  \n  \n     The Call Stack window displays the call stack of the current GPU thread.  \n  \n### To use the Parallel Stacks window  \n  \n1.  To open the Parallel Stacks window, on the menu bar, choose **Debug**, **Windows**, **Parallel Stacks**.  \n  \n     You can use the Parallel Stacks window to simultaneously inspect the stack frames of multiple GPU threads.  \n  \n2.  Dock the Parallel Stacks window at the bottom of Visual Studio.  \n  \n3.  Make sure that **Threads** is selected in the list in the upper-left corner. In the following illustration, the Parallel Stacks window shows a call-stack focused view of the GPU threads that you saw in the GPU Threads window.  \n  \n     ![Parallel Stacks window with 4 active threads](../../parallel/amp/media/campd.png \"campd\")  \nParallel Stacks window  \n  \n     32 threads went from `_kernel_stub` to the lambda statement in the `parallel_for_each` function call and then to the `sum_kernel_tiled` function, where the parallel reduction occurs. 28 out of the 32 threads have progressed to the [tile_barrier::wait](reference/tile-barrier-class.md#wait) statement and remain blocked at line 22, whereas the other 4 threads remain active in the `sum_kernel_tiled` function at line 30.  \n\n  \n     You can inspect the properties of a GPU thread that are available in the GPU Threads window in the rich DataTip of the Parallel Stacks window. To do this, rest the mouse pointer on the stack frame of **sum_kernel_tiled**. The following illustration shows the DataTip.  \n  \n     ![DataTip for Parallel Stacks window](../../parallel/amp/media/campe.png \"campe\")  \nGPU thread DataTip  \n  \n     For more information about the Parallel Stacks window, see [Using the Parallel Stacks Window](/visualstudio/debugger/using-the-parallel-stacks-window).  \n  \n### To use the Parallel Watch window  \n  \n1.  To open the Parallel Watch window, on the menu bar, choose **Debug**, **Windows**, **Parallel Watch**, **Parallel Watch 1**.  \n  \n     You can use the Parallel Watch window to inspect the values of an expression across multiple threads.  \n  \n2.  Dock the Parallel Watch 1 window to the bottom of Visual Studio. There are 32 rows in the table of the Parallel Watch window. Each corresponds to a GPU thread that appeared in both the GPU Threads window and the Parallel Stacks window. Now, you can enter expressions whose values you want to inspect across all 32 GPU threads.  \n  \n3.  Select the **Add Watch** column header, enter `localIdx`, and then choose the Enter key.  \n  \n4.  Select the **Add Watch** column header again, type `globalIdx`, and then choose the Enter key.  \n  \n5.  Select the **Add Watch** column header again, type `localA[localIdx[0]]`, and then choose the Enter key.  \n  \n     You can sort by a specified expression by selecting its corresponding column header.  \n  \n     Select the **localA[localIdx[0]]** column header to sort the column. The following illustration shows the results of sorting by **localA[localIdx[0]]**.  \n  \n     ![Parallel Watch window with sorted results](../../parallel/amp/media/campf.png \"campf\")  \n Results of sort  \n  \n     You can export the content in the Parallel Watch window to Excel by choosing the Excel button and then choosing **Open in Excel**. If you have Excel installed on your development computer, this opens an Excel worksheet that contains the content.  \n  \n6.  In the upper-right corner of the Parallel Watch window, there's a filter control that you can use to filter the content by using Boolean expressions. Enter `localA[localIdx[0]] > 20000` in the filter control text box and then choose the Enter key.  \n  \n     The window now contains only threads on which the `localA[localIdx[0]]` value is greater than 20000. The content is still sorted by the `localA[localIdx[0]]` column, which is the sorting action you performed earlier.  \n  \n## Flagging GPU Threads  \n You can mark specific GPU threads by flagging them in the GPU Threads window, the Parallel Watch window, or the DataTip in the Parallel Stacks window. If a row in the GPU Threads window contains more than one thread, flagging that row flags all threads that are contained in the row.  \n  \n### To flag GPU threads  \n  \n1.  Select the **[Thread]** column header in the Parallel Watch 1 window to sort by tile index and thread index.  \n  \n2.  On the menu bar, choose **Debug**, **Continue**, which causes the four threads that were active to progress to the next barrier (defined at line 32 of AMPMapReduce.cpp).  \n  \n3.  Choose the flag symbol on the left side of the row that contains the four threads that are now active.  \n  \n     The following illustration shows the four active flagged threads in the GPU Threads window.  \n  \n     ![GPU Threads window with flagged threads](../../parallel/amp/media/campg.png \"campg\")  \nActive threads in the GPU Threads window  \n  \n     The Parallel Watch window and the DataTip of the Parallel stacks window both indicate the flagged threads.  \n  \n4.  If you want to focus on the four threads that you flagged, you can choose to show, in the GPU Threads, Parallel Watch, and Parallel Stacks windows, only the flagged threads.  \n  \n     Choose the Show Flagged Only button on any of the windows or on the **Debug Location** toolbar. The following illustration shows the Show Flagged Only button on the **Debug Location** toolbar.  \n  \n     ![Debug Location toolbar with Show Only Flagged icon](../../parallel/amp/media/camph.png \"camph\")  \nShow Flagged Only button  \n  \n     Now the GPU Threads, Parallel Watch, and Parallel Stacks windows display only the flagged threads.  \n  \n## Freezing and Thawing GPU Threads  \n You can freeze (suspend) and thaw (resume) GPU threads from either the GPU Threads window or the Parallel Watch window. You can freeze and thaw CPU threads the same way; for information, see [How to: Use the Threads Window](http://msdn.microsoft.com/library/adfbe002-3d7b-42a9-b42a-5ac0903dfc25).  \n  \n### To freeze and thaw GPU threads  \n  \n1.  Choose the **Show Flagged Only** button to display all the threads.  \n  \n2.  On the menu bar, choose **Debug**, **Continue**.  \n  \n3.  Open the shortcut menu for the active row and then choose **Freeze**.  \n  \n     The following illustration of the GPU Threads window shows that all four threads are frozen.  \n  \n     ![GPU Threads windows showing frozen threads](../../parallel/amp/media/campk.png \"campk\")  \nFrozen threads in the GPU Threads window  \n  \n     Similarly, the Parallel Watch window shows that all four threads are frozen.  \n  \n4.  On the menu bar, choose **Debug**, **Continue** to allow the next four GPU threads to progress past the barrier at line 22 and to reach the breakpoint at line 30. The GPU Threads window shows that the four previously frozen threads remain frozen and in the active state.  \n  \n5.  On the menu bar, choose **Debug**, **Continue**.  \n  \n6.  From the Parallel Watch window, you can also thaw individual or multiple GPU threads.  \n  \n### To group GPU threads  \n  \n1.  On the shortcut menu for one of the threads in the **GPU Threads** window, choose **Group By**, **Address**.  \n  \n     The threads in the GPU Threads window are grouped by address. The address corresponds to the instruction in disassembly where each group of threads is located. 24 threads are at line 22 where the [tile_barrier::wait Method](reference/tile-barrier-class.md#wait) is executed. 12 threads are at the instruction for the barrier at line 32. Four of these threads are flagged. Eight threads are at the breakpoint at line 30. Four of these threads are frozen. The following illustration shows the grouped threads in the GPU Threads window.  \n\n  \n     ![GPU Threads window with threads grouped by Address](../../parallel/amp/media/campl.png \"campl\")  \nGrouped threads in the GPU Threads window  \n  \n2.  You can also perform the **Group By** operation by opening the shortcut menu for the data grid of the Parallel Watch window, choosing **Group By**, and then choosing the menu item that corresponds to how you want to group the threads.  \n  \n## Running All Threads to a Specific Location in Code  \n You run all the threads in a given tile to the line that contains the cursor by using **Run Current Tile To Cursor**.  \n  \n### To run all threads to the location marked by the cursor  \n  \n1.  On the shortcut menu for the frozen threads, choose **Thaw**.  \n  \n2.  In the Code Editor, put the cursor in line 30.  \n  \n3.  On the shortcut menu for the Code Editor, choose **Run Current Tile To Cursor**.  \n  \n     The 24 threads that were previously blocked at the barrier at line 21 have progressed to line 32. This is shown in the **GPU Threads** window.  \n  \n## See Also  \n [C++ AMP Overview](../../parallel/amp/cpp-amp-overview.md)   \n [Debugging GPU Code](/visualstudio/debugger/debugging-gpu-code)   \n [How to: Use the GPU Threads Window](http://msdn.microsoft.com/library/c647c502-a9f0-48e0-a430-976744a5fa51)   \n [How to: Use the Parallel Watch Window](http://msdn.microsoft.com/library/28004d9b-420c-48f7-b80e-ab1519802558)   \n [Analyzing C++ AMP Code with the Concurrency Visualizer](http://go.microsoft.com/fwlink/linkid=253987&clcid=0x409)\n\n"}