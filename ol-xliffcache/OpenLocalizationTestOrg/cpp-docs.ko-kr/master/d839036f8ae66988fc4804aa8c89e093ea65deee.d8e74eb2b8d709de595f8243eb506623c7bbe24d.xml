{"nodes":[{"pos":[12,67],"content":"Obtaining Metadata with Schema Rowsets | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Obtaining Metadata with Schema Rowsets | Microsoft Docs","pos":[0,55]}]},{"content":"Obtaining Metadata with Schema Rowsets","pos":[726,764]},{"content":"Sometimes you need to obtain information about the provider, rowset, table, columns, or other database information without opening the rowset.","pos":[765,907]},{"content":"Data about the database structure is called metadata and can be retrieved by a number of different methods.","pos":[908,1015]},{"content":"One method is to use schema rowsets.","pos":[1016,1052]},{"pos":[1059,1305],"content":"OLE DB Templates provide a set of classes to retrieve schema information; these classes create predefined schema rowsets and are listed in <bpt id=\"p1\">[</bpt>Schema Rowset Classes and Typedef Classes<ept id=\"p1\">](../../data/oledb/schema-rowset-classes-and-typedef-classes.md)</ept>.","source":"OLE DB Templates provide a set of classes to retrieve schema information; these classes create predefined schema rowsets and are listed in [Schema Rowset Classes and Typedef Classes](../../data/oledb/schema-rowset-classes-and-typedef-classes.md)."},{"pos":[1313,1648],"content":"[!NOTE]\n If you are using OLAP and some of your rowsets are not supported by the schema rowset classes (for example, you have a variable number of columns), you should consider using `CManualAccessor` or `CDynamicAccessor`. You can scroll through the columns and use case statements to handle the possible data types for each column.","leadings":["","> "],"nodes":[{"content":" If you are using OLAP and some of your rowsets are not supported by the schema rowset classes (for example, you have a variable number of columns), you should consider using `CManualAccessor` or `CDynamicAccessor`. You can scroll through the columns and use case statements to handle the possible data types for each column.","pos":[8,333],"nodes":[{"content":"If you are using OLAP and some of your rowsets are not supported by the schema rowset classes (for example, you have a variable number of columns), you should consider using <ph id=\"ph1\">`CManualAccessor`</ph> or <ph id=\"ph2\">`CDynamicAccessor`</ph>.","pos":[1,215],"source":" If you are using OLAP and some of your rowsets are not supported by the schema rowset classes (for example, you have a variable number of columns), you should consider using `CManualAccessor` or `CDynamicAccessor`."},{"content":"You can scroll through the columns and use case statements to handle the possible data types for each column.","pos":[216,325]}]}]},{"content":"Catalog/Schema Model","pos":[1657,1677]},{"content":"ANSI SQL defines a catalog/schema model for data stores; OLE DB uses this model.","pos":[1681,1761]},{"content":"In this model, catalogs (databases) contain schemas and schemas contain tables.","pos":[1762,1841]},{"content":"<bpt id=\"p1\">**</bpt>Catalog<ept id=\"p1\">**</ept> A catalog is another name for a database.","pos":[1851,1904],"source":"**Catalog** A catalog is another name for a database."},{"content":"It is a collection of related schemas.","pos":[1905,1943]},{"content":"To list the catalogs (databases) belonging to a given data source, use <bpt id=\"p1\">[</bpt>CCatalog<ept id=\"p1\">](../../data/oledb/ccatalogs-ccataloginfo.md)</ept>.","pos":[1944,2070],"source":" To list the catalogs (databases) belonging to a given data source, use [CCatalog](../../data/oledb/ccatalogs-ccataloginfo.md)."},{"content":"Because many databases have only one catalog, metadata is sometimes simply called schema information.","pos":[2071,2172]},{"content":"<bpt id=\"p1\">**</bpt>Schema<ept id=\"p1\">**</ept> A schema is a collection of database objects that are owned or have been created by a particular user.","pos":[2182,2295],"source":"**Schema** A schema is a collection of database objects that are owned or have been created by a particular user."},{"content":"To list the schemas owned by a given user, use <bpt id=\"p1\">[</bpt>CSchemata<ept id=\"p1\">](../../data/oledb/cschemata-cschematainfo.md)</ept>.","pos":[2296,2400],"source":" To list the schemas owned by a given user, use [CSchemata](../../data/oledb/cschemata-cschematainfo.md)."},{"content":"In Microsoft SQL Server and ODBC 2.x terms, a schema is an owner (for example, dbo is a typical schema name).","pos":[2411,2520]},{"content":"Also, SQL Server stores metadata in a set of tables: one table contains a list of all the tables and another table contains a list of all the columns.","pos":[2521,2671]},{"content":"There is no equivalent to a schema in a Microsoft Access database.","pos":[2672,2738]},{"content":"<bpt id=\"p1\">**</bpt>Table<ept id=\"p1\">**</ept> Tables are collections of columns arranged in specific orders.","pos":[2748,2820],"source":"**Table** Tables are collections of columns arranged in specific orders."},{"content":"To list the tables defined in a given catalog (database) and information about those tables, use <bpt id=\"p1\">[</bpt>CTables<ept id=\"p1\">](../../data/oledb/ctables-ctableinfo.md)</ept>).","pos":[2821,2969],"source":" To list the tables defined in a given catalog (database) and information about those tables, use [CTables](../../data/oledb/ctables-ctableinfo.md))."},{"content":"Restrictions","pos":[2978,2990]},{"content":"When you query for schema information, you can use restrictions to specify the type of information in which you are interested.","pos":[2994,3121]},{"content":"You can think of restrictions as a filter or qualifier in a query.","pos":[3122,3188]},{"content":"For example, in the query:","pos":[3189,3215]},{"content":"is a restriction.","pos":[3292,3309]},{"content":"This is a very simple example with only one restriction; the schema rowset classes support several restrictions.","pos":[3310,3422]},{"content":"The <bpt id=\"p1\">[</bpt>schema rowset typedef classes<ept id=\"p1\">](../../data/oledb/schema-rowset-classes-and-typedef-classes.md)</ept> encapsulate all the OLE DB schema rowsets so that you can access a schema rowset just like any other rowset by instantiating and opening it.","pos":[3429,3668],"source":"The [schema rowset typedef classes](../../data/oledb/schema-rowset-classes-and-typedef-classes.md) encapsulate all the OLE DB schema rowsets so that you can access a schema rowset just like any other rowset by instantiating and opening it."},{"content":"For example, the typedef class <bpt id=\"p1\">[</bpt>CColumns<ept id=\"p1\">](../../data/oledb/ccolumns-ccolumnsinfo.md)</ept> is defined as:","pos":[3669,3768],"source":" For example, the typedef class [CColumns](../../data/oledb/ccolumns-ccolumnsinfo.md) is defined as:"},{"content":"The <bpt id=\"p1\">[</bpt>CRestrictions<ept id=\"p1\">](../../data/oledb/crestrictions-class.md)</ept> class supplies the restriction support.","pos":[3830,3930],"source":"The [CRestrictions](../../data/oledb/crestrictions-class.md) class supplies the restriction support."},{"content":"After you create an instance of the schema rowset, call <bpt id=\"p1\">[</bpt>CRestrictions::Open<ept id=\"p1\">](../../data/oledb/crestrictions-open.md)</ept>.","pos":[3931,4049],"source":" After you create an instance of the schema rowset, call [CRestrictions::Open](../../data/oledb/crestrictions-open.md)."},{"content":"This method returns a result set based on the restrictions that you specify.","pos":[4050,4126]},{"content":"To specify restrictions, refer to <bpt id=\"p1\">[</bpt>Appendix B: Schema Rowsets<ept id=\"p1\">](http://go.microsoft.com/fwlink/?linkid=64681)</ept> and look up the rowset that you are using.","pos":[4133,4284],"source":"To specify restrictions, refer to [Appendix B: Schema Rowsets](http://go.microsoft.com/fwlink/?linkid=64681) and look up the rowset that you are using."},{"content":"For example, <bpt id=\"p1\">**</bpt>CColumns<ept id=\"p1\">**</ept> corresponds to the <bpt id=\"p2\">[</bpt>COLUMNS Rowset<ept id=\"p2\">](http://go.microsoft.com/fwlink/?linkid=64682)</ept>; that topic lists the restriction columns in the COLUMNS rowset: TABLE_CATALOG, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME.","pos":[4285,4511],"source":" For example, **CColumns** corresponds to the [COLUMNS Rowset](http://go.microsoft.com/fwlink/?linkid=64682); that topic lists the restriction columns in the COLUMNS rowset: TABLE_CATALOG, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME."},{"content":"You must follow that order in specifying your restrictions.","pos":[4512,4571]},{"pos":[4578,4816],"content":"So, for example, if you want to restrict by table name, note that TABLE_NAME is the third restriction column, and then call <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>, specifying the desired table name as the third restriction parameter, as shown in the following example.","source":"So, for example, if you want to restrict by table name, note that TABLE_NAME is the third restriction column, and then call **Open**, specifying the desired table name as the third restriction parameter, as shown in the following example."},{"content":"To use schema rowsets","pos":[4827,4848]},{"content":"You must include the header file Atldbsch.h (of course, you need Atldbcli.h for consumer support as well).","pos":[4858,4964]},{"content":"Instantiate a schema rowset object in the consumer's or the document's header file.","pos":[4974,5057]},{"content":"If you want table information, declare a <bpt id=\"p1\">**</bpt>CTables<ept id=\"p1\">**</ept> object; if you want column information, declare a <bpt id=\"p2\">**</bpt>CColumns<ept id=\"p2\">**</ept> object.","pos":[5058,5181],"source":" If you want table information, declare a **CTables** object; if you want column information, declare a **CColumns** object."},{"content":"This example shows how to retrieve the columns in the authors table:","pos":[5182,5250]},{"content":"To fetch the information, access the appropriate data member of the schema rowset object, for example, <ph id=\"ph1\">`ColumnSchemaRowset.m_szColumnName`</ph>.","pos":[5704,5843],"source":"To fetch the information, access the appropriate data member of the schema rowset object, for example, `ColumnSchemaRowset.m_szColumnName`."},{"content":"This corresponds to COLUMN_NAME.","pos":[5844,5876]},{"content":"To see which OLE DB column each data member corresponds to, see <bpt id=\"p1\">[</bpt>CColumns<ept id=\"p1\">](../../data/oledb/ccolumns-ccolumnsinfo.md)</ept>.","pos":[5877,5995],"source":" To see which OLE DB column each data member corresponds to, see [CColumns](../../data/oledb/ccolumns-ccolumnsinfo.md)."},{"pos":[6002,6204],"content":"For the reference of the schema rowset, typedef classes provided in the OLE DB Templates (see <bpt id=\"p1\">[</bpt>Schema Rowset Classes and Typedef Classes<ept id=\"p1\">](../../data/oledb/schema-rowset-classes-and-typedef-classes.md)</ept>).","source":"For the reference of the schema rowset, typedef classes provided in the OLE DB Templates (see [Schema Rowset Classes and Typedef Classes](../../data/oledb/schema-rowset-classes-and-typedef-classes.md))."},{"pos":[6211,6408],"content":"For more information about OLE DB schema rowsets, including restriction columns, see <bpt id=\"p1\">[</bpt>Appendix B: Schema Rowsets<ept id=\"p1\">](http://go.microsoft.com/fwlink/?linkid=64681)</ept> in the OLE DB Programmer's Reference.","source":"For more information about OLE DB schema rowsets, including restriction columns, see [Appendix B: Schema Rowsets](http://go.microsoft.com/fwlink/?linkid=64681) in the OLE DB Programmer's Reference."},{"pos":[6415,6657],"content":"For more complex examples of how to use schema rowset classes, see the <bpt id=\"p1\">[</bpt>CatDB<ept id=\"p1\">](http://msdn.microsoft.com/en-us/003d516b-2bf6-444e-8be5-4ebaa0b66046)</ept> and <bpt id=\"p2\">[</bpt>DBViewer<ept id=\"p2\">](http://msdn.microsoft.com/en-us/07620f99-c347-4d09-9ebc-2459e8049832)</ept> samples.","source":"For more complex examples of how to use schema rowset classes, see the [CatDB](http://msdn.microsoft.com/en-us/003d516b-2bf6-444e-8be5-4ebaa0b66046) and [DBViewer](http://msdn.microsoft.com/en-us/07620f99-c347-4d09-9ebc-2459e8049832) samples."},{"pos":[6664,6802],"content":"For information about provider support for schema rowsets, see <bpt id=\"p1\">[</bpt>Supporting Schema Rowsets<ept id=\"p1\">](../../data/oledb/supporting-schema-rowsets.md)</ept>.","source":"For information about provider support for schema rowsets, see [Supporting Schema Rowsets](../../data/oledb/supporting-schema-rowsets.md)."},{"content":"See Also","pos":[6811,6819]},{"content":"Using Accessors","pos":[6824,6839]}],"content":"---\ntitle: \"Obtaining Metadata with Schema Rowsets | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"schema rowsets, getting OLE DB provider metadata\"\n  - \"OLE DB consumer templates, getting provider metadata\"\n  - \"metadata, getting (OLE DB Templates)\"\nms.assetid: 6b448461-82fb-4acf-816b-3cbb0ca1d186\ncaps.latest.revision: 9\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Obtaining Metadata with Schema Rowsets\nSometimes you need to obtain information about the provider, rowset, table, columns, or other database information without opening the rowset. Data about the database structure is called metadata and can be retrieved by a number of different methods. One method is to use schema rowsets.  \n  \n OLE DB Templates provide a set of classes to retrieve schema information; these classes create predefined schema rowsets and are listed in [Schema Rowset Classes and Typedef Classes](../../data/oledb/schema-rowset-classes-and-typedef-classes.md).  \n  \n> [!NOTE]\n>  If you are using OLAP and some of your rowsets are not supported by the schema rowset classes (for example, you have a variable number of columns), you should consider using `CManualAccessor` or `CDynamicAccessor`. You can scroll through the columns and use case statements to handle the possible data types for each column.  \n  \n## Catalog/Schema Model  \n ANSI SQL defines a catalog/schema model for data stores; OLE DB uses this model. In this model, catalogs (databases) contain schemas and schemas contain tables.  \n  \n-   **Catalog** A catalog is another name for a database. It is a collection of related schemas. To list the catalogs (databases) belonging to a given data source, use [CCatalog](../../data/oledb/ccatalogs-ccataloginfo.md). Because many databases have only one catalog, metadata is sometimes simply called schema information.  \n  \n-   **Schema** A schema is a collection of database objects that are owned or have been created by a particular user. To list the schemas owned by a given user, use [CSchemata](../../data/oledb/cschemata-cschematainfo.md).  \n  \n     In Microsoft SQL Server and ODBC 2.x terms, a schema is an owner (for example, dbo is a typical schema name). Also, SQL Server stores metadata in a set of tables: one table contains a list of all the tables and another table contains a list of all the columns. There is no equivalent to a schema in a Microsoft Access database.  \n  \n-   **Table** Tables are collections of columns arranged in specific orders. To list the tables defined in a given catalog (database) and information about those tables, use [CTables](../../data/oledb/ctables-ctableinfo.md)).  \n  \n## Restrictions  \n When you query for schema information, you can use restrictions to specify the type of information in which you are interested. You can think of restrictions as a filter or qualifier in a query. For example, in the query:  \n  \n```  \nSELECT * FROM authors where l_name = 'pivo'  \n```  \n  \n `l_name` is a restriction. This is a very simple example with only one restriction; the schema rowset classes support several restrictions.  \n  \n The [schema rowset typedef classes](../../data/oledb/schema-rowset-classes-and-typedef-classes.md) encapsulate all the OLE DB schema rowsets so that you can access a schema rowset just like any other rowset by instantiating and opening it. For example, the typedef class [CColumns](../../data/oledb/ccolumns-ccolumnsinfo.md) is defined as:  \n  \n```  \nCRestrictions<CAccessor<CColumnsInfo>  \n```  \n  \n The [CRestrictions](../../data/oledb/crestrictions-class.md) class supplies the restriction support. After you create an instance of the schema rowset, call [CRestrictions::Open](../../data/oledb/crestrictions-open.md). This method returns a result set based on the restrictions that you specify.  \n  \n To specify restrictions, refer to [Appendix B: Schema Rowsets](http://go.microsoft.com/fwlink/?linkid=64681) and look up the rowset that you are using. For example, **CColumns** corresponds to the [COLUMNS Rowset](http://go.microsoft.com/fwlink/?linkid=64682); that topic lists the restriction columns in the COLUMNS rowset: TABLE_CATALOG, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME. You must follow that order in specifying your restrictions.  \n  \n So, for example, if you want to restrict by table name, note that TABLE_NAME is the third restriction column, and then call **Open**, specifying the desired table name as the third restriction parameter, as shown in the following example.  \n  \n#### To use schema rowsets  \n  \n1.  You must include the header file Atldbsch.h (of course, you need Atldbcli.h for consumer support as well).  \n  \n2.  Instantiate a schema rowset object in the consumer's or the document's header file. If you want table information, declare a **CTables** object; if you want column information, declare a **CColumns** object. This example shows how to retrieve the columns in the authors table:  \n  \n    ```  \n    CDataSource ds;  \n    ds.Open();  \n    CSession ss;  \n    ss.Open();  \n    CColumns ColumnSchemaRowset;  \n    // TABLE_NAME is the third restriction column, so  \n    // specify \"authors\" as the third restriction parameter:  \n    hr = ColumnSchemaRowset.Open(ss, NULL, NULL, \"authors\");  \n    hr = ColumnSchemaRowset.MoveFirst();  \n    while (hr == S_OK)  \n    {  \n       hr = ColumnSchemaRowset.MoveNext();  \n    }  \n    ```  \n  \n3.  To fetch the information, access the appropriate data member of the schema rowset object, for example, `ColumnSchemaRowset.m_szColumnName`. This corresponds to COLUMN_NAME. To see which OLE DB column each data member corresponds to, see [CColumns](../../data/oledb/ccolumns-ccolumnsinfo.md).  \n  \n For the reference of the schema rowset, typedef classes provided in the OLE DB Templates (see [Schema Rowset Classes and Typedef Classes](../../data/oledb/schema-rowset-classes-and-typedef-classes.md)).  \n  \n For more information about OLE DB schema rowsets, including restriction columns, see [Appendix B: Schema Rowsets](http://go.microsoft.com/fwlink/?linkid=64681) in the OLE DB Programmer's Reference.  \n  \n For more complex examples of how to use schema rowset classes, see the [CatDB](http://msdn.microsoft.com/en-us/003d516b-2bf6-444e-8be5-4ebaa0b66046) and [DBViewer](http://msdn.microsoft.com/en-us/07620f99-c347-4d09-9ebc-2459e8049832) samples.  \n  \n For information about provider support for schema rowsets, see [Supporting Schema Rowsets](../../data/oledb/supporting-schema-rowsets.md).  \n  \n## See Also  \n [Using Accessors](../../data/oledb/using-accessors.md)"}