{"nodes":[{"pos":[12,37],"content":"_malloca | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"_malloca | Microsoft Docs","pos":[0,25]}]},{"pos":[939,947],"content":"_malloca","linkify":"_malloca","nodes":[{"content":"_malloca","pos":[0,8]}]},{"content":"Allocates memory on the stack.","pos":[948,978]},{"content":"This is a version of <bpt id=\"p1\">[</bpt>_alloca<ept id=\"p1\">](../../c-runtime-library/reference/alloca.md)</ept> with security enhancements as described in <bpt id=\"p2\">[</bpt>Security Features in the CRT<ept id=\"p2\">](../../c-runtime-library/security-features-in-the-crt.md)</ept>.","pos":[979,1186],"source":" This is a version of [_alloca](../../c-runtime-library/reference/alloca.md) with security enhancements as described in [Security Features in the CRT](../../c-runtime-library/security-features-in-the-crt.md)."},{"pos":[1195,1201],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1269,1279],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"Bytes to be allocated from the stack.","pos":[1293,1330]},{"pos":[1339,1351],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"content":"The <ph id=\"ph1\">`_malloca`</ph> routine returns a <ph id=\"ph2\">`void`</ph> pointer to the allocated space, which is guaranteed to be suitably aligned for storage of any type of object.","pos":[1355,1504],"source":"The `_malloca` routine returns a `void` pointer to the allocated space, which is guaranteed to be suitably aligned for storage of any type of object."},{"content":"If <ph id=\"ph1\">`size`</ph> is 0, <ph id=\"ph2\">`_malloca`</ph> allocates a zero-length item and returns a valid pointer to that item.","pos":[1505,1602],"source":" If `size` is 0, `_malloca` allocates a zero-length item and returns a valid pointer to that item."},{"content":"A stack overflow exception is generated if the space cannot be allocated.","pos":[1609,1682]},{"content":"The stack overflow exception is not a C++ exception; it is a structured exception.","pos":[1683,1765]},{"content":"Instead of using C++ exception handling, you must use <bpt id=\"p1\">[</bpt>Structured Exception Handling<ept id=\"p1\">](../../cpp/structured-exception-handling-c-cpp.md)</ept> (SEH).","pos":[1766,1908],"source":" Instead of using C++ exception handling, you must use [Structured Exception Handling](../../cpp/structured-exception-handling-c-cpp.md) (SEH)."},{"pos":[1917,1924],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"<ph id=\"ph1\">`_malloca`</ph> allocates <ph id=\"ph2\">`size`</ph> bytes from the program stack or the heap if the request exceeds a certain size in bytes given by <ph id=\"ph3\">`_ALLOCA_S_THRESHOLD`</ph>.","pos":[1928,2075],"source":"`_malloca` allocates `size` bytes from the program stack or the heap if the request exceeds a certain size in bytes given by `_ALLOCA_S_THRESHOLD`."},{"content":"The difference between <ph id=\"ph1\">`_malloca`</ph> and <ph id=\"ph2\">`_alloca`</ph> is that <ph id=\"ph3\">`_alloca`</ph> always allocates on the stack, regardless of the size.","pos":[2076,2196],"source":" The difference between `_malloca` and `_alloca` is that `_alloca` always allocates on the stack, regardless of the size."},{"content":"Unlike <ph id=\"ph1\">`_alloca`</ph>, which does not require or permit a call to <ph id=\"ph2\">`free`</ph> to free the memory so allocated, <ph id=\"ph3\">`_malloca`</ph> requires the use of <bpt id=\"p1\">[</bpt>_freea<ept id=\"p1\">](../../c-runtime-library/reference/freea.md)</ept> to free memory.","pos":[2197,2397],"source":" Unlike `_alloca`, which does not require or permit a call to `free` to free the memory so allocated, `_malloca` requires the use of [_freea](../../c-runtime-library/reference/freea.md) to free memory."},{"content":"In debug mode, <ph id=\"ph1\">`_malloca`</ph> always allocates memory from the heap.","pos":[2398,2462],"source":" In debug mode, `_malloca` always allocates memory from the heap."},{"content":"There are restrictions to explicitly calling <ph id=\"ph1\">`_malloca`</ph> in an exception handler (EH).","pos":[2469,2554],"source":"There are restrictions to explicitly calling `_malloca` in an exception handler (EH)."},{"content":"EH routines that run on x86-class processors operate in their own memory frame: They perform their tasks in memory space that is not based on the current location of the stack pointer of the enclosing function.","pos":[2555,2765]},{"content":"The most common implementations include Windows NT structured exception handling (SEH) and C++ catch clause expressions.","pos":[2766,2886]},{"content":"Therefore, explicitly calling <ph id=\"ph1\">`_malloca`</ph> in any of the following scenarios results in program failure during the return to the calling EH routine:","pos":[2887,3033],"source":" Therefore, explicitly calling `_malloca` in any of the following scenarios results in program failure during the return to the calling EH routine:"},{"pos":[3043,3114],"content":"Windows NT SEH exception filter expression: <ph id=\"ph1\">`__except`</ph> (<ph id=\"ph2\">`_malloca ()`</ph> )","source":"Windows NT SEH exception filter expression: `__except` (`_malloca ()` )"},{"pos":[3124,3192],"content":"Windows NT SEH final exception handler: <ph id=\"ph1\">`__finally`</ph> {<ph id=\"ph2\">`_malloca ()`</ph> }","source":"Windows NT SEH final exception handler: `__finally` {`_malloca ()` }"},{"content":"C++ EH catch clause expression","pos":[3202,3232]},{"pos":[3239,3412],"content":"However, <ph id=\"ph1\">`_malloca`</ph> can be called directly from within an EH routine or from an application-supplied callback that gets invoked by one of the EH scenarios previously listed.","source":"However, `_malloca` can be called directly from within an EH routine or from an application-supplied callback that gets invoked by one of the EH scenarios previously listed."},{"pos":[3420,3601],"content":"[!IMPORTANT]\n In Windows XP, if `_malloca` is called inside a try/catch block, you must call [_resetstkoflw](../../c-runtime-library/reference/resetstkoflw.md) in the catch block.","leadings":["","> "],"nodes":[{"content":"In Windows XP, if <ph id=\"ph1\">`_malloca`</ph> is called inside a try/catch block, you must call <bpt id=\"p1\">[</bpt>_resetstkoflw<ept id=\"p1\">](../../c-runtime-library/reference/resetstkoflw.md)</ept> in the catch block.","pos":[14,179],"source":" In Windows XP, if `_malloca` is called inside a try/catch block, you must call [_resetstkoflw](../../c-runtime-library/reference/resetstkoflw.md) in the catch block."}]},{"content":"In addition to the above restrictions, when using the <bpt id=\"p1\">[</bpt>/clr (Common Language Runtime Compilation)<ept id=\"p1\">](../../build/reference/clr-common-language-runtime-compilation.md)</ept> option, <ph id=\"ph1\">`_malloca`</ph> cannot be used in <ph id=\"ph2\">`__except`</ph> blocks.","pos":[3608,3828],"source":"In addition to the above restrictions, when using the [/clr (Common Language Runtime Compilation)](../../build/reference/clr-common-language-runtime-compilation.md) option, `_malloca` cannot be used in `__except` blocks."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>/clr Restrictions<ept id=\"p1\">](../../build/reference/clr-restrictions.md)</ept>.","pos":[3829,3918],"source":" For more information, see [/clr Restrictions](../../build/reference/clr-restrictions.md)."},{"pos":[3927,3939],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"content":"Routine","pos":[3946,3953]},{"content":"Required header","pos":[3954,3969]},{"content":"<ph id=\"ph1\">\\&lt;</ph>malloc.h&gt;","pos":[4025,4036],"source":"\\<malloc.h>"},{"pos":[4046,4053],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[4297,4304],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[5669,5674],"content":"Input","linkify":"Input","nodes":[{"content":"Input","pos":[0,5]}]},{"pos":[5705,5718],"content":"Sample Output","linkify":"Sample Output","nodes":[{"content":"Sample Output","pos":[0,13]}]},{"pos":[5803,5828],"content":".NET Framework Equivalent","linkify":".NET Framework Equivalent","nodes":[{"content":".NET Framework Equivalent","pos":[0,25]}]},{"content":"Not applicable.","pos":[5832,5847]},{"content":"To call the standard C function, use <ph id=\"ph1\">`PInvoke`</ph>.","pos":[5848,5895],"source":" To call the standard C function, use `PInvoke`."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Platform Invoke Examples<ept id=\"p1\">](http://msdn.microsoft.com/Library/15926806-f0b7-487e-93a6-4e9367ec689f)</ept>.","pos":[5896,6021],"source":" For more information, see [Platform Invoke Examples](http://msdn.microsoft.com/Library/15926806-f0b7-487e-93a6-4e9367ec689f)."},{"pos":[6030,6038],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Memory Allocation<ept id=\"p1\">](../../c-runtime-library/memory-allocation.md)</ept><ph id=\"ph1\"> </ph>","pos":[6042,6108],"source":"[Memory Allocation](../../c-runtime-library/memory-allocation.md) "},{"content":"<bpt id=\"p1\"> [</bpt>calloc<ept id=\"p1\">](../../c-runtime-library/reference/calloc.md)</ept><ph id=\"ph1\"> </ph>","pos":[6111,6166],"source":" [calloc](../../c-runtime-library/reference/calloc.md) "},{"content":"<bpt id=\"p1\"> [</bpt>malloc<ept id=\"p1\">](../../c-runtime-library/reference/malloc.md)</ept><ph id=\"ph1\"> </ph>","pos":[6169,6224],"source":" [malloc](../../c-runtime-library/reference/malloc.md) "},{"content":"<bpt id=\"p1\"> [</bpt>realloc<ept id=\"p1\">](../../c-runtime-library/reference/realloc.md)</ept><ph id=\"ph1\"> </ph>","pos":[6227,6284],"source":" [realloc](../../c-runtime-library/reference/realloc.md) "},{"content":"<bpt id=\"p1\"> [</bpt>_resetstkoflw<ept id=\"p1\">](../../c-runtime-library/reference/resetstkoflw.md)</ept>","pos":[6287,6354],"source":" [_resetstkoflw](../../c-runtime-library/reference/resetstkoflw.md)"}],"content":"---\ntitle: \"_malloca | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\napiname: \n  - \"_malloca\"\napilocation: \n  - \"msvcrt.dll\"\n  - \"msvcr80.dll\"\n  - \"msvcr90.dll\"\n  - \"msvcr100.dll\"\n  - \"msvcr100_clr0400.dll\"\n  - \"msvcr110.dll\"\n  - \"msvcr110_clr0400.dll\"\n  - \"msvcr120.dll\"\n  - \"msvcr120_clr0400.dll\"\n  - \"ucrtbase.dll\"\napitype: \"DLLExport\"\nf1_keywords: \n  - \"malloca\"\n  - \"_malloca\"\ndev_langs: \n  - \"C++\"\n  - \"C\"\nhelpviewer_keywords: \n  - \"memory allocation, stack\"\n  - \"malloca function\"\n  - \"_malloca function\"\nms.assetid: 293992df-cfca-4bc9-b313-0a733a6bb936\ncaps.latest.revision: 27\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# _malloca\nAllocates memory on the stack. This is a version of [_alloca](../../c-runtime-library/reference/alloca.md) with security enhancements as described in [Security Features in the CRT](../../c-runtime-library/security-features-in-the-crt.md).  \n  \n## Syntax  \n  \n```  \nvoid *_malloca(   \n   size_t size   \n);  \n```  \n  \n#### Parameters  \n `size`  \n Bytes to be allocated from the stack.  \n  \n## Return Value  \n The `_malloca` routine returns a `void` pointer to the allocated space, which is guaranteed to be suitably aligned for storage of any type of object. If `size` is 0, `_malloca` allocates a zero-length item and returns a valid pointer to that item.  \n  \n A stack overflow exception is generated if the space cannot be allocated. The stack overflow exception is not a C++ exception; it is a structured exception. Instead of using C++ exception handling, you must use [Structured Exception Handling](../../cpp/structured-exception-handling-c-cpp.md) (SEH).  \n  \n## Remarks  \n `_malloca` allocates `size` bytes from the program stack or the heap if the request exceeds a certain size in bytes given by `_ALLOCA_S_THRESHOLD`. The difference between `_malloca` and `_alloca` is that `_alloca` always allocates on the stack, regardless of the size. Unlike `_alloca`, which does not require or permit a call to `free` to free the memory so allocated, `_malloca` requires the use of [_freea](../../c-runtime-library/reference/freea.md) to free memory. In debug mode, `_malloca` always allocates memory from the heap.  \n  \n There are restrictions to explicitly calling `_malloca` in an exception handler (EH). EH routines that run on x86-class processors operate in their own memory frame: They perform their tasks in memory space that is not based on the current location of the stack pointer of the enclosing function. The most common implementations include Windows NT structured exception handling (SEH) and C++ catch clause expressions. Therefore, explicitly calling `_malloca` in any of the following scenarios results in program failure during the return to the calling EH routine:  \n  \n-   Windows NT SEH exception filter expression: `__except` (`_malloca ()` )  \n  \n-   Windows NT SEH final exception handler: `__finally` {`_malloca ()` }  \n  \n-   C++ EH catch clause expression  \n  \n However, `_malloca` can be called directly from within an EH routine or from an application-supplied callback that gets invoked by one of the EH scenarios previously listed.  \n  \n> [!IMPORTANT]\n>  In Windows XP, if `_malloca` is called inside a try/catch block, you must call [_resetstkoflw](../../c-runtime-library/reference/resetstkoflw.md) in the catch block.  \n  \n In addition to the above restrictions, when using the [/clr (Common Language Runtime Compilation)](../../build/reference/clr-common-language-runtime-compilation.md) option, `_malloca` cannot be used in `__except` blocks. For more information, see [/clr Restrictions](../../build/reference/clr-restrictions.md).  \n  \n## Requirements  \n  \n|Routine|Required header|  \n|-------------|---------------------|  \n|`_malloca`|\\<malloc.h>|  \n  \n## Example  \n  \n```  \n// crt_malloca_simple.c  \n#include <stdio.h>  \n#include <malloc.h>  \n  \nvoid Fn()  \n{  \n   char * buf = (char *)_malloca( 100 );  \n   // do something with buf  \n   _freea( buf );  \n}  \n  \nint main()  \n{  \n   Fn();  \n}  \n```  \n  \n## Example  \n  \n```  \n// crt_malloca_exception.c  \n// This program demonstrates the use of  \n// _malloca and trapping any exceptions  \n// that may occur.  \n  \n#include <windows.h>  \n#include <stdio.h>  \n#include <malloc.h>  \n  \nint main()  \n{  \n    int     size;  \n    int     numberRead = 0;  \n    int     errcode = 0;  \n    void    *p = NULL;  \n    void    *pMarker = NULL;  \n  \n    while (numberRead == 0)  \n    {  \n        printf_s(\"Enter the number of bytes to allocate \"  \n                 \"using _malloca: \");  \n        numberRead = scanf_s(\"%d\", &size);  \n    }  \n  \n    // Do not use try/catch for _malloca,  \n    // use __try/__except, since _malloca throws  \n    // Structured Exceptions, not C++ exceptions.  \n  \n    __try  \n    {  \n        if (size > 0)  \n        {  \n            p =  _malloca( size );  \n        }  \n        else  \n        {  \n            printf_s(\"Size must be a positive number.\");  \n        }  \n        _freea( p );  \n    }  \n  \n    // Catch any exceptions that may occur.  \n    __except( GetExceptionCode() == STATUS_STACK_OVERFLOW )  \n    {  \n        printf_s(\"_malloca failed!\\n\");  \n  \n        // If the stack overflows, use this function to restore.  \n        errcode = _resetstkoflw();  \n        if (errcode)  \n        {  \n            printf(\"Could not reset the stack!\");  \n            _exit(1);  \n        }  \n    };  \n}  \n```  \n  \n## Input  \n  \n```  \n1000  \n```  \n  \n## Sample Output  \n  \n```  \nEnter the number of bytes to allocate using _malloca: 1000  \n```  \n  \n## .NET Framework Equivalent  \n Not applicable. To call the standard C function, use `PInvoke`. For more information, see [Platform Invoke Examples](http://msdn.microsoft.com/Library/15926806-f0b7-487e-93a6-4e9367ec689f).  \n  \n## See Also  \n [Memory Allocation](../../c-runtime-library/memory-allocation.md)   \n [calloc](../../c-runtime-library/reference/calloc.md)   \n [malloc](../../c-runtime-library/reference/malloc.md)   \n [realloc](../../c-runtime-library/reference/realloc.md)   \n [_resetstkoflw](../../c-runtime-library/reference/resetstkoflw.md)"}