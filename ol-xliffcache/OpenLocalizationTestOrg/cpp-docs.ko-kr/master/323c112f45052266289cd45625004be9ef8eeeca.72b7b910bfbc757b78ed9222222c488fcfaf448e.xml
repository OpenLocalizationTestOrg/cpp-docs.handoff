{"nodes":[{"pos":[12,95],"content":"Profile Guided Optimization in the Performance and Diagnostics Hub | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Profile Guided Optimization in the Performance and Diagnostics Hub | Microsoft Docs","pos":[0,83]}]},{"content":"Profile Guided Optimization in the Performance and Diagnostics Hub","pos":[576,642]},{"content":"The Profile Guided Optimization for Visual C++ plug-in in the Performance and Diagnostics Hub streamlines the profile guided optimization experience for developers.","pos":[643,807]},{"content":"You can <bpt id=\"p1\">[</bpt>download the plug-in<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=327915)</ept> from the Visual Studio website.","pos":[808,919],"source":" You can [download the plug-in](http://go.microsoft.com/fwlink/p/?LinkId=327915) from the Visual Studio website."},{"content":"Profile guided optimization (PGO) helps you create builds of x86 and x64 native apps that are optimized for the way users interact with them.","pos":[926,1067]},{"content":"PGO is a multi-step process: You create an app build that's instrumented for profiling, and then you perform \"training\"—that is, you run the instrumented app through common user interaction scenarios.","pos":[1068,1268]},{"content":"You save the captured profiling data, and then you rebuild your app by using the results to guide whole-program optimization.","pos":[1269,1394]},{"content":"Although you can perform these steps individually in Visual Studio or on the command line, the PGO plug-in centralizes and simplifies the process.","pos":[1395,1541]},{"content":"The PGO plug-in sets all of the required options, guides you through each step, shows you the analysis, and then uses the results to configure the build to optimize each function for size or speed.","pos":[1542,1739]},{"content":"The PGO plug-in also makes it easy to rerun your app training and update the build-optimization data as you change your code.","pos":[1740,1865]},{"content":"Prerequisites","pos":[1874,1887]},{"pos":[1891,2069],"content":"You must <bpt id=\"p1\">[</bpt>download the PGO plug-in<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=327915)</ept> and install it in Visual Studio before you can use it in the Performance and Diagnostics Hub.","source":"You must [download the PGO plug-in](http://go.microsoft.com/fwlink/p/?LinkId=327915) and install it in Visual Studio before you can use it in the Performance and Diagnostics Hub."},{"content":"Walkthrough: Using the PGO Plug-in to Optimize an App","pos":[2078,2131]},{"content":"First, you'll create a basic Win32 desktop app in Visual Studio.","pos":[2135,2199]},{"content":"If you already have a native app that you want to optimize, you can use it and skip this step.","pos":[2200,2294]},{"content":"To create an app","pos":[2305,2321]},{"pos":[2331,2386],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>.","source":"On the menu bar, choose **File**, **New**, **Project**."},{"pos":[2396,2525],"content":"In the left pane of the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box, expand <bpt id=\"p2\">**</bpt>Installed<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Templates<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Visual C++<ept id=\"p4\">**</ept>, and then select <bpt id=\"p5\">**</bpt>MFC<ept id=\"p5\">**</ept>.","source":"In the left pane of the **New Project** dialog box, expand **Installed**, **Templates**, **Visual C++**, and then select **MFC**."},{"pos":[2535,2582],"content":"In the center pane, select <bpt id=\"p1\">**</bpt>MFC Application<ept id=\"p1\">**</ept>.","source":"In the center pane, select **MFC Application**."},{"content":"Specify a name for the project—for example, <bpt id=\"p1\">**</bpt>SamplePGOProject<ept id=\"p1\">**</ept>—in the <bpt id=\"p2\">**</bpt>Name<ept id=\"p2\">**</ept> box.","pos":[2592,2677],"source":"Specify a name for the project—for example, **SamplePGOProject**—in the **Name** box."},{"content":"Choose the <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> button.","pos":[2678,2703],"source":" Choose the **OK** button."},{"pos":[2713,2813],"content":"On the <bpt id=\"p1\">**</bpt>Overview<ept id=\"p1\">**</ept> page of the <bpt id=\"p2\">**</bpt>MFC Application Wizard<ept id=\"p2\">**</ept> dialog box, choose the <bpt id=\"p3\">**</bpt>Finish<ept id=\"p3\">**</ept> button.","source":"On the **Overview** page of the **MFC Application Wizard** dialog box, choose the **Finish** button."},{"content":"Next, set the build configuration of your app to Release to ready it for the PGO build and training steps.","pos":[2820,2926]},{"content":"To set the build configuration","pos":[2937,2967]},{"pos":[2977,3038],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Configuration Manager<ept id=\"p2\">**</ept>.","source":"On the menu bar, choose **Build**, **Configuration Manager**."},{"content":"In the <bpt id=\"p1\">**</bpt>Configuration Manager<ept id=\"p1\">**</ept> dialog box, choose the <bpt id=\"p2\">**</bpt>Active Solution Configuration<ept id=\"p2\">**</ept> drop-down button and select <bpt id=\"p3\">**</bpt>Release<ept id=\"p3\">**</ept>.","pos":[3048,3178],"source":"In the **Configuration Manager** dialog box, choose the **Active Solution Configuration** drop-down button and select **Release**."},{"content":"Choose the <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> button.","pos":[3179,3207],"source":" Choose the **Close** button."},{"content":"Open the Performance and Diagnostics Hub—on the menu bar, choose <bpt id=\"p1\">**</bpt>Analyze<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Performance and Diagnostics<ept id=\"p2\">**</ept>.","pos":[3214,3324],"source":"Open the Performance and Diagnostics Hub—on the menu bar, choose **Analyze**, **Performance and Diagnostics**."},{"content":"This opens a diagnostics session page that has the analysis tools that are available for your project type.","pos":[3325,3432]},{"content":"PGO in the Performance and Diagnostics Hub","pos":[3441,3483]},{"content":"In <bpt id=\"p1\">**</bpt>Available Tools<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>Profile Guided Optimization<ept id=\"p2\">**</ept> check box.","pos":[3548,3625],"source":"In **Available Tools**, select the **Profile Guided Optimization** check box."},{"content":"Choose the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> button to start the PGO plug-in.","pos":[3626,3679],"source":" Choose the **Start** button to start the PGO plug-in."},{"content":"PGO introduction page","pos":[3688,3709]},{"content":"The <bpt id=\"p1\">**</bpt>Profile Guided Optimization<ept id=\"p1\">**</ept> page describes the steps the plug-in uses to improve the performance of your app.","pos":[3778,3895],"source":"The **Profile Guided Optimization** page describes the steps the plug-in uses to improve the performance of your app."},{"content":"Choose the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> button.","pos":[3896,3924],"source":" Choose the **Start** button."},{"content":"PGO instrumentation page","pos":[3933,3957]},{"content":"In the <bpt id=\"p1\">**</bpt>Instrumentation<ept id=\"p1\">**</ept> section, you use the <bpt id=\"p2\">**</bpt>Training is initially enabled<ept id=\"p2\">**</ept> option to choose whether to include the startup phase of your app as part of the training.","pos":[4036,4208],"source":"In the **Instrumentation** section, you use the **Training is initially enabled** option to choose whether to include the startup phase of your app as part of the training."},{"content":"If this option is not selected, training data is not recorded in a running instrumented app until you explicitly enable training.","pos":[4209,4338]},{"content":"Choose the <bpt id=\"p1\">**</bpt>Instrument<ept id=\"p1\">**</ept> button to build your app with a special set of compiler options.","pos":[4345,4435],"source":"Choose the **Instrument** button to build your app with a special set of compiler options."},{"content":"The compiler inserts probe instructions in the generated code.","pos":[4436,4498]},{"content":"These instructions record profiling data during the training phase.","pos":[4499,4566]},{"content":"PGO instrumented build page","pos":[4575,4602]},{"content":"When the instrumented build of your app is complete, the app is started automatically.","pos":[4671,4757]},{"pos":[4764,4895],"content":"If any errors or warnings occur during the build, correct them and then choose <bpt id=\"p1\">**</bpt>Restart Build<ept id=\"p1\">**</ept> to restart the instrumented build.","source":"If any errors or warnings occur during the build, correct them and then choose **Restart Build** to restart the instrumented build."},{"content":"When your app is started, you can use the <bpt id=\"p1\">**</bpt>Start Training<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Pause Training<ept id=\"p2\">**</ept> links in the <bpt id=\"p3\">**</bpt>Training<ept id=\"p3\">**</ept> section to control when profiling information is recorded.","pos":[4902,5070],"source":"When your app is started, you can use the **Start Training** and **Pause Training** links in the **Training** section to control when profiling information is recorded."},{"content":"You can use the <bpt id=\"p1\">**</bpt>Stop Application<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Start Application<ept id=\"p2\">**</ept> links to stop and restart the app.","pos":[5071,5168],"source":" You can use the **Stop Application** and **Start Application** links to stop and restart the app."},{"content":"PGO training page","pos":[5177,5194]},{"content":"During training, go through your user scenarios to capture the profiling information that the PGO plug-in needs to optimize the code.","pos":[5269,5402]},{"content":"When you have completed the training, close your app or choose the <bpt id=\"p1\">**</bpt>Stop Application<ept id=\"p1\">**</ept> link.","pos":[5403,5496],"source":" When you have completed the training, close your app or choose the **Stop Application** link."},{"content":"Choose the <bpt id=\"p1\">**</bpt>Analyze<ept id=\"p1\">**</ept> button to start the analysis step.","pos":[5497,5554],"source":" Choose the **Analyze** button to start the analysis step."},{"content":"When the analysis is complete, the <bpt id=\"p1\">**</bpt>Analysis<ept id=\"p1\">**</ept> section shows a report of the profiling information that was captured during the user-scenario training phase.","pos":[5561,5719],"source":"When the analysis is complete, the **Analysis** section shows a report of the profiling information that was captured during the user-scenario training phase."},{"content":"You can use this report to examine which functions your app called the most and spent the most time in.","pos":[5720,5823]},{"content":"The PGO plug-in uses the information to determine which app functions to optimize for speed and which to optimize for size.","pos":[5824,5947]},{"content":"The PGO plug-in configures build optimizations to create the smallest, fastest app for the user scenarios that you recorded during training.","pos":[5948,6088]},{"content":"PGO analysis page","pos":[6097,6114]},{"content":"If the training captured the expected profiling information, you can choose <bpt id=\"p1\">**</bpt>Save Changes<ept id=\"p1\">**</ept> to save the analyzed profile data in your project to optimize future builds.","pos":[6187,6356],"source":"If the training captured the expected profiling information, you can choose **Save Changes** to save the analyzed profile data in your project to optimize future builds."},{"content":"To discard the profile data and start the training over from the beginning, choose <bpt id=\"p1\">**</bpt>Redo Training<ept id=\"p1\">**</ept>.","pos":[6357,6458],"source":" To discard the profile data and start the training over from the beginning, choose **Redo Training**."},{"content":"The profile data file is saved in your project in a <bpt id=\"p1\">**</bpt>PGO Training Data<ept id=\"p1\">**</ept> folder.","pos":[6465,6546],"source":"The profile data file is saved in your project in a **PGO Training Data** folder."},{"content":"This data is used to control the compiler build optimization settings in your app.","pos":[6547,6629]},{"content":"PGO data file in Solution Explorer","pos":[6638,6672]},{"content":"After analysis, the PGO plug-in sets build options in your project to use the profile data to selectively optimize your app during compilation.","pos":[6739,6882]},{"content":"You can continue to modify and build your app with the same profile data.","pos":[6883,6956]},{"content":"When the app is built, the build output reports how many functions and instructions were optimized by using profile data.","pos":[6957,7078]},{"content":"PGO output diagnostics","pos":[7087,7109]},{"content":"If you make significant code changes during development, you may have to retrain your app to get the best optimizations.","pos":[7190,7310]},{"content":"We recommend that you retrain your app when the build output reports that less than 80 percent of functions or instructions were optimized by using profile data.","pos":[7311,7472]}],"content":"---\ntitle: \"Profile Guided Optimization in the Performance and Diagnostics Hub | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nms.assetid: dc3a1914-dbb6-4401-bc63-10665a8c8943\ncaps.latest.revision: 12\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Profile Guided Optimization in the Performance and Diagnostics Hub\nThe Profile Guided Optimization for Visual C++ plug-in in the Performance and Diagnostics Hub streamlines the profile guided optimization experience for developers. You can [download the plug-in](http://go.microsoft.com/fwlink/p/?LinkId=327915) from the Visual Studio website.  \n  \n Profile guided optimization (PGO) helps you create builds of x86 and x64 native apps that are optimized for the way users interact with them. PGO is a multi-step process: You create an app build that's instrumented for profiling, and then you perform \"training\"—that is, you run the instrumented app through common user interaction scenarios. You save the captured profiling data, and then you rebuild your app by using the results to guide whole-program optimization. Although you can perform these steps individually in Visual Studio or on the command line, the PGO plug-in centralizes and simplifies the process. The PGO plug-in sets all of the required options, guides you through each step, shows you the analysis, and then uses the results to configure the build to optimize each function for size or speed. The PGO plug-in also makes it easy to rerun your app training and update the build-optimization data as you change your code.  \n  \n## Prerequisites  \n You must [download the PGO plug-in](http://go.microsoft.com/fwlink/p/?LinkId=327915) and install it in Visual Studio before you can use it in the Performance and Diagnostics Hub.  \n  \n## Walkthrough: Using the PGO Plug-in to Optimize an App  \n First, you'll create a basic Win32 desktop app in Visual Studio. If you already have a native app that you want to optimize, you can use it and skip this step.  \n  \n#### To create an app  \n  \n1.  On the menu bar, choose **File**, **New**, **Project**.  \n  \n2.  In the left pane of the **New Project** dialog box, expand **Installed**, **Templates**, **Visual C++**, and then select **MFC**.  \n  \n3.  In the center pane, select **MFC Application**.  \n  \n4.  Specify a name for the project—for example, **SamplePGOProject**—in the **Name** box. Choose the **OK** button.  \n  \n5.  On the **Overview** page of the **MFC Application Wizard** dialog box, choose the **Finish** button.  \n  \n Next, set the build configuration of your app to Release to ready it for the PGO build and training steps.  \n  \n#### To set the build configuration  \n  \n1.  On the menu bar, choose **Build**, **Configuration Manager**.  \n  \n2.  In the **Configuration Manager** dialog box, choose the **Active Solution Configuration** drop-down button and select **Release**. Choose the **Close** button.  \n  \n Open the Performance and Diagnostics Hub—on the menu bar, choose **Analyze**, **Performance and Diagnostics**. This opens a diagnostics session page that has the analysis tools that are available for your project type.  \n  \n ![PGO in the Performance and Diagnostics Hub](../../build/reference/media/pgofig0hub.png \"PGOFig0Hub\")  \n  \n In **Available Tools**, select the **Profile Guided Optimization** check box. Choose the **Start** button to start the PGO plug-in.  \n  \n ![PGO introduction page](../../build/reference/media/pgofig1start.png \"PGOFig1Start\")  \n  \n The **Profile Guided Optimization** page describes the steps the plug-in uses to improve the performance of your app. Choose the **Start** button.  \n  \n ![PGO instrumentation page](../../build/reference/media/pgofig2instrument.png \"PGOFig2Instrument\")  \n  \n In the **Instrumentation** section, you use the **Training is initially enabled** option to choose whether to include the startup phase of your app as part of the training. If this option is not selected, training data is not recorded in a running instrumented app until you explicitly enable training.  \n  \n Choose the **Instrument** button to build your app with a special set of compiler options. The compiler inserts probe instructions in the generated code. These instructions record profiling data during the training phase.  \n  \n ![PGO instrumented build page](../../build/reference/media/pgofig3build.PNG \"PGOFig3Build\")  \n  \n When the instrumented build of your app is complete, the app is started automatically.  \n  \n If any errors or warnings occur during the build, correct them and then choose **Restart Build** to restart the instrumented build.  \n  \n When your app is started, you can use the **Start Training** and **Pause Training** links in the **Training** section to control when profiling information is recorded. You can use the **Stop Application** and **Start Application** links to stop and restart the app.  \n  \n ![PGO training page](../../build/reference/media/pgofig4training.PNG \"PGOFig4Training\")  \n  \n During training, go through your user scenarios to capture the profiling information that the PGO plug-in needs to optimize the code. When you have completed the training, close your app or choose the **Stop Application** link. Choose the **Analyze** button to start the analysis step.  \n  \n When the analysis is complete, the **Analysis** section shows a report of the profiling information that was captured during the user-scenario training phase. You can use this report to examine which functions your app called the most and spent the most time in. The PGO plug-in uses the information to determine which app functions to optimize for speed and which to optimize for size. The PGO plug-in configures build optimizations to create the smallest, fastest app for the user scenarios that you recorded during training.  \n  \n ![PGO analysis page](../../build/reference/media/pgofig5analyze.png \"PGOFig5Analyze\")  \n  \n If the training captured the expected profiling information, you can choose **Save Changes** to save the analyzed profile data in your project to optimize future builds. To discard the profile data and start the training over from the beginning, choose **Redo Training**.  \n  \n The profile data file is saved in your project in a **PGO Training Data** folder. This data is used to control the compiler build optimization settings in your app.  \n  \n ![PGO data file in Solution Explorer](../../build/reference/media/pgofig6data.png \"PGOFig6Data\")  \n  \n After analysis, the PGO plug-in sets build options in your project to use the profile data to selectively optimize your app during compilation. You can continue to modify and build your app with the same profile data. When the app is built, the build output reports how many functions and instructions were optimized by using profile data.  \n  \n ![PGO output diagnostics](../../build/reference/media/pgofig7diagnostics.png \"PGOFig7Diagnostics\")  \n  \n If you make significant code changes during development, you may have to retrain your app to get the best optimizations. We recommend that you retrain your app when the build output reports that less than 80 percent of functions or instructions were optimized by using profile data."}