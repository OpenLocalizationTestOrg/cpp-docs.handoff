{"nodes":[{"pos":[12,76],"content":"Exceptions: Using MFC Macros and C++ Exceptions | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Exceptions: Using MFC Macros and C++ Exceptions | Microsoft Docs","pos":[0,64]}]},{"content":"Exceptions: Using MFC Macros and C++ Exceptions","pos":[1074,1121]},{"content":"This article discusses considerations for writing code that uses both the MFC exception-handling macros and the C++ exception-handling keywords.","pos":[1122,1266]},{"content":"This article covers the following topics:","pos":[1273,1314]},{"content":"Mixing exception keywords and macros","pos":[1325,1361]},{"content":"Try blocks inside catch blocks","pos":[1418,1448]},{"pos":[1556,1592],"content":"Mixing Exception Keywords and Macros"},{"content":"You can mix MFC exception macros and C++ exception keywords in the same program.","pos":[1596,1676]},{"content":"But you cannot mix MFC macros with C++ exception keywords in the same block because the macros delete exception objects automatically when they go out of scope, whereas code using the exception-handling keywords does not.","pos":[1677,1898]},{"content":"For more information, see the article <bpt id=\"p1\">[</bpt>Exceptions: Catching and Deleting Exceptions<ept id=\"p1\">](../mfc/exceptions-catching-and-deleting-exceptions.md)</ept>.","pos":[1899,2039],"source":" For more information, see the article [Exceptions: Catching and Deleting Exceptions](../mfc/exceptions-catching-and-deleting-exceptions.md)."},{"content":"The main difference between the macros and the keywords is that the macros \"automatically\" delete a caught exception when the exception goes out of scope.","pos":[2046,2200]},{"content":"Code using the keywords does not; exceptions caught in a catch block must be explicitly deleted.","pos":[2201,2297]},{"content":"Mixing macros and C++ exception keywords can cause memory leaks when an exception object is not deleted, or heap corruption when an exception is deleted twice.","pos":[2298,2457]},{"content":"The following code, for example, invalidates the exception pointer:","pos":[2464,2531]},{"pos":[2549,2569],"content":"NVC_MFCExceptions#10"},{"content":"The problem occurs because <ph id=\"ph1\">`e`</ph> is deleted when execution passes out of the \"inner\" <bpt id=\"p1\">**</bpt>CATCH<ept id=\"p1\">**</ept> block.","pos":[2655,2754],"source":"The problem occurs because `e` is deleted when execution passes out of the \"inner\" **CATCH** block."},{"content":"Using the <ph id=\"ph1\">`THROW_LAST`</ph> macro instead of the <bpt id=\"p1\">**</bpt>THROW<ept id=\"p1\">**</ept> statement will cause the \"outer\" <bpt id=\"p2\">**</bpt>CATCH<ept id=\"p2\">**</ept> block to receive a valid pointer:","pos":[2755,2885],"source":" Using the `THROW_LAST` macro instead of the **THROW** statement will cause the \"outer\" **CATCH** block to receive a valid pointer:"},{"pos":[2903,2923],"content":"NVC_MFCExceptions#11"},{"pos":[3064,3094],"content":"Try Blocks Inside Catch Blocks"},{"content":"You cannot re-throw the current exception from within a <bpt id=\"p1\">**</bpt>try<ept id=\"p1\">**</ept> block that is inside a <bpt id=\"p2\">**</bpt>CATCH<ept id=\"p2\">**</ept> block.","pos":[3098,3201],"source":"You cannot re-throw the current exception from within a **try** block that is inside a **CATCH** block."},{"content":"The following example is invalid:","pos":[3202,3235]},{"pos":[3253,3273],"content":"NVC_MFCExceptions#12"},{"pos":[3359,3479],"content":"For more information, see <bpt id=\"p1\">[</bpt>Exceptions: Examining Exception Contents<ept id=\"p1\">](../mfc/exceptions-examining-exception-contents.md)</ept>.","source":"For more information, see [Exceptions: Examining Exception Contents](../mfc/exceptions-examining-exception-contents.md)."},{"content":"See Also","pos":[3488,3496]},{"content":"Exception Handling","pos":[3501,3519]}],"content":"---\ntitle: \"Exceptions: Using MFC Macros and C++ Exceptions | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"exception objects\"\n  - \"memory leaks, exception object not deleted\"\n  - \"exception handling, MFC\"\n  - \"try-catch exception handling, mixing MFC macros and C++ keywords\"\n  - \"exception objects, deleting\"\n  - \"exceptions, MFC macros vs. C++ keywords\"\n  - \"catch blocks, mixed\"\n  - \"exception handling, mixed-language\"\n  - \"nested try blocks\"\n  - \"catch blocks, explicitly deleting code in\"\n  - \"try-catch exception handling, nested try blocks\"\n  - \"heap corruption\"\n  - \"nested catch blocks\"\nms.assetid: d664a83d-879b-44d4-bdf0-029f0aca69e9\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Exceptions: Using MFC Macros and C++ Exceptions\nThis article discusses considerations for writing code that uses both the MFC exception-handling macros and the C++ exception-handling keywords.  \n  \n This article covers the following topics:  \n  \n-   [Mixing exception keywords and macros](#_core_mixing_exception_keywords_and_macros)  \n  \n-   [Try blocks inside catch blocks](#_core_try_blocks_inside_catch_blocks)  \n  \n##  <a name=\"_core_mixing_exception_keywords_and_macros\"></a> Mixing Exception Keywords and Macros  \n You can mix MFC exception macros and C++ exception keywords in the same program. But you cannot mix MFC macros with C++ exception keywords in the same block because the macros delete exception objects automatically when they go out of scope, whereas code using the exception-handling keywords does not. For more information, see the article [Exceptions: Catching and Deleting Exceptions](../mfc/exceptions-catching-and-deleting-exceptions.md).  \n  \n The main difference between the macros and the keywords is that the macros \"automatically\" delete a caught exception when the exception goes out of scope. Code using the keywords does not; exceptions caught in a catch block must be explicitly deleted. Mixing macros and C++ exception keywords can cause memory leaks when an exception object is not deleted, or heap corruption when an exception is deleted twice.  \n  \n The following code, for example, invalidates the exception pointer:  \n  \n [!code-cpp[NVC_MFCExceptions#10](../mfc/codesnippet/cpp/exceptions-using-mfc-macros-and-cpp-exceptions_1.cpp)]  \n  \n The problem occurs because `e` is deleted when execution passes out of the \"inner\" **CATCH** block. Using the `THROW_LAST` macro instead of the **THROW** statement will cause the \"outer\" **CATCH** block to receive a valid pointer:  \n  \n [!code-cpp[NVC_MFCExceptions#11](../mfc/codesnippet/cpp/exceptions-using-mfc-macros-and-cpp-exceptions_2.cpp)]  \n  \n##  <a name=\"_core_try_blocks_inside_catch_blocks\"></a> Try Blocks Inside Catch Blocks  \n You cannot re-throw the current exception from within a **try** block that is inside a **CATCH** block. The following example is invalid:  \n  \n [!code-cpp[NVC_MFCExceptions#12](../mfc/codesnippet/cpp/exceptions-using-mfc-macros-and-cpp-exceptions_3.cpp)]  \n  \n For more information, see [Exceptions: Examining Exception Contents](../mfc/exceptions-examining-exception-contents.md).  \n  \n## See Also  \n [Exception Handling](../mfc/exception-handling-in-mfc.md)\n\n"}