{"nodes":[{"pos":[12,75],"content":"How to: Compile MFC and ATL Code By Using -clr | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Compile MFC and ATL Code By Using -clr | Microsoft Docs","pos":[0,63]}]},{"content":"How to: Compile MFC and ATL Code By Using /clr","pos":[985,1031]},{"content":"This topic discusses how to compile existing MFC and ATL programs to target the Common Language Runtime.","pos":[1032,1136]},{"content":"To compile an MFC executable or regular DLL by using /clr","pos":[1146,1203]},{"pos":[1213,1292],"content":"Right-click the project in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","source":"Right-click the project in **Solution Explorer** and then click **Properties**."},{"content":"In the <bpt id=\"p1\">**</bpt>Project Properties<ept id=\"p1\">**</ept> dialog box, expand the node next to <bpt id=\"p2\">**</bpt>Configuration Properties<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[1302,1420],"source":"In the **Project Properties** dialog box, expand the node next to **Configuration Properties** and select **General**."},{"content":"In the right pane, under <bpt id=\"p1\">**</bpt>Project Defaults<ept id=\"p1\">**</ept>, set <bpt id=\"p2\">**</bpt>Common Language Runtime support<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>Common Language Runtime Support (/clr)<ept id=\"p3\">**</ept>.","pos":[1421,1554],"source":" In the right pane, under **Project Defaults**, set **Common Language Runtime support** to **Common Language Runtime Support (/clr)**."},{"pos":[1565,1651],"content":"In the same pane, make sure that <bpt id=\"p1\">**</bpt>Use of MFC<ept id=\"p1\">**</ept> is set to <bpt id=\"p2\">**</bpt>Use MFC in a Shared DLL<ept id=\"p2\">**</ept>.","source":"In the same pane, make sure that **Use of MFC** is set to **Use MFC in a Shared DLL**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[1661,1754],"source":"Under **Configuration Properties**, expand the node next to **C/C++** and select **General**."},{"content":"Make sure that <bpt id=\"p1\">**</bpt>Debug Information Format<ept id=\"p1\">**</ept> is set to <bpt id=\"p2\">**</bpt>Program Database /Zi<ept id=\"p2\">**</ept> (not <bpt id=\"p3\">**</bpt>/ZI<ept id=\"p3\">**</ept>).","pos":[1755,1848],"source":" Make sure that **Debug Information Format** is set to **Program Database /Zi** (not **/ZI**)."},{"content":"Select the <bpt id=\"p1\">**</bpt>Code Generation<ept id=\"p1\">**</ept> node.","pos":[1858,1894],"source":"Select the **Code Generation** node."},{"content":"Set <bpt id=\"p1\">**</bpt>Enable Minimal Rebuild<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>No (/Gm-)<ept id=\"p2\">**</ept>.","pos":[1895,1943],"source":" Set **Enable Minimal Rebuild** to **No (/Gm-)**."},{"content":"Also set <bpt id=\"p1\">**</bpt>Basic Runtime Checks<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>Default<ept id=\"p2\">**</ept>.","pos":[1944,1993],"source":" Also set **Basic Runtime Checks** to **Default**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and then <bpt id=\"p3\">**</bpt>Code Generation<ept id=\"p3\">**</ept>.","pos":[2003,2085],"source":"Under **Configuration Properties**, select **C/C++** and then **Code Generation**."},{"content":"Make sure that <bpt id=\"p1\">**</bpt>Runtime Library<ept id=\"p1\">**</ept> is set to either <bpt id=\"p2\">**</bpt>Multi-threaded Debug DLL (/MDd)<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Multi-threaded DLL (/MD)<ept id=\"p3\">**</ept>.","pos":[2086,2206],"source":" Make sure that **Runtime Library** is set to either **Multi-threaded Debug DLL (/MDd)** or **Multi-threaded DLL (/MD)**."},{"content":"In Stdafx.h, add the following line.","pos":[2216,2252]},{"content":"To compile an MFC extension DLL by using /clr","pos":[2325,2370]},{"content":"Follow the steps in \"To compile an MFC executable or regular DLL by using /clr\".","pos":[2380,2460]},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>Precompiled Headers<ept id=\"p3\">**</ept>.","pos":[2470,2575],"source":"Under **Configuration Properties**, expand the node next to **C/C++** and select **Precompiled Headers**."},{"content":"Set <bpt id=\"p1\">**</bpt>Create/Use Precompiled Header<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>Not using Precompiled Headers<ept id=\"p2\">**</ept>.","pos":[2576,2651],"source":" Set **Create/Use Precompiled Header** to **Not using Precompiled Headers**."},{"content":"As an alternative, in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click Stdafx.cpp and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","pos":[2662,2760],"source":"As an alternative, in **Solution Explorer**, right-click Stdafx.cpp and then click **Properties**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[2761,2854],"source":" Under **Configuration Properties**, expand the node next to **C/C++** and select **General**."},{"content":"Set <bpt id=\"p1\">**</bpt>Compile with Common Language Runtime support<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>No Common Language Runtime support<ept id=\"p2\">**</ept>.","pos":[2855,2950],"source":" Set **Compile with Common Language Runtime support** to **No Common Language Runtime support**."},{"content":"For the file that contains DllMain and anything it calls, in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the file and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","pos":[2960,3095],"source":"For the file that contains DllMain and anything it calls, in **Solution Explorer**, right-click the file and then click **Properties**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[3096,3189],"source":" Under **Configuration Properties**, expand the node next to **C/C++** and select **General**."},{"content":"In the right pane, under <bpt id=\"p1\">**</bpt>Project Defaults<ept id=\"p1\">**</ept>, set <bpt id=\"p2\">**</bpt>Compile with Common Language Runtime support<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>No Common Language Runtime support<ept id=\"p3\">**</ept>.","pos":[3190,3332],"source":" In the right pane, under **Project Defaults**, set **Compile with Common Language Runtime support** to **No Common Language Runtime support**."},{"content":"To compile an ATL executable by using /clr","pos":[3342,3384]},{"pos":[3394,3474],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the project and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","source":"In **Solution Explorer**, right-click the project and then click **Properties**."},{"content":"In the <bpt id=\"p1\">**</bpt>Project Properties<ept id=\"p1\">**</ept> dialog box, expand the node next to <bpt id=\"p2\">**</bpt>Configuration Properties<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[3484,3602],"source":"In the **Project Properties** dialog box, expand the node next to **Configuration Properties** and select **General**."},{"content":"In the right pane, under <bpt id=\"p1\">**</bpt>Project Defaults<ept id=\"p1\">**</ept>, set <bpt id=\"p2\">**</bpt>Common Language Runtime support<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>Common Language Runtime Support (/clr)<ept id=\"p3\">**</ept>.","pos":[3603,3736],"source":" In the right pane, under **Project Defaults**, set **Common Language Runtime support** to **Common Language Runtime Support (/clr)**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[3746,3839],"source":"Under **Configuration Properties**, expand the node next to **C/C++** and select **General**."},{"content":"Make sure that <bpt id=\"p1\">**</bpt>Debug Information Format<ept id=\"p1\">**</ept> is set to <bpt id=\"p2\">**</bpt>Program Database /Zi<ept id=\"p2\">**</ept> (not <bpt id=\"p3\">**</bpt>/ZI<ept id=\"p3\">**</ept>).","pos":[3840,3933],"source":" Make sure that **Debug Information Format** is set to **Program Database /Zi** (not **/ZI**)."},{"content":"Select the <bpt id=\"p1\">**</bpt>Code Generation<ept id=\"p1\">**</ept> node.","pos":[3943,3979],"source":"Select the **Code Generation** node."},{"content":"Set <bpt id=\"p1\">**</bpt>Enable Minimal Rebuild<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>No (/Gm-)<ept id=\"p2\">**</ept>.","pos":[3980,4028],"source":" Set **Enable Minimal Rebuild** to **No (/Gm-)**."},{"content":"Also set <bpt id=\"p1\">**</bpt>Basic Runtime Checks<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>Default<ept id=\"p2\">**</ept>.","pos":[4029,4078],"source":" Also set **Basic Runtime Checks** to **Default**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and then <bpt id=\"p3\">**</bpt>Code Generation<ept id=\"p3\">**</ept>.","pos":[4088,4170],"source":"Under **Configuration Properties**, select **C/C++** and then **Code Generation**."},{"content":"Make sure that <bpt id=\"p1\">**</bpt>Runtime Library<ept id=\"p1\">**</ept> is set to either <bpt id=\"p2\">**</bpt>Multi-threaded Debug DLL (/MDd)<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Multi-threaded DLL (/MD)<ept id=\"p3\">**</ept>.","pos":[4171,4291],"source":" Make sure that **Runtime Library** is set to either **Multi-threaded Debug DLL (/MDd)** or **Multi-threaded DLL (/MD)**."},{"content":"For every MIDL-generated file (C files), right-click the file in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","pos":[4301,4418],"source":"For every MIDL-generated file (C files), right-click the file in **Solution Explorer** and then click **Properties**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[4419,4512],"source":" Under **Configuration Properties**, expand the node next to **C/C++** and select **General**."},{"content":"Set <bpt id=\"p1\">**</bpt>Compile with Common Language Runtime support<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>No Common Language Runtime support<ept id=\"p2\">**</ept>.","pos":[4513,4608],"source":" Set **Compile with Common Language Runtime support** to **No Common Language Runtime support**."},{"content":"To compile an ATL DLL by using /clr","pos":[4618,4653]},{"content":"Follow the steps in the \"To compile an ATL executable by using /clr\" section.","pos":[4663,4740]},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>Precompiled Headers<ept id=\"p3\">**</ept>.","pos":[4750,4855],"source":"Under **Configuration Properties**, expand the node next to **C/C++** and select **Precompiled Headers**."},{"content":"Set <bpt id=\"p1\">**</bpt>Create/Use Precompiled Header<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>Not using Precompiled Headers<ept id=\"p2\">**</ept>.","pos":[4856,4931],"source":" Set **Create/Use Precompiled Header** to **Not using Precompiled Headers**."},{"content":"As an alternative, in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click Stdafx.cpp and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","pos":[4942,5040],"source":"As an alternative, in **Solution Explorer**, right-click Stdafx.cpp and then click **Properties**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[5041,5134],"source":" Under **Configuration Properties**, expand the node next to **C/C++** and select **General**."},{"content":"Set <bpt id=\"p1\">**</bpt>Compile with Common Language Runtime support<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>No Common Language Runtime support<ept id=\"p2\">**</ept>.","pos":[5135,5230],"source":" Set **Compile with Common Language Runtime support** to **No Common Language Runtime support**."},{"content":"For the file that contains DllMain and anything it calls, in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the file and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","pos":[5240,5375],"source":"For the file that contains DllMain and anything it calls, in **Solution Explorer**, right-click the file and then click **Properties**."},{"content":"Under <bpt id=\"p1\">**</bpt>Configuration Properties<ept id=\"p1\">**</ept>, expand the node next to <bpt id=\"p2\">**</bpt>C/C++<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>.","pos":[5376,5469],"source":" Under **Configuration Properties**, expand the node next to **C/C++** and select **General**."},{"content":"In the right pane, under <bpt id=\"p1\">**</bpt>Project Defaults<ept id=\"p1\">**</ept>, set <bpt id=\"p2\">**</bpt>Compile with Common Language Runtime support<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>No Common Language Runtime support<ept id=\"p3\">**</ept>.","pos":[5470,5612],"source":" In the right pane, under **Project Defaults**, set **Compile with Common Language Runtime support** to **No Common Language Runtime support**."},{"content":"See Also","pos":[5621,5629]},{"content":"Mixed (Native and Managed) Assemblies","pos":[5634,5671]}],"content":"---\ntitle: \"How to: Compile MFC and ATL Code By Using -clr | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"get-started-article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MFC [C++], interoperability\"\n  - \"ATL [C++], interoperability\"\n  - \"mixed assemblies [C++], MFC code\"\n  - \"mixed assemblies [C++], ATL code\"\n  - \"/clr compiler option [C++], compiling ATL and MFC code\"\n  - \"interoperability [C++], /clr compiler option\"\n  - \"regular DLLs [D++], /clr compiler option\"\n  - \"interop [C++], /clr compiler option\"\n  - \"extension DLLs [C++], /clr compiler option\"\nms.assetid: 12464bec-33a4-482c-880a-c078de7f6ea5\ncaps.latest.revision: 9\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# How to: Compile MFC and ATL Code By Using /clr\nThis topic discusses how to compile existing MFC and ATL programs to target the Common Language Runtime.  \n  \n### To compile an MFC executable or regular DLL by using /clr  \n  \n1.  Right-click the project in **Solution Explorer** and then click **Properties**.  \n  \n2.  In the **Project Properties** dialog box, expand the node next to **Configuration Properties** and select **General**. In the right pane, under **Project Defaults**, set **Common Language Runtime support** to **Common Language Runtime Support (/clr)**.  \n  \n     In the same pane, make sure that **Use of MFC** is set to **Use MFC in a Shared DLL**.  \n  \n3.  Under **Configuration Properties**, expand the node next to **C/C++** and select **General**. Make sure that **Debug Information Format** is set to **Program Database /Zi** (not **/ZI**).  \n  \n4.  Select the **Code Generation** node. Set **Enable Minimal Rebuild** to **No (/Gm-)**. Also set **Basic Runtime Checks** to **Default**.  \n  \n5.  Under **Configuration Properties**, select **C/C++** and then **Code Generation**. Make sure that **Runtime Library** is set to either **Multi-threaded Debug DLL (/MDd)** or **Multi-threaded DLL (/MD)**.  \n  \n6.  In Stdafx.h, add the following line.  \n  \n    ```  \n    #using <System.Windows.Forms.dll>  \n    ```  \n  \n### To compile an MFC extension DLL by using /clr  \n  \n1.  Follow the steps in \"To compile an MFC executable or regular DLL by using /clr\".  \n  \n2.  Under **Configuration Properties**, expand the node next to **C/C++** and select **Precompiled Headers**. Set **Create/Use Precompiled Header** to **Not using Precompiled Headers**.  \n  \n     As an alternative, in **Solution Explorer**, right-click Stdafx.cpp and then click **Properties**. Under **Configuration Properties**, expand the node next to **C/C++** and select **General**. Set **Compile with Common Language Runtime support** to **No Common Language Runtime support**.  \n  \n3.  For the file that contains DllMain and anything it calls, in **Solution Explorer**, right-click the file and then click **Properties**. Under **Configuration Properties**, expand the node next to **C/C++** and select **General**. In the right pane, under **Project Defaults**, set **Compile with Common Language Runtime support** to **No Common Language Runtime support**.  \n  \n### To compile an ATL executable by using /clr  \n  \n1.  In **Solution Explorer**, right-click the project and then click **Properties**.  \n  \n2.  In the **Project Properties** dialog box, expand the node next to **Configuration Properties** and select **General**. In the right pane, under **Project Defaults**, set **Common Language Runtime support** to **Common Language Runtime Support (/clr)**.  \n  \n3.  Under **Configuration Properties**, expand the node next to **C/C++** and select **General**. Make sure that **Debug Information Format** is set to **Program Database /Zi** (not **/ZI**).  \n  \n4.  Select the **Code Generation** node. Set **Enable Minimal Rebuild** to **No (/Gm-)**. Also set **Basic Runtime Checks** to **Default**.  \n  \n5.  Under **Configuration Properties**, select **C/C++** and then **Code Generation**. Make sure that **Runtime Library** is set to either **Multi-threaded Debug DLL (/MDd)** or **Multi-threaded DLL (/MD)**.  \n  \n6.  For every MIDL-generated file (C files), right-click the file in **Solution Explorer** and then click **Properties**. Under **Configuration Properties**, expand the node next to **C/C++** and select **General**. Set **Compile with Common Language Runtime support** to **No Common Language Runtime support**.  \n  \n### To compile an ATL DLL by using /clr  \n  \n1.  Follow the steps in the \"To compile an ATL executable by using /clr\" section.  \n  \n2.  Under **Configuration Properties**, expand the node next to **C/C++** and select **Precompiled Headers**. Set **Create/Use Precompiled Header** to **Not using Precompiled Headers**.  \n  \n     As an alternative, in **Solution Explorer**, right-click Stdafx.cpp and then click **Properties**. Under **Configuration Properties**, expand the node next to **C/C++** and select **General**. Set **Compile with Common Language Runtime support** to **No Common Language Runtime support**.  \n  \n3.  For the file that contains DllMain and anything it calls, in **Solution Explorer**, right-click the file and then click **Properties**. Under **Configuration Properties**, expand the node next to **C/C++** and select **General**. In the right pane, under **Project Defaults**, set **Compile with Common Language Runtime support** to **No Common Language Runtime support**.  \n  \n## See Also  \n [Mixed (Native and Managed) Assemblies](../dotnet/mixed-native-and-managed-assemblies.md)"}