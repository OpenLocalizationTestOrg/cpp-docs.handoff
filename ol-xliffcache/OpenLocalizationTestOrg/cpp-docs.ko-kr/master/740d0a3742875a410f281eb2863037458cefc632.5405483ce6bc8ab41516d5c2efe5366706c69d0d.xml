{"nodes":[{"pos":[12,49],"content":"Idle Loop Processing | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Idle Loop Processing | Microsoft Docs","pos":[0,37]}]},{"content":"Idle Loop Processing","pos":[938,958]},{"content":"Many applications perform lengthy processing \"in the background.\"","pos":[959,1024]},{"content":"Sometimes performance considerations dictate using multithreading for such work.","pos":[1025,1105]},{"content":"Threads involve extra development overhead, so they are not recommended for simple tasks like the idle-time work that MFC does in the <bpt id=\"p1\">[</bpt>OnIdle<ept id=\"p1\">](../mfc/reference/cwinthread-class.md#cwinthread__onidle)</ept> function.","pos":[1106,1315],"source":" Threads involve extra development overhead, so they are not recommended for simple tasks like the idle-time work that MFC does in the [OnIdle](../mfc/reference/cwinthread-class.md#cwinthread__onidle) function."},{"content":"This article focuses on idle processing.","pos":[1316,1356]},{"content":"For more information about multithreading, see <bpt id=\"p1\">[</bpt>Multithreading Topics<ept id=\"p1\">](../parallel/multithreading-support-for-older-code-visual-cpp.md)</ept>.","pos":[1357,1493],"source":" For more information about multithreading, see [Multithreading Topics](../parallel/multithreading-support-for-older-code-visual-cpp.md)."},{"content":"Some kinds of background processing are appropriately done during intervals that the user is not otherwise interacting with the application.","pos":[1500,1640]},{"content":"In an application developed for the Microsoft Windows operating system, an application can perform idle-time processing by splitting a lengthy process into many small fragments.","pos":[1641,1818]},{"content":"After processing each fragment, the application yields execution control to Windows using a <bpt id=\"p1\">[</bpt>PeekMessage<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms644943)</ept> loop.","pos":[1819,1990],"source":" After processing each fragment, the application yields execution control to Windows using a [PeekMessage](http://msdn.microsoft.com/library/windows/desktop/ms644943) loop."},{"content":"This article explains two ways to do idle processing in your application:","pos":[1997,2070]},{"pos":[2080,2129],"content":"Using <bpt id=\"p1\">**</bpt>PeekMessage<ept id=\"p1\">**</ept> in MFC's main message loop.","source":"Using **PeekMessage** in MFC's main message loop."},{"pos":[2139,2212],"content":"Embedding another <bpt id=\"p1\">**</bpt>PeekMessage<ept id=\"p1\">**</ept> loop somewhere else in the application.","source":"Embedding another **PeekMessage** loop somewhere else in the application."},{"pos":[2279,2314],"content":"PeekMessage in the MFC Message Loop"},{"content":"In an application developed with MFC, the main message loop in the <ph id=\"ph1\">`CWinThread`</ph> class contains a message loop that calls the <bpt id=\"p1\">[</bpt>PeekMessage<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms644943)</ept> Win32 API.","pos":[2318,2527],"source":"In an application developed with MFC, the main message loop in the `CWinThread` class contains a message loop that calls the [PeekMessage](http://msdn.microsoft.com/library/windows/desktop/ms644943) Win32 API."},{"content":"This loop also calls the <ph id=\"ph1\">`OnIdle`</ph> member function of <ph id=\"ph2\">`CWinThread`</ph> between messages.","pos":[2528,2611],"source":" This loop also calls the `OnIdle` member function of `CWinThread` between messages."},{"content":"An application can process messages in this idle time by overriding the <ph id=\"ph1\">`OnIdle`</ph> function.","pos":[2612,2702],"source":" An application can process messages in this idle time by overriding the `OnIdle` function."},{"pos":[2710,2884],"content":"[!NOTE]\n **Run**, `OnIdle`, and certain other member functions are now members of class `CWinThread` rather than of class `CWinApp`. `CWinApp` is derived from `CWinThread`.","leadings":["","> "],"nodes":[{"content":" **Run**, `OnIdle`, and certain other member functions are now members of class `CWinThread` rather than of class `CWinApp`. `CWinApp` is derived from `CWinThread`.","pos":[8,172],"nodes":[{"content":"<bpt id=\"p1\"> **</bpt>Run<ept id=\"p1\">**</ept>, <ph id=\"ph1\">`OnIdle`</ph>, and certain other member functions are now members of class <ph id=\"ph2\">`CWinThread`</ph> rather than of class <ph id=\"ph3\">`CWinApp`</ph>.","pos":[0,124],"source":" **Run**, `OnIdle`, and certain other member functions are now members of class `CWinThread` rather than of class `CWinApp`."},{"content":"is derived from <ph id=\"ph1\">`CWinThread`</ph>.","pos":[135,164],"source":" is derived from `CWinThread`."}]}]},{"pos":[2891,3039],"content":"For more information about performing idle processing, see <bpt id=\"p1\">[</bpt>OnIdle<ept id=\"p1\">](../mfc/reference/cwinthread-class.md#cwinthread__onidle)</ept> in the <bpt id=\"p2\">*</bpt>MFC Reference<ept id=\"p2\">*</ept>.","source":"For more information about performing idle processing, see [OnIdle](../mfc/reference/cwinthread-class.md#cwinthread__onidle) in the *MFC Reference*."},{"pos":[3112,3153],"content":"PeekMessage Elsewhere in Your Application"},{"content":"Another method for performing idle processing in an application involves embedding a message loop in one of your functions.","pos":[3157,3280]},{"content":"This message loop is very similar to MFC's main message loop, found in <bpt id=\"p1\">[</bpt>CWinThread::Run<ept id=\"p1\">](../mfc/reference/cwinthread-class.md#cwinthread__run)</ept>.","pos":[3281,3424],"source":" This message loop is very similar to MFC's main message loop, found in [CWinThread::Run](../mfc/reference/cwinthread-class.md#cwinthread__run)."},{"content":"That means such a loop in an application developed with MFC must perform many of the same functions as the main message loop.","pos":[3425,3550]},{"content":"The following code fragment demonstrates writing a message loop that is compatible with MFC:","pos":[3551,3643]},{"pos":[3661,3677],"content":"NVC_MFCDocView#8"},{"content":"This code, embedded in a function, loops as long as there is idle processing to do.","pos":[3737,3820]},{"content":"Within that loop, a nested loop repeatedly calls <bpt id=\"p1\">**</bpt>PeekMessage<ept id=\"p1\">**</ept>.","pos":[3821,3886],"source":" Within that loop, a nested loop repeatedly calls **PeekMessage**."},{"content":"As long as that call returns a nonzero value, the loop calls <ph id=\"ph1\">`CWinThread::PumpMessage`</ph> to perform normal message translation and dispatching.","pos":[3887,4028],"source":" As long as that call returns a nonzero value, the loop calls `CWinThread::PumpMessage` to perform normal message translation and dispatching."},{"content":"Although <ph id=\"ph1\">`PumpMessage`</ph> is undocumented, you can examine its source code in the ThrdCore.Cpp file in the \\atlmfc\\src\\mfc directory of your Visual C++ installation.","pos":[4029,4191],"source":" Although `PumpMessage` is undocumented, you can examine its source code in the ThrdCore.Cpp file in the \\atlmfc\\src\\mfc directory of your Visual C++ installation."},{"content":"Once the inner loop ends, the outer loop performs idle processing with one or more calls to <ph id=\"ph1\">`OnIdle`</ph>.","pos":[4198,4299],"source":"Once the inner loop ends, the outer loop performs idle processing with one or more calls to `OnIdle`."},{"content":"The first call is for MFC's purposes.","pos":[4300,4337]},{"content":"You can make additional calls to <ph id=\"ph1\">`OnIdle`</ph> to do your own background work.","pos":[4338,4411],"source":" You can make additional calls to `OnIdle` to do your own background work."},{"pos":[4418,4572],"content":"For more information about performing idle processing, see <bpt id=\"p1\">[</bpt>OnIdle<ept id=\"p1\">](../mfc/reference/cwinthread-class.md#cwinthread__onidle)</ept> in the MFC Library Reference.","source":"For more information about performing idle processing, see [OnIdle](../mfc/reference/cwinthread-class.md#cwinthread__onidle) in the MFC Library Reference."},{"content":"See Also","pos":[4581,4589]},{"content":"General MFC Topics","pos":[4594,4612]}],"content":"---\ntitle: \"Idle Loop Processing | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MFC, background processing\"\n  - \"PeekMessage method, elsewhere than message loop\"\n  - \"PeekMessage method\"\n  - \"MFC, messages\"\n  - \"messages, loops\"\n  - \"OnIdle method\"\n  - \"processing, background\"\n  - \"idle loop processing\"\n  - \"idle processing\"\n  - \"threading [MFC], alternatives to multithreading\"\n  - \"processing, during idle loop\"\n  - \"processing\"\n  - \"background processing\"\nms.assetid: 5c7c46c1-6107-4304-895f-480983bb1e44\ncaps.latest.revision: 11\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Idle Loop Processing\nMany applications perform lengthy processing \"in the background.\" Sometimes performance considerations dictate using multithreading for such work. Threads involve extra development overhead, so they are not recommended for simple tasks like the idle-time work that MFC does in the [OnIdle](../mfc/reference/cwinthread-class.md#cwinthread__onidle) function. This article focuses on idle processing. For more information about multithreading, see [Multithreading Topics](../parallel/multithreading-support-for-older-code-visual-cpp.md).  \n  \n Some kinds of background processing are appropriately done during intervals that the user is not otherwise interacting with the application. In an application developed for the Microsoft Windows operating system, an application can perform idle-time processing by splitting a lengthy process into many small fragments. After processing each fragment, the application yields execution control to Windows using a [PeekMessage](http://msdn.microsoft.com/library/windows/desktop/ms644943) loop.  \n  \n This article explains two ways to do idle processing in your application:  \n  \n-   Using **PeekMessage** in MFC's main message loop.  \n  \n-   Embedding another **PeekMessage** loop somewhere else in the application.  \n  \n##  <a name=\"_core_peekmessage_in_the_mfc_message_loop\"></a> PeekMessage in the MFC Message Loop  \n In an application developed with MFC, the main message loop in the `CWinThread` class contains a message loop that calls the [PeekMessage](http://msdn.microsoft.com/library/windows/desktop/ms644943) Win32 API. This loop also calls the `OnIdle` member function of `CWinThread` between messages. An application can process messages in this idle time by overriding the `OnIdle` function.  \n  \n> [!NOTE]\n>  **Run**, `OnIdle`, and certain other member functions are now members of class `CWinThread` rather than of class `CWinApp`. `CWinApp` is derived from `CWinThread`.  \n  \n For more information about performing idle processing, see [OnIdle](../mfc/reference/cwinthread-class.md#cwinthread__onidle) in the *MFC Reference*.  \n  \n##  <a name=\"_core_peekmessage_elsewhere_in_your_application\"></a> PeekMessage Elsewhere in Your Application  \n Another method for performing idle processing in an application involves embedding a message loop in one of your functions. This message loop is very similar to MFC's main message loop, found in [CWinThread::Run](../mfc/reference/cwinthread-class.md#cwinthread__run). That means such a loop in an application developed with MFC must perform many of the same functions as the main message loop. The following code fragment demonstrates writing a message loop that is compatible with MFC:  \n  \n [!code-cpp[NVC_MFCDocView#8](../mfc/codesnippet/cpp/idle-loop-processing_1.cpp)]  \n  \n This code, embedded in a function, loops as long as there is idle processing to do. Within that loop, a nested loop repeatedly calls **PeekMessage**. As long as that call returns a nonzero value, the loop calls `CWinThread::PumpMessage` to perform normal message translation and dispatching. Although `PumpMessage` is undocumented, you can examine its source code in the ThrdCore.Cpp file in the \\atlmfc\\src\\mfc directory of your Visual C++ installation.  \n  \n Once the inner loop ends, the outer loop performs idle processing with one or more calls to `OnIdle`. The first call is for MFC's purposes. You can make additional calls to `OnIdle` to do your own background work.  \n  \n For more information about performing idle processing, see [OnIdle](../mfc/reference/cwinthread-class.md#cwinthread__onidle) in the MFC Library Reference.  \n  \n## See Also  \n [General MFC Topics](../mfc/general-mfc-topics.md)\n\n"}