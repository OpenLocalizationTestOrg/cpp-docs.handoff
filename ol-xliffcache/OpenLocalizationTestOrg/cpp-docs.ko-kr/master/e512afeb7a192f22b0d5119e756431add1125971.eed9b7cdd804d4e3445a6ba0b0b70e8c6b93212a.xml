{"nodes":[{"pos":[12,73],"content":"TN042: ODBC Driver Developer Recommendations | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"TN042: ODBC Driver Developer Recommendations | Microsoft Docs","pos":[0,61]}]},{"content":"TN042: ODBC Driver Developer Recommendations","pos":[678,722]},{"pos":[725,1040],"content":"[!NOTE]\n The following technical note has not been updated since it was first included in the online documentation. As a result, some procedures and topics might be out of date or incorrect. For the latest information, it is recommended that you search for the topic of interest in the online documentation index.","leadings":["","> "],"nodes":[{"content":" The following technical note has not been updated since it was first included in the online documentation. As a result, some procedures and topics might be out of date or incorrect. For the latest information, it is recommended that you search for the topic of interest in the online documentation index.","pos":[8,313],"nodes":[{"content":"The following technical note has not been updated since it was first included in the online documentation.","pos":[1,107]},{"content":"As a result, some procedures and topics might be out of date or incorrect.","pos":[108,182]},{"content":"For the latest information, it is recommended that you search for the topic of interest in the online documentation index.","pos":[183,305]}]}]},{"content":"This note describes guidelines for ODBC driver writers.","pos":[1047,1102]},{"content":"It outlines general requirements and assumptions of ODBC functionality that the MFC Database classes make, and various expected semantic details.","pos":[1103,1248]},{"content":"Required driver functionality to support the three <ph id=\"ph1\">`CRecordset`</ph> Open modes (<bpt id=\"p1\">**</bpt>forwardOnly<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>snapshot<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>dynaset<ept id=\"p3\">**</ept>) are described.","pos":[1249,1386],"source":" Required driver functionality to support the three `CRecordset` Open modes (**forwardOnly**, **snapshot** and **dynaset**) are described."},{"content":"ODBC's Cursor Library","pos":[1395,1416]},{"content":"The MFC Database classes present functionality to the user that in many cases surpasses the functionality provided by most level 1 ODBC drivers.","pos":[1420,1564]},{"content":"Fortunately, ODBC's Cursor Library will layer itself between the database classes and the driver, and will automatically provide much of this additional functionality.","pos":[1565,1732]},{"content":"For instance, most 1.0 drivers do not support backward scrolling.","pos":[1739,1804]},{"content":"The Cursor Library can detect this, and will cache rows from the driver and present them as requested on FETCH_PREV calls in <bpt id=\"p1\">**</bpt>SQLExtendedFetch<ept id=\"p1\">**</ept>.","pos":[1805,1951],"source":" The Cursor Library can detect this, and will cache rows from the driver and present them as requested on FETCH_PREV calls in **SQLExtendedFetch**."},{"content":"Another important example of cursor library dependence is positioned updates.","pos":[1958,2035]},{"content":"Most 1.0 drivers also do not have positioned updates, but the cursor library will generate update statements which identify a target row on the data source based upon its current cached data values, or a cached timestamp value.","pos":[2036,2263]},{"content":"The class library never makes use of multiple rowsets.","pos":[2270,2324]},{"content":"Therefore, the few <bpt id=\"p1\">**</bpt>SQLSetPos<ept id=\"p1\">**</ept> statements are always applied to row 1 of the rowset.","pos":[2325,2411],"source":" Therefore, the few **SQLSetPos** statements are always applied to row 1 of the rowset."},{"content":"CDatabases","pos":[2420,2430]},{"content":"Each <ph id=\"ph1\">`CDatabase`</ph> allocates a single <bpt id=\"p1\">**</bpt>HDBC<ept id=\"p1\">**</ept>.","pos":[2434,2479],"source":"Each `CDatabase` allocates a single **HDBC**."},{"content":"(If <ph id=\"ph1\">`CDatabase`</ph>'s <ph id=\"ph2\">`ExecuteSQL`</ph> function is used, an <bpt id=\"p1\">**</bpt>HSTMT<ept id=\"p1\">**</ept> is temporarily allocated.) So if multiple <ph id=\"ph3\">`CDatabase`</ph>'s are required, multiple <bpt id=\"p2\">**</bpt>HDBC<ept id=\"p2\">**</ept>s per <bpt id=\"p3\">**</bpt>HENV<ept id=\"p3\">**</ept> must be supported.","pos":[2480,2662],"source":" (If `CDatabase`'s `ExecuteSQL` function is used, an **HSTMT** is temporarily allocated.) So if multiple `CDatabase`'s are required, multiple **HDBC**s per **HENV** must be supported."},{"content":"The database classes require the cursor library.","pos":[2669,2717]},{"content":"This is reflected in a <bpt id=\"p1\">**</bpt>SQLSetConnections<ept id=\"p1\">**</ept> call <bpt id=\"p2\">**</bpt>SQL_ODBC_CURSORS<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>SQL_CUR_USE_ODBC<ept id=\"p3\">**</ept>.","pos":[2718,2811],"source":" This is reflected in a **SQLSetConnections** call **SQL_ODBC_CURSORS**, **SQL_CUR_USE_ODBC**."},{"pos":[2818,2940],"content":"<bpt id=\"p1\">**</bpt>SQLDriverConnect<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQL_DRIVER_COMPLETE<ept id=\"p2\">**</ept> is used by <ph id=\"ph1\">`CDatabase::Open`</ph> to establish the connection to the data source.","source":"**SQLDriverConnect**, **SQL_DRIVER_COMPLETE** is used by `CDatabase::Open` to establish the connection to the data source."},{"pos":[2947,3097],"content":"The driver must support <bpt id=\"p1\">**</bpt>SQLGetInfo SQL_ODBC_API_CONFORMANCE<ept id=\"p1\">**</ept><ph id=\"ph1\"> &gt;= </ph><bpt id=\"p2\">**</bpt>SQL_OAC_LEVEL1<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>SQLGetInfo SQL_ODBC_SQL_CONFORMANCE<ept id=\"p3\">**</ept><ph id=\"ph2\"> &gt;= </ph><bpt id=\"p4\">**</bpt>SQL_OSC_MINIMUM<ept id=\"p4\">**</ept>.","source":"The driver must support **SQLGetInfo SQL_ODBC_API_CONFORMANCE** >= **SQL_OAC_LEVEL1**, **SQLGetInfo SQL_ODBC_SQL_CONFORMANCE** >= **SQL_OSC_MINIMUM**."},{"content":"In order for transactions to be supported for the <ph id=\"ph1\">`CDatabase`</ph> and its dependent recordsets, <bpt id=\"p1\">**</bpt>SQLGetInfo SQL_CURSOR_COMMIT_BEHAVIOR<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SQL_CURSOR_ROLLBACK_BEHAVIOR<ept id=\"p2\">**</ept> must have <bpt id=\"p3\">**</bpt>SQL_CR_PRESERVE<ept id=\"p3\">**</ept>.","pos":[3104,3305],"source":"In order for transactions to be supported for the `CDatabase` and its dependent recordsets, **SQLGetInfo SQL_CURSOR_COMMIT_BEHAVIOR** and **SQL_CURSOR_ROLLBACK_BEHAVIOR** must have **SQL_CR_PRESERVE**."},{"content":"Otherwise, attempts to perform transaction control will be ignored.","pos":[3306,3373]},{"content":"<bpt id=\"p1\">**</bpt>SQLGetInfo SQL_DATA_SOURCE_READ_ONLY<ept id=\"p1\">**</ept> must be supported.","pos":[3380,3439],"source":"**SQLGetInfo SQL_DATA_SOURCE_READ_ONLY** must be supported."},{"content":"If it returns \"Y\", no update operations will be performed on the data source.","pos":[3440,3517]},{"pos":[3524,3689],"content":"If the <ph id=\"ph1\">`CDatabase`</ph> is opened ReadOnly, an attempt to set the data source read only will be made with <bpt id=\"p1\">**</bpt>SQLSetConnectOption SQL_ACCESS_MODE<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQL_MODE_READ_ONLY<ept id=\"p2\">**</ept>.","source":"If the `CDatabase` is opened ReadOnly, an attempt to set the data source read only will be made with **SQLSetConnectOption SQL_ACCESS_MODE**, **SQL_MODE_READ_ONLY**."},{"pos":[3696,3834],"content":"If identifiers require quoting, this information should be returned from the driver with an <bpt id=\"p1\">**</bpt>SQLGetInfo SQL_IDENTIFIER_QUOTE_CHAR<ept id=\"p1\">**</ept> call.","source":"If identifiers require quoting, this information should be returned from the driver with an **SQLGetInfo SQL_IDENTIFIER_QUOTE_CHAR** call."},{"pos":[3841,3945],"content":"For debugging purposes, <bpt id=\"p1\">**</bpt>SQLGetInfo SQL_DBMS_VER<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SQL_DBMS_NAME<ept id=\"p2\">**</ept> are retrieved from the driver.","source":"For debugging purposes, **SQLGetInfo SQL_DBMS_VER** and **SQL_DBMS_NAME** are retrieved from the driver."},{"pos":[3952,4058],"content":"<bpt id=\"p1\">**</bpt>SQLSetStmtOption SQL_QUERY_TIMEOUT<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SQL_ASYNC_ENABLE<ept id=\"p2\">**</ept> may be called on a <ph id=\"ph1\">`CDatabase`</ph>'s <bpt id=\"p3\">**</bpt>HDBC<ept id=\"p3\">**</ept>.","source":"**SQLSetStmtOption SQL_QUERY_TIMEOUT** and **SQL_ASYNC_ENABLE** may be called on a `CDatabase`'s **HDBC**."},{"pos":[4065,4123],"content":"<bpt id=\"p1\">**</bpt>SQLError<ept id=\"p1\">**</ept> may be called with any or all arguments NULL.","source":"**SQLError** may be called with any or all arguments NULL."},{"pos":[4130,4238],"content":"Of course, <bpt id=\"p1\">**</bpt>SQLAllocEnv<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQLAllocConnect<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>SQLDisconnect<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>SQLFreeConnect<ept id=\"p4\">**</ept> must be supported.","source":"Of course, **SQLAllocEnv**, **SQLAllocConnect**, **SQLDisconnect** and **SQLFreeConnect** must be supported."},{"content":"ExecuteSQL","pos":[4247,4257]},{"content":"In addition to allocating and freeing a temporary <bpt id=\"p1\">**</bpt>HSTMT<ept id=\"p1\">**</ept>, <ph id=\"ph1\">`ExecuteSQL`</ph> calls <bpt id=\"p2\">**</bpt>SQLExecDirect<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>SQLFetch<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>SQLNumResultCol<ept id=\"p4\">**</ept> and <ph id=\"ph2\">`SQLMoreResults`</ph>.","pos":[4261,4415],"source":"In addition to allocating and freeing a temporary **HSTMT**, `ExecuteSQL` calls **SQLExecDirect**, **SQLFetch**, **SQLNumResultCol** and `SQLMoreResults`."},{"content":"<bpt id=\"p1\">**</bpt>SQLCancel<ept id=\"p1\">**</ept> may be called on the <bpt id=\"p2\">**</bpt>HSTMT<ept id=\"p2\">**</ept>.","pos":[4416,4461],"source":"**SQLCancel** may be called on the **HSTMT**."},{"content":"GetDatabaseName","pos":[4470,4485]},{"pos":[4489,4537],"content":"<bpt id=\"p1\">**</bpt>SQLGetInfo SQL_DATABASE_NAME<ept id=\"p1\">**</ept> will be called.","source":"**SQLGetInfo SQL_DATABASE_NAME** will be called."},{"content":"BeginTrans, CommitTrans, Rollback","pos":[4546,4579]},{"pos":[4583,4742],"content":"<bpt id=\"p1\">**</bpt>SQLSetConnectOption SQL_AUTOCOMMIT<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SQLTransact SQL_COMMIT<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>SQL_ROLLBACK<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>SQL_AUTOCOMMIT<ept id=\"p4\">**</ept> will be called if transaction requests are made.","source":"**SQLSetConnectOption SQL_AUTOCOMMIT** and **SQLTransact SQL_COMMIT**, **SQL_ROLLBACK** and **SQL_AUTOCOMMIT** will be called if transaction requests are made."},{"content":"CRecordsets","pos":[4751,4762]},{"content":"<bpt id=\"p1\">**</bpt>SQLAllocStmt<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQLPrepare<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>SQLExecute<ept id=\"p3\">**</ept> (For <bpt id=\"p4\">**</bpt>Open<ept id=\"p4\">**</ept> and <bpt id=\"p5\">**</bpt>Requery<ept id=\"p5\">**</ept>), <bpt id=\"p6\">**</bpt>SQLExecDirect<ept id=\"p6\">**</ept> (for update operations), <bpt id=\"p7\">**</bpt>SQLFreeStmt<ept id=\"p7\">**</ept> must be supported.","pos":[4766,4924],"source":"**SQLAllocStmt**, **SQLPrepare**, **SQLExecute** (For **Open** and **Requery**), **SQLExecDirect** (for update operations), **SQLFreeStmt** must be supported."},{"content":"<bpt id=\"p1\">**</bpt>SQLNumResultCols<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SQLDescribeCol<ept id=\"p2\">**</ept> will be called on the results set at various times.","pos":[4925,5020],"source":"**SQLNumResultCols** and **SQLDescribeCol** will be called on the results set at various times."},{"pos":[5027,5125],"content":"<bpt id=\"p1\">**</bpt>SQLSetParam<ept id=\"p1\">**</ept> is used extensively for binding parameter data and <bpt id=\"p2\">**</bpt>DATA_AT_EXEC<ept id=\"p2\">**</ept> functionality.","source":"**SQLSetParam** is used extensively for binding parameter data and **DATA_AT_EXEC** functionality."},{"pos":[5132,5226],"content":"<bpt id=\"p1\">**</bpt>SQLBindCol<ept id=\"p1\">**</ept> is used extensively to register output Column data storage locations with ODBC.","source":"**SQLBindCol** is used extensively to register output Column data storage locations with ODBC."},{"content":"Two <bpt id=\"p1\">**</bpt>SQLGetData<ept id=\"p1\">**</ept> calls are used to retrieve <bpt id=\"p2\">**</bpt>SQL_LONG_VARCHAR<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>SQL_LONG_VARBINARY<ept id=\"p3\">**</ept> data.","pos":[5233,5332],"source":"Two **SQLGetData** calls are used to retrieve **SQL_LONG_VARCHAR** and **SQL_LONG_VARBINARY** data."},{"content":"The first call attempts to find the total length of the column value by calling <bpt id=\"p1\">**</bpt>SQLGetData<ept id=\"p1\">**</ept> with cbMaxValue of 0, but with a valid pcbValue.","pos":[5333,5476],"source":" The first call attempts to find the total length of the column value by calling **SQLGetData** with cbMaxValue of 0, but with a valid pcbValue."},{"content":"If pcbValue holds <bpt id=\"p1\">**</bpt>SQL_NO_TOTAL<ept id=\"p1\">**</ept>, an exception is thrown.","pos":[5477,5536],"source":" If pcbValue holds **SQL_NO_TOTAL**, an exception is thrown."},{"content":"Otherwise, an <ph id=\"ph1\">`HGLOBAL`</ph> is allocated, and another <bpt id=\"p1\">**</bpt>SQLGetData<ept id=\"p1\">**</ept> call made to retrieve the entire result.","pos":[5537,5642],"source":" Otherwise, an `HGLOBAL` is allocated, and another **SQLGetData** call made to retrieve the entire result."},{"content":"Updating","pos":[5651,5659]},{"content":"If pessimistic locking is requested, <bpt id=\"p1\">**</bpt>SQLGetInfo SQL_LOCK_TYPES<ept id=\"p1\">**</ept> will be queried.","pos":[5663,5746],"source":"If pessimistic locking is requested, **SQLGetInfo SQL_LOCK_TYPES** will be queried."},{"content":"If <bpt id=\"p1\">**</bpt>SQL_LCK_EXCLUSIVE<ept id=\"p1\">**</ept> is not supported, an exception will be thrown.","pos":[5747,5818],"source":" If **SQL_LCK_EXCLUSIVE** is not supported, an exception will be thrown."},{"content":"Attempts to update a <ph id=\"ph1\">`CRecordset`</ph> (<bpt id=\"p1\">**</bpt>snapshot<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>dynaset<ept id=\"p2\">**</ept>) will cause a second <bpt id=\"p3\">**</bpt>HSTMT<ept id=\"p3\">**</ept> to be allocated.","pos":[5825,5935],"source":"Attempts to update a `CRecordset` (**snapshot** or **dynaset**) will cause a second **HSTMT** to be allocated."},{"content":"For drivers that do not support second <bpt id=\"p1\">**</bpt>HSTMT<ept id=\"p1\">**</ept>, the cursor library will simulate this functionality.","pos":[5936,6038],"source":" For drivers that do not support second **HSTMT**, the cursor library will simulate this functionality."},{"content":"Unfortunately, this may sometimes mean forcing the current query on the first <bpt id=\"p1\">**</bpt>HSTMT<ept id=\"p1\">**</ept> to completion before processing the second <bpt id=\"p2\">**</bpt>HSTMT<ept id=\"p2\">**</ept>'s request.","pos":[6039,6190],"source":" Unfortunately, this may sometimes mean forcing the current query on the first **HSTMT** to completion before processing the second **HSTMT**'s request."},{"pos":[6197,6313],"content":"<bpt id=\"p1\">**</bpt>SQLFreeStmt SQL_CLOSE<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SQL_RESET_PARAMS<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>SQLGetCursorName<ept id=\"p3\">**</ept> will be called during update operations.","source":"**SQLFreeStmt SQL_CLOSE** and **SQL_RESET_PARAMS** and **SQLGetCursorName** will be called during update operations."},{"content":"If there are <bpt id=\"p1\">**</bpt>CLongBinarys<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>outputColumns<ept id=\"p2\">**</ept>, ODBC's <bpt id=\"p3\">**</bpt>DATA_AT_EXEC<ept id=\"p3\">**</ept> functionality must be supported.","pos":[6320,6432],"source":"If there are **CLongBinarys** in the **outputColumns**, ODBC's **DATA_AT_EXEC** functionality must be supported."},{"content":"This includes returning <bpt id=\"p1\">**</bpt>SQL_NEED_DATA<ept id=\"p1\">**</ept> from <bpt id=\"p2\">**</bpt>SQLExecDirect<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>SQLParamData<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>SQLPutData<ept id=\"p4\">**</ept>.","pos":[6433,6535],"source":" This includes returning **SQL_NEED_DATA** from **SQLExecDirect**, **SQLParamData** and **SQLPutData**."},{"pos":[6542,6650],"content":"<bpt id=\"p1\">**</bpt>SQLRowCount<ept id=\"p1\">**</ept> is called after executing to verify that only 1 record was updated by the <bpt id=\"p2\">**</bpt>SQLExecDirect<ept id=\"p2\">**</ept>.","source":"**SQLRowCount** is called after executing to verify that only 1 record was updated by the **SQLExecDirect**."},{"content":"ForwardOnly Cursors","pos":[6659,6678]},{"content":"Only <bpt id=\"p1\">**</bpt>SQLFetch<ept id=\"p1\">**</ept> is required for the <bpt id=\"p2\">**</bpt>Move<ept id=\"p2\">**</ept> operations.","pos":[6682,6740],"source":"Only **SQLFetch** is required for the **Move** operations."},{"content":"Note that <bpt id=\"p1\">**</bpt>forwardOnly<ept id=\"p1\">**</ept> cursors do not support updates.","pos":[6741,6798],"source":" Note that **forwardOnly** cursors do not support updates."},{"content":"Snapshot Cursors","pos":[6807,6823]},{"content":"Snapshot functionality requires <bpt id=\"p1\">**</bpt>SQLExtendedFetch<ept id=\"p1\">**</ept> support.","pos":[6827,6888],"source":"Snapshot functionality requires **SQLExtendedFetch** support."},{"content":"As noted above, the ODBC cursor library will detect when a driver does not support <bpt id=\"p1\">**</bpt>SQLExtendedFetch<ept id=\"p1\">**</ept>, and provide the necessary support itself.","pos":[6889,7035],"source":" As noted above, the ODBC cursor library will detect when a driver does not support **SQLExtendedFetch**, and provide the necessary support itself."},{"pos":[7042,7112],"content":"<bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQL_SCROLL_OPTIONS<ept id=\"p2\">**</ept> must support <bpt id=\"p3\">**</bpt>SQL_SO_STATIC<ept id=\"p3\">**</ept>.","source":"**SQLGetInfo**, **SQL_SCROLL_OPTIONS** must support **SQL_SO_STATIC**."},{"content":"Dynaset Cursors","pos":[7121,7136]},{"content":"Below is the minimum support required to open a dynaset:","pos":[7140,7196]},{"pos":[7203,7255],"content":"<bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQL_ODBC_VER<ept id=\"p2\">**</ept> must return &gt; \"01\".","source":"**SQLGetInfo**, **SQL_ODBC_VER** must return > \"01\"."},{"pos":[7262,7339],"content":"<bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQL_SCROLL_OPTIONS<ept id=\"p2\">**</ept> must support <bpt id=\"p3\">**</bpt>SQL_SO_KEYSET_DRIVEN<ept id=\"p3\">**</ept>.","source":"**SQLGetInfo**, **SQL_SCROLL_OPTIONS** must support **SQL_SO_KEYSET_DRIVEN**."},{"pos":[7346,7398],"content":"<bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQL_ROW_UPDATES<ept id=\"p2\">**</ept> must return \"Y\".","source":"**SQLGetInfo**, **SQL_ROW_UPDATES** must return \"Y\"."},{"pos":[7405,7523],"content":"<bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>SQL_POSITIONED_UPDATES<ept id=\"p2\">**</ept> must support <bpt id=\"p3\">**</bpt>SQL_PS_POSITIONED_DELETE<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>SQL_PS_POSITIONED_UPDATE<ept id=\"p4\">**</ept>.","source":"**SQLGetInfo**, **SQL_POSITIONED_UPDATES** must support **SQL_PS_POSITIONED_DELETE** and **SQL_PS_POSITIONED_UPDATE**."},{"pos":[7530,7677],"content":"In addition, if pessimistic locking is requested, a call to <bpt id=\"p1\">**</bpt>SQLSetPos<ept id=\"p1\">**</ept> with irow 1, fRefresh FALSE and fLock <bpt id=\"p2\">**</bpt>SQL_LCK_EXCLUSIVE<ept id=\"p2\">**</ept> will be made.","source":"In addition, if pessimistic locking is requested, a call to **SQLSetPos** with irow 1, fRefresh FALSE and fLock **SQL_LCK_EXCLUSIVE** will be made."},{"content":"See Also","pos":[7686,7694]},{"content":"Technical Notes by Number","pos":[7699,7724]},{"content":"Technical Notes by Category","pos":[7768,7795]}],"content":"---\ntitle: \"TN042: ODBC Driver Developer Recommendations | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"vc.odbc\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"ODBC drivers [C++], writing\"\n  - \"databases [C++], ODBC\"\n  - \"TN042\"\nms.assetid: ecc6b5d9-f480-4582-9e22-8309fe561dad\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# TN042: ODBC Driver Developer Recommendations\n> [!NOTE]\n>  The following technical note has not been updated since it was first included in the online documentation. As a result, some procedures and topics might be out of date or incorrect. For the latest information, it is recommended that you search for the topic of interest in the online documentation index.  \n  \n This note describes guidelines for ODBC driver writers. It outlines general requirements and assumptions of ODBC functionality that the MFC Database classes make, and various expected semantic details. Required driver functionality to support the three `CRecordset` Open modes (**forwardOnly**, **snapshot** and **dynaset**) are described.  \n  \n## ODBC's Cursor Library  \n The MFC Database classes present functionality to the user that in many cases surpasses the functionality provided by most level 1 ODBC drivers. Fortunately, ODBC's Cursor Library will layer itself between the database classes and the driver, and will automatically provide much of this additional functionality.  \n  \n For instance, most 1.0 drivers do not support backward scrolling. The Cursor Library can detect this, and will cache rows from the driver and present them as requested on FETCH_PREV calls in **SQLExtendedFetch**.  \n  \n Another important example of cursor library dependence is positioned updates. Most 1.0 drivers also do not have positioned updates, but the cursor library will generate update statements which identify a target row on the data source based upon its current cached data values, or a cached timestamp value.  \n  \n The class library never makes use of multiple rowsets. Therefore, the few **SQLSetPos** statements are always applied to row 1 of the rowset.  \n  \n## CDatabases  \n Each `CDatabase` allocates a single **HDBC**. (If `CDatabase`'s `ExecuteSQL` function is used, an **HSTMT** is temporarily allocated.) So if multiple `CDatabase`'s are required, multiple **HDBC**s per **HENV** must be supported.  \n  \n The database classes require the cursor library. This is reflected in a **SQLSetConnections** call **SQL_ODBC_CURSORS**, **SQL_CUR_USE_ODBC**.  \n  \n **SQLDriverConnect**, **SQL_DRIVER_COMPLETE** is used by `CDatabase::Open` to establish the connection to the data source.  \n  \n The driver must support **SQLGetInfo SQL_ODBC_API_CONFORMANCE** >= **SQL_OAC_LEVEL1**, **SQLGetInfo SQL_ODBC_SQL_CONFORMANCE** >= **SQL_OSC_MINIMUM**.  \n  \n In order for transactions to be supported for the `CDatabase` and its dependent recordsets, **SQLGetInfo SQL_CURSOR_COMMIT_BEHAVIOR** and **SQL_CURSOR_ROLLBACK_BEHAVIOR** must have **SQL_CR_PRESERVE**. Otherwise, attempts to perform transaction control will be ignored.  \n  \n **SQLGetInfo SQL_DATA_SOURCE_READ_ONLY** must be supported. If it returns \"Y\", no update operations will be performed on the data source.  \n  \n If the `CDatabase` is opened ReadOnly, an attempt to set the data source read only will be made with **SQLSetConnectOption SQL_ACCESS_MODE**, **SQL_MODE_READ_ONLY**.  \n  \n If identifiers require quoting, this information should be returned from the driver with an **SQLGetInfo SQL_IDENTIFIER_QUOTE_CHAR** call.  \n  \n For debugging purposes, **SQLGetInfo SQL_DBMS_VER** and **SQL_DBMS_NAME** are retrieved from the driver.  \n  \n **SQLSetStmtOption SQL_QUERY_TIMEOUT** and **SQL_ASYNC_ENABLE** may be called on a `CDatabase`'s **HDBC**.  \n  \n **SQLError** may be called with any or all arguments NULL.  \n  \n Of course, **SQLAllocEnv**, **SQLAllocConnect**, **SQLDisconnect** and **SQLFreeConnect** must be supported.  \n  \n## ExecuteSQL  \n In addition to allocating and freeing a temporary **HSTMT**, `ExecuteSQL` calls **SQLExecDirect**, **SQLFetch**, **SQLNumResultCol** and `SQLMoreResults`. **SQLCancel** may be called on the **HSTMT**.  \n  \n## GetDatabaseName  \n **SQLGetInfo SQL_DATABASE_NAME** will be called.  \n  \n## BeginTrans, CommitTrans, Rollback  \n **SQLSetConnectOption SQL_AUTOCOMMIT** and **SQLTransact SQL_COMMIT**, **SQL_ROLLBACK** and **SQL_AUTOCOMMIT** will be called if transaction requests are made.  \n  \n## CRecordsets  \n **SQLAllocStmt**, **SQLPrepare**, **SQLExecute** (For **Open** and **Requery**), **SQLExecDirect** (for update operations), **SQLFreeStmt** must be supported. **SQLNumResultCols** and **SQLDescribeCol** will be called on the results set at various times.  \n  \n **SQLSetParam** is used extensively for binding parameter data and **DATA_AT_EXEC** functionality.  \n  \n **SQLBindCol** is used extensively to register output Column data storage locations with ODBC.  \n  \n Two **SQLGetData** calls are used to retrieve **SQL_LONG_VARCHAR** and **SQL_LONG_VARBINARY** data. The first call attempts to find the total length of the column value by calling **SQLGetData** with cbMaxValue of 0, but with a valid pcbValue. If pcbValue holds **SQL_NO_TOTAL**, an exception is thrown. Otherwise, an `HGLOBAL` is allocated, and another **SQLGetData** call made to retrieve the entire result.  \n  \n## Updating  \n If pessimistic locking is requested, **SQLGetInfo SQL_LOCK_TYPES** will be queried. If **SQL_LCK_EXCLUSIVE** is not supported, an exception will be thrown.  \n  \n Attempts to update a `CRecordset` (**snapshot** or **dynaset**) will cause a second **HSTMT** to be allocated. For drivers that do not support second **HSTMT**, the cursor library will simulate this functionality. Unfortunately, this may sometimes mean forcing the current query on the first **HSTMT** to completion before processing the second **HSTMT**'s request.  \n  \n **SQLFreeStmt SQL_CLOSE** and **SQL_RESET_PARAMS** and **SQLGetCursorName** will be called during update operations.  \n  \n If there are **CLongBinarys** in the **outputColumns**, ODBC's **DATA_AT_EXEC** functionality must be supported. This includes returning **SQL_NEED_DATA** from **SQLExecDirect**, **SQLParamData** and **SQLPutData**.  \n  \n **SQLRowCount** is called after executing to verify that only 1 record was updated by the **SQLExecDirect**.  \n  \n## ForwardOnly Cursors  \n Only **SQLFetch** is required for the **Move** operations. Note that **forwardOnly** cursors do not support updates.  \n  \n## Snapshot Cursors  \n Snapshot functionality requires **SQLExtendedFetch** support. As noted above, the ODBC cursor library will detect when a driver does not support **SQLExtendedFetch**, and provide the necessary support itself.  \n  \n **SQLGetInfo**, **SQL_SCROLL_OPTIONS** must support **SQL_SO_STATIC**.  \n  \n## Dynaset Cursors  \n Below is the minimum support required to open a dynaset:  \n  \n **SQLGetInfo**, **SQL_ODBC_VER** must return > \"01\".  \n  \n **SQLGetInfo**, **SQL_SCROLL_OPTIONS** must support **SQL_SO_KEYSET_DRIVEN**.  \n  \n **SQLGetInfo**, **SQL_ROW_UPDATES** must return \"Y\".  \n  \n **SQLGetInfo**, **SQL_POSITIONED_UPDATES** must support **SQL_PS_POSITIONED_DELETE** and **SQL_PS_POSITIONED_UPDATE**.  \n  \n In addition, if pessimistic locking is requested, a call to **SQLSetPos** with irow 1, fRefresh FALSE and fLock **SQL_LCK_EXCLUSIVE** will be made.  \n  \n## See Also  \n [Technical Notes by Number](../mfc/technical-notes-by-number.md)   \n [Technical Notes by Category](../mfc/technical-notes-by-category.md)\n\n"}