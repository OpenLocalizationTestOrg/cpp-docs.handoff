{"nodes":[{"pos":[12,66],"content":"Adding Connection Points to an Object | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Adding Connection Points to an Object | Microsoft Docs","pos":[0,54]}]},{"content":"Adding Connection Points to an Object","pos":[666,703]},{"content":"The <bpt id=\"p1\">[</bpt>ATL Tutorial<ept id=\"p1\">](../atl/active-template-library-atl-tutorial.md)</ept> demonstrates how to create a control with support for connection points, how to add events, and then how to implement the connection point.","pos":[704,910],"source":"The [ATL Tutorial](../atl/active-template-library-atl-tutorial.md) demonstrates how to create a control with support for connection points, how to add events, and then how to implement the connection point."},{"content":"ATL implements connection points with the <bpt id=\"p1\">[</bpt>IConnectionPointImpl<ept id=\"p1\">](../atl/reference/iconnectionpointimpl-class.md)</ept> class.","pos":[911,1030],"source":" ATL implements connection points with the [IConnectionPointImpl](../atl/reference/iconnectionpointimpl-class.md) class."},{"content":"To implement a connection point, you have two choices:","pos":[1037,1091]},{"content":"Implement your own outgoing event source, by adding a connection point to the control or object.","pos":[1101,1197]},{"content":"Reuse a connection point interface defined in another type library.","pos":[1207,1274]},{"content":"In either case, the Implement Connection Point Wizard uses a type library to do its work.","pos":[1281,1370]},{"content":"To add a connection point to a control or object","pos":[1380,1428]},{"content":"Define a dispinterface in the library block of the .idl file.","pos":[1438,1499]},{"content":"If you enabled support for connection points when you created the control with the ATL Control Wizard, the dispinterface will already be created.","pos":[1500,1645]},{"content":"If you did not enable support for connection points when you created the control, you must manually add a dispinterface to the .idl file.","pos":[1646,1783]},{"content":"The following is an example of a dispinterface.","pos":[1784,1831]},{"content":"Outgoing interfaces are not required to be dispatch interfaces but many scripting languages such as VBScript and JScript require this, so this example uses two dispinterfaces:","pos":[1832,2007]},{"pos":[2029,2049],"content":"NVC_ATL_Windowing#81"},{"content":"Use either the uuidgen.exe or guidgen.exe utility to generate a GUID.","pos":[2130,2199]},{"content":"Add the dispinterface as the <ph id=\"ph1\">`[default,source]`</ph> interface in the coclass for the object in the project's .idl file.","pos":[2209,2324],"source":"Add the dispinterface as the `[default,source]` interface in the coclass for the object in the project's .idl file."},{"content":"Again, if you enabled support for connection points when you created the control, the ATL Control Wizard will create the <ph id=\"ph1\">`[default,source`</ph>] entry.","pos":[2325,2471],"source":" Again, if you enabled support for connection points when you created the control, the ATL Control Wizard will create the `[default,source`] entry."},{"content":"To manually add this entry, add the line in bold:","pos":[2472,2521]},{"pos":[2543,2563],"content":"NVC_ATL_Windowing#82"},{"pos":[2644,2728],"content":"See the .idl file in the <bpt id=\"p1\">[</bpt>Circ<ept id=\"p1\">](../visual-cpp-samples.md)</ept> ATL sample for an example.","source":"See the .idl file in the [Circ](../visual-cpp-samples.md) ATL sample for an example."},{"content":"Use Class View to add methods and properties to the event interface.","pos":[2738,2806]},{"content":"Right-click the class in Class View, point to <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> on the shortcut menu, and click <bpt id=\"p2\">**</bpt>Add Connection Point<ept id=\"p2\">**</ept>.","pos":[2807,2918],"source":" Right-click the class in Class View, point to **Add** on the shortcut menu, and click **Add Connection Point**."},{"content":"In the <bpt id=\"p1\">**</bpt>Source Interfaces<ept id=\"p1\">**</ept> list box of the Implement Connection Point Wizard, select <bpt id=\"p2\">**</bpt>Project's interfaces<ept id=\"p2\">**</ept>.","pos":[2928,3040],"source":"In the **Source Interfaces** list box of the Implement Connection Point Wizard, select **Project's interfaces**."},{"content":"If you choose an interface for your control and press <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>, you will:","pos":[3041,3112],"source":" If you choose an interface for your control and press **OK**, you will:"},{"content":"Generate a header file with an event proxy class that implements the code that will make the outgoing calls for the event.","pos":[3126,3248]},{"content":"Add an entry to the connection point map.","pos":[3262,3303]},{"content":"You will also see a list of all of the type libraries on your computer.","pos":[3314,3385]},{"content":"You should only use one of these other type libraries to define your connection point if you want to implement the exact same outgoing interface found in another type library.","pos":[3386,3561]},{"content":"To reuse a connection point interface defined in another type library","pos":[3571,3640]},{"pos":[3650,3802],"content":"In Class View, right-click a class that implements a <bpt id=\"p1\">**</bpt>BEGIN_COM_MAP<ept id=\"p1\">**</ept> macro, point to <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept> on the shortcut menu, and click <bpt id=\"p3\">**</bpt>Add Connection Point<ept id=\"p3\">**</ept>.","source":"In Class View, right-click a class that implements a **BEGIN_COM_MAP** macro, point to **Add** on the shortcut menu, and click **Add Connection Point**."},{"pos":[3812,3931],"content":"In the Implement Connection Point Wizard, select a type library and an interface in the type library and click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>.","source":"In the Implement Connection Point Wizard, select a type library and an interface in the type library and click **Add**."},{"content":"Edit the .idl file to either:","pos":[3941,3970]},{"content":"Copy the dispinterface from the .idl file for the object whose event-source is being used.","pos":[3984,4074]},{"pos":[4088,4143],"content":"Use the <bpt id=\"p1\">**</bpt>importlib<ept id=\"p1\">**</ept> instruction on that type library.","source":"Use the **importlib** instruction on that type library."},{"content":"See Also","pos":[4152,4160]},{"content":"Connection Point","pos":[4165,4181]}],"content":"---\ntitle: \"Adding Connection Points to an Object | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"connection points [C++], adding to ATL objects\"\n  - \"Implement Connection Point ATL wizard\"\nms.assetid: 843531be-4a36-4db0-9d54-e029b1a72a8b\ncaps.latest.revision: 12\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Adding Connection Points to an Object\nThe [ATL Tutorial](../atl/active-template-library-atl-tutorial.md) demonstrates how to create a control with support for connection points, how to add events, and then how to implement the connection point. ATL implements connection points with the [IConnectionPointImpl](../atl/reference/iconnectionpointimpl-class.md) class.  \n  \n To implement a connection point, you have two choices:  \n  \n-   Implement your own outgoing event source, by adding a connection point to the control or object.  \n  \n-   Reuse a connection point interface defined in another type library.  \n  \n In either case, the Implement Connection Point Wizard uses a type library to do its work.  \n  \n### To add a connection point to a control or object  \n  \n1.  Define a dispinterface in the library block of the .idl file. If you enabled support for connection points when you created the control with the ATL Control Wizard, the dispinterface will already be created. If you did not enable support for connection points when you created the control, you must manually add a dispinterface to the .idl file. The following is an example of a dispinterface. Outgoing interfaces are not required to be dispatch interfaces but many scripting languages such as VBScript and JScript require this, so this example uses two dispinterfaces:  \n  \n     [!code-cpp[NVC_ATL_Windowing#81](../atl/codesnippet/cpp/adding-connection-points-to-an-object_1.idl)]  \n  \n     Use either the uuidgen.exe or guidgen.exe utility to generate a GUID.  \n  \n2.  Add the dispinterface as the `[default,source]` interface in the coclass for the object in the project's .idl file. Again, if you enabled support for connection points when you created the control, the ATL Control Wizard will create the `[default,source`] entry. To manually add this entry, add the line in bold:  \n  \n     [!code-cpp[NVC_ATL_Windowing#82](../atl/codesnippet/cpp/adding-connection-points-to-an-object_2.idl)]  \n  \n     See the .idl file in the [Circ](../visual-cpp-samples.md) ATL sample for an example.  \n  \n3.  Use Class View to add methods and properties to the event interface. Right-click the class in Class View, point to **Add** on the shortcut menu, and click **Add Connection Point**.  \n  \n4.  In the **Source Interfaces** list box of the Implement Connection Point Wizard, select **Project's interfaces**. If you choose an interface for your control and press **OK**, you will:  \n  \n    -   Generate a header file with an event proxy class that implements the code that will make the outgoing calls for the event.  \n  \n    -   Add an entry to the connection point map.  \n  \n     You will also see a list of all of the type libraries on your computer. You should only use one of these other type libraries to define your connection point if you want to implement the exact same outgoing interface found in another type library.  \n  \n### To reuse a connection point interface defined in another type library  \n  \n1.  In Class View, right-click a class that implements a **BEGIN_COM_MAP** macro, point to **Add** on the shortcut menu, and click **Add Connection Point**.  \n  \n2.  In the Implement Connection Point Wizard, select a type library and an interface in the type library and click **Add**.  \n  \n3.  Edit the .idl file to either:  \n  \n    -   Copy the dispinterface from the .idl file for the object whose event-source is being used.  \n  \n    -   Use the **importlib** instruction on that type library.  \n  \n## See Also  \n [Connection Point](../atl/atl-connection-points.md)\n\n"}