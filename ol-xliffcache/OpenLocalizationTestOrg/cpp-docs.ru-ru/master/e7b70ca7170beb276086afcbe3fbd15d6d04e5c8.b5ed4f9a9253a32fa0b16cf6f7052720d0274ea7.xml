{"nodes":[{"pos":[12,62],"content":"Supporting Transactions in OLE DB | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Supporting Transactions in OLE DB | Microsoft Docs","pos":[0,50]}]},{"content":"Supporting Transactions in OLE DB","pos":[814,847]},{"content":"A <bpt id=\"p1\">[</bpt>transaction<ept id=\"p1\">](../../data/transactions-mfc-data-access.md)</ept> is a way to group, or batch, a series of updates to a data source so that either all succeed and are committed at once or (if any one of them fails) none are committed and the entire transaction is rolled back.","pos":[848,1118],"source":"A [transaction](../../data/transactions-mfc-data-access.md) is a way to group, or batch, a series of updates to a data source so that either all succeed and are committed at once or (if any one of them fails) none are committed and the entire transaction is rolled back."},{"content":"This process ensures the integrity of the result on the data source.","pos":[1119,1187]},{"content":"OLE DB supports transactions with the following three methods:","pos":[1194,1256]},{"content":"ITransactionLocal::StartTransaction","pos":[1267,1302]},{"content":"ITransaction::Commit","pos":[1370,1390]},{"content":"ITransaction::Abort","pos":[1458,1477]},{"content":"Relationship of Sessions and Transactions","pos":[1543,1584]},{"content":"A single data source object can create one or more session objects, each of which can be inside or outside the scope of a transaction at a given time.","pos":[1588,1738]},{"content":"When a session does not enter a transaction, all work done within that session on the data store is immediately committed on each method call.","pos":[1745,1887]},{"content":"(This is sometimes referred to as autocommit mode or implicit mode.)","pos":[1888,1956]},{"content":"When a session enters a transaction, all work done within that session on the data store is part of that transaction and is committed or aborted as a single unit.","pos":[1963,2125]},{"content":"(This is sometimes referred to as manual-commit mode.)","pos":[2126,2180]},{"content":"Transaction support is provider-specific.","pos":[2187,2228]},{"content":"If the provider you are using supports transactions, a session object that supports <bpt id=\"p1\">**</bpt>ITransaction<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>ITransactionLocal<ept id=\"p2\">**</ept> can enter a simple (that is, non-nested) transaction.","pos":[2229,2409],"source":" If the provider you are using supports transactions, a session object that supports **ITransaction** and **ITransactionLocal** can enter a simple (that is, non-nested) transaction."},{"content":"The OLE DB Templates class <bpt id=\"p1\">[</bpt>CSession<ept id=\"p1\">](../../data/oledb/csession-class.md)</ept> supports these interfaces and is the recommended way to implement transaction support in Visual C++.","pos":[2410,2584],"source":" The OLE DB Templates class [CSession](../../data/oledb/csession-class.md) supports these interfaces and is the recommended way to implement transaction support in Visual C++."},{"content":"Starting and Ending the Transaction","pos":[2593,2628]},{"pos":[2632,2736],"content":"You call the <ph id=\"ph1\">`StartTransaction`</ph>, <bpt id=\"p1\">**</bpt>Commit<ept id=\"p1\">**</ept>, and <bpt id=\"p2\">**</bpt>Abort<ept id=\"p2\">**</ept> methods in the rowset object in the consumer.","source":"You call the `StartTransaction`, **Commit**, and **Abort** methods in the rowset object in the consumer."},{"content":"Calling <bpt id=\"p1\">**</bpt>ITransactionLocal::StartTransaction<ept id=\"p1\">**</ept> starts a new local transaction.","pos":[2743,2822],"source":"Calling **ITransactionLocal::StartTransaction** starts a new local transaction."},{"content":"When you start the transaction, any changes mandated by subsequent operations are not actually applied to the data store until you commit the transaction.","pos":[2823,2977]},{"content":"Calling <bpt id=\"p1\">**</bpt>ITransaction::Commit<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>ITransaction::Abort<ept id=\"p2\">**</ept> ends the transaction.","pos":[2984,3065],"source":"Calling **ITransaction::Commit** or **ITransaction::Abort** ends the transaction."},{"content":"<bpt id=\"p1\">**</bpt>Commit<ept id=\"p1\">**</ept> causes all changes within the scope of the transaction to be applied to the data store.","pos":[3066,3164],"source":"**Commit** causes all changes within the scope of the transaction to be applied to the data store."},{"content":"<bpt id=\"p1\">**</bpt>Abort<ept id=\"p1\">**</ept> causes all changes within the scope of the transaction to be canceled and the data store is left in the state it had before the transaction started.","pos":[3165,3323],"source":"**Abort** causes all changes within the scope of the transaction to be canceled and the data store is left in the state it had before the transaction started."},{"content":"Nested Transactions","pos":[3332,3351]},{"content":"A <bpt id=\"p1\">[</bpt>nested transaction<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/ms716985.aspx)</ept> occurs when you start a new local transaction when an active transaction already exists on the session.","pos":[3355,3537],"source":"A [nested transaction](https://msdn.microsoft.com/en-us/library/ms716985.aspx) occurs when you start a new local transaction when an active transaction already exists on the session."},{"content":"The new transaction is started as a nested transaction below the current transaction.","pos":[3538,3623]},{"content":"If the provider does not support nested transactions, calling <ph id=\"ph1\">`StartTransaction`</ph> when there is already an active transaction on the session returns <bpt id=\"p1\">**</bpt>XACT_E_XTIONEXISTS<ept id=\"p1\">**</ept>.","pos":[3624,3795],"source":" If the provider does not support nested transactions, calling `StartTransaction` when there is already an active transaction on the session returns **XACT_E_XTIONEXISTS**."},{"content":"Distributed Transactions","pos":[3804,3828]},{"content":"A distributed transaction is a transaction that updates distributed data; that is, data on more than one networked computer system.","pos":[3832,3963]},{"content":"If you want to support transactions over a distributed system, you should use the .NET Framework rather than the OLE DB transaction support.","pos":[3964,4104]},{"content":"See Also","pos":[4113,4121]},{"content":"Using Accessors","pos":[4126,4141]}],"content":"---\ntitle: \"Supporting Transactions in OLE DB | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"OLE DB consumer templates [C++], transaction support\"\n  - \"transactions [C++], OLE DB support for\"\n  - \"nested transactions [C++]\"\n  - \"OLE DB [C++], transaction support\"\n  - \"databases [C++], transactions\"\n  - \"distributed transactions [C++]\"\nms.assetid: 3d72e583-ad38-42ff-8f11-e2166d60a5a7\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Supporting Transactions in OLE DB\nA [transaction](../../data/transactions-mfc-data-access.md) is a way to group, or batch, a series of updates to a data source so that either all succeed and are committed at once or (if any one of them fails) none are committed and the entire transaction is rolled back. This process ensures the integrity of the result on the data source.  \n  \n OLE DB supports transactions with the following three methods:  \n  \n-   [ITransactionLocal::StartTransaction](https://msdn.microsoft.com/en-us/library/ms709786.aspx)  \n  \n-   [ITransaction::Commit](https://msdn.microsoft.com/en-us/library/ms713008.aspx)  \n  \n-   [ITransaction::Abort](https://msdn.microsoft.com/en-us/library/ms709833.aspx)  \n  \n## Relationship of Sessions and Transactions  \n A single data source object can create one or more session objects, each of which can be inside or outside the scope of a transaction at a given time.  \n  \n When a session does not enter a transaction, all work done within that session on the data store is immediately committed on each method call. (This is sometimes referred to as autocommit mode or implicit mode.)  \n  \n When a session enters a transaction, all work done within that session on the data store is part of that transaction and is committed or aborted as a single unit. (This is sometimes referred to as manual-commit mode.)  \n  \n Transaction support is provider-specific. If the provider you are using supports transactions, a session object that supports **ITransaction** and **ITransactionLocal** can enter a simple (that is, non-nested) transaction. The OLE DB Templates class [CSession](../../data/oledb/csession-class.md) supports these interfaces and is the recommended way to implement transaction support in Visual C++.  \n  \n## Starting and Ending the Transaction  \n You call the `StartTransaction`, **Commit**, and **Abort** methods in the rowset object in the consumer.  \n  \n Calling **ITransactionLocal::StartTransaction** starts a new local transaction. When you start the transaction, any changes mandated by subsequent operations are not actually applied to the data store until you commit the transaction.  \n  \n Calling **ITransaction::Commit** or **ITransaction::Abort** ends the transaction. **Commit** causes all changes within the scope of the transaction to be applied to the data store. **Abort** causes all changes within the scope of the transaction to be canceled and the data store is left in the state it had before the transaction started.  \n  \n## Nested Transactions  \n A [nested transaction](https://msdn.microsoft.com/en-us/library/ms716985.aspx) occurs when you start a new local transaction when an active transaction already exists on the session. The new transaction is started as a nested transaction below the current transaction. If the provider does not support nested transactions, calling `StartTransaction` when there is already an active transaction on the session returns **XACT_E_XTIONEXISTS**.  \n  \n## Distributed Transactions  \n A distributed transaction is a transaction that updates distributed data; that is, data on more than one networked computer system. If you want to support transactions over a distributed system, you should use the .NET Framework rather than the OLE DB transaction support.  \n  \n## See Also  \n [Using Accessors](../../data/oledb/using-accessors.md)"}