{"nodes":[{"pos":[12,73],"content":"Windows Sockets: Using Sockets with Archives | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Windows Sockets: Using Sockets with Archives | Microsoft Docs","pos":[0,61]}]},{"content":"Windows Sockets: Using Sockets with Archives","pos":[730,774]},{"content":"This article describes the <bpt id=\"p1\">[</bpt>CSocket programming model<ept id=\"p1\">](#_core_the_csocket_programming_model)</ept>.","pos":[775,868],"source":"This article describes the [CSocket programming model](#_core_the_csocket_programming_model)."},{"content":"Class <bpt id=\"p1\">[</bpt>CSocket<ept id=\"p1\">](../mfc/reference/csocket-class.md)</ept> supplies socket support at a higher level of abstraction than does class <bpt id=\"p2\">[</bpt>CAsyncSocket<ept id=\"p2\">](../mfc/reference/casyncsocket-class.md)</ept>.","pos":[869,1048],"source":" Class [CSocket](../mfc/reference/csocket-class.md) supplies socket support at a higher level of abstraction than does class [CAsyncSocket](../mfc/reference/casyncsocket-class.md)."},{"content":"uses a version of the MFC serialization protocol to pass data to and from a socket object through an MFC <bpt id=\"p1\">[</bpt>CArchive<ept id=\"p1\">](../mfc/reference/carchive-class.md)</ept> object.","pos":[1059,1218],"source":" uses a version of the MFC serialization protocol to pass data to and from a socket object through an MFC [CArchive](../mfc/reference/carchive-class.md) object."},{"content":"provides blocking (while managing background processing of Windows messages) and gives you access to <ph id=\"ph1\">`CArchive`</ph>, which manages many aspects of the communication that you would have to do yourself using either the raw API or class <ph id=\"ph2\">`CAsyncSocket`</ph>.","pos":[1229,1474],"source":" provides blocking (while managing background processing of Windows messages) and gives you access to `CArchive`, which manages many aspects of the communication that you would have to do yourself using either the raw API or class `CAsyncSocket`."},{"pos":[1482,1659],"content":"[!TIP]\n You can use class `CSocket` by itself, as a more convenient version of `CAsyncSocket`, but the simplest programming model is to use `CSocket` with a `CArchive` object.","leadings":["","> "],"nodes":[{"content":"You can use class <ph id=\"ph1\">`CSocket`</ph> by itself, as a more convenient version of <ph id=\"ph2\">`CAsyncSocket`</ph>, but the simplest programming model is to use <ph id=\"ph3\">`CSocket`</ph> with a <ph id=\"ph4\">`CArchive`</ph> object.","pos":[8,175],"source":" You can use class `CSocket` by itself, as a more convenient version of `CAsyncSocket`, but the simplest programming model is to use `CSocket` with a `CArchive` object."}]},{"content":"For more information about how the implementation of sockets with archives works, see <bpt id=\"p1\">[</bpt>Windows Sockets: How Sockets with Archives Work<ept id=\"p1\">](../mfc/windows-sockets-how-sockets-with-archives-work.md)</ept>.","pos":[1666,1860],"source":"For more information about how the implementation of sockets with archives works, see [Windows Sockets: How Sockets with Archives Work](../mfc/windows-sockets-how-sockets-with-archives-work.md)."},{"content":"For example code, see <bpt id=\"p1\">[</bpt>Windows Sockets: Sequence of Operations<ept id=\"p1\">](../mfc/windows-sockets-sequence-of-operations.md)</ept> and <bpt id=\"p2\">[</bpt>Windows Sockets: Example of Sockets Using Archives<ept id=\"p2\">](../mfc/windows-sockets-example-of-sockets-using-archives.md)</ept>.","pos":[1861,2093],"source":" For example code, see [Windows Sockets: Sequence of Operations](../mfc/windows-sockets-sequence-of-operations.md) and [Windows Sockets: Example of Sockets Using Archives](../mfc/windows-sockets-example-of-sockets-using-archives.md)."},{"content":"For information about some of the functionality you can gain by deriving your own classes from the sockets classes, see <bpt id=\"p1\">[</bpt>Windows Sockets: Deriving from Socket Classes<ept id=\"p1\">](../mfc/windows-sockets-deriving-from-socket-classes.md)</ept>.","pos":[2094,2318],"source":" For information about some of the functionality you can gain by deriving your own classes from the sockets classes, see [Windows Sockets: Deriving from Socket Classes](../mfc/windows-sockets-deriving-from-socket-classes.md)."},{"pos":[2326,2806],"content":"[!NOTE]\n If you are writing an MFC client program to communicate with established (non-MFC) servers, do not send C++ objects through the archive. Unless the server is an MFC application that understands the kinds of objects you want to send, it will not be able to receive and deserialize your objects. For related material on the subject of communicating with non-MFC applications, also see the article [Windows Sockets: Byte Ordering](../mfc/windows-sockets-byte-ordering.md).","leadings":["","> "],"nodes":[{"content":" If you are writing an MFC client program to communicate with established (non-MFC) servers, do not send C++ objects through the archive. Unless the server is an MFC application that understands the kinds of objects you want to send, it will not be able to receive and deserialize your objects. For related material on the subject of communicating with non-MFC applications, also see the article [Windows Sockets: Byte Ordering](../mfc/windows-sockets-byte-ordering.md).","pos":[8,478],"nodes":[{"content":"If you are writing an MFC client program to communicate with established (non-MFC) servers, do not send C++ objects through the archive.","pos":[1,137]},{"content":"Unless the server is an MFC application that understands the kinds of objects you want to send, it will not be able to receive and deserialize your objects.","pos":[138,294]},{"content":"For related material on the subject of communicating with non-MFC applications, also see the article <bpt id=\"p1\">[</bpt>Windows Sockets: Byte Ordering<ept id=\"p1\">](../mfc/windows-sockets-byte-ordering.md)</ept>.","pos":[295,470],"source":" For related material on the subject of communicating with non-MFC applications, also see the article [Windows Sockets: Byte Ordering](../mfc/windows-sockets-byte-ordering.md)."}]}]},{"pos":[2867,2896],"content":"The CSocket Programming Model"},{"content":"Using a <ph id=\"ph1\">`CSocket`</ph> object involves creating and associating together several MFC class objects.","pos":[2900,2994],"source":"Using a `CSocket` object involves creating and associating together several MFC class objects."},{"content":"In the general procedure below, each step is taken by both the server socket and the client socket, except for step 3, in which each socket type requires a different action.","pos":[2995,3168]},{"pos":[3176,3453],"content":"[!TIP]\n At run time, the server application usually starts first to be ready and \"listening\" when the client application seeks a connection. If the server is not ready when the client tries to connect, you typically require the user application to try connecting again later.","leadings":["","> "],"nodes":[{"content":" At run time, the server application usually starts first to be ready and \"listening\" when the client application seeks a connection. If the server is not ready when the client tries to connect, you typically require the user application to try connecting again later.","pos":[7,275],"nodes":[{"content":"At run time, the server application usually starts first to be ready and \"listening\" when the client application seeks a connection.","pos":[1,133]},{"content":"If the server is not ready when the client tries to connect, you typically require the user application to try connecting again later.","pos":[134,268]}]}]},{"content":"To set up communication between a server socket and a client socket","pos":[3464,3531]},{"pos":[3541,3605],"content":"Construct a <bpt id=\"p1\">[</bpt>CSocket<ept id=\"p1\">](../mfc/reference/csocket-class.md)</ept> object.","source":"Construct a [CSocket](../mfc/reference/csocket-class.md) object."},{"pos":[3615,3673],"content":"Use the object to create the underlying <bpt id=\"p1\">**</bpt>SOCKET<ept id=\"p1\">**</ept> handle.","source":"Use the object to create the underlying **SOCKET** handle."},{"content":"For a <ph id=\"ph1\">`CSocket`</ph> client object, you should normally use the default parameters to <bpt id=\"p1\">[</bpt>Create<ept id=\"p1\">](../mfc/reference/casyncsocket-class.md#casyncsocket__create)</ept>, unless you need a datagram socket.","pos":[3684,3870],"source":"For a `CSocket` client object, you should normally use the default parameters to [Create](../mfc/reference/casyncsocket-class.md#casyncsocket__create), unless you need a datagram socket."},{"content":"For a <ph id=\"ph1\">`CSocket`</ph> server object, you must specify a port in the <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept> call.","pos":[3871,3949],"source":" For a `CSocket` server object, you must specify a port in the **Create** call."},{"pos":[3961,4491],"content":"[!NOTE]\n `CArchive` does not work with datagram sockets. If you want to use `CSocket` for a datagram socket, you must use the class as you would use `CAsyncSocket`, that is, without an archive. Because datagrams are unreliable (not guaranteed to arrive and may be repeated or out of sequence), they are not compatible with serialization through an archive. You expect a serialization operation to complete reliably and in sequence. If you try to use `CSocket` with a `CArchive` object for a datagram, an MFC assertion fails.","leadings":["","    > "],"nodes":[{"content":" does not work with datagram sockets. If you want to use `CSocket` for a datagram socket, you must use the class as you would use `CAsyncSocket`, that is, without an archive. Because datagrams are unreliable (not guaranteed to arrive and may be repeated or out of sequence), they are not compatible with serialization through an archive. You expect a serialization operation to complete reliably and in sequence. If you try to use `CSocket` with a `CArchive` object for a datagram, an MFC assertion fails.","pos":[19,524],"nodes":[{"content":"does not work with datagram sockets.","pos":[1,37]},{"content":"If you want to use <ph id=\"ph1\">`CSocket`</ph> for a datagram socket, you must use the class as you would use <ph id=\"ph2\">`CAsyncSocket`</ph>, that is, without an archive.","pos":[38,174],"source":" If you want to use `CSocket` for a datagram socket, you must use the class as you would use `CAsyncSocket`, that is, without an archive."},{"content":"Because datagrams are unreliable (not guaranteed to arrive and may be repeated or out of sequence), they are not compatible with serialization through an archive.","pos":[175,337]},{"content":"You expect a serialization operation to complete reliably and in sequence.","pos":[338,412]},{"content":"If you try to use <ph id=\"ph1\">`CSocket`</ph> with a <ph id=\"ph2\">`CArchive`</ph> object for a datagram, an MFC assertion fails.","pos":[413,505],"source":" If you try to use `CSocket` with a `CArchive` object for a datagram, an MFC assertion fails."}]}]},{"pos":[4501,4667],"content":"If the socket is a client, call <bpt id=\"p1\">[</bpt>CAsyncSocket::Connect<ept id=\"p1\">](../mfc/reference/casyncsocket-class.md#casyncsocket__connect)</ept> to connect the socket object to a server socket.","source":"If the socket is a client, call [CAsyncSocket::Connect](../mfc/reference/casyncsocket-class.md#casyncsocket__connect) to connect the socket object to a server socket."},{"content":"-or-","pos":[4678,4682]},{"content":"If the socket is a server, call <bpt id=\"p1\">[</bpt>CAsyncSocket::Listen<ept id=\"p1\">](../mfc/reference/casyncsocket-class.md#casyncsocket__listen)</ept> to begin listening for connect attempts from a client.","pos":[4693,4863],"source":"If the socket is a server, call [CAsyncSocket::Listen](../mfc/reference/casyncsocket-class.md#casyncsocket__listen) to begin listening for connect attempts from a client."},{"content":"Upon receiving a connection request, accept it by calling <bpt id=\"p1\">[</bpt>CAsyncSocket::Accept<ept id=\"p1\">](../mfc/reference/casyncsocket-class.md#casyncsocket__accept)</ept>.","pos":[4864,5006],"source":" Upon receiving a connection request, accept it by calling [CAsyncSocket::Accept](../mfc/reference/casyncsocket-class.md#casyncsocket__accept)."},{"pos":[5018,5306],"content":"[!NOTE]\n The **Accept** member function takes a reference to a new, empty `CSocket` object as its parameter. You must construct this object before you call **Accept**. If this socket object goes out of scope, the connection closes. Do not call **Create** for this new socket object.","leadings":["","    > "],"nodes":[{"content":" The **Accept** member function takes a reference to a new, empty `CSocket` object as its parameter. You must construct this object before you call **Accept**. If this socket object goes out of scope, the connection closes. Do not call **Create** for this new socket object.","pos":[8,282],"nodes":[{"content":"The <bpt id=\"p1\">**</bpt>Accept<ept id=\"p1\">**</ept> member function takes a reference to a new, empty <ph id=\"ph1\">`CSocket`</ph> object as its parameter.","pos":[1,100],"source":" The **Accept** member function takes a reference to a new, empty `CSocket` object as its parameter."},{"content":"You must construct this object before you call <bpt id=\"p1\">**</bpt>Accept<ept id=\"p1\">**</ept>.","pos":[101,159],"source":" You must construct this object before you call **Accept**."},{"content":"If this socket object goes out of scope, the connection closes.","pos":[160,223]},{"content":"Do not call <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept> for this new socket object.","pos":[224,274],"source":" Do not call **Create** for this new socket object."}]}]},{"pos":[5316,5427],"content":"Create a <bpt id=\"p1\">[</bpt>CSocketFile<ept id=\"p1\">](../mfc/reference/csocketfile-class.md)</ept> object, associating the <ph id=\"ph1\">`CSocket`</ph> object with it.","source":"Create a [CSocketFile](../mfc/reference/csocketfile-class.md) object, associating the `CSocket` object with it."},{"content":"Create a <bpt id=\"p1\">[</bpt>CArchive<ept id=\"p1\">](../mfc/reference/carchive-class.md)</ept> object for either loading (receiving) or storing (sending) data.","pos":[5437,5557],"source":"Create a [CArchive](../mfc/reference/carchive-class.md) object for either loading (receiving) or storing (sending) data."},{"content":"The archive is associated with the <ph id=\"ph1\">`CSocketFile`</ph> object.","pos":[5558,5614],"source":" The archive is associated with the `CSocketFile` object."},{"pos":[5625,5690],"content":"Keep in mind that <ph id=\"ph1\">`CArchive`</ph> does not work with datagram sockets.","source":"Keep in mind that `CArchive` does not work with datagram sockets."},{"pos":[5700,5777],"content":"Use the <ph id=\"ph1\">`CArchive`</ph> object to pass data between the client and server sockets.","source":"Use the `CArchive` object to pass data between the client and server sockets."},{"content":"Keep in mind that a given <ph id=\"ph1\">`CArchive`</ph> object moves data in one direction only: either for loading (receiving) or storing (sending).","pos":[5788,5918],"source":"Keep in mind that a given `CArchive` object moves data in one direction only: either for loading (receiving) or storing (sending)."},{"content":"In some cases, you will use two <ph id=\"ph1\">`CArchive`</ph> objects: one for sending data, the other for receiving acknowledgments.","pos":[5919,6033],"source":" In some cases, you will use two `CArchive` objects: one for sending data, the other for receiving acknowledgments."},{"content":"After accepting a connection and setting up the archive, you can perform such tasks as validating passwords.","pos":[6044,6152]},{"content":"Destroy the archive, socket file, and socket objects.","pos":[6162,6215]},{"pos":[6227,6632],"content":"[!NOTE]\n Class `CArchive` supplies the `IsBufferEmpty` member function specifically for use with class `CSocket`. If the buffer contains multiple data messages, for example, you need to loop until all of them are read and the buffer is cleared. Otherwise, your next notification that there is data to be received may be indefinitely delayed. Use `IsBufferEmpty` to assure that you retrieve all data.","leadings":["","    > "],"nodes":[{"content":" Class `CArchive` supplies the `IsBufferEmpty` member function specifically for use with class `CSocket`. If the buffer contains multiple data messages, for example, you need to loop until all of them are read and the buffer is cleared. Otherwise, your next notification that there is data to be received may be indefinitely delayed. Use `IsBufferEmpty` to assure that you retrieve all data.","pos":[8,399],"nodes":[{"content":"Class <ph id=\"ph1\">`CArchive`</ph> supplies the <ph id=\"ph2\">`IsBufferEmpty`</ph> member function specifically for use with class <ph id=\"ph3\">`CSocket`</ph>.","pos":[1,105],"source":" Class `CArchive` supplies the `IsBufferEmpty` member function specifically for use with class `CSocket`."},{"content":"If the buffer contains multiple data messages, for example, you need to loop until all of them are read and the buffer is cleared.","pos":[106,236]},{"content":"Otherwise, your next notification that there is data to be received may be indefinitely delayed.","pos":[237,333]},{"content":"Use <ph id=\"ph1\">`IsBufferEmpty`</ph> to assure that you retrieve all data.","pos":[334,391],"source":" Use `IsBufferEmpty` to assure that you retrieve all data."}]}]},{"pos":[6639,6800],"content":"The article <bpt id=\"p1\">[</bpt>Windows Sockets: Sequence of Operations<ept id=\"p1\">](../mfc/windows-sockets-sequence-of-operations.md)</ept> illustrates both sides of this process with example code.","source":"The article [Windows Sockets: Sequence of Operations](../mfc/windows-sockets-sequence-of-operations.md) illustrates both sides of this process with example code."},{"content":"For more information, see:","pos":[6807,6833]},{"content":"Windows Sockets: Stream Sockets","pos":[6844,6875]},{"content":"Windows Sockets: Datagram Sockets","pos":[6929,6962]},{"content":"See Also","pos":[7016,7024]},{"content":"Windows Sockets in MFC","pos":[7029,7051]},{"content":"CSocket::Create","pos":[7092,7107]}],"content":"---\ntitle: \"Windows Sockets: Using Sockets with Archives | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"Windows Sockets [C++], archives\"\n  - \"sockets [C++], with archives\"\n  - \"archives [C++], and Windows Sockets\"\n  - \"CSocket class, programming model\"\nms.assetid: 17e71a99-a09e-4e1a-9fda-13d62805c824\ncaps.latest.revision: 12\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Windows Sockets: Using Sockets with Archives\nThis article describes the [CSocket programming model](#_core_the_csocket_programming_model). Class [CSocket](../mfc/reference/csocket-class.md) supplies socket support at a higher level of abstraction than does class [CAsyncSocket](../mfc/reference/casyncsocket-class.md). `CSocket` uses a version of the MFC serialization protocol to pass data to and from a socket object through an MFC [CArchive](../mfc/reference/carchive-class.md) object. `CSocket` provides blocking (while managing background processing of Windows messages) and gives you access to `CArchive`, which manages many aspects of the communication that you would have to do yourself using either the raw API or class `CAsyncSocket`.  \n  \n> [!TIP]\n>  You can use class `CSocket` by itself, as a more convenient version of `CAsyncSocket`, but the simplest programming model is to use `CSocket` with a `CArchive` object.  \n  \n For more information about how the implementation of sockets with archives works, see [Windows Sockets: How Sockets with Archives Work](../mfc/windows-sockets-how-sockets-with-archives-work.md). For example code, see [Windows Sockets: Sequence of Operations](../mfc/windows-sockets-sequence-of-operations.md) and [Windows Sockets: Example of Sockets Using Archives](../mfc/windows-sockets-example-of-sockets-using-archives.md). For information about some of the functionality you can gain by deriving your own classes from the sockets classes, see [Windows Sockets: Deriving from Socket Classes](../mfc/windows-sockets-deriving-from-socket-classes.md).  \n  \n> [!NOTE]\n>  If you are writing an MFC client program to communicate with established (non-MFC) servers, do not send C++ objects through the archive. Unless the server is an MFC application that understands the kinds of objects you want to send, it will not be able to receive and deserialize your objects. For related material on the subject of communicating with non-MFC applications, also see the article [Windows Sockets: Byte Ordering](../mfc/windows-sockets-byte-ordering.md).  \n  \n##  <a name=\"_core_the_csocket_programming_model\"></a> The CSocket Programming Model  \n Using a `CSocket` object involves creating and associating together several MFC class objects. In the general procedure below, each step is taken by both the server socket and the client socket, except for step 3, in which each socket type requires a different action.  \n  \n> [!TIP]\n>  At run time, the server application usually starts first to be ready and \"listening\" when the client application seeks a connection. If the server is not ready when the client tries to connect, you typically require the user application to try connecting again later.  \n  \n#### To set up communication between a server socket and a client socket  \n  \n1.  Construct a [CSocket](../mfc/reference/csocket-class.md) object.  \n  \n2.  Use the object to create the underlying **SOCKET** handle.  \n  \n     For a `CSocket` client object, you should normally use the default parameters to [Create](../mfc/reference/casyncsocket-class.md#casyncsocket__create), unless you need a datagram socket. For a `CSocket` server object, you must specify a port in the **Create** call.  \n  \n    > [!NOTE]\n    >  `CArchive` does not work with datagram sockets. If you want to use `CSocket` for a datagram socket, you must use the class as you would use `CAsyncSocket`, that is, without an archive. Because datagrams are unreliable (not guaranteed to arrive and may be repeated or out of sequence), they are not compatible with serialization through an archive. You expect a serialization operation to complete reliably and in sequence. If you try to use `CSocket` with a `CArchive` object for a datagram, an MFC assertion fails.  \n  \n3.  If the socket is a client, call [CAsyncSocket::Connect](../mfc/reference/casyncsocket-class.md#casyncsocket__connect) to connect the socket object to a server socket.  \n  \n     -or-  \n  \n     If the socket is a server, call [CAsyncSocket::Listen](../mfc/reference/casyncsocket-class.md#casyncsocket__listen) to begin listening for connect attempts from a client. Upon receiving a connection request, accept it by calling [CAsyncSocket::Accept](../mfc/reference/casyncsocket-class.md#casyncsocket__accept).  \n  \n    > [!NOTE]\n    >  The **Accept** member function takes a reference to a new, empty `CSocket` object as its parameter. You must construct this object before you call **Accept**. If this socket object goes out of scope, the connection closes. Do not call **Create** for this new socket object.  \n  \n4.  Create a [CSocketFile](../mfc/reference/csocketfile-class.md) object, associating the `CSocket` object with it.  \n  \n5.  Create a [CArchive](../mfc/reference/carchive-class.md) object for either loading (receiving) or storing (sending) data. The archive is associated with the `CSocketFile` object.  \n  \n     Keep in mind that `CArchive` does not work with datagram sockets.  \n  \n6.  Use the `CArchive` object to pass data between the client and server sockets.  \n  \n     Keep in mind that a given `CArchive` object moves data in one direction only: either for loading (receiving) or storing (sending). In some cases, you will use two `CArchive` objects: one for sending data, the other for receiving acknowledgments.  \n  \n     After accepting a connection and setting up the archive, you can perform such tasks as validating passwords.  \n  \n7.  Destroy the archive, socket file, and socket objects.  \n  \n    > [!NOTE]\n    >  Class `CArchive` supplies the `IsBufferEmpty` member function specifically for use with class `CSocket`. If the buffer contains multiple data messages, for example, you need to loop until all of them are read and the buffer is cleared. Otherwise, your next notification that there is data to be received may be indefinitely delayed. Use `IsBufferEmpty` to assure that you retrieve all data.  \n  \n The article [Windows Sockets: Sequence of Operations](../mfc/windows-sockets-sequence-of-operations.md) illustrates both sides of this process with example code.  \n  \n For more information, see:  \n  \n-   [Windows Sockets: Stream Sockets](../mfc/windows-sockets-stream-sockets.md)  \n  \n-   [Windows Sockets: Datagram Sockets](../mfc/windows-sockets-datagram-sockets.md)  \n  \n## See Also  \n [Windows Sockets in MFC](../mfc/windows-sockets-in-mfc.md)   \n [CSocket::Create](../mfc/reference/csocket-class.md#csocket__create)\n\n"}