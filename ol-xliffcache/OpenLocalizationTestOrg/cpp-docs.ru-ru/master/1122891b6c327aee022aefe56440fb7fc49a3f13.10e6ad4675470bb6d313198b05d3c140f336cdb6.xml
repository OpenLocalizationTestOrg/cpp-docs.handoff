{"nodes":[{"pos":[12,77],"content":"Walkthrough: Creating an Agent-Based Application | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Walkthrough: Creating an Agent-Based Application | Microsoft Docs","pos":[0,65]}]},{"content":"Walkthrough: Creating an Agent-Based Application","pos":[669,717]},{"content":"This topic describes how to create a basic agent-based application.","pos":[718,785]},{"content":"In this walkthrough, you can create an agent that reads data from a text file asynchronously.","pos":[786,879]},{"content":"The application uses the Adler-32 checksum algorithm to calculate the checksum of the contents of that file.","pos":[880,988]},{"content":"Prerequisites","pos":[997,1010]},{"content":"You must understand the following topics to complete this walkthrough:","pos":[1014,1084]},{"content":"Asynchronous Agents","pos":[1093,1112]},{"content":"Asynchronous Message Blocks","pos":[1168,1195]},{"content":"Message Passing Functions","pos":[1259,1284]},{"content":"Synchronization Data Structures","pos":[1346,1377]},{"pos":[1465,1473],"content":"Sections"},{"content":"This walkthrough demonstrates how to perform the following tasks:","pos":[1477,1542]},{"content":"Creating the Console Application","pos":[1551,1583]},{"content":"Creating the file_reader Class","pos":[1613,1643]},{"content":"Using the file_reader Class in the Application","pos":[1672,1718]},{"pos":[1778,1810],"content":"Creating the Console Application"},{"content":"This section shows how to create a Visual C++ console application that references the header files that the program will use.","pos":[1814,1939]},{"content":"To create a Visual C++ application by using the Win32 Console Application Wizard","pos":[1950,2030]},{"pos":[2040,2146],"content":"On the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept> to display the <bpt id=\"p4\">**</bpt>New Project<ept id=\"p4\">**</ept> dialog box.","source":"On the **File** menu, click **New**, and then click **Project** to display the **New Project** dialog box."},{"content":"In the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box, select the <bpt id=\"p2\">**</bpt>Visual C++<ept id=\"p2\">**</ept> node in the <bpt id=\"p3\">**</bpt>Project types<ept id=\"p3\">**</ept> pane and then select <bpt id=\"p4\">**</bpt>Win32 Console Application<ept id=\"p4\">**</ept> in the <bpt id=\"p5\">**</bpt>Templates<ept id=\"p5\">**</ept> pane.","pos":[2156,2324],"source":"In the **New Project** dialog box, select the **Visual C++** node in the **Project types** pane and then select **Win32 Console Application** in the **Templates** pane."},{"content":"Type a name for the project, for example, <ph id=\"ph1\">`BasicAgent`</ph>, and then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">**</bpt>Win32 Console Application Wizard<ept id=\"p2\">**</ept>.","pos":[2325,2455],"source":" Type a name for the project, for example, `BasicAgent`, and then click **OK** to display the **Win32 Console Application Wizard**."},{"pos":[2465,2538],"content":"In the <bpt id=\"p1\">**</bpt>Win32 Console Application Wizard<ept id=\"p1\">**</ept> dialog box, click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept>.","source":"In the **Win32 Console Application Wizard** dialog box, click **Finish**."},{"content":"In stdafx.h, add the following code.","pos":[2548,2584]},{"pos":[2602,2622],"content":"concrt-basic-agent#1"},{"pos":[2726,2860],"content":"The header file agents.h contains the functionality of the <bpt id=\"p1\">[</bpt>concurrency::agent<ept id=\"p1\">](../../parallel/concrt/reference/agent-class.md)</ept> class.","source":"The header file agents.h contains the functionality of the [concurrency::agent](../../parallel/concrt/reference/agent-class.md) class."},{"content":"Verify that the application was created successfully by building and running it.","pos":[2870,2950]},{"content":"To build the application, on the <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Build Solution<ept id=\"p2\">**</ept>.","pos":[2951,3025],"source":" To build the application, on the **Build** menu, click **Build Solution**."},{"content":"If the application builds successfully, run the application by clicking <bpt id=\"p1\">**</bpt>Start Debugging<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>Debug<ept id=\"p2\">**</ept> menu.","pos":[3026,3140],"source":" If the application builds successfully, run the application by clicking **Start Debugging** on the **Debug** menu."},{"pos":[3147,3160],"content":"[<bpt id=\"p1\">[</bpt>Top<ept id=\"p1\">](#top)</ept>]","source":"[[Top](#top)]"},{"pos":[3202,3232],"content":"Creating the file_reader Class"},{"content":"This section shows how to create the <ph id=\"ph1\">`file_reader`</ph> class.","pos":[3236,3293],"source":"This section shows how to create the `file_reader` class."},{"content":"The runtime schedules each agent to perform work in its own context.","pos":[3294,3362]},{"content":"Therefore, you can create an agent that performs work synchronously, but interacts with other components asynchronously.","pos":[3363,3483]},{"content":"The <ph id=\"ph1\">`file_reader`</ph> class reads data from a given input file and sends data from that file to a given target component.","pos":[3484,3601],"source":" The `file_reader` class reads data from a given input file and sends data from that file to a given target component."},{"content":"To create the file_reader class","pos":[3612,3643]},{"content":"Add a new C++ header file to your project.","pos":[3653,3695]},{"content":"To do so, right-click the <bpt id=\"p1\">**</bpt>Header Files<ept id=\"p1\">**</ept> node in <bpt id=\"p2\">**</bpt>Solution Explorer<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>New Item<ept id=\"p4\">**</ept>.","pos":[3696,3813],"source":" To do so, right-click the **Header Files** node in **Solution Explorer**, click **Add**, and then click **New Item**."},{"content":"In the <bpt id=\"p1\">**</bpt>Templates<ept id=\"p1\">**</ept> pane, select <bpt id=\"p2\">**</bpt>Header File (.h)<ept id=\"p2\">**</ept>.","pos":[3814,3869],"source":" In the **Templates** pane, select **Header File (.h)**."},{"content":"In the <bpt id=\"p1\">**</bpt>Add New Item<ept id=\"p1\">**</ept> dialog box, type <ph id=\"ph1\">`file_reader.h`</ph> in the <bpt id=\"p2\">**</bpt>Name<ept id=\"p2\">**</ept> box and then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>.","pos":[3870,3970],"source":" In the **Add New Item** dialog box, type `file_reader.h` in the **Name** box and then click **Add**."},{"content":"In file_reader.h, add the following code.","pos":[3980,4021]},{"pos":[4039,4060],"content":"concrt-basic-agent#17"},{"pos":[4163,4250],"content":"In file_reader.h, create a class that is named <ph id=\"ph1\">`file_reader`</ph> that derives from <ph id=\"ph2\">`agent`</ph>.","source":"In file_reader.h, create a class that is named `file_reader` that derives from `agent`."},{"pos":[4268,4288],"content":"concrt-basic-agent#2"},{"pos":[4391,4461],"content":"Add the following data members to the <ph id=\"ph1\">`private`</ph> section of your class.","source":"Add the following data members to the `private` section of your class."},{"pos":[4479,4499],"content":"concrt-basic-agent#3"},{"content":"The <ph id=\"ph1\">`_file_name`</ph> member is the file name that the agent reads from.","pos":[4603,4670],"source":"The `_file_name` member is the file name that the agent reads from."},{"content":"The <ph id=\"ph1\">`_target`</ph> member is a <bpt id=\"p1\">[</bpt>concurrency::ITarget<ept id=\"p1\">](../../parallel/concrt/reference/itarget-class.md)</ept> object that the agent writes the contents of the file to.","pos":[4671,4827],"source":" The `_target` member is a [concurrency::ITarget](../../parallel/concrt/reference/itarget-class.md) object that the agent writes the contents of the file to."},{"content":"The <ph id=\"ph1\">`_error`</ph> member holds any error that occurs during the life of the agent.","pos":[4828,4905],"source":" The `_error` member holds any error that occurs during the life of the agent."},{"pos":[4915,5024],"content":"Add the following code for the <ph id=\"ph1\">`file_reader`</ph> constructors to the <ph id=\"ph2\">`public`</ph> section of the <ph id=\"ph3\">`file_reader`</ph> class.","source":"Add the following code for the `file_reader` constructors to the `public` section of the `file_reader` class."},{"pos":[5042,5062],"content":"concrt-basic-agent#4"},{"content":"Each constructor overload sets the <ph id=\"ph1\">`file_reader`</ph> data members.","pos":[5166,5228],"source":"Each constructor overload sets the `file_reader` data members."},{"content":"The second and third constructor overload enables your application to use a specific scheduler with your agent.","pos":[5229,5340]},{"content":"The first overload uses the default scheduler with your agent.","pos":[5341,5403]},{"pos":[5413,5489],"content":"Add the <ph id=\"ph1\">`get_error`</ph> method to the public section of the <ph id=\"ph2\">`file_reader`</ph> class.","source":"Add the `get_error` method to the public section of the `file_reader` class."},{"pos":[5507,5527],"content":"concrt-basic-agent#5"},{"pos":[5631,5715],"content":"The <ph id=\"ph1\">`get_error`</ph> method retrieves any error that occurs during the life of the agent.","source":"The `get_error` method retrieves any error that occurs during the life of the agent."},{"pos":[5726,5844],"content":"Implement the <bpt id=\"p1\">[</bpt>concurrency::agent::run<ept id=\"p1\">](reference/agent-class.md#run)</ept> method in the <ph id=\"ph1\">`protected`</ph> section of your class.","source":"Implement the [concurrency::agent::run](reference/agent-class.md#run) method in the `protected` section of your class."},{"pos":[5863,5883],"content":"concrt-basic-agent#6"},{"content":"The <ph id=\"ph1\">`run`</ph> method opens the file and reads data from it.","pos":[5987,6042],"source":"The `run` method opens the file and reads data from it."},{"content":"The <ph id=\"ph1\">`run`</ph> method uses exception handling to capture any errors that occur during file processing.","pos":[6043,6140],"source":" The `run` method uses exception handling to capture any errors that occur during file processing."},{"content":"Each time this method reads data from the file, it calls the <bpt id=\"p1\">[</bpt>concurrency::asend<ept id=\"p1\">](reference/concurrency-namespace-functions.md#asend)</ept> function to send that data to the target buffer.","pos":[6151,6333],"source":"Each time this method reads data from the file, it calls the [concurrency::asend](reference/concurrency-namespace-functions.md#asend) function to send that data to the target buffer."},{"content":"It sends the empty string to its target buffer to indicate the end of processing.","pos":[6334,6415]},{"content":"The following example shows the complete contents of file_reader.h.","pos":[6423,6490]},{"pos":[6508,6528],"content":"concrt-basic-agent#7"},{"pos":[6628,6641],"content":"[<bpt id=\"p1\">[</bpt>Top<ept id=\"p1\">](#top)</ept>]","source":"[[Top](#top)]"},{"pos":[6680,6726],"content":"Using the file_reader Class in the Application"},{"content":"This section shows how to use the <ph id=\"ph1\">`file_reader`</ph> class to read the contents of a text file.","pos":[6730,6820],"source":"This section shows how to use the `file_reader` class to read the contents of a text file."},{"content":"It also shows how to create a <bpt id=\"p1\">[</bpt>concurrency::call<ept id=\"p1\">](../../parallel/concrt/reference/call-class.md)</ept> object that receives this file data and calculates its Adler-32 checksum.","pos":[6821,6991],"source":" It also shows how to create a [concurrency::call](../../parallel/concrt/reference/call-class.md) object that receives this file data and calculates its Adler-32 checksum."},{"content":"To use the file_reader class in your application","pos":[7002,7050]},{"pos":[7060,7118],"content":"In BasicAgent.cpp, add the following <ph id=\"ph1\">`#include`</ph> statement.","source":"In BasicAgent.cpp, add the following `#include` statement."},{"pos":[7136,7156],"content":"concrt-basic-agent#8"},{"pos":[7261,7317],"content":"In BasicAgent.cpp, add the following <ph id=\"ph1\">`using`</ph> directives.","source":"In BasicAgent.cpp, add the following `using` directives."},{"pos":[7335,7355],"content":"concrt-basic-agent#9"},{"pos":[7461,7607],"content":"In the <ph id=\"ph1\">`_tmain`</ph> function, create a <bpt id=\"p1\">[</bpt>concurrency::event<ept id=\"p1\">](../../parallel/concrt/reference/event-class.md)</ept> object that signals the end of processing.","source":"In the `_tmain` function, create a [concurrency::event](../../parallel/concrt/reference/event-class.md) object that signals the end of processing."},{"pos":[7625,7646],"content":"concrt-basic-agent#10"},{"pos":[7752,7823],"content":"Create a <ph id=\"ph1\">`call`</ph> object that updates the checksum when it receives data.","source":"Create a `call` object that updates the checksum when it receives data."},{"pos":[7841,7862],"content":"concrt-basic-agent#11"},{"pos":[7969,8083],"content":"This <ph id=\"ph1\">`call`</ph> object also sets the <ph id=\"ph2\">`event`</ph> object when it receives the empty string to signal the end of processing.","source":"This `call` object also sets the `event` object when it receives the empty string to signal the end of processing."},{"pos":[8093,8215],"content":"Create a <ph id=\"ph1\">`file_reader`</ph> object that reads from the file test.txt and writes the contents of that file to the <ph id=\"ph2\">`call`</ph> object.","source":"Create a `file_reader` object that reads from the file test.txt and writes the contents of that file to the `call` object."},{"pos":[8233,8254],"content":"concrt-basic-agent#12"},{"content":"Start the agent and wait for it to finish.","pos":[8360,8402]},{"pos":[8420,8441],"content":"concrt-basic-agent#13"},{"pos":[8547,8605],"content":"Wait for the <ph id=\"ph1\">`call`</ph> object to receive all data and finish.","source":"Wait for the `call` object to receive all data and finish."},{"pos":[8623,8644],"content":"concrt-basic-agent#14"},{"content":"Check the file reader for errors.","pos":[8750,8783]},{"content":"If no error occurred, calculate the final Adler-32 sum and print the sum to the console.","pos":[8784,8872]},{"pos":[8890,8911],"content":"concrt-basic-agent#15"},{"content":"The following example shows the complete BasicAgent.cpp file.","pos":[9014,9075]},{"pos":[9093,9114],"content":"concrt-basic-agent#16"},{"pos":[9217,9230],"content":"[<bpt id=\"p1\">[</bpt>Top<ept id=\"p1\">](#top)</ept>]","source":"[[Top](#top)]"},{"content":"Sample Input","pos":[9239,9251]},{"content":"This is the sample contents of the input file text.txt:","pos":[9255,9310]},{"content":"Sample Output","pos":[9390,9403]},{"content":"When used with the sample input, this program produces the following output:","pos":[9407,9483]},{"content":"Robust Programming","pos":[9540,9558]},{"content":"To prevent concurrent access to data members, we recommend that you add methods that perform work to the <ph id=\"ph1\">`protected`</ph> or <ph id=\"ph2\">`private`</ph> section of your class.","pos":[9562,9714],"source":"To prevent concurrent access to data members, we recommend that you add methods that perform work to the `protected` or `private` section of your class."},{"content":"Only add methods that send or receive messages to or from the agent to the <ph id=\"ph1\">`public`</ph> section of your class.","pos":[9715,9821],"source":" Only add methods that send or receive messages to or from the agent to the `public` section of your class."},{"content":"Always call the <bpt id=\"p1\">[</bpt>concurrency::agent::done<ept id=\"p1\">](reference/agent-class.md#done)</ept> method to move your agent to the completed state.","pos":[9829,9952],"source":"Always call the [concurrency::agent::done](reference/agent-class.md#done) method to move your agent to the completed state."},{"content":"You typically call this method before you return from the <ph id=\"ph1\">`run`</ph> method.","pos":[9953,10024],"source":" You typically call this method before you return from the `run` method."},{"content":"Next Steps","pos":[10034,10044]},{"pos":[10048,10218],"content":"For another example of an agent-based application, see <bpt id=\"p1\">[</bpt>Walkthrough: Using join to Prevent Deadlock<ept id=\"p1\">](../../parallel/concrt/walkthrough-using-join-to-prevent-deadlock.md)</ept>.","source":"For another example of an agent-based application, see [Walkthrough: Using join to Prevent Deadlock](../../parallel/concrt/walkthrough-using-join-to-prevent-deadlock.md)."},{"content":"See Also","pos":[10227,10235]},{"content":"Asynchronous Agents Library","pos":[10240,10267]},{"content":"Asynchronous Message Blocks","pos":[10328,10355]},{"content":"Message Passing Functions","pos":[10416,10441]},{"content":"Synchronization Data Structures","pos":[10500,10531]},{"content":"Walkthrough: Using join to Prevent Deadlock","pos":[10596,10639]}],"content":"---\ntitle: \"Walkthrough: Creating an Agent-Based Application | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"asynchronous agents, creating\"\n  - \"agent class, example\"\nms.assetid: 730f42ce-6d58-4753-b948-fd9c9ef2ce6c\ncaps.latest.revision: 24\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"ru-ru\"\n  - \"zh-cn\"\n  - \"zh-tw\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# Walkthrough: Creating an Agent-Based Application\nThis topic describes how to create a basic agent-based application. In this walkthrough, you can create an agent that reads data from a text file asynchronously. The application uses the Adler-32 checksum algorithm to calculate the checksum of the contents of that file.  \n  \n## Prerequisites  \n You must understand the following topics to complete this walkthrough:  \n  \n- [Asynchronous Agents](../../parallel/concrt/asynchronous-agents.md)  \n  \n- [Asynchronous Message Blocks](../../parallel/concrt/asynchronous-message-blocks.md)  \n  \n- [Message Passing Functions](../../parallel/concrt/message-passing-functions.md)  \n  \n- [Synchronization Data Structures](../../parallel/concrt/synchronization-data-structures.md)  \n  \n##  <a name=\"top\"></a> Sections  \n This walkthrough demonstrates how to perform the following tasks:  \n  \n- [Creating the Console Application](#createapplication)  \n  \n- [Creating the file_reader Class](#createagentclass)  \n  \n- [Using the file_reader Class in the Application](#useagentclass)  \n  \n##  <a name=\"createapplication\"></a> Creating the Console Application  \n This section shows how to create a Visual C++ console application that references the header files that the program will use.  \n  \n#### To create a Visual C++ application by using the Win32 Console Application Wizard  \n  \n1.  On the **File** menu, click **New**, and then click **Project** to display the **New Project** dialog box.  \n  \n2.  In the **New Project** dialog box, select the **Visual C++** node in the **Project types** pane and then select **Win32 Console Application** in the **Templates** pane. Type a name for the project, for example, `BasicAgent`, and then click **OK** to display the **Win32 Console Application Wizard**.  \n  \n3.  In the **Win32 Console Application Wizard** dialog box, click **Finish**.  \n  \n4.  In stdafx.h, add the following code.  \n  \n [!code-cpp[concrt-basic-agent#1](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_1.h)]  \n  \n     The header file agents.h contains the functionality of the [concurrency::agent](../../parallel/concrt/reference/agent-class.md) class.  \n  \n5.  Verify that the application was created successfully by building and running it. To build the application, on the **Build** menu, click **Build Solution**. If the application builds successfully, run the application by clicking **Start Debugging** on the **Debug** menu.  \n  \n [[Top](#top)]  \n  \n##  <a name=\"createagentclass\"></a> Creating the file_reader Class  \n This section shows how to create the `file_reader` class. The runtime schedules each agent to perform work in its own context. Therefore, you can create an agent that performs work synchronously, but interacts with other components asynchronously. The `file_reader` class reads data from a given input file and sends data from that file to a given target component.  \n  \n#### To create the file_reader class  \n  \n1.  Add a new C++ header file to your project. To do so, right-click the **Header Files** node in **Solution Explorer**, click **Add**, and then click **New Item**. In the **Templates** pane, select **Header File (.h)**. In the **Add New Item** dialog box, type `file_reader.h` in the **Name** box and then click **Add**.  \n  \n2.  In file_reader.h, add the following code.  \n  \n [!code-cpp[concrt-basic-agent#17](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_2.h)]  \n  \n3.  In file_reader.h, create a class that is named `file_reader` that derives from `agent`.  \n  \n [!code-cpp[concrt-basic-agent#2](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_3.h)]  \n  \n4.  Add the following data members to the `private` section of your class.  \n  \n [!code-cpp[concrt-basic-agent#3](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_4.h)]  \n  \n     The `_file_name` member is the file name that the agent reads from. The `_target` member is a [concurrency::ITarget](../../parallel/concrt/reference/itarget-class.md) object that the agent writes the contents of the file to. The `_error` member holds any error that occurs during the life of the agent.  \n  \n5.  Add the following code for the `file_reader` constructors to the `public` section of the `file_reader` class.  \n  \n [!code-cpp[concrt-basic-agent#4](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_5.h)]  \n  \n     Each constructor overload sets the `file_reader` data members. The second and third constructor overload enables your application to use a specific scheduler with your agent. The first overload uses the default scheduler with your agent.  \n  \n6.  Add the `get_error` method to the public section of the `file_reader` class.  \n  \n [!code-cpp[concrt-basic-agent#5](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_6.h)]  \n  \n     The `get_error` method retrieves any error that occurs during the life of the agent.  \n  \n\n7.  Implement the [concurrency::agent::run](reference/agent-class.md#run) method in the `protected` section of your class.  \n\n  \n [!code-cpp[concrt-basic-agent#6](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_7.h)]  \n  \n     The `run` method opens the file and reads data from it. The `run` method uses exception handling to capture any errors that occur during file processing.  \n  \n     Each time this method reads data from the file, it calls the [concurrency::asend](reference/concurrency-namespace-functions.md#asend) function to send that data to the target buffer. It sends the empty string to its target buffer to indicate the end of processing.  \n\n  \n The following example shows the complete contents of file_reader.h.  \n  \n [!code-cpp[concrt-basic-agent#7](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_8.h)]  \n  \n [[Top](#top)]  \n  \n##  <a name=\"useagentclass\"></a> Using the file_reader Class in the Application  \n This section shows how to use the `file_reader` class to read the contents of a text file. It also shows how to create a [concurrency::call](../../parallel/concrt/reference/call-class.md) object that receives this file data and calculates its Adler-32 checksum.  \n  \n#### To use the file_reader class in your application  \n  \n1.  In BasicAgent.cpp, add the following `#include` statement.  \n  \n [!code-cpp[concrt-basic-agent#8](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_9.cpp)]  \n  \n2.  In BasicAgent.cpp, add the following `using` directives.  \n  \n [!code-cpp[concrt-basic-agent#9](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_10.cpp)]  \n  \n3.  In the `_tmain` function, create a [concurrency::event](../../parallel/concrt/reference/event-class.md) object that signals the end of processing.  \n  \n [!code-cpp[concrt-basic-agent#10](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_11.cpp)]  \n  \n4.  Create a `call` object that updates the checksum when it receives data.  \n  \n [!code-cpp[concrt-basic-agent#11](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_12.cpp)]  \n  \n     This `call` object also sets the `event` object when it receives the empty string to signal the end of processing.  \n  \n5.  Create a `file_reader` object that reads from the file test.txt and writes the contents of that file to the `call` object.  \n  \n [!code-cpp[concrt-basic-agent#12](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_13.cpp)]  \n  \n6.  Start the agent and wait for it to finish.  \n  \n [!code-cpp[concrt-basic-agent#13](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_14.cpp)]  \n  \n7.  Wait for the `call` object to receive all data and finish.  \n  \n [!code-cpp[concrt-basic-agent#14](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_15.cpp)]  \n  \n8.  Check the file reader for errors. If no error occurred, calculate the final Adler-32 sum and print the sum to the console.  \n  \n [!code-cpp[concrt-basic-agent#15](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_16.cpp)]  \n  \n The following example shows the complete BasicAgent.cpp file.  \n  \n [!code-cpp[concrt-basic-agent#16](../../parallel/concrt/codesnippet/cpp/walkthrough-creating-an-agent-based-application_17.cpp)]  \n  \n [[Top](#top)]  \n  \n## Sample Input  \n This is the sample contents of the input file text.txt:  \n  \n```Output  \nThe quick brown fox  \njumps  \nover the lazy dog  \n```  \n  \n## Sample Output  \n When used with the sample input, this program produces the following output:  \n  \n```Output  \nAdler-32 sum is fefb0d75  \n```  \n  \n## Robust Programming  \n To prevent concurrent access to data members, we recommend that you add methods that perform work to the `protected` or `private` section of your class. Only add methods that send or receive messages to or from the agent to the `public` section of your class.  \n  \n\n Always call the [concurrency::agent::done](reference/agent-class.md#done) method to move your agent to the completed state. You typically call this method before you return from the `run` method.  \n\n  \n## Next Steps  \n For another example of an agent-based application, see [Walkthrough: Using join to Prevent Deadlock](../../parallel/concrt/walkthrough-using-join-to-prevent-deadlock.md).  \n  \n## See Also  \n [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md)   \n [Asynchronous Message Blocks](../../parallel/concrt/asynchronous-message-blocks.md)   \n [Message Passing Functions](../../parallel/concrt/message-passing-functions.md)   \n [Synchronization Data Structures](../../parallel/concrt/synchronization-data-structures.md)   \n [Walkthrough: Using join to Prevent Deadlock](../../parallel/concrt/walkthrough-using-join-to-prevent-deadlock.md)\n\n"}