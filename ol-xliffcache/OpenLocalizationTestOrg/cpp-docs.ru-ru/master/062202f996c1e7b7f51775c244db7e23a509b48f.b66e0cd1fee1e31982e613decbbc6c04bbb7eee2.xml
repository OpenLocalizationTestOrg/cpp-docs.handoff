{"nodes":[{"pos":[12,58],"content":"ODBC: The ODBC Cursor Library | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"ODBC: The ODBC Cursor Library | Microsoft Docs","pos":[0,46]}]},{"content":"ODBC: The ODBC Cursor Library","pos":[953,982]},{"content":"This topic describes the ODBC Cursor Library and explains how to use it.","pos":[983,1055]},{"content":"For more information, see:","pos":[1056,1082]},{"content":"Cursor Library and Level 1 ODBC Drivers","pos":[1093,1132]},{"content":"Positioned Updates and Timestamp Columns","pos":[1196,1236]},{"content":"Using the Cursor Library","pos":[1297,1321]},{"content":"The ODBC Cursor Library is a dynamic-link library (DLL) that resides between the ODBC Driver Manager and the driver.","pos":[1362,1478]},{"content":"In ODBC terms, a driver maintains a cursor to keep track of its position in the recordset.","pos":[1479,1569]},{"content":"The cursor marks the position in the recordset to which you have already scrolled — the current record.","pos":[1570,1673]},{"pos":[1748,1787],"content":"Cursor Library and Level 1 ODBC Drivers"},{"content":"The ODBC Cursor Library gives Level 1 drivers the following new capabilities:","pos":[1791,1868]},{"content":"Forward and backward scrolling.","pos":[1878,1909]},{"content":"Level 2 drivers do not need the cursor library because they are already scrollable.","pos":[1910,1993]},{"content":"Support for snapshots.","pos":[2003,2025]},{"content":"The cursor library manages a buffer containing the snapshot's records.","pos":[2026,2096]},{"content":"This buffer reflects your program's deletions and edits to records but not the additions, deletions, or edits of other users.","pos":[2097,2222]},{"content":"Therefore, the snapshot is only as current as the cursor library's buffer.","pos":[2223,2297]},{"content":"The buffer also does not reflect your own additions until you call <bpt id=\"p1\">**</bpt>Requery<ept id=\"p1\">**</ept>.","pos":[2298,2377],"source":" The buffer also does not reflect your own additions until you call **Requery**."},{"content":"Dynasets do not use the cursor library.","pos":[2378,2417]},{"content":"The cursor library gives you snapshots (static cursors) even if they are not normally supported by your driver.","pos":[2424,2535]},{"content":"If your driver already supports static cursors, you do not need to load the cursor library to get snapshot support.","pos":[2536,2651]},{"content":"If you do use the cursor library, you can use only snapshots and forward-only recordsets.","pos":[2652,2741]},{"content":"If your driver supports dynasets (KEYSET_DRIVEN cursors) and you want to use them, you must not use the cursor library.","pos":[2742,2861]},{"content":"If you want to use both snapshots and dynasets, you must base them on two different <ph id=\"ph1\">`CDatabase`</ph> objects (two different connections) unless your driver supports both.","pos":[2862,3027],"source":" If you want to use both snapshots and dynasets, you must base them on two different `CDatabase` objects (two different connections) unless your driver supports both."},{"pos":[3099,3139],"content":"Positioned Updates and Timestamp Columns"},{"pos":[3147,3301],"content":"[!NOTE]\n ODBC data sources are accessible through the MFC ODBC classes, as described in this topic, or through the MFC Data Access Object (DAO) classes.","leadings":["","> "],"nodes":[{"content":"ODBC data sources are accessible through the MFC ODBC classes, as described in this topic, or through the MFC Data Access Object (DAO) classes.","pos":[9,152]}]},{"pos":[3309,3426],"content":"[!NOTE]\n If your ODBC driver supports **SQLSetPos**, which MFC uses if available, this topic does not apply to you.","leadings":["","> "],"nodes":[{"content":"If your ODBC driver supports <bpt id=\"p1\">**</bpt>SQLSetPos<ept id=\"p1\">**</ept>, which MFC uses if available, this topic does not apply to you.","pos":[9,115],"source":" If your ODBC driver supports **SQLSetPos**, which MFC uses if available, this topic does not apply to you."}]},{"content":"Most Level 1 drivers do not support positioned updates.","pos":[3433,3488]},{"content":"Such drivers rely on the cursor library to emulate the capabilities of Level 2 drivers in this regard.","pos":[3489,3591]},{"content":"The cursor library emulates positioned update support by doing a searched update on the unchanging fields.","pos":[3592,3698]},{"content":"In some cases, a recordset might contain a timestamp column as one of those unchanging fields.","pos":[3705,3799]},{"content":"Two issues arise in using MFC recordsets with tables that contain timestamp columns.","pos":[3800,3884]},{"content":"The first issue concerns updateable snapshots on tables with timestamp columns.","pos":[3891,3970]},{"content":"If the table to which your snapshot is bound contains a timestamp column, you should call <bpt id=\"p1\">**</bpt>Requery<ept id=\"p1\">**</ept> after you call <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept>.","pos":[3971,4112],"source":" If the table to which your snapshot is bound contains a timestamp column, you should call **Requery** after you call **Edit** and **Update**."},{"content":"If not, you might not be able to edit the same record again.","pos":[4113,4173]},{"content":"When you call <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> and then <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>, the record is written to the data source and the timestamp column is updated.","pos":[4174,4295],"source":" When you call **Edit** and then **Update**, the record is written to the data source and the timestamp column is updated."},{"content":"If you do not call <bpt id=\"p1\">**</bpt>Requery<ept id=\"p1\">**</ept>, the timestamp value for the record in your snapshot no longer matches the corresponding timestamp on the data source.","pos":[4296,4445],"source":" If you do not call **Requery**, the timestamp value for the record in your snapshot no longer matches the corresponding timestamp on the data source."},{"content":"When you try to update the record again, the data source might disallow the update because of the mismatch.","pos":[4446,4553]},{"content":"The second issue concerns limitations of class <bpt id=\"p1\">[</bpt>CTime<ept id=\"p1\">](../../atl-mfc-shared/reference/ctime-class.md)</ept> when used with the <ph id=\"ph1\">`RFX_Date`</ph> function to transfer time and date information to or from a table.","pos":[4560,4758],"source":"The second issue concerns limitations of class [CTime](../../atl-mfc-shared/reference/ctime-class.md) when used with the `RFX_Date` function to transfer time and date information to or from a table."},{"content":"Processing the <ph id=\"ph1\">`CTime`</ph> object imposes some overhead in the form of extra intermediate processing during the data transfer.","pos":[4759,4881],"source":" Processing the `CTime` object imposes some overhead in the form of extra intermediate processing during the data transfer."},{"content":"The date range of <ph id=\"ph1\">`CTime`</ph> objects might also be too limiting for some applications.","pos":[4882,4965],"source":" The date range of `CTime` objects might also be too limiting for some applications."},{"content":"A new version of the <ph id=\"ph1\">`RFX_Date`</ph> function takes an ODBC <bpt id=\"p1\">**</bpt>TIMESTAMP_STRUCT<ept id=\"p1\">**</ept> parameter instead of a <ph id=\"ph2\">`CTime`</ph> object.","pos":[4966,5080],"source":" A new version of the `RFX_Date` function takes an ODBC **TIMESTAMP_STRUCT** parameter instead of a `CTime` object."},{"content":"For more information, see <ph id=\"ph1\">`RFX_Date`</ph> in <bpt id=\"p1\">[</bpt>Macros and Globals<ept id=\"p1\">](../../mfc/reference/mfc-macros-and-globals.md)</ept> in the <bpt id=\"p2\">*</bpt>MFC Reference<ept id=\"p2\">*</ept>.","pos":[5081,5212],"source":" For more information, see `RFX_Date` in [Macros and Globals](../../mfc/reference/mfc-macros-and-globals.md) in the *MFC Reference*."},{"pos":[5269,5293],"content":"Using the Cursor Library"},{"content":"When you connect to a data source — by calling <bpt id=\"p1\">[</bpt>CDatabase::OpenEx<ept id=\"p1\">](../../mfc/reference/cdatabase-class.md#cdatabase__openex)</ept> or <bpt id=\"p2\">[</bpt>CDatabase::Open<ept id=\"p2\">](../../mfc/reference/cdatabase-class.md#cdatabase__open)</ept> — you can specify whether to use the cursor library for the data source.","pos":[5297,5571],"source":"When you connect to a data source — by calling [CDatabase::OpenEx](../../mfc/reference/cdatabase-class.md#cdatabase__openex) or [CDatabase::Open](../../mfc/reference/cdatabase-class.md#cdatabase__open) — you can specify whether to use the cursor library for the data source."},{"content":"If you will be creating snapshots on that data source, specify the <bpt id=\"p1\">**</bpt>CDatabase::useCursorLib<ept id=\"p1\">**</ept> option in the <ph id=\"ph1\">`dwOptions`</ph> parameter to <ph id=\"ph2\">`OpenEx`</ph> or specify <bpt id=\"p2\">**</bpt>TRUE<ept id=\"p2\">**</ept> for the <bpt id=\"p3\">**</bpt>bUseCursorLib<ept id=\"p3\">**</ept> parameter to <bpt id=\"p4\">**</bpt>Open<ept id=\"p4\">**</ept> (the default value is <bpt id=\"p5\">**</bpt>TRUE<ept id=\"p5\">**</ept>).","pos":[5572,5815],"source":" If you will be creating snapshots on that data source, specify the **CDatabase::useCursorLib** option in the `dwOptions` parameter to `OpenEx` or specify **TRUE** for the **bUseCursorLib** parameter to **Open** (the default value is **TRUE**)."},{"content":"If your ODBC driver supports dynasets and you want to open dynasets on the data source, do not use the cursor library (it masks some driver functionality needed for dynasets).","pos":[5816,5991]},{"content":"In that case, do not specify <bpt id=\"p1\">**</bpt>CDatabase::useCursorLib<ept id=\"p1\">**</ept> in <ph id=\"ph1\">`OpenEx`</ph> or specify <bpt id=\"p2\">**</bpt>FALSE<ept id=\"p2\">**</ept> for the <bpt id=\"p3\">**</bpt>bUseCursorLib<ept id=\"p3\">**</ept> parameter in <bpt id=\"p4\">**</bpt>Open<ept id=\"p4\">**</ept>.","pos":[5992,6130],"source":" In that case, do not specify **CDatabase::useCursorLib** in `OpenEx` or specify **FALSE** for the **bUseCursorLib** parameter in **Open**."},{"content":"See Also","pos":[6139,6147]},{"content":"ODBC Basics","pos":[6152,6163]}],"content":"---\ntitle: \"ODBC: The ODBC Cursor Library | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"cursor library [ODBC]\"\n  - \"snapshots, support in ODBC\"\n  - \"timestamps, ODBC timestamp columns\"\n  - \"ODBC cursor library [ODBC]\"\n  - \"static cursors\"\n  - \"ODBC drivers, Level 1\"\n  - \"ODBC drivers, cursor support\"\n  - \"positioned updates\"\n  - \"cursors, ODBC cursor library\"\n  - \"Level 1 ODBC drivers\"\n  - \"cursor library [ODBC], snapshots\"\n  - \"ODBC, timestamp\"\n  - \"positioning cursors\"\nms.assetid: 6608db92-82b1-4164-bb08-78153c227be3\ncaps.latest.revision: 9\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# ODBC: The ODBC Cursor Library\nThis topic describes the ODBC Cursor Library and explains how to use it. For more information, see:  \n  \n-   [Cursor Library and Level 1 ODBC Drivers](#_core_the_cursor_library_and_level_1_odbc_drivers)  \n  \n-   [Positioned Updates and Timestamp Columns](#_core_positioned_updates_and_timestamp_columns)  \n  \n-   [Using the Cursor Library](#_core_using_the_cursor_library)  \n  \n The ODBC Cursor Library is a dynamic-link library (DLL) that resides between the ODBC Driver Manager and the driver. In ODBC terms, a driver maintains a cursor to keep track of its position in the recordset. The cursor marks the position in the recordset to which you have already scrolled — the current record.  \n  \n##  <a name=\"_core_the_cursor_library_and_level_1_odbc_drivers\"></a> Cursor Library and Level 1 ODBC Drivers  \n The ODBC Cursor Library gives Level 1 drivers the following new capabilities:  \n  \n-   Forward and backward scrolling. Level 2 drivers do not need the cursor library because they are already scrollable.  \n  \n-   Support for snapshots. The cursor library manages a buffer containing the snapshot's records. This buffer reflects your program's deletions and edits to records but not the additions, deletions, or edits of other users. Therefore, the snapshot is only as current as the cursor library's buffer. The buffer also does not reflect your own additions until you call **Requery**. Dynasets do not use the cursor library.  \n  \n The cursor library gives you snapshots (static cursors) even if they are not normally supported by your driver. If your driver already supports static cursors, you do not need to load the cursor library to get snapshot support. If you do use the cursor library, you can use only snapshots and forward-only recordsets. If your driver supports dynasets (KEYSET_DRIVEN cursors) and you want to use them, you must not use the cursor library. If you want to use both snapshots and dynasets, you must base them on two different `CDatabase` objects (two different connections) unless your driver supports both.  \n  \n##  <a name=\"_core_positioned_updates_and_timestamp_columns\"></a> Positioned Updates and Timestamp Columns  \n  \n> [!NOTE]\n>  ODBC data sources are accessible through the MFC ODBC classes, as described in this topic, or through the MFC Data Access Object (DAO) classes.  \n  \n> [!NOTE]\n>  If your ODBC driver supports **SQLSetPos**, which MFC uses if available, this topic does not apply to you.  \n  \n Most Level 1 drivers do not support positioned updates. Such drivers rely on the cursor library to emulate the capabilities of Level 2 drivers in this regard. The cursor library emulates positioned update support by doing a searched update on the unchanging fields.  \n  \n In some cases, a recordset might contain a timestamp column as one of those unchanging fields. Two issues arise in using MFC recordsets with tables that contain timestamp columns.  \n  \n The first issue concerns updateable snapshots on tables with timestamp columns. If the table to which your snapshot is bound contains a timestamp column, you should call **Requery** after you call **Edit** and **Update**. If not, you might not be able to edit the same record again. When you call **Edit** and then **Update**, the record is written to the data source and the timestamp column is updated. If you do not call **Requery**, the timestamp value for the record in your snapshot no longer matches the corresponding timestamp on the data source. When you try to update the record again, the data source might disallow the update because of the mismatch.  \n  \n The second issue concerns limitations of class [CTime](../../atl-mfc-shared/reference/ctime-class.md) when used with the `RFX_Date` function to transfer time and date information to or from a table. Processing the `CTime` object imposes some overhead in the form of extra intermediate processing during the data transfer. The date range of `CTime` objects might also be too limiting for some applications. A new version of the `RFX_Date` function takes an ODBC **TIMESTAMP_STRUCT** parameter instead of a `CTime` object. For more information, see `RFX_Date` in [Macros and Globals](../../mfc/reference/mfc-macros-and-globals.md) in the *MFC Reference*.  \n\n  \n##  <a name=\"_core_using_the_cursor_library\"></a> Using the Cursor Library  \n When you connect to a data source — by calling [CDatabase::OpenEx](../../mfc/reference/cdatabase-class.md#cdatabase__openex) or [CDatabase::Open](../../mfc/reference/cdatabase-class.md#cdatabase__open) — you can specify whether to use the cursor library for the data source. If you will be creating snapshots on that data source, specify the **CDatabase::useCursorLib** option in the `dwOptions` parameter to `OpenEx` or specify **TRUE** for the **bUseCursorLib** parameter to **Open** (the default value is **TRUE**). If your ODBC driver supports dynasets and you want to open dynasets on the data source, do not use the cursor library (it masks some driver functionality needed for dynasets). In that case, do not specify **CDatabase::useCursorLib** in `OpenEx` or specify **FALSE** for the **bUseCursorLib** parameter in **Open**.  \n  \n## See Also  \n [ODBC Basics](../../data/odbc/odbc-basics.md)"}