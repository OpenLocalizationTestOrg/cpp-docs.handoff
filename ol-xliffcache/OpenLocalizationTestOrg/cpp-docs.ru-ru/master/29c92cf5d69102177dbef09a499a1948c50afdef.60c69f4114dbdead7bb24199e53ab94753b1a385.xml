{"nodes":[{"pos":[12,65],"content":"Two Ways to Create a CArchive Object | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Two Ways to Create a CArchive Object | Microsoft Docs","pos":[0,53]}]},{"content":"Two Ways to Create a CArchive Object","pos":[895,931]},{"pos":[932,981],"content":"There are two ways to create a <ph id=\"ph1\">`CArchive`</ph> object:","source":"There are two ways to create a `CArchive` object:"},{"content":"Implicit creation of a CArchive object via the framework","pos":[992,1048]},{"content":"Explicit creation of a CArchive object","pos":[1125,1163]},{"pos":[1299,1355],"content":"Implicit Creation of a CArchive Object via the Framework"},{"pos":[1359,1529],"content":"The most common, and easiest, way is to let the framework create a <ph id=\"ph1\">`CArchive`</ph> object for your document on behalf of the Save, Save As, and Open commands on the File menu.","source":"The most common, and easiest, way is to let the framework create a `CArchive` object for your document on behalf of the Save, Save As, and Open commands on the File menu."},{"content":"Here is what the framework does when the user of your application issues the Save As command from the File menu:","pos":[1536,1648]},{"pos":[1658,1730],"content":"Presents the <bpt id=\"p1\">**</bpt>Save As<ept id=\"p1\">**</ept> dialog box and gets the filename from the user.","source":"Presents the **Save As** dialog box and gets the filename from the user."},{"pos":[1740,1793],"content":"Opens the file named by the user as a <ph id=\"ph1\">`CFile`</ph> object.","source":"Opens the file named by the user as a `CFile` object."},{"content":"Creates a <ph id=\"ph1\">`CArchive`</ph> object that points to this <ph id=\"ph2\">`CFile`</ph> object.","pos":[1803,1866],"source":"Creates a `CArchive` object that points to this `CFile` object."},{"content":"In creating the <ph id=\"ph1\">`CArchive`</ph> object, the framework sets the mode to \"store\" (write, serialize), as opposed to \"load\" (read, deserialize).","pos":[1867,2002],"source":" In creating the `CArchive` object, the framework sets the mode to \"store\" (write, serialize), as opposed to \"load\" (read, deserialize)."},{"pos":[2012,2136],"content":"Calls the <ph id=\"ph1\">`Serialize`</ph> function defined in your <bpt id=\"p1\">**</bpt>CDocument<ept id=\"p1\">**</ept>-derived class, passing it a reference to the <ph id=\"ph2\">`CArchive`</ph> object.","source":"Calls the `Serialize` function defined in your **CDocument**-derived class, passing it a reference to the `CArchive` object."},{"content":"Your document's <ph id=\"ph1\">`Serialize`</ph> function then writes data to the <ph id=\"ph2\">`CArchive`</ph> object, as explained shortly.","pos":[2143,2244],"source":"Your document's `Serialize` function then writes data to the `CArchive` object, as explained shortly."},{"content":"Upon return from your <ph id=\"ph1\">`Serialize`</ph> function, the framework destroys the <ph id=\"ph2\">`CArchive`</ph> object and then the <ph id=\"ph3\">`CFile`</ph> object.","pos":[2245,2362],"source":" Upon return from your `Serialize` function, the framework destroys the `CArchive` object and then the `CFile` object."},{"content":"Thus, if you let the framework create the <ph id=\"ph1\">`CArchive`</ph> object for your document, all you have to do is implement the document's <ph id=\"ph2\">`Serialize`</ph> function that writes and reads to and from the archive.","pos":[2369,2562],"source":"Thus, if you let the framework create the `CArchive` object for your document, all you have to do is implement the document's `Serialize` function that writes and reads to and from the archive."},{"content":"You also have to implement <ph id=\"ph1\">`Serialize`</ph> for any <ph id=\"ph2\">`CObject`</ph>-derived objects that the document's <ph id=\"ph3\">`Serialize`</ph> function in turn serializes directly or indirectly.","pos":[2563,2719],"source":" You also have to implement `Serialize` for any `CObject`-derived objects that the document's `Serialize` function in turn serializes directly or indirectly."},{"pos":[2789,2827],"content":"Explicit Creation of a CArchive Object"},{"content":"Besides serializing a document via the framework, there are other occasions when you may need a <ph id=\"ph1\">`CArchive`</ph> object.","pos":[2831,2945],"source":"Besides serializing a document via the framework, there are other occasions when you may need a `CArchive` object."},{"content":"For example, you might want to serialize data to and from the Clipboard, represented by a <ph id=\"ph1\">`CSharedFile`</ph> object.","pos":[2946,3057],"source":" For example, you might want to serialize data to and from the Clipboard, represented by a `CSharedFile` object."},{"content":"Or, you may want to use a user interface for saving a file that is different from the one offered by the framework.","pos":[3058,3173]},{"content":"In this case, you can explicitly create a <ph id=\"ph1\">`CArchive`</ph> object.","pos":[3174,3234],"source":" In this case, you can explicitly create a `CArchive` object."},{"content":"You do this the same way the framework does, using the following procedure.","pos":[3235,3310]},{"content":"To explicitly create a CArchive object","pos":[3321,3359]},{"pos":[3369,3430],"content":"Construct a <ph id=\"ph1\">`CFile`</ph> object or an object derived from <ph id=\"ph2\">`CFile`</ph>.","source":"Construct a `CFile` object or an object derived from `CFile`."},{"pos":[3440,3533],"content":"Pass the <ph id=\"ph1\">`CFile`</ph> object to the constructor for <ph id=\"ph2\">`CArchive`</ph>, as shown in the following example:","source":"Pass the `CFile` object to the constructor for `CArchive`, as shown in the following example:"},{"pos":[3555,3577],"content":"NVC_MFCSerialization#5"},{"content":"The second argument to the <ph id=\"ph1\">`CArchive`</ph> constructor is an enumerated value that specifies whether the archive will be used for storing or loading data to or from the file.","pos":[3657,3826],"source":"The second argument to the `CArchive` constructor is an enumerated value that specifies whether the archive will be used for storing or loading data to or from the file."},{"content":"The <ph id=\"ph1\">`Serialize`</ph> function of an object checks this state by calling the <ph id=\"ph2\">`IsStoring`</ph> function for the archive object.","pos":[3827,3942],"source":" The `Serialize` function of an object checks this state by calling the `IsStoring` function for the archive object."},{"content":"When you are finished storing or loading data to or from the <ph id=\"ph1\">`CArchive`</ph> object, close it.","pos":[3949,4038],"source":"When you are finished storing or loading data to or from the `CArchive` object, close it."},{"content":"Although the <ph id=\"ph1\">`CArchive`</ph> (and <ph id=\"ph2\">`CFile`</ph>) objects will automatically close the archive (and file), it is good practice to explicitly do so since it makes recovery from errors easier.","pos":[4039,4217],"source":" Although the `CArchive` (and `CFile`) objects will automatically close the archive (and file), it is good practice to explicitly do so since it makes recovery from errors easier."},{"content":"For more information about error handling, see the article <bpt id=\"p1\">[</bpt>Exceptions: Catching and Deleting Exceptions<ept id=\"p1\">](../mfc/exceptions-catching-and-deleting-exceptions.md)</ept>.","pos":[4218,4379],"source":" For more information about error handling, see the article [Exceptions: Catching and Deleting Exceptions](../mfc/exceptions-catching-and-deleting-exceptions.md)."},{"content":"To close the CArchive object","pos":[4390,4418]},{"pos":[4428,4497],"content":"The following example illustrates how to close the <ph id=\"ph1\">`CArchive`</ph> object:","source":"The following example illustrates how to close the `CArchive` object:"},{"pos":[4519,4541],"content":"NVC_MFCSerialization#6"},{"content":"See Also","pos":[4619,4627]},{"content":"Serialization: Serializing an Object","pos":[4632,4668]}],"content":"---\ntitle: \"Two Ways to Create a CArchive Object | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"CArchive\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CArchive class, closing CArchive objects\"\n  - \"CArchive objects, closing\"\n  - \"I/O [MFC], creating CArchive objects\"\n  - \"serialization [C++], CArchive class\"\n  - \"CArchive objects\"\n  - \"storage [C++], CArchive class\"\n  - \"data storage [C++], CArchive class\"\n  - \"CArchive class, constructor\"\nms.assetid: aefa28ce-b55c-40dc-9e42-5f038030985d\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Two Ways to Create a CArchive Object\nThere are two ways to create a `CArchive` object:  \n  \n-   [Implicit creation of a CArchive object via the framework](#_core_implicit_creation_of_a_carchive_object_via_the_framework)  \n  \n-   [Explicit creation of a CArchive object](#_core_explicit_creation_of_a_carchive_object)  \n  \n##  <a name=\"_core_implicit_creation_of_a_carchive_object_via_the_framework\"></a> Implicit Creation of a CArchive Object via the Framework  \n The most common, and easiest, way is to let the framework create a `CArchive` object for your document on behalf of the Save, Save As, and Open commands on the File menu.  \n  \n Here is what the framework does when the user of your application issues the Save As command from the File menu:  \n  \n1.  Presents the **Save As** dialog box and gets the filename from the user.  \n  \n2.  Opens the file named by the user as a `CFile` object.  \n  \n3.  Creates a `CArchive` object that points to this `CFile` object. In creating the `CArchive` object, the framework sets the mode to \"store\" (write, serialize), as opposed to \"load\" (read, deserialize).  \n  \n4.  Calls the `Serialize` function defined in your **CDocument**-derived class, passing it a reference to the `CArchive` object.  \n  \n Your document's `Serialize` function then writes data to the `CArchive` object, as explained shortly. Upon return from your `Serialize` function, the framework destroys the `CArchive` object and then the `CFile` object.  \n  \n Thus, if you let the framework create the `CArchive` object for your document, all you have to do is implement the document's `Serialize` function that writes and reads to and from the archive. You also have to implement `Serialize` for any `CObject`-derived objects that the document's `Serialize` function in turn serializes directly or indirectly.  \n  \n##  <a name=\"_core_explicit_creation_of_a_carchive_object\"></a> Explicit Creation of a CArchive Object  \n Besides serializing a document via the framework, there are other occasions when you may need a `CArchive` object. For example, you might want to serialize data to and from the Clipboard, represented by a `CSharedFile` object. Or, you may want to use a user interface for saving a file that is different from the one offered by the framework. In this case, you can explicitly create a `CArchive` object. You do this the same way the framework does, using the following procedure.  \n  \n#### To explicitly create a CArchive object  \n  \n1.  Construct a `CFile` object or an object derived from `CFile`.  \n  \n2.  Pass the `CFile` object to the constructor for `CArchive`, as shown in the following example:  \n  \n     [!code-cpp[NVC_MFCSerialization#5](../mfc/codesnippet/cpp/two-ways-to-create-a-carchive-object_1.cpp)]  \n  \n     The second argument to the `CArchive` constructor is an enumerated value that specifies whether the archive will be used for storing or loading data to or from the file. The `Serialize` function of an object checks this state by calling the `IsStoring` function for the archive object.  \n  \n When you are finished storing or loading data to or from the `CArchive` object, close it. Although the `CArchive` (and `CFile`) objects will automatically close the archive (and file), it is good practice to explicitly do so since it makes recovery from errors easier. For more information about error handling, see the article [Exceptions: Catching and Deleting Exceptions](../mfc/exceptions-catching-and-deleting-exceptions.md).  \n  \n#### To close the CArchive object  \n  \n1.  The following example illustrates how to close the `CArchive` object:  \n  \n     [!code-cpp[NVC_MFCSerialization#6](../mfc/codesnippet/cpp/two-ways-to-create-a-carchive-object_2.cpp)]  \n  \n## See Also  \n [Serialization: Serializing an Object](../mfc/serialization-serializing-an-object.md)\n\n"}