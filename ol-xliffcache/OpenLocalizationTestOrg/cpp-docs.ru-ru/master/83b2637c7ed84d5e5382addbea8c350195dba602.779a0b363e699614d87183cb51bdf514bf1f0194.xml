{"nodes":[{"pos":[12,44],"content":"CDatabase Class | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"CDatabase Class | Microsoft Docs","pos":[0,32]}]},{"content":"CDatabase Class","pos":[768,783]},{"content":"Represents a connection to a data source, through which you can operate on the data source.","pos":[784,875]},{"content":"Syntax","pos":[884,890]},{"content":"Members","pos":[949,956]},{"content":"Public Constructors","pos":[966,985]},{"content":"Name","pos":[992,996]},{"content":"Description","pos":[997,1008]},{"content":"CDatabase::CDatabase","pos":[1047,1067]},{"content":"Constructs a <ph id=\"ph1\">`CDatabase`</ph> object.","pos":[1092,1124],"source":"Constructs a `CDatabase` object."},{"content":"You must initialize the object by calling <ph id=\"ph1\">`OpenEx`</ph> or <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>.","pos":[1125,1188],"source":" You must initialize the object by calling `OpenEx` or **Open**."},{"content":"Public Methods","pos":[1199,1213]},{"content":"Name","pos":[1220,1224]},{"content":"Description","pos":[1225,1236]},{"content":"CDatabase::BeginTrans","pos":[1275,1296]},{"content":"Starts a \"transaction\" â€” a series of reversible calls to the <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept> member functions of class <ph id=\"ph2\">`CRecordset`</ph> â€” on the connected data source.","pos":[1322,1504],"source":"Starts a \"transaction\" â€” a series of reversible calls to the `AddNew`, **Edit**, **Delete**, and **Update** member functions of class `CRecordset` â€” on the connected data source."},{"content":"The data source must support transactions for <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> to have any effect.","pos":[1505,1585],"source":" The data source must support transactions for **BeginTrans** to have any effect."},{"content":"CDatabase::BindParameters","pos":[1591,1616]},{"pos":[1646,1715],"content":"Allows you to bind parameters before calling <ph id=\"ph1\">`CDatabase::ExecuteSQL`</ph>.","source":"Allows you to bind parameters before calling `CDatabase::ExecuteSQL`."},{"content":"CDatabase::Cancel","pos":[1721,1738]},{"content":"Cancels an asynchronous operation or a process from a second thread.","pos":[1760,1828]},{"content":"CDatabase::CanTransact","pos":[1834,1856]},{"content":"Returns nonzero if the data source supports transactions.","pos":[1883,1940]},{"content":"CDatabase::CanUpdate","pos":[1946,1966]},{"pos":[1991,2062],"content":"Returns nonzero if the <ph id=\"ph1\">`CDatabase`</ph> object is updatable (not read-only).","source":"Returns nonzero if the `CDatabase` object is updatable (not read-only)."},{"content":"CDatabase::Close","pos":[2068,2084]},{"content":"Closes the data source connection.","pos":[2105,2139]},{"content":"CDatabase::CommitTrans","pos":[2145,2167]},{"content":"Completes a transaction begun by <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept>.","pos":[2194,2242],"source":"Completes a transaction begun by **BeginTrans**."},{"content":"Commands in the transaction that alter the data source are carried out.","pos":[2243,2314]},{"content":"CDatabase::ExecuteSQL","pos":[2320,2341]},{"content":"Executes a SQL statement.","pos":[2367,2392]},{"content":"No data records are returned.","pos":[2393,2422]},{"content":"CDatabase::GetBookmarkPersistence","pos":[2428,2461]},{"content":"Identifies the operations through which bookmarks persist on recordset objects.","pos":[2499,2578]},{"content":"CDatabase::GetConnect","pos":[2584,2605]},{"pos":[2631,2722],"content":"Returns the ODBC connection string used to connect the <ph id=\"ph1\">`CDatabase`</ph> object to a data source.","source":"Returns the ODBC connection string used to connect the `CDatabase` object to a data source."},{"content":"CDatabase::GetCursorCommitBehavior","pos":[2728,2762]},{"content":"Identifies the effect of committing a transaction on an open recordset object.","pos":[2801,2879]},{"content":"CDatabase::GetCursorRollbackBehavior","pos":[2885,2921]},{"content":"Identifies the effect of rolling back a transaction on an open recordset object.","pos":[2962,3042]},{"content":"CDatabase::GetDatabaseName","pos":[3048,3074]},{"content":"Returns the name of the database currently in use.","pos":[3105,3155]},{"content":"CDatabase::IsOpen","pos":[3161,3178]},{"pos":[3200,3282],"content":"Returns nonzero if the <ph id=\"ph1\">`CDatabase`</ph> object is currently connected to a data source.","source":"Returns nonzero if the `CDatabase` object is currently connected to a data source."},{"content":"CDatabase::OnSetOptions","pos":[3288,3311]},{"content":"Called by the framework to set standard connection options.","pos":[3339,3398]},{"content":"The default implementation sets the query timeout value.","pos":[3399,3455]},{"content":"You can establish these options ahead of time by calling <ph id=\"ph1\">`SetQueryTimeout`</ph>.","pos":[3456,3531],"source":" You can establish these options ahead of time by calling `SetQueryTimeout`."},{"content":"CDatabase::Open","pos":[3537,3552]},{"content":"Establishes a connection to a data source (through an ODBC driver).","pos":[3572,3639]},{"content":"CDatabase::OpenEx","pos":[3645,3662]},{"content":"Establishes a connection to a data source (through an ODBC driver).","pos":[3684,3751]},{"content":"CDatabase::Rollback","pos":[3757,3776]},{"content":"Reverses changes made during the current transaction.","pos":[3800,3853]},{"content":"The data source returns to its previous state, as defined at the <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> call, unaltered.","pos":[3854,3950],"source":" The data source returns to its previous state, as defined at the **BeginTrans** call, unaltered."},{"content":"CDatabase::SetLoginTimeout","pos":[3956,3982]},{"content":"Sets the number of seconds after which a data source connection attempt will time out.","pos":[4013,4099]},{"content":"CDatabase::SetQueryTimeout","pos":[4105,4131]},{"content":"Sets the number of seconds after which database query operations will time out.","pos":[4162,4241]},{"content":"Affects all subsequent recordset <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>, <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Delete<ept id=\"p3\">**</ept> calls.","pos":[4242,4326],"source":" Affects all subsequent recordset **Open**, `AddNew`, **Edit**, and **Delete** calls."},{"content":"Public Data Members","pos":[4337,4356]},{"content":"Name","pos":[4363,4367]},{"content":"Description","pos":[4368,4379]},{"content":"CDatabase::m_hdbc","pos":[4418,4435]},{"content":"Open Database Connectivity (ODBC) connection handle to a data source.","pos":[4457,4526]},{"content":"Type <bpt id=\"p1\">**</bpt>HDBC<ept id=\"p1\">**</ept>.","pos":[4527,4541],"source":" Type **HDBC**."},{"content":"Remarks","pos":[4551,4558]},{"content":"A data source is a specific instance of data hosted by some database management system (DBMS).","pos":[4562,4656]},{"content":"Examples include Microsoft SQL Server, Microsoft Access, Borland dBASE, and xBASE.","pos":[4657,4739]},{"content":"You can have one or more <ph id=\"ph1\">`CDatabase`</ph> objects active at a time in your application.","pos":[4740,4822],"source":" You can have one or more `CDatabase` objects active at a time in your application."},{"pos":[4830,5157],"content":"[!NOTE]\n If you are working with the Data Access Objects (DAO) classes rather than the Open Database Connectivity (ODBC) classes, use class [CDaoDatabase](../../mfc/reference/cdaodatabase-class.md) instead. For more information, see the article [Overview: Database Programming](../../data/data-access-programming-mfc-atl.md).","leadings":["","> "],"nodes":[{"content":" If you are working with the Data Access Objects (DAO) classes rather than the Open Database Connectivity (ODBC) classes, use class [CDaoDatabase](../../mfc/reference/cdaodatabase-class.md) instead. For more information, see the article [Overview: Database Programming](../../data/data-access-programming-mfc-atl.md).","pos":[8,325],"nodes":[{"content":"If you are working with the Data Access Objects (DAO) classes rather than the Open Database Connectivity (ODBC) classes, use class <bpt id=\"p1\">[</bpt>CDaoDatabase<ept id=\"p1\">](../../mfc/reference/cdaodatabase-class.md)</ept> instead.","pos":[1,198],"source":" If you are working with the Data Access Objects (DAO) classes rather than the Open Database Connectivity (ODBC) classes, use class [CDaoDatabase](../../mfc/reference/cdaodatabase-class.md) instead."},{"content":"For more information, see the article <bpt id=\"p1\">[</bpt>Overview: Database Programming<ept id=\"p1\">](../../data/data-access-programming-mfc-atl.md)</ept>.","pos":[199,317],"source":" For more information, see the article [Overview: Database Programming](../../data/data-access-programming-mfc-atl.md)."}]}]},{"content":"To use <ph id=\"ph1\">`CDatabase`</ph>, construct a <ph id=\"ph2\">`CDatabase`</ph> object and call its <ph id=\"ph3\">`OpenEx`</ph> member function.","pos":[5164,5253],"source":"To use `CDatabase`, construct a `CDatabase` object and call its `OpenEx` member function."},{"content":"This opens a connection.","pos":[5254,5278]},{"content":"When you then construct <ph id=\"ph1\">`CRecordset`</ph> objects for operating on the connected data source, pass the recordset constructor a pointer to your <ph id=\"ph2\">`CDatabase`</ph> object.","pos":[5279,5436],"source":" When you then construct `CRecordset` objects for operating on the connected data source, pass the recordset constructor a pointer to your `CDatabase` object."},{"content":"When you finish using the connection, call the <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> member function and destroy the <ph id=\"ph1\">`CDatabase`</ph> object.","pos":[5437,5545],"source":" When you finish using the connection, call the **Close** member function and destroy the `CDatabase` object."},{"content":"<bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> closes any recordsets you have not closed previously.","pos":[5546,5609],"source":"**Close** closes any recordsets you have not closed previously."},{"pos":[5616,5815],"content":"For more information about <ph id=\"ph1\">`CDatabase`</ph>, see the articles <bpt id=\"p1\">[</bpt>Data Source (ODBC)<ept id=\"p1\">](../../data/odbc/data-source-odbc.md)</ept> and <bpt id=\"p2\">[</bpt>Overview: Database Programming<ept id=\"p2\">](../../data/data-access-programming-mfc-atl.md)</ept>.","source":"For more information about `CDatabase`, see the articles [Data Source (ODBC)](../../data/odbc/data-source-odbc.md) and [Overview: Database Programming](../../data/data-access-programming-mfc-atl.md)."},{"content":"Inheritance Hierarchy","pos":[5824,5845]},{"content":"CObject","pos":[5850,5857]},{"content":"Requirements","pos":[5923,5935]},{"pos":[5939,5958],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> afxdb.h","source":"**Header:** afxdb.h"},{"pos":[6006,6027],"content":"CDatabase::BeginTrans"},{"content":"Call this member function to begin a transaction with the connected data source.","pos":[6031,6111]},{"content":"Return Value","pos":[6155,6167]},{"content":"Nonzero if the call was successful and changes are committed only manually; otherwise 0.","pos":[6171,6259]},{"content":"Remarks","pos":[6269,6276]},{"content":"A transaction consists of one or more calls to the <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept> member functions of a <ph id=\"ph2\">`CRecordset`</ph> object.","pos":[6280,6420],"source":"A transaction consists of one or more calls to the `AddNew`, **Edit**, **Delete**, and **Update** member functions of a `CRecordset` object."},{"content":"Before beginning a transaction, the <ph id=\"ph1\">`CDatabase`</ph> object must already have been connected to the data source by calling its <ph id=\"ph2\">`OpenEx`</ph> or <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> member function.","pos":[6421,6580],"source":" Before beginning a transaction, the `CDatabase` object must already have been connected to the data source by calling its `OpenEx` or **Open** member function."},{"content":"To end the transaction, call <bpt id=\"p1\">[</bpt>CommitTrans<ept id=\"p1\">](#cdatabase__committrans)</ept> to accept all changes to the data source (and carry them out) or call <bpt id=\"p2\">[</bpt>Rollback<ept id=\"p2\">](#cdatabase__rollback)</ept> to abort the entire transaction.","pos":[6581,6784],"source":" To end the transaction, call [CommitTrans](#cdatabase__committrans) to accept all changes to the data source (and carry them out) or call [Rollback](#cdatabase__rollback) to abort the entire transaction."},{"content":"Call <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> after you open any recordsets involved in the transaction and as close to the actual update operations as possible.","pos":[6785,6920],"source":" Call **BeginTrans** after you open any recordsets involved in the transaction and as close to the actual update operations as possible."},{"pos":[6928,7578],"content":"[!CAUTION]\n Depending on your ODBC driver, opening a recordset before calling **BeginTrans** may cause problems when calling **Rollback**. You should check the specific driver you are using. For example, when using the Microsoft Access driver included in the Microsoft ODBC Desktop Driver Pack 3.0, you must account for the Jet database engine's requirement that you should not begin a transaction on any database that has an open cursor. In the MFC database classes, an open cursor means an open `CRecordset` object. For more information, see [Technical Note 68](../../mfc/tn068-performing-transactions-with-the-microsoft-access-7-odbc-driver.md).","leadings":["","> "],"nodes":[{"content":" Depending on your ODBC driver, opening a recordset before calling **BeginTrans** may cause problems when calling **Rollback**. You should check the specific driver you are using. For example, when using the Microsoft Access driver included in the Microsoft ODBC Desktop Driver Pack 3.0, you must account for the Jet database engine's requirement that you should not begin a transaction on any database that has an open cursor. In the MFC database classes, an open cursor means an open `CRecordset` object. For more information, see [Technical Note 68](../../mfc/tn068-performing-transactions-with-the-microsoft-access-7-odbc-driver.md).","pos":[11,648],"nodes":[{"content":"Depending on your ODBC driver, opening a recordset before calling <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> may cause problems when calling <bpt id=\"p2\">**</bpt>Rollback<ept id=\"p2\">**</ept>.","pos":[1,127],"source":" Depending on your ODBC driver, opening a recordset before calling **BeginTrans** may cause problems when calling **Rollback**."},{"content":"You should check the specific driver you are using.","pos":[128,179]},{"content":"For example, when using the Microsoft Access driver included in the Microsoft ODBC Desktop Driver Pack 3.0, you must account for the Jet database engine's requirement that you should not begin a transaction on any database that has an open cursor.","pos":[180,427]},{"content":"In the MFC database classes, an open cursor means an open <ph id=\"ph1\">`CRecordset`</ph> object.","pos":[428,506],"source":" In the MFC database classes, an open cursor means an open `CRecordset` object."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Technical Note 68<ept id=\"p1\">](../../mfc/tn068-performing-transactions-with-the-microsoft-access-7-odbc-driver.md)</ept>.","pos":[507,637],"source":" For more information, see [Technical Note 68](../../mfc/tn068-performing-transactions-with-the-microsoft-access-7-odbc-driver.md)."}]}]},{"content":"<bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> may also lock data records on the server, depending on the requested concurrency and the capabilities of the data source.","pos":[7585,7721],"source":"**BeginTrans** may also lock data records on the server, depending on the requested concurrency and the capabilities of the data source."},{"content":"For information about locking data, see the article <bpt id=\"p1\">[</bpt>Recordset: Locking Records (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-locking-records-odbc.md)</ept>.","pos":[7722,7861],"source":" For information about locking data, see the article [Recordset: Locking Records (ODBC)](../../data/odbc/recordset-locking-records-odbc.md)."},{"pos":[7868,7981],"content":"User-defined transactions are explained in the article <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","source":"User-defined transactions are explained in the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"content":"<bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> establishes the state to which the sequence of transactions can be rolled back (reversed).","pos":[7988,8093],"source":"**BeginTrans** establishes the state to which the sequence of transactions can be rolled back (reversed)."},{"content":"To establish a new state for rollbacks, commit any current transaction, then call <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> again.","pos":[8094,8197],"source":" To establish a new state for rollbacks, commit any current transaction, then call **BeginTrans** again."},{"pos":[8205,8308],"content":"[!CAUTION]\n Calling **BeginTrans** again without calling **CommitTrans** or **Rollback** is an error.","leadings":["","> "],"nodes":[{"content":"Calling <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> again without calling <bpt id=\"p2\">**</bpt>CommitTrans<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Rollback<ept id=\"p3\">**</ept> is an error.","pos":[12,101],"source":" Calling **BeginTrans** again without calling **CommitTrans** or **Rollback** is an error."}]},{"content":"Call the <bpt id=\"p1\">[</bpt>CanTransact<ept id=\"p1\">](#cdatabase__cantransact)</ept> member function to determine whether your driver supports transactions for a given database.","pos":[8315,8455],"source":"Call the [CanTransact](#cdatabase__cantransact) member function to determine whether your driver supports transactions for a given database."},{"content":"You should also call <bpt id=\"p1\">[</bpt>GetCursorCommitBehavior<ept id=\"p1\">](#cdatabase__getcursorcommitbehavior)</ept> and <bpt id=\"p2\">[</bpt>GetCursorRollbackBehavior<ept id=\"p2\">](#cdatabase__getcursorrollbackbehavior)</ept> to determine the support for cursor preservation.","pos":[8456,8660],"source":" You should also call [GetCursorCommitBehavior](#cdatabase__getcursorcommitbehavior) and [GetCursorRollbackBehavior](#cdatabase__getcursorrollbackbehavior) to determine the support for cursor preservation."},{"pos":[8667,8782],"content":"For more information about transactions, see the article <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","source":"For more information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"content":"Example","pos":[8792,8799]},{"pos":[8804,8959],"content":"See the article <bpt id=\"p1\">[</bpt>Transaction: Performing a Transaction in a Recordset (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)</ept>.","source":"See the article [Transaction: Performing a Transaction in a Recordset (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)."},{"pos":[9011,9036],"content":"CDatabase::BindParameters"},{"pos":[9040,9162],"content":"Override <ph id=\"ph1\">`BindParameters`</ph> when you need to bind parameters before calling <bpt id=\"p1\">[</bpt>CDatabase::ExecuteSQL<ept id=\"p1\">](#cdatabase__executesql)</ept>.","source":"Override `BindParameters` when you need to bind parameters before calling [CDatabase::ExecuteSQL](#cdatabase__executesql)."},{"content":"Parameters","pos":[9229,9239]},{"content":"The ODBC statement handle for which you want to bind parameters.","pos":[9254,9318]},{"content":"Remarks","pos":[9328,9335]},{"content":"This approach is useful when you do not need the result set from a stored procedure.","pos":[9339,9423]},{"content":"In your override, call <bpt id=\"p1\">**</bpt>SQLBindParameters<ept id=\"p1\">**</ept> and related ODBC functions to bind the parameters.","pos":[9430,9525],"source":"In your override, call **SQLBindParameters** and related ODBC functions to bind the parameters."},{"content":"MFC calls your override before your call to <ph id=\"ph1\">`ExecuteSQL`</ph>.","pos":[9526,9583],"source":" MFC calls your override before your call to `ExecuteSQL`."},{"content":"You do not need to call <bpt id=\"p1\">**</bpt>SQLPrepare<ept id=\"p1\">**</ept>; <ph id=\"ph1\">`ExecuteSQL`</ph> calls <bpt id=\"p2\">**</bpt>SQLExecDirect<ept id=\"p2\">**</ept> and destroys the <bpt id=\"p3\">**</bpt>hstmt<ept id=\"p3\">**</ept>, which is used only once.","pos":[9584,9713],"source":" You do not need to call **SQLPrepare**; `ExecuteSQL` calls **SQLExecDirect** and destroys the **hstmt**, which is used only once."},{"pos":[9757,9774],"content":"CDatabase::Cancel"},{"content":"Call this member function to request that the data source cancel either an asynchronous operation in progress or a process from a second thread.","pos":[9778,9922]},{"content":"Remarks","pos":[9962,9969]},{"content":"Note that the MFC ODBC classes no longer use asynchronous processing; to perform an asychronous operation, you must directly call the ODBC API function <bpt id=\"p1\">[</bpt>SQLSetConnectOption<ept id=\"p1\">](https://msdn.microsoft.com/library/ms713564.aspx)</ept>.","pos":[9973,10197],"source":"Note that the MFC ODBC classes no longer use asynchronous processing; to perform an asychronous operation, you must directly call the ODBC API function [SQLSetConnectOption](https://msdn.microsoft.com/library/ms713564.aspx)."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Asynchronous Execution<ept id=\"p1\">](https://msdn.microsoft.com/library/ms713563.aspx)</ept> in the <ph id=\"ph1\">[!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]</ph>.","pos":[10198,10358],"source":" For more information, see [Asynchronous Execution](https://msdn.microsoft.com/library/ms713563.aspx) in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]."},{"pos":[10407,10429],"content":"CDatabase::CanTransact"},{"content":"Call this member function to determine whether the database allows transactions.","pos":[10433,10513]},{"content":"Return Value","pos":[10567,10579]},{"pos":[10583,10667],"content":"Nonzero if recordsets using this <ph id=\"ph1\">`CDatabase`</ph> object allow transactions; otherwise 0.","source":"Nonzero if recordsets using this `CDatabase` object allow transactions; otherwise 0."},{"content":"Remarks","pos":[10677,10684]},{"pos":[10688,10798],"content":"For information about transactions, see the article <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","source":"For information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"pos":[10845,10865],"content":"CDatabase::CanUpdate"},{"pos":[10869,10954],"content":"Call this member function to determine whether the <ph id=\"ph1\">`CDatabase`</ph> object allows updates.","source":"Call this member function to determine whether the `CDatabase` object allows updates."},{"content":"Return Value","pos":[11006,11018]},{"content":"Nonzero if the <ph id=\"ph1\">`CDatabase`</ph> object allows updates; otherwise 0, indicating either that you passed <bpt id=\"p1\">**</bpt>TRUE<ept id=\"p1\">**</ept> in <ph id=\"ph2\">`bReadOnly`</ph> when you opened the <ph id=\"ph3\">`CDatabase`</ph> object or that the data source itself is read-only.","pos":[11022,11226],"source":"Nonzero if the `CDatabase` object allows updates; otherwise 0, indicating either that you passed **TRUE** in `bReadOnly` when you opened the `CDatabase` object or that the data source itself is read-only."},{"content":"The data source is read-only if a call to the ODBC API function <bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept> for <bpt id=\"p2\">**</bpt>SQL_DATASOURCE_READ_ONLY<ept id=\"p2\">**</ept> returns \"y\".","pos":[11227,11351],"source":" The data source is read-only if a call to the ODBC API function **SQLGetInfo** for **SQL_DATASOURCE_READ_ONLY** returns \"y\"."},{"content":"Remarks","pos":[11361,11368]},{"content":"Not all drivers support updates.","pos":[11372,11404]},{"pos":[11451,11471],"content":"CDatabase::CDatabase"},{"pos":[11475,11507],"content":"Constructs a <ph id=\"ph1\">`CDatabase`</ph> object.","source":"Constructs a `CDatabase` object."},{"content":"Remarks","pos":[11545,11552]},{"pos":[11556,11695],"content":"After constructing the object, you must call its <ph id=\"ph1\">`OpenEx`</ph> or <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> member function to establish a connection to a specified data source.","source":"After constructing the object, you must call its `OpenEx` or **Open** member function to establish a connection to a specified data source."},{"pos":[11702,11784],"content":"You may find it convenient to embed the <ph id=\"ph1\">`CDatabase`</ph> object in your document class.","source":"You may find it convenient to embed the `CDatabase` object in your document class."},{"content":"Example","pos":[11794,11801]},{"pos":[11805,11879],"content":"This example illustrates using <ph id=\"ph1\">`CDatabase`</ph> in a <ph id=\"ph2\">`CDocument`</ph>-derived class.","source":"This example illustrates using `CDatabase` in a `CDocument`-derived class."},{"pos":[11897,11914],"content":"NVC_MFCDatabase#9"},{"pos":[11981,11999],"content":"NVC_MFCDatabase#10"},{"pos":[12093,12109],"content":"CDatabase::Close"},{"content":"Call this member function if you want to disconnect from a data source.","pos":[12113,12184]},{"content":"Remarks","pos":[12231,12238]},{"content":"You must close any recordsets associated with the <ph id=\"ph1\">`CDatabase`</ph> object before you call this member function.","pos":[12242,12348],"source":"You must close any recordsets associated with the `CDatabase` object before you call this member function."},{"content":"Because <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> does not destroy the <ph id=\"ph1\">`CDatabase`</ph> object, you can reuse the object by opening a new connection to the same data source or a different data source.","pos":[12349,12512],"source":" Because **Close** does not destroy the `CDatabase` object, you can reuse the object by opening a new connection to the same data source or a different data source."},{"content":"All pending <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> statements of recordsets using the database are canceled, and all pending transactions are rolled back.","pos":[12519,12655],"source":"All pending `AddNew` or **Edit** statements of recordsets using the database are canceled, and all pending transactions are rolled back."},{"content":"Any recordsets dependent on the <ph id=\"ph1\">`CDatabase`</ph> object are left in an undefined state.","pos":[12656,12738],"source":" Any recordsets dependent on the `CDatabase` object are left in an undefined state."},{"content":"Example","pos":[12748,12755]},{"pos":[12770,12788],"content":"NVC_MFCDatabase#12"},{"pos":[12888,12910],"content":"CDatabase::CommitTrans"},{"content":"Call this member function upon completing transactions.","pos":[12914,12969]},{"content":"Return Value","pos":[13014,13026]},{"content":"Nonzero if the updates were successfully committed; otherwise 0.","pos":[13030,13094]},{"content":"If <bpt id=\"p1\">**</bpt>CommitTrans<ept id=\"p1\">**</ept> fails, the state of the data source is undefined.","pos":[13095,13163],"source":" If **CommitTrans** fails, the state of the data source is undefined."},{"content":"You must check the data to determine its state.","pos":[13164,13211]},{"content":"Remarks","pos":[13221,13228]},{"content":"A transaction consists of a series of calls to the <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept> member functions of a <ph id=\"ph2\">`CRecordset`</ph> object that began with a call to the <bpt id=\"p4\">[</bpt>BeginTrans<ept id=\"p4\">](#cdatabase__begintrans)</ept> member function.","pos":[13232,13455],"source":"A transaction consists of a series of calls to the `AddNew`, **Edit**, **Delete**, and **Update** member functions of a `CRecordset` object that began with a call to the [BeginTrans](#cdatabase__begintrans) member function."},{"content":"<bpt id=\"p1\">**</bpt>CommitTrans<ept id=\"p1\">**</ept> commits the transaction.","pos":[13456,13496],"source":"**CommitTrans** commits the transaction."},{"content":"By default, updates are committed immediately; calling <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> causes commitment of updates to be delayed until <bpt id=\"p2\">**</bpt>CommitTrans<ept id=\"p2\">**</ept> is called.","pos":[13497,13642],"source":" By default, updates are committed immediately; calling **BeginTrans** causes commitment of updates to be delayed until **CommitTrans** is called."},{"content":"Until you call <bpt id=\"p1\">**</bpt>CommitTrans<ept id=\"p1\">**</ept> to end a transaction, you can call the <bpt id=\"p2\">[</bpt>Rollback<ept id=\"p2\">](#cdatabase__rollback)</ept> member function to abort the transaction and leave the data source in its original state.","pos":[13649,13841],"source":"Until you call **CommitTrans** to end a transaction, you can call the [Rollback](#cdatabase__rollback) member function to abort the transaction and leave the data source in its original state."},{"content":"To begin a new transaction, call <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> again.","pos":[13842,13896],"source":" To begin a new transaction, call **BeginTrans** again."},{"pos":[13903,14018],"content":"For more information about transactions, see the article <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","source":"For more information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"content":"Example","pos":[14028,14035]},{"pos":[14040,14195],"content":"See the article <bpt id=\"p1\">[</bpt>Transaction: Performing a Transaction in a Recordset (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)</ept>.","source":"See the article [Transaction: Performing a Transaction in a Recordset (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)."},{"pos":[14243,14264],"content":"CDatabase::ExecuteSQL"},{"content":"Call this member function when you need to execute a SQL command directly.","pos":[14268,14342]},{"content":"Parameters","pos":[14401,14411]},{"content":"Pointer to a null-terminated string containing a valid SQL command to execute.","pos":[14428,14506]},{"content":"You can pass a <bpt id=\"p1\">[</bpt>CString<ept id=\"p1\">](../../atl-mfc-shared/reference/cstringt-class.md)</ept>.","pos":[14507,14582],"source":" You can pass a [CString](../../atl-mfc-shared/reference/cstringt-class.md)."},{"content":"Remarks","pos":[14592,14599]},{"content":"Create the command as a null-terminated string.","pos":[14603,14650]},{"content":"does not return data records.","pos":[14664,14693]},{"content":"If you want to operate on records, use a recordset object instead.","pos":[14694,14760]},{"content":"Most of your commands for a data source are issued through recordset objects, which support commands for selecting data, inserting new records, deleting records, and editing records.","pos":[14767,14949]},{"content":"However, not all ODBC functionality is directly supported by the database classes, so you may at times need to make a direct SQL call with <ph id=\"ph1\">`ExecuteSQL`</ph>.","pos":[14950,15102],"source":" However, not all ODBC functionality is directly supported by the database classes, so you may at times need to make a direct SQL call with `ExecuteSQL`."},{"content":"Example","pos":[15112,15119]},{"pos":[15134,15152],"content":"NVC_MFCDatabase#13"},{"pos":[15263,15296],"content":"CDatabase::GetBookmarkPersistence"},{"content":"Call this member function to determine the persistence of bookmarks on a recordset object after certain operations.","pos":[15300,15415]},{"content":"Return Value","pos":[15481,15493]},{"content":"A bitmask that identifies the operations through which bookmarks persist on a recordset object.","pos":[15497,15592]},{"content":"For details, see Remarks.","pos":[15593,15618]},{"content":"Remarks","pos":[15628,15635]},{"content":"For example, if you call <ph id=\"ph1\">`CRecordset::GetBookmark`</ph> and then call <ph id=\"ph2\">`CRecordset::Requery`</ph>, the bookmark obtained from <ph id=\"ph3\">`GetBookmark`</ph> may no longer be valid.","pos":[15639,15791],"source":"For example, if you call `CRecordset::GetBookmark` and then call `CRecordset::Requery`, the bookmark obtained from `GetBookmark` may no longer be valid."},{"content":"You should call <ph id=\"ph1\">`GetBookmarkPersistence`</ph> before calling <ph id=\"ph2\">`CRecordset::SetBookmark`</ph>.","pos":[15792,15874],"source":" You should call `GetBookmarkPersistence` before calling `CRecordset::SetBookmark`."},{"pos":[15881,15996],"content":"The following table lists the bitmask values that can be combined for the return value of <ph id=\"ph1\">`GetBookmarkPersistence`</ph>.","source":"The following table lists the bitmask values that can be combined for the return value of `GetBookmarkPersistence`."},{"content":"Bitmask value","pos":[16003,16016]},{"content":"Bookmark persistence","pos":[16017,16037]},{"pos":[16108,16158],"content":"Bookmarks are valid after a <bpt id=\"p1\">**</bpt>Requery<ept id=\"p1\">**</ept> operation.","source":"Bookmarks are valid after a **Requery** operation."},{"pos":[16179,16252],"content":"The bookmark for a row is valid after a <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> operation on that row.","source":"The bookmark for a row is valid after a **Delete** operation on that row."},{"pos":[16271,16319],"content":"Bookmarks are valid after a <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> operation.","source":"Bookmarks are valid after a **Close** operation."},{"content":"Bookmarks are valid after any <bpt id=\"p1\">**</bpt>Move<ept id=\"p1\">**</ept> operation.","pos":[16340,16389],"source":"Bookmarks are valid after any **Move** operation."},{"content":"This simply identifies if bookmarks are supported on the recordset, as returned by <ph id=\"ph1\">`CRecordset::CanBookmark`</ph>.","pos":[16390,16499],"source":" This simply identifies if bookmarks are supported on the recordset, as returned by `CRecordset::CanBookmark`."},{"content":"Bookmarks are valid after a transaction is committed or rolled back.","pos":[16525,16593]},{"pos":[16614,16688],"content":"The bookmark for a row is valid after an <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> operation on that row.","source":"The bookmark for a row is valid after an **Update** operation on that row."},{"content":"Bookmarks associated with one recordset object are valid on a second recordset.","pos":[16714,16793]},{"content":"For more information about this return value, see the ODBC API function <bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept> in the <ph id=\"ph1\">[!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]</ph>.","pos":[16801,16947],"source":"For more information about this return value, see the ODBC API function **SQLGetInfo** in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]."},{"content":"For more information about bookmarks, see the article <bpt id=\"p1\">[</bpt>Recordset: Bookmarks and Absolute Positions (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-bookmarks-and-absolute-positions-odbc.md)</ept>.","pos":[16948,17123],"source":" For more information about bookmarks, see the article [Recordset: Bookmarks and Absolute Positions (ODBC)](../../data/odbc/recordset-bookmarks-and-absolute-positions-odbc.md)."},{"pos":[17171,17192],"content":"CDatabase::GetConnect"},{"pos":[17196,17354],"content":"Call this member function to retrieve the connection string used during the call to <ph id=\"ph1\">`OpenEx`</ph> or <ph id=\"ph2\">`Open`</ph> that connected the <ph id=\"ph3\">`CDatabase`</ph> object to a data source.","source":"Call this member function to retrieve the connection string used during the call to `OpenEx` or `Open` that connected the `CDatabase` object to a data source."},{"content":"Return Value","pos":[17416,17428]},{"pos":[17432,17600],"content":"A <ph id=\"ph1\">`const`</ph><bpt id=\"p1\">[</bpt>CString<ept id=\"p1\">](../../atl-mfc-shared/reference/cstringt-class.md)</ept> containing the connection string if <ph id=\"ph2\">`OpenEx`</ph> or <ph id=\"ph3\">`Open`</ph> has been called; otherwise, an empty string.","source":"A `const`[CString](../../atl-mfc-shared/reference/cstringt-class.md) containing the connection string if `OpenEx` or `Open` has been called; otherwise, an empty string."},{"content":"Remarks","pos":[17610,17617]},{"pos":[17621,17719],"content":"See <bpt id=\"p1\">[</bpt>CDatabase::Open<ept id=\"p1\">](#cdatabase__open)</ept> for a description of how the connection string is created.","source":"See [CDatabase::Open](#cdatabase__open) for a description of how the connection string is created."},{"pos":[17780,17814],"content":"CDatabase::GetCursorCommitBehavior"},{"pos":[17818,17954],"content":"Call this member function to determine how a <bpt id=\"p1\">[</bpt>CommitTrans<ept id=\"p1\">](#cdatabase__committrans)</ept> operation affects cursors on open recordset objects.","source":"Call this member function to determine how a [CommitTrans](#cdatabase__committrans) operation affects cursors on open recordset objects."},{"content":"Return Value","pos":[18019,18031]},{"content":"A value indicating the effect of transactions on open recordset objects.","pos":[18035,18107]},{"content":"For details, see Remarks.","pos":[18108,18133]},{"content":"Remarks","pos":[18143,18150]},{"pos":[18154,18288],"content":"The following table lists the possible return values for <ph id=\"ph1\">`GetCursorCommitBehavior`</ph> and the corresponding effect on the open recordset.","source":"The following table lists the possible return values for `GetCursorCommitBehavior` and the corresponding effect on the open recordset."},{"content":"Return value","pos":[18295,18307]},{"content":"Effect on CRecordset objects","pos":[18308,18336]},{"pos":[18414,18486],"content":"Call <ph id=\"ph1\">`CRecordset::Requery`</ph> immediately following the transaction commit.","source":"Call `CRecordset::Requery` immediately following the transaction commit."},{"pos":[18507,18577],"content":"Call <ph id=\"ph1\">`CRecordset::Close`</ph> immediately following the transaction commit.","source":"Call `CRecordset::Close` immediately following the transaction commit."},{"pos":[18600,18646],"content":"Proceed normally with <ph id=\"ph1\">`CRecordset`</ph> operations.","source":"Proceed normally with `CRecordset` operations."},{"content":"For more information about this return value, see the ODBC API function <bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept> in the <ph id=\"ph1\">[!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]</ph>.","pos":[18654,18800],"source":"For more information about this return value, see the ODBC API function **SQLGetInfo** in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]."},{"content":"For more information about transactions, see the article <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","pos":[18801,18916],"source":" For more information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"pos":[18979,19015],"content":"CDatabase::GetCursorRollbackBehavior"},{"pos":[19019,19149],"content":"Call this member function to determine how a <bpt id=\"p1\">[</bpt>Rollback<ept id=\"p1\">](#cdatabase__rollback)</ept> operation affects cursors on open recordset objects.","source":"Call this member function to determine how a [Rollback](#cdatabase__rollback) operation affects cursors on open recordset objects."},{"content":"Return Value","pos":[19216,19228]},{"content":"A value indicating the effect of transactions on open recordset objects.","pos":[19232,19304]},{"content":"For details, see Remarks.","pos":[19305,19330]},{"content":"Remarks","pos":[19340,19347]},{"pos":[19351,19487],"content":"The following table lists the possible return values for <ph id=\"ph1\">`GetCursorRollbackBehavior`</ph> and the corresponding effect on the open recordset.","source":"The following table lists the possible return values for `GetCursorRollbackBehavior` and the corresponding effect on the open recordset."},{"content":"Return value","pos":[19494,19506]},{"content":"Effect on CRecordset objects","pos":[19507,19535]},{"pos":[19613,19687],"content":"Call <ph id=\"ph1\">`CRecordset::Requery`</ph> immediately following the transaction rollback.","source":"Call `CRecordset::Requery` immediately following the transaction rollback."},{"pos":[19708,19780],"content":"Call <ph id=\"ph1\">`CRecordset::Close`</ph> immediately following the transaction rollback.","source":"Call `CRecordset::Close` immediately following the transaction rollback."},{"pos":[19803,19849],"content":"Proceed normally with <ph id=\"ph1\">`CRecordset`</ph> operations.","source":"Proceed normally with `CRecordset` operations."},{"content":"For more information about this return value, see the ODBC API function <bpt id=\"p1\">**</bpt>SQLGetInfo<ept id=\"p1\">**</ept> in the <ph id=\"ph1\">[!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]</ph>.","pos":[19857,20003],"source":"For more information about this return value, see the ODBC API function **SQLGetInfo** in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]."},{"content":"For more information about transactions, see the article <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","pos":[20004,20119],"source":" For more information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"pos":[20172,20198],"content":"CDatabase::GetDatabaseName"},{"content":"Call this member function to retrieve the name of the currently connected database (provided that the data source defines a named object called \"database\").","pos":[20202,20358]},{"content":"Return Value","pos":[20419,20431]},{"pos":[20435,20571],"content":"A <bpt id=\"p1\">[</bpt>CString<ept id=\"p1\">](../../atl-mfc-shared/reference/cstringt-class.md)</ept> containing the database name if successful; otherwise, an empty <ph id=\"ph1\">`CString`</ph>.","source":"A [CString](../../atl-mfc-shared/reference/cstringt-class.md) containing the database name if successful; otherwise, an empty `CString`."},{"content":"Remarks","pos":[20581,20588]},{"content":"This is not the same as the data source name (DSN) specified in the <ph id=\"ph1\">`OpenEx`</ph> or <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> call.","pos":[20592,20686],"source":"This is not the same as the data source name (DSN) specified in the `OpenEx` or **Open** call."},{"content":"What <ph id=\"ph1\">`GetDatabaseName`</ph> returns depends on ODBC.","pos":[20687,20734],"source":" What `GetDatabaseName` returns depends on ODBC."},{"content":"In general, a database is a collection of tables.","pos":[20735,20784]},{"content":"If this entity has a name, <ph id=\"ph1\">`GetDatabaseName`</ph> returns it.","pos":[20785,20841],"source":" If this entity has a name, `GetDatabaseName` returns it."},{"content":"You might, for example, want to display this name in a heading.","pos":[20848,20911]},{"content":"If an error occurs while retrieving the name from ODBC, <ph id=\"ph1\">`GetDatabaseName`</ph> returns an empty <bpt id=\"p1\">**</bpt>Cstring<ept id=\"p1\">**</ept>.","pos":[20912,21015],"source":" If an error occurs while retrieving the name from ODBC, `GetDatabaseName` returns an empty **Cstring**."},{"pos":[21059,21076],"content":"CDatabase::IsOpen"},{"pos":[21080,21190],"content":"Call this member function to determine whether the <ph id=\"ph1\">`CDatabase`</ph> object is currently connected to a data source.","source":"Call this member function to determine whether the `CDatabase` object is currently connected to a data source."},{"content":"Return Value","pos":[21239,21251]},{"pos":[21255,21325],"content":"Nonzero if the <ph id=\"ph1\">`CDatabase`</ph> object is currently connected; otherwise 0.","source":"Nonzero if the `CDatabase` object is currently connected; otherwise 0."},{"pos":[21369,21386],"content":"CDatabase::m_hdbc"},{"content":"Contains a public handle to an ODBC data source connection â€” a \"connection handle.\"","pos":[21390,21475]},{"content":"Remarks","pos":[21485,21492]},{"content":"Normally, you will have no need to access this member variable directly.","pos":[21496,21568]},{"content":"Instead, the framework allocates the handle when you call <ph id=\"ph1\">`OpenEx`</ph> or <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>.","pos":[21569,21648],"source":" Instead, the framework allocates the handle when you call `OpenEx` or **Open**."},{"content":"The framework deallocates the handle when you call the <bpt id=\"p1\">**</bpt>delete<ept id=\"p1\">**</ept> operator on the <ph id=\"ph1\">`CDatabase`</ph> object.","pos":[21649,21750],"source":" The framework deallocates the handle when you call the **delete** operator on the `CDatabase` object."},{"content":"Note that the <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> member function does not deallocate the handle.","pos":[21751,21822],"source":" Note that the **Close** member function does not deallocate the handle."},{"content":"Under some circumstances, however, you may need to use the handle directly.","pos":[21829,21904]},{"content":"For example, if you need to call ODBC API functions directly rather than through class <ph id=\"ph1\">`CDatabase`</ph>, you may need a connection handle to pass as a parameter.","pos":[21905,22061],"source":" For example, if you need to call ODBC API functions directly rather than through class `CDatabase`, you may need a connection handle to pass as a parameter."},{"content":"See the code example below.","pos":[22062,22089]},{"content":"Example","pos":[22099,22106]},{"pos":[22121,22139],"content":"NVC_MFCDatabase#15"},{"pos":[22240,22263],"content":"CDatabase::OnSetOptions"},{"pos":[22267,22386],"content":"The framework calls this member function when directly executing a SQL statement with the <ph id=\"ph1\">`ExecuteSQL`</ph> member function.","source":"The framework calls this member function when directly executing a SQL statement with the `ExecuteSQL` member function."},{"content":"Parameters","pos":[22451,22461]},{"content":"The ODBC statement handle for which options are being set.","pos":[22476,22534]},{"content":"Remarks","pos":[22544,22551]},{"pos":[22582,22614],"content":"also calls this member function."},{"content":"sets the login timeout value.","pos":[22636,22665]},{"content":"If there have been previous calls to the <ph id=\"ph1\">`SetQueryTimeout`</ph> and member function, <ph id=\"ph2\">`OnSetOptions`</ph> reflects the current values; otherwise, it sets default values.","pos":[22666,22824],"source":" If there have been previous calls to the `SetQueryTimeout` and member function, `OnSetOptions` reflects the current values; otherwise, it sets default values."},{"pos":[22832,23105],"content":"[!NOTE]\n Prior to MFC 4.2, `OnSetOptions` also set the processing mode to either snychronous or asynchronous. Beginning with MFC 4.2, all operations are synchronous. To perform an asynchronous operation, you must make a direct call to the ODBC API function **SQLSetPos**.","leadings":["","> "],"nodes":[{"content":" Prior to MFC 4.2, `OnSetOptions` also set the processing mode to either snychronous or asynchronous. Beginning with MFC 4.2, all operations are synchronous. To perform an asynchronous operation, you must make a direct call to the ODBC API function **SQLSetPos**.","pos":[8,271],"nodes":[{"content":"Prior to MFC 4.2, <ph id=\"ph1\">`OnSetOptions`</ph> also set the processing mode to either snychronous or asynchronous.","pos":[1,101],"source":" Prior to MFC 4.2, `OnSetOptions` also set the processing mode to either snychronous or asynchronous."},{"content":"Beginning with MFC 4.2, all operations are synchronous.","pos":[102,157]},{"content":"To perform an asynchronous operation, you must make a direct call to the ODBC API function <bpt id=\"p1\">**</bpt>SQLSetPos<ept id=\"p1\">**</ept>.","pos":[158,263],"source":" To perform an asynchronous operation, you must make a direct call to the ODBC API function **SQLSetPos**."}]}]},{"content":"You do not need to override <ph id=\"ph1\">`OnSetOptions`</ph> to change the timeout value.","pos":[23112,23183],"source":"You do not need to override `OnSetOptions` to change the timeout value."},{"content":"Instead, to customize the query timeout value, call <ph id=\"ph1\">`SetQueryTimeout`</ph> before creating a recordset; <ph id=\"ph2\">`OnSetOptions`</ph> will use the new value.","pos":[23184,23321],"source":" Instead, to customize the query timeout value, call `SetQueryTimeout` before creating a recordset; `OnSetOptions` will use the new value."},{"content":"The values set apply to subsequent operations on all recordsets or direct SQL calls.","pos":[23322,23406]},{"content":"Override <ph id=\"ph1\">`OnSetOptions`</ph> if you want to set additional options.","pos":[23413,23475],"source":"Override `OnSetOptions` if you want to set additional options."},{"content":"Your override should call the base class <ph id=\"ph1\">`OnSetOptions`</ph> either before or after you call the ODBC API function <bpt id=\"p1\">**</bpt>SQLSetStmtOption<ept id=\"p1\">**</ept>.","pos":[23476,23607],"source":" Your override should call the base class `OnSetOptions` either before or after you call the ODBC API function **SQLSetStmtOption**."},{"content":"Follow the method illustrated in the framework's default implementation of <ph id=\"ph1\">`OnSetOptions`</ph>.","pos":[23608,23698],"source":" Follow the method illustrated in the framework's default implementation of `OnSetOptions`."},{"pos":[23740,23755],"content":"CDatabase::Open"},{"pos":[23759,23838],"content":"Call this member function to initialize a newly constructed <ph id=\"ph1\">`CDatabase`</ph> object.","source":"Call this member function to initialize a newly constructed `CDatabase` object."},{"content":"Parameters","pos":[24039,24049]},{"content":"Specifies a data source name â€” a name registered with ODBC through the ODBC Administrator program.","pos":[24066,24166]},{"content":"If a DSN value is specified in <ph id=\"ph1\">`lpszConnect`</ph> (in the form \"DSN=<ph id=\"ph2\">\\&lt;</ph>data-source&gt;\"), it must not be specified again in <ph id=\"ph3\">`lpszDSN`</ph>.","pos":[24167,24292],"source":" If a DSN value is specified in `lpszConnect` (in the form \"DSN=\\<data-source>\"), it must not be specified again in `lpszDSN`."},{"content":"In this case, <ph id=\"ph1\">`lpszDSN`</ph> should be <bpt id=\"p1\">**</bpt>NULL<ept id=\"p1\">**</ept>.","pos":[24293,24336],"source":" In this case, `lpszDSN` should be **NULL**."},{"content":"Otherwise, you can pass <bpt id=\"p1\">**</bpt>NULL<ept id=\"p1\">**</ept> if you want to present the user with a Data Source dialog box in which the user can select a data source.","pos":[24337,24475],"source":" Otherwise, you can pass **NULL** if you want to present the user with a Data Source dialog box in which the user can select a data source."},{"content":"For further information, see Remarks.","pos":[24476,24513]},{"content":"Not supported in this version of the class library.","pos":[24536,24587]},{"content":"Currently, an assertion fails if this parameter is <bpt id=\"p1\">**</bpt>TRUE<ept id=\"p1\">**</ept>.","pos":[24588,24648],"source":" Currently, an assertion fails if this parameter is **TRUE**."},{"content":"The data source is always opened as shared (not exclusive).","pos":[24649,24708]},{"content":"<bpt id=\"p1\"> **</bpt>TRUE<ept id=\"p1\">**</ept> if you intend the connection to be read-only and to prohibit updates to the data source.","pos":[24729,24827],"source":" **TRUE** if you intend the connection to be read-only and to prohibit updates to the data source."},{"content":"All dependent recordsets inherit this attribute.","pos":[24828,24876]},{"content":"The default value is <bpt id=\"p1\">**</bpt>FALSE<ept id=\"p1\">**</ept>.","pos":[24877,24908],"source":" The default value is **FALSE**."},{"content":"Specifies a connection string.","pos":[24932,24962]},{"content":"The connection string concatenates information, possibly including a data source name, a user ID valid on the data source, a user authentication string (password, if the data source requires one), and other information.","pos":[24963,25182]},{"content":"The whole connection string must be prefixed by the string \"ODBC;\" (uppercase or lowercase).","pos":[25183,25275]},{"content":"The \"ODBC;\" string is used to indicate that the connection is to an ODBC data source; this is for upward compatibility when future versions of the class library might support non-ODBC data sources.","pos":[25276,25473]},{"content":"<bpt id=\"p1\"> **</bpt>TRUE<ept id=\"p1\">**</ept> if you want the ODBC Cursor Library DLL to be loaded.","pos":[25498,25561],"source":" **TRUE** if you want the ODBC Cursor Library DLL to be loaded."},{"content":"The cursor library masks some functionality of the underlying ODBC driver, effectively preventing the use of dynasets (if the driver supports them).","pos":[25562,25710]},{"content":"The only cursors supported if the cursor library is loaded are static snapshots and forward-only cursors.","pos":[25711,25816]},{"content":"The default value is <bpt id=\"p1\">**</bpt>TRUE<ept id=\"p1\">**</ept>.","pos":[25817,25847],"source":" The default value is **TRUE**."},{"content":"If you plan to create a recordset object directly from <ph id=\"ph1\">`CRecordset`</ph> without deriving from it, you should not load the cursor library.","pos":[25848,25981],"source":" If you plan to create a recordset object directly from `CRecordset` without deriving from it, you should not load the cursor library."},{"content":"Return Value","pos":[25991,26003]},{"content":"Nonzero if the connection is successfully made; otherwise 0 if the user chooses Cancel when presented a dialog box asking for more connection information.","pos":[26007,26161]},{"content":"In all other cases, the framework throws an exception.","pos":[26162,26216]},{"content":"Remarks","pos":[26226,26233]},{"content":"Your database object must be initialized before you can use it to construct a recordset object.","pos":[26237,26332]},{"pos":[26340,26493],"content":"[!NOTE]\n Calling the [OpenEx](#cdatabase__openex) member function is the preferred way to connect to a data source and initialize your database object.","leadings":["","> "],"nodes":[{"content":"Calling the <bpt id=\"p1\">[</bpt>OpenEx<ept id=\"p1\">](#cdatabase__openex)</ept> member function is the preferred way to connect to a data source and initialize your database object.","pos":[9,151],"source":" Calling the [OpenEx](#cdatabase__openex) member function is the preferred way to connect to a data source and initialize your database object."}]},{"content":"If the parameters in your <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> call do not contain enough information to make the connection, the ODBC driver opens a dialog box to obtain the necessary information from the user.","pos":[26500,26683],"source":"If the parameters in your **Open** call do not contain enough information to make the connection, the ODBC driver opens a dialog box to obtain the necessary information from the user."},{"content":"When you call <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>, your connection string, <ph id=\"ph1\">`lpszConnect`</ph>, is stored privately in the <ph id=\"ph2\">`CDatabase`</ph> object and is available by calling the <bpt id=\"p2\">[</bpt>GetConnect<ept id=\"p2\">](#cdatabase__getconnect)</ept> member function.","pos":[26684,26878],"source":" When you call **Open**, your connection string, `lpszConnect`, is stored privately in the `CDatabase` object and is available by calling the [GetConnect](#cdatabase__getconnect) member function."},{"content":"If you wish, you can open your own dialog box before you call <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> to get information from the user, such as a password, then add that information to the connection string you pass to <bpt id=\"p2\">**</bpt>Open<ept id=\"p2\">**</ept>.","pos":[26885,27082],"source":"If you wish, you can open your own dialog box before you call **Open** to get information from the user, such as a password, then add that information to the connection string you pass to **Open**."},{"content":"Or you might want to save the connection string you pass so you can reuse it the next time your application calls <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> on a <ph id=\"ph1\">`CDatabase`</ph> object.","pos":[27083,27230],"source":" Or you might want to save the connection string you pass so you can reuse it the next time your application calls **Open** on a `CDatabase` object."},{"content":"You can also use the connection string for multiple levels of login authorization (each for a different <ph id=\"ph1\">`CDatabase`</ph> object) or to convey other data source-specific information.","pos":[27237,27413],"source":"You can also use the connection string for multiple levels of login authorization (each for a different `CDatabase` object) or to convey other data source-specific information."},{"content":"For more information about connection strings, see Chapter 5 in the <ph id=\"ph1\">[!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]</ph>.","pos":[27414,27534],"source":" For more information about connection strings, see Chapter 5 in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]."},{"content":"It is possible for a connection attempt to time out if, for example, the DBMS host is unavailable.","pos":[27541,27639]},{"content":"If the connection attempt fails, <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> throws a <ph id=\"ph1\">`CDBException`</ph>.","pos":[27640,27706],"source":" If the connection attempt fails, **Open** throws a `CDBException`."},{"content":"Example","pos":[27716,27723]},{"pos":[27738,27756],"content":"NVC_MFCDatabase#14"},{"pos":[27851,27868],"content":"CDatabase::OpenEx"},{"pos":[27872,27951],"content":"Call this member function to initialize a newly constructed <ph id=\"ph1\">`CDatabase`</ph> object.","source":"Call this member function to initialize a newly constructed `CDatabase` object."},{"content":"Parameters","pos":[28056,28066]},{"content":"Specifies an ODBC connection string.","pos":[28093,28129]},{"content":"This includes the data source name as well as other optional information, such as a user ID and password.","pos":[28130,28235]},{"content":"For example, \"DSN=SQLServer_Source;UID=SA;PWD=abc123\" is a possible connection string.","pos":[28236,28322]},{"content":"Note that if you pass <bpt id=\"p1\">**</bpt>NULL<ept id=\"p1\">**</ept> for <ph id=\"ph1\">`lpszConnectString`</ph>, a Data Source dialog box will prompt the user to select a data source.","pos":[28323,28449],"source":" Note that if you pass **NULL** for `lpszConnectString`, a Data Source dialog box will prompt the user to select a data source."},{"content":"A bitmask which specifies a combination of the following values.","pos":[28471,28535]},{"content":"The default value is 0, meaning that the database will be opened as shared with write access, the ODBC Cursor Library DLL will not be loaded, and the ODBC connection dialog box will display only if there is not enough information to make the connection.","pos":[28536,28789]},{"content":"<bpt id=\"p1\">**</bpt>CDatabase::openExclusive<ept id=\"p1\">**</ept> Not supported in this version of the class library.","pos":[28797,28877],"source":"**CDatabase::openExclusive** Not supported in this version of the class library."},{"content":"A data source is always opened as shared (not exclusive).","pos":[28878,28935]},{"content":"Currently, an assertion fails if you specify this option.","pos":[28936,28993]},{"pos":[29001,29063],"content":"<bpt id=\"p1\">**</bpt>CDatabase::openReadOnly<ept id=\"p1\">**</ept> Open the data source as read-only.","source":"**CDatabase::openReadOnly** Open the data source as read-only."},{"content":"<bpt id=\"p1\">**</bpt>CDatabase::useCursorLib<ept id=\"p1\">**</ept> Load the ODBC Cursor Library DLL.","pos":[29071,29132],"source":"**CDatabase::useCursorLib** Load the ODBC Cursor Library DLL."},{"content":"The cursor library masks some functionality of the underlying ODBC driver, effectively preventing the use of dynasets (if the driver supports them).","pos":[29133,29281]},{"content":"The only cursors supported if the cursor library is loaded are static snapshots and forward-only cursors.","pos":[29282,29387]},{"content":"If you plan to create a recordset object directly from <ph id=\"ph1\">`CRecordset`</ph> without deriving from it, you should not load the cursor library.","pos":[29388,29521],"source":" If you plan to create a recordset object directly from `CRecordset` without deriving from it, you should not load the cursor library."},{"pos":[29529,29668],"content":"<bpt id=\"p1\">**</bpt>CDatabase::noOdbcDialog<ept id=\"p1\">**</ept> Do not display the ODBC connection dialog box, regardless of whether enough connection information is supplied.","source":"**CDatabase::noOdbcDialog** Do not display the ODBC connection dialog box, regardless of whether enough connection information is supplied."},{"pos":[29676,29753],"content":"<bpt id=\"p1\">**</bpt>CDatabase::forceOdbcDialog<ept id=\"p1\">**</ept> Always display the ODBC connection dialog box.","source":"**CDatabase::forceOdbcDialog** Always display the ODBC connection dialog box."},{"content":"Return Value","pos":[29763,29775]},{"content":"Nonzero if the connection is successfully made; otherwise 0 if the user chooses Cancel when presented a dialog box asking for more connection information.","pos":[29779,29933]},{"content":"In all other cases, the framework throws an exception.","pos":[29934,29988]},{"content":"Remarks","pos":[29998,30005]},{"content":"Your database object must be initialized before you can use it to construct a recordset object.","pos":[30009,30104]},{"content":"If the <ph id=\"ph1\">`lpszConnectString`</ph> parameter in your <ph id=\"ph2\">`OpenEx`</ph> call does not contain enough information to make the connection, the ODBC driver opens a dialog box to obtain the necessary information from the user, provided you have not set <bpt id=\"p1\">**</bpt>CDatabase::noOdbcDialog<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>CDatabase::forceOdbcDialog<ept id=\"p2\">**</ept> in the <ph id=\"ph3\">`dwOptions`</ph> parameter.","pos":[30111,30433],"source":"If the `lpszConnectString` parameter in your `OpenEx` call does not contain enough information to make the connection, the ODBC driver opens a dialog box to obtain the necessary information from the user, provided you have not set **CDatabase::noOdbcDialog** or **CDatabase::forceOdbcDialog** in the `dwOptions` parameter."},{"content":"When you call <ph id=\"ph1\">`OpenEx`</ph>, your connection string, <ph id=\"ph2\">`lpszConnectString`</ph>, is stored privately in the <ph id=\"ph3\">`CDatabase`</ph> object and is available by calling the <bpt id=\"p1\">[</bpt>GetConnect<ept id=\"p1\">](#cdatabase__getconnect)</ept> member function.","pos":[30434,30634],"source":" When you call `OpenEx`, your connection string, `lpszConnectString`, is stored privately in the `CDatabase` object and is available by calling the [GetConnect](#cdatabase__getconnect) member function."},{"content":"If you wish, you can open your own dialog box before you call <ph id=\"ph1\">`OpenEx`</ph> to get information from the user, such as a password, and then add that information to the connection string you pass to <ph id=\"ph2\">`OpenEx`</ph>.","pos":[30641,30842],"source":"If you wish, you can open your own dialog box before you call `OpenEx` to get information from the user, such as a password, and then add that information to the connection string you pass to `OpenEx`."},{"content":"Or you might want to save the connection string you pass so you can reuse it the next time your application calls <ph id=\"ph1\">`OpenEx`</ph> on a <ph id=\"ph2\">`CDatabase`</ph> object.","pos":[30843,30990],"source":" Or you might want to save the connection string you pass so you can reuse it the next time your application calls `OpenEx` on a `CDatabase` object."},{"content":"You can also use the connection string for multiple levels of login authorization (each for a different <ph id=\"ph1\">`CDatabase`</ph> object) or to convey other data source-specific information.","pos":[30997,31173],"source":"You can also use the connection string for multiple levels of login authorization (each for a different `CDatabase` object) or to convey other data source-specific information."},{"content":"For more information about connection strings, see Chapter 6 in the <bpt id=\"p1\">*</bpt>ODBC Programmer's Reference<ept id=\"p1\">*</ept>.","pos":[31174,31272],"source":" For more information about connection strings, see Chapter 6 in the *ODBC Programmer's Reference*."},{"content":"It is possible for a connection attempt to time out if, for example, the DBMS host is unavailable.","pos":[31279,31377]},{"content":"If the connection attempt fails, <ph id=\"ph1\">`OpenEx`</ph> throws a <ph id=\"ph2\">`CDBException`</ph>.","pos":[31378,31444],"source":" If the connection attempt fails, `OpenEx` throws a `CDBException`."},{"content":"Example","pos":[31454,31461]},{"pos":[31476,31494],"content":"NVC_MFCDatabase#11"},{"pos":[31591,31610],"content":"CDatabase::Rollback"},{"content":"Call this member function to reverse the changes made during a transaction.","pos":[31614,31689]},{"content":"Return Value","pos":[31731,31743]},{"content":"Nonzero if the transaction was successfully reversed; otherwise 0.","pos":[31747,31813]},{"content":"If a <bpt id=\"p1\">**</bpt>Rollback<ept id=\"p1\">**</ept> call fails, the data source and transaction states are undefined.","pos":[31814,31897],"source":" If a **Rollback** call fails, the data source and transaction states are undefined."},{"content":"If <bpt id=\"p1\">**</bpt>Rollback<ept id=\"p1\">**</ept> returns 0, you must check the data source to determine its state.","pos":[31898,31979],"source":" If **Rollback** returns 0, you must check the data source to determine its state."},{"content":"Remarks","pos":[31989,31996]},{"pos":[32000,32197],"content":"All <ph id=\"ph1\">`CRecordset``AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept> calls executed since the last <bpt id=\"p4\">[</bpt>BeginTrans<ept id=\"p4\">](#cdatabase__begintrans)</ept> are rolled back to the state that existed at the time of that call.","source":"All `CRecordset``AddNew`, **Edit**, **Delete**, and **Update** calls executed since the last [BeginTrans](#cdatabase__begintrans) are rolled back to the state that existed at the time of that call."},{"content":"After a call to <bpt id=\"p1\">**</bpt>Rollback<ept id=\"p1\">**</ept>, the transaction is over, and you must call <bpt id=\"p2\">**</bpt>BeginTrans<ept id=\"p2\">**</ept> again for another transaction.","pos":[32204,32322],"source":"After a call to **Rollback**, the transaction is over, and you must call **BeginTrans** again for another transaction."},{"content":"The record that was current before you called <bpt id=\"p1\">**</bpt>BeginTrans<ept id=\"p1\">**</ept> becomes the current record again after <bpt id=\"p2\">**</bpt>Rollback<ept id=\"p2\">**</ept>.","pos":[32323,32436],"source":" The record that was current before you called **BeginTrans** becomes the current record again after **Rollback**."},{"content":"After a rollback, the record that was current before the rollback remains current.","pos":[32443,32525]},{"content":"For details about the state of the recordset and the data source after a rollback, see the article <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","pos":[32526,32683],"source":" For details about the state of the recordset and the data source after a rollback, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"content":"Example","pos":[32693,32700]},{"pos":[32705,32860],"content":"See the article <bpt id=\"p1\">[</bpt>Transaction: Performing a Transaction in a Recordset (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)</ept>.","source":"See the article [Transaction: Performing a Transaction in a Recordset (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)."},{"pos":[32913,32939],"content":"CDatabase::SetLoginTimeout"},{"pos":[32943,33117],"content":"Call this member function â€” before you call <ph id=\"ph1\">`OpenEx`</ph> or <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> â€” to override the default number of seconds allowed before an attempted data source connection times out.","source":"Call this member function â€” before you call `OpenEx` or **Open** â€” to override the default number of seconds allowed before an attempted data source connection times out."},{"content":"Parameters","pos":[33181,33191]},{"content":"The number of seconds to allow before a connection attempt times out.","pos":[33210,33279]},{"content":"Remarks","pos":[33289,33296]},{"content":"A connection attempt might time out if, for example, the DBMS is not available.","pos":[33300,33379]},{"content":"Call <bpt id=\"p1\">**</bpt>SetLoginTimeout<ept id=\"p1\">**</ept> after you construct the uninitialized <ph id=\"ph1\">`CDatabase`</ph> object but before you call <ph id=\"ph2\">`OpenEx`</ph> or <bpt id=\"p2\">**</bpt>Open<ept id=\"p2\">**</ept>.","pos":[33380,33503],"source":" Call **SetLoginTimeout** after you construct the uninitialized `CDatabase` object but before you call `OpenEx` or **Open**."},{"content":"The default value for login timeouts is 15 seconds.","pos":[33510,33561]},{"content":"Not all data sources support the ability to specify a login timeout value.","pos":[33562,33636]},{"content":"If the data source does not support timeout, you get trace output but not an exception.","pos":[33637,33724]},{"content":"A value of 0 means \"infinite.\"","pos":[33725,33755]},{"pos":[33808,33834],"content":"CDatabase::SetQueryTimeout"},{"content":"Call this member function to override the default number of seconds to allow before subsequent operations on the connected data source time out.","pos":[33838,33982]},{"content":"Parameters","pos":[34046,34056]},{"content":"The number of seconds to allow before a query attempt times out.","pos":[34075,34139]},{"content":"Remarks","pos":[34149,34156]},{"content":"An operation might time out due to network access problems, excessive query processing time, and so on.","pos":[34160,34263]},{"content":"Call <ph id=\"ph1\">`SetQueryTimeout`</ph> prior to opening your recordset or prior to calling the recordset's <ph id=\"ph2\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept> member functions if you want to change the query timeout value.","pos":[34264,34453],"source":" Call `SetQueryTimeout` prior to opening your recordset or prior to calling the recordset's `AddNew`, **Update** or **Delete** member functions if you want to change the query timeout value."},{"content":"The setting affects all subsequent <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>, <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Delete<ept id=\"p3\">**</ept> calls to any recordsets associated with this <ph id=\"ph2\">`CDatabase`</ph> object.","pos":[34454,34600],"source":" The setting affects all subsequent **Open**, `AddNew`, **Update**, and **Delete** calls to any recordsets associated with this `CDatabase` object."},{"content":"Changing the query timeout value for a recordset after opening does not change the value for the recordset.","pos":[34601,34708]},{"content":"For example, subsequent <bpt id=\"p1\">**</bpt>Move<ept id=\"p1\">**</ept> operations do not use the new value.","pos":[34709,34778],"source":" For example, subsequent **Move** operations do not use the new value."},{"content":"The default value for query timeouts is 15 seconds.","pos":[34785,34836]},{"content":"Not all data sources support the ability to set a query timeout value.","pos":[34837,34907]},{"content":"If you set a query timeout value of 0, no timeout occurs; the communication with the data source may stop responding.","pos":[34908,35025]},{"content":"This behavior may be useful during development.","pos":[35026,35073]},{"content":"If the data source does not support timeout, you get trace output but not an exception.","pos":[35074,35161]},{"content":"See Also","pos":[35170,35178]},{"content":"CObject Class","pos":[35183,35196]},{"content":"Hierarchy Chart","pos":[35241,35256]},{"content":"CRecordset Class","pos":[35293,35309]}],"content":"---\ntitle: \"CDatabase Class | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\nf1_keywords: \n  - \"CDatabase\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"database classes [C++], ODBC\"\n  - \"MFC [C++], ODBC\"\n  - \"ODBC [C++], CDatabase class\"\n  - \"ODBC database class\"\n  - \"database connections [C++], CDatabase class\"\n  - \"CDatabase class\"\nms.assetid: bd0de70a-e3c3-4441-bcaa-bbf434426ca8\ncaps.latest.revision: 24\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# CDatabase Class\nRepresents a connection to a data source, through which you can operate on the data source.  \n  \n## Syntax  \n  \n```  \nclass CDatabase : public CObject  \n```  \n  \n## Members  \n  \n### Public Constructors  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CDatabase::CDatabase](#cdatabase__cdatabase)|Constructs a `CDatabase` object. You must initialize the object by calling `OpenEx` or **Open**.|  \n  \n### Public Methods  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CDatabase::BeginTrans](#cdatabase__begintrans)|Starts a \"transaction\" â€” a series of reversible calls to the `AddNew`, **Edit**, **Delete**, and **Update** member functions of class `CRecordset` â€” on the connected data source. The data source must support transactions for **BeginTrans** to have any effect.|  \n|[CDatabase::BindParameters](#cdatabase__bindparameters)|Allows you to bind parameters before calling `CDatabase::ExecuteSQL`.|  \n|[CDatabase::Cancel](#cdatabase__cancel)|Cancels an asynchronous operation or a process from a second thread.|  \n|[CDatabase::CanTransact](#cdatabase__cantransact)|Returns nonzero if the data source supports transactions.|  \n|[CDatabase::CanUpdate](#cdatabase__canupdate)|Returns nonzero if the `CDatabase` object is updatable (not read-only).|  \n|[CDatabase::Close](#cdatabase__close)|Closes the data source connection.|  \n|[CDatabase::CommitTrans](#cdatabase__committrans)|Completes a transaction begun by **BeginTrans**. Commands in the transaction that alter the data source are carried out.|  \n|[CDatabase::ExecuteSQL](#cdatabase__executesql)|Executes a SQL statement. No data records are returned.|  \n|[CDatabase::GetBookmarkPersistence](#cdatabase__getbookmarkpersistence)|Identifies the operations through which bookmarks persist on recordset objects.|  \n|[CDatabase::GetConnect](#cdatabase__getconnect)|Returns the ODBC connection string used to connect the `CDatabase` object to a data source.|  \n|[CDatabase::GetCursorCommitBehavior](#cdatabase__getcursorcommitbehavior)|Identifies the effect of committing a transaction on an open recordset object.|  \n|[CDatabase::GetCursorRollbackBehavior](#cdatabase__getcursorrollbackbehavior)|Identifies the effect of rolling back a transaction on an open recordset object.|  \n|[CDatabase::GetDatabaseName](#cdatabase__getdatabasename)|Returns the name of the database currently in use.|  \n|[CDatabase::IsOpen](#cdatabase__isopen)|Returns nonzero if the `CDatabase` object is currently connected to a data source.|  \n|[CDatabase::OnSetOptions](#cdatabase__onsetoptions)|Called by the framework to set standard connection options. The default implementation sets the query timeout value. You can establish these options ahead of time by calling `SetQueryTimeout`.|  \n|[CDatabase::Open](#cdatabase__open)|Establishes a connection to a data source (through an ODBC driver).|  \n|[CDatabase::OpenEx](#cdatabase__openex)|Establishes a connection to a data source (through an ODBC driver).|  \n|[CDatabase::Rollback](#cdatabase__rollback)|Reverses changes made during the current transaction. The data source returns to its previous state, as defined at the **BeginTrans** call, unaltered.|  \n|[CDatabase::SetLoginTimeout](#cdatabase__setlogintimeout)|Sets the number of seconds after which a data source connection attempt will time out.|  \n|[CDatabase::SetQueryTimeout](#cdatabase__setquerytimeout)|Sets the number of seconds after which database query operations will time out. Affects all subsequent recordset **Open**, `AddNew`, **Edit**, and **Delete** calls.|  \n  \n### Public Data Members  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CDatabase::m_hdbc](#cdatabase__m_hdbc)|Open Database Connectivity (ODBC) connection handle to a data source. Type **HDBC**.|  \n  \n## Remarks  \n A data source is a specific instance of data hosted by some database management system (DBMS). Examples include Microsoft SQL Server, Microsoft Access, Borland dBASE, and xBASE. You can have one or more `CDatabase` objects active at a time in your application.  \n  \n> [!NOTE]\n>  If you are working with the Data Access Objects (DAO) classes rather than the Open Database Connectivity (ODBC) classes, use class [CDaoDatabase](../../mfc/reference/cdaodatabase-class.md) instead. For more information, see the article [Overview: Database Programming](../../data/data-access-programming-mfc-atl.md).  \n  \n To use `CDatabase`, construct a `CDatabase` object and call its `OpenEx` member function. This opens a connection. When you then construct `CRecordset` objects for operating on the connected data source, pass the recordset constructor a pointer to your `CDatabase` object. When you finish using the connection, call the **Close** member function and destroy the `CDatabase` object. **Close** closes any recordsets you have not closed previously.  \n  \n For more information about `CDatabase`, see the articles [Data Source (ODBC)](../../data/odbc/data-source-odbc.md) and [Overview: Database Programming](../../data/data-access-programming-mfc-atl.md).  \n  \n## Inheritance Hierarchy  \n [CObject](../../mfc/reference/cobject-class.md)  \n  \n `CDatabase`  \n  \n## Requirements  \n **Header:** afxdb.h  \n  \n##  <a name=\"cdatabase__begintrans\"></a>  CDatabase::BeginTrans  \n Call this member function to begin a transaction with the connected data source.  \n  \n```  \nBOOL BeginTrans();\n```  \n  \n### Return Value  \n Nonzero if the call was successful and changes are committed only manually; otherwise 0.  \n  \n### Remarks  \n A transaction consists of one or more calls to the `AddNew`, **Edit**, **Delete**, and **Update** member functions of a `CRecordset` object. Before beginning a transaction, the `CDatabase` object must already have been connected to the data source by calling its `OpenEx` or **Open** member function. To end the transaction, call [CommitTrans](#cdatabase__committrans) to accept all changes to the data source (and carry them out) or call [Rollback](#cdatabase__rollback) to abort the entire transaction. Call **BeginTrans** after you open any recordsets involved in the transaction and as close to the actual update operations as possible.  \n  \n> [!CAUTION]\n>  Depending on your ODBC driver, opening a recordset before calling **BeginTrans** may cause problems when calling **Rollback**. You should check the specific driver you are using. For example, when using the Microsoft Access driver included in the Microsoft ODBC Desktop Driver Pack 3.0, you must account for the Jet database engine's requirement that you should not begin a transaction on any database that has an open cursor. In the MFC database classes, an open cursor means an open `CRecordset` object. For more information, see [Technical Note 68](../../mfc/tn068-performing-transactions-with-the-microsoft-access-7-odbc-driver.md).  \n  \n **BeginTrans** may also lock data records on the server, depending on the requested concurrency and the capabilities of the data source. For information about locking data, see the article [Recordset: Locking Records (ODBC)](../../data/odbc/recordset-locking-records-odbc.md).  \n  \n User-defined transactions are explained in the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n **BeginTrans** establishes the state to which the sequence of transactions can be rolled back (reversed). To establish a new state for rollbacks, commit any current transaction, then call **BeginTrans** again.  \n  \n> [!CAUTION]\n>  Calling **BeginTrans** again without calling **CommitTrans** or **Rollback** is an error.  \n  \n Call the [CanTransact](#cdatabase__cantransact) member function to determine whether your driver supports transactions for a given database. You should also call [GetCursorCommitBehavior](#cdatabase__getcursorcommitbehavior) and [GetCursorRollbackBehavior](#cdatabase__getcursorrollbackbehavior) to determine the support for cursor preservation.  \n  \n For more information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n### Example  \n  See the article [Transaction: Performing a Transaction in a Recordset (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md).  \n  \n##  <a name=\"cdatabase__bindparameters\"></a>  CDatabase::BindParameters  \n Override `BindParameters` when you need to bind parameters before calling [CDatabase::ExecuteSQL](#cdatabase__executesql).  \n  \n```  \nvirtual void BindParameters(HSTMT hstmt);\n```  \n  \n### Parameters  \n `hstmt`  \n The ODBC statement handle for which you want to bind parameters.  \n  \n### Remarks  \n This approach is useful when you do not need the result set from a stored procedure.  \n  \n In your override, call **SQLBindParameters** and related ODBC functions to bind the parameters. MFC calls your override before your call to `ExecuteSQL`. You do not need to call **SQLPrepare**; `ExecuteSQL` calls **SQLExecDirect** and destroys the **hstmt**, which is used only once.  \n  \n##  <a name=\"cdatabase__cancel\"></a>  CDatabase::Cancel  \n Call this member function to request that the data source cancel either an asynchronous operation in progress or a process from a second thread.  \n  \n```  \nvoid Cancel();\n```  \n  \n### Remarks  \n Note that the MFC ODBC classes no longer use asynchronous processing; to perform an asychronous operation, you must directly call the ODBC API function [SQLSetConnectOption](https://msdn.microsoft.com/library/ms713564.aspx). For more information, see [Asynchronous Execution](https://msdn.microsoft.com/library/ms713563.aspx) in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)].  \n  \n##  <a name=\"cdatabase__cantransact\"></a>  CDatabase::CanTransact  \n Call this member function to determine whether the database allows transactions.  \n  \n```  \nBOOL CanTransact() const;\n\n \n```  \n  \n### Return Value  \n Nonzero if recordsets using this `CDatabase` object allow transactions; otherwise 0.  \n  \n### Remarks  \n For information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n##  <a name=\"cdatabase__canupdate\"></a>  CDatabase::CanUpdate  \n Call this member function to determine whether the `CDatabase` object allows updates.  \n  \n```  \nBOOL CanUpdate() const;\n\n \n```  \n  \n### Return Value  \n Nonzero if the `CDatabase` object allows updates; otherwise 0, indicating either that you passed **TRUE** in `bReadOnly` when you opened the `CDatabase` object or that the data source itself is read-only. The data source is read-only if a call to the ODBC API function **SQLGetInfo** for **SQL_DATASOURCE_READ_ONLY** returns \"y\".  \n  \n### Remarks  \n Not all drivers support updates.  \n  \n##  <a name=\"cdatabase__cdatabase\"></a>  CDatabase::CDatabase  \n Constructs a `CDatabase` object.  \n  \n```  \nCDatabase();\n```  \n  \n### Remarks  \n After constructing the object, you must call its `OpenEx` or **Open** member function to establish a connection to a specified data source.  \n  \n You may find it convenient to embed the `CDatabase` object in your document class.  \n  \n### Example  \n This example illustrates using `CDatabase` in a `CDocument`-derived class.  \n  \n [!code-cpp[NVC_MFCDatabase#9](../../mfc/codesnippet/cpp/cdatabase-class_1.h)]  \n  \n [!code-cpp[NVC_MFCDatabase#10](../../mfc/codesnippet/cpp/cdatabase-class_2.cpp)]  \n  \n##  <a name=\"cdatabase__close\"></a>  CDatabase::Close  \n Call this member function if you want to disconnect from a data source.  \n  \n```  \nvirtual void Close();\n```  \n  \n### Remarks  \n You must close any recordsets associated with the `CDatabase` object before you call this member function. Because **Close** does not destroy the `CDatabase` object, you can reuse the object by opening a new connection to the same data source or a different data source.  \n  \n All pending `AddNew` or **Edit** statements of recordsets using the database are canceled, and all pending transactions are rolled back. Any recordsets dependent on the `CDatabase` object are left in an undefined state.  \n  \n### Example  \n [!code-cpp[NVC_MFCDatabase#12](../../mfc/codesnippet/cpp/cdatabase-class_3.cpp)]  \n  \n##  <a name=\"cdatabase__committrans\"></a>  CDatabase::CommitTrans  \n Call this member function upon completing transactions.  \n  \n```  \nBOOL CommitTrans();\n```  \n  \n### Return Value  \n Nonzero if the updates were successfully committed; otherwise 0. If **CommitTrans** fails, the state of the data source is undefined. You must check the data to determine its state.  \n  \n### Remarks  \n A transaction consists of a series of calls to the `AddNew`, **Edit**, **Delete**, and **Update** member functions of a `CRecordset` object that began with a call to the [BeginTrans](#cdatabase__begintrans) member function. **CommitTrans** commits the transaction. By default, updates are committed immediately; calling **BeginTrans** causes commitment of updates to be delayed until **CommitTrans** is called.  \n  \n Until you call **CommitTrans** to end a transaction, you can call the [Rollback](#cdatabase__rollback) member function to abort the transaction and leave the data source in its original state. To begin a new transaction, call **BeginTrans** again.  \n  \n For more information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n### Example  \n  See the article [Transaction: Performing a Transaction in a Recordset (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md).  \n  \n##  <a name=\"cdatabase__executesql\"></a>  CDatabase::ExecuteSQL  \n Call this member function when you need to execute a SQL command directly.  \n  \n```  \nvoid ExecuteSQL(LPCTSTR lpszSQL);\n```  \n  \n### Parameters  \n `lpszSQL`  \n Pointer to a null-terminated string containing a valid SQL command to execute. You can pass a [CString](../../atl-mfc-shared/reference/cstringt-class.md).  \n  \n### Remarks  \n Create the command as a null-terminated string. `ExecuteSQL` does not return data records. If you want to operate on records, use a recordset object instead.  \n  \n Most of your commands for a data source are issued through recordset objects, which support commands for selecting data, inserting new records, deleting records, and editing records. However, not all ODBC functionality is directly supported by the database classes, so you may at times need to make a direct SQL call with `ExecuteSQL`.  \n  \n### Example  \n [!code-cpp[NVC_MFCDatabase#13](../../mfc/codesnippet/cpp/cdatabase-class_4.cpp)]  \n  \n##  <a name=\"cdatabase__getbookmarkpersistence\"></a>  CDatabase::GetBookmarkPersistence  \n Call this member function to determine the persistence of bookmarks on a recordset object after certain operations.  \n  \n```  \nDWORD GetBookmarkPersistence() const;\n\n \n```  \n  \n### Return Value  \n A bitmask that identifies the operations through which bookmarks persist on a recordset object. For details, see Remarks.  \n  \n### Remarks  \n For example, if you call `CRecordset::GetBookmark` and then call `CRecordset::Requery`, the bookmark obtained from `GetBookmark` may no longer be valid. You should call `GetBookmarkPersistence` before calling `CRecordset::SetBookmark`.  \n  \n The following table lists the bitmask values that can be combined for the return value of `GetBookmarkPersistence`.  \n  \n|Bitmask value|Bookmark persistence|  \n|-------------------|--------------------------|  \n|`SQL_BP_CLOSE`|Bookmarks are valid after a **Requery** operation.|  \n|`SQL_BP_DELETE`|The bookmark for a row is valid after a **Delete** operation on that row.|  \n|`SQL_BP_DROP`|Bookmarks are valid after a **Close** operation.|  \n|`SQL_BP_SCROLL`|Bookmarks are valid after any **Move** operation. This simply identifies if bookmarks are supported on the recordset, as returned by `CRecordset::CanBookmark`.|  \n|`SQL_BP_TRANSACTION`|Bookmarks are valid after a transaction is committed or rolled back.|  \n|`SQL_BP_UPDATE`|The bookmark for a row is valid after an **Update** operation on that row.|  \n|`SQL_BP_OTHER_HSTMT`|Bookmarks associated with one recordset object are valid on a second recordset.|  \n  \n For more information about this return value, see the ODBC API function **SQLGetInfo** in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]. For more information about bookmarks, see the article [Recordset: Bookmarks and Absolute Positions (ODBC)](../../data/odbc/recordset-bookmarks-and-absolute-positions-odbc.md).  \n  \n##  <a name=\"cdatabase__getconnect\"></a>  CDatabase::GetConnect  \n Call this member function to retrieve the connection string used during the call to `OpenEx` or `Open` that connected the `CDatabase` object to a data source.  \n  \n```  \nconst CString GetConnect() const;\n\n \n```  \n  \n### Return Value  \n A `const`[CString](../../atl-mfc-shared/reference/cstringt-class.md) containing the connection string if `OpenEx` or `Open` has been called; otherwise, an empty string.  \n  \n### Remarks  \n See [CDatabase::Open](#cdatabase__open) for a description of how the connection string is created.  \n  \n##  <a name=\"cdatabase__getcursorcommitbehavior\"></a>  CDatabase::GetCursorCommitBehavior  \n Call this member function to determine how a [CommitTrans](#cdatabase__committrans) operation affects cursors on open recordset objects.  \n  \n```  \nint GetCursorCommitBehavior() const;\n\n \n```  \n  \n### Return Value  \n A value indicating the effect of transactions on open recordset objects. For details, see Remarks.  \n  \n### Remarks  \n The following table lists the possible return values for `GetCursorCommitBehavior` and the corresponding effect on the open recordset.  \n  \n|Return value|Effect on CRecordset objects|  \n|------------------|----------------------------------|  \n|`SQL_CB_CLOSE`|Call `CRecordset::Requery` immediately following the transaction commit.|  \n|`SQL_CB_DELETE`|Call `CRecordset::Close` immediately following the transaction commit.|  \n|`SQL_CB_PRESERVE`|Proceed normally with `CRecordset` operations.|  \n  \n For more information about this return value, see the ODBC API function **SQLGetInfo** in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]. For more information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n##  <a name=\"cdatabase__getcursorrollbackbehavior\"></a>  CDatabase::GetCursorRollbackBehavior  \n Call this member function to determine how a [Rollback](#cdatabase__rollback) operation affects cursors on open recordset objects.  \n  \n```  \nint GetCursorRollbackBehavior() const;\n\n \n```  \n  \n### Return Value  \n A value indicating the effect of transactions on open recordset objects. For details, see Remarks.  \n  \n### Remarks  \n The following table lists the possible return values for `GetCursorRollbackBehavior` and the corresponding effect on the open recordset.  \n  \n|Return value|Effect on CRecordset objects|  \n|------------------|----------------------------------|  \n|`SQL_CB_CLOSE`|Call `CRecordset::Requery` immediately following the transaction rollback.|  \n|`SQL_CB_DELETE`|Call `CRecordset::Close` immediately following the transaction rollback.|  \n|`SQL_CB_PRESERVE`|Proceed normally with `CRecordset` operations.|  \n  \n For more information about this return value, see the ODBC API function **SQLGetInfo** in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]. For more information about transactions, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n##  <a name=\"cdatabase__getdatabasename\"></a>  CDatabase::GetDatabaseName  \n Call this member function to retrieve the name of the currently connected database (provided that the data source defines a named object called \"database\").  \n  \n```  \nCString GetDatabaseName() const;\n\n \n```  \n  \n### Return Value  \n A [CString](../../atl-mfc-shared/reference/cstringt-class.md) containing the database name if successful; otherwise, an empty `CString`.  \n  \n### Remarks  \n This is not the same as the data source name (DSN) specified in the `OpenEx` or **Open** call. What `GetDatabaseName` returns depends on ODBC. In general, a database is a collection of tables. If this entity has a name, `GetDatabaseName` returns it.  \n  \n You might, for example, want to display this name in a heading. If an error occurs while retrieving the name from ODBC, `GetDatabaseName` returns an empty **Cstring**.  \n  \n##  <a name=\"cdatabase__isopen\"></a>  CDatabase::IsOpen  \n Call this member function to determine whether the `CDatabase` object is currently connected to a data source.  \n  \n```  \nBOOL IsOpen() const;\n\n \n```  \n  \n### Return Value  \n Nonzero if the `CDatabase` object is currently connected; otherwise 0.  \n  \n##  <a name=\"cdatabase__m_hdbc\"></a>  CDatabase::m_hdbc  \n Contains a public handle to an ODBC data source connection â€” a \"connection handle.\"  \n  \n### Remarks  \n Normally, you will have no need to access this member variable directly. Instead, the framework allocates the handle when you call `OpenEx` or **Open**. The framework deallocates the handle when you call the **delete** operator on the `CDatabase` object. Note that the **Close** member function does not deallocate the handle.  \n  \n Under some circumstances, however, you may need to use the handle directly. For example, if you need to call ODBC API functions directly rather than through class `CDatabase`, you may need a connection handle to pass as a parameter. See the code example below.  \n  \n### Example  \n [!code-cpp[NVC_MFCDatabase#15](../../mfc/codesnippet/cpp/cdatabase-class_5.cpp)]  \n  \n##  <a name=\"cdatabase__onsetoptions\"></a>  CDatabase::OnSetOptions  \n The framework calls this member function when directly executing a SQL statement with the `ExecuteSQL` member function.  \n  \n```  \nvirtual void OnSetOptions(HSTMT hstmt);\n```  \n  \n### Parameters  \n `hstmt`  \n The ODBC statement handle for which options are being set.  \n  \n### Remarks  \n `CRecordset::OnSetOptions` also calls this member function.  \n  \n `OnSetOptions` sets the login timeout value. If there have been previous calls to the `SetQueryTimeout` and member function, `OnSetOptions` reflects the current values; otherwise, it sets default values.  \n  \n> [!NOTE]\n>  Prior to MFC 4.2, `OnSetOptions` also set the processing mode to either snychronous or asynchronous. Beginning with MFC 4.2, all operations are synchronous. To perform an asynchronous operation, you must make a direct call to the ODBC API function **SQLSetPos**.  \n  \n You do not need to override `OnSetOptions` to change the timeout value. Instead, to customize the query timeout value, call `SetQueryTimeout` before creating a recordset; `OnSetOptions` will use the new value. The values set apply to subsequent operations on all recordsets or direct SQL calls.  \n  \n Override `OnSetOptions` if you want to set additional options. Your override should call the base class `OnSetOptions` either before or after you call the ODBC API function **SQLSetStmtOption**. Follow the method illustrated in the framework's default implementation of `OnSetOptions`.  \n  \n##  <a name=\"cdatabase__open\"></a>  CDatabase::Open  \n Call this member function to initialize a newly constructed `CDatabase` object.  \n  \n```  \nvirtual BOOL Open(\n    LPCTSTR lpszDSN,  \n    BOOL bExclusive = FALSE,  \n    BOOL bReadOnly = FALSE,  \n    LPCTSTR lpszConnect = _T(\"ODBC;\"),  \n    BOOL bUseCursorLib = TRUE);\n```  \n  \n### Parameters  \n `lpszDSN`  \n Specifies a data source name â€” a name registered with ODBC through the ODBC Administrator program. If a DSN value is specified in `lpszConnect` (in the form \"DSN=\\<data-source>\"), it must not be specified again in `lpszDSN`. In this case, `lpszDSN` should be **NULL**. Otherwise, you can pass **NULL** if you want to present the user with a Data Source dialog box in which the user can select a data source. For further information, see Remarks.  \n  \n `bExclusive`  \n Not supported in this version of the class library. Currently, an assertion fails if this parameter is **TRUE**. The data source is always opened as shared (not exclusive).  \n  \n `bReadOnly`  \n **TRUE** if you intend the connection to be read-only and to prohibit updates to the data source. All dependent recordsets inherit this attribute. The default value is **FALSE**.  \n  \n `lpszConnect`  \n Specifies a connection string. The connection string concatenates information, possibly including a data source name, a user ID valid on the data source, a user authentication string (password, if the data source requires one), and other information. The whole connection string must be prefixed by the string \"ODBC;\" (uppercase or lowercase). The \"ODBC;\" string is used to indicate that the connection is to an ODBC data source; this is for upward compatibility when future versions of the class library might support non-ODBC data sources.  \n  \n `bUseCursorLib`  \n **TRUE** if you want the ODBC Cursor Library DLL to be loaded. The cursor library masks some functionality of the underlying ODBC driver, effectively preventing the use of dynasets (if the driver supports them). The only cursors supported if the cursor library is loaded are static snapshots and forward-only cursors. The default value is **TRUE**. If you plan to create a recordset object directly from `CRecordset` without deriving from it, you should not load the cursor library.  \n  \n### Return Value  \n Nonzero if the connection is successfully made; otherwise 0 if the user chooses Cancel when presented a dialog box asking for more connection information. In all other cases, the framework throws an exception.  \n  \n### Remarks  \n Your database object must be initialized before you can use it to construct a recordset object.  \n  \n> [!NOTE]\n>  Calling the [OpenEx](#cdatabase__openex) member function is the preferred way to connect to a data source and initialize your database object.  \n  \n If the parameters in your **Open** call do not contain enough information to make the connection, the ODBC driver opens a dialog box to obtain the necessary information from the user. When you call **Open**, your connection string, `lpszConnect`, is stored privately in the `CDatabase` object and is available by calling the [GetConnect](#cdatabase__getconnect) member function.  \n  \n If you wish, you can open your own dialog box before you call **Open** to get information from the user, such as a password, then add that information to the connection string you pass to **Open**. Or you might want to save the connection string you pass so you can reuse it the next time your application calls **Open** on a `CDatabase` object.  \n  \n You can also use the connection string for multiple levels of login authorization (each for a different `CDatabase` object) or to convey other data source-specific information. For more information about connection strings, see Chapter 5 in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)].  \n  \n It is possible for a connection attempt to time out if, for example, the DBMS host is unavailable. If the connection attempt fails, **Open** throws a `CDBException`.  \n  \n### Example  \n [!code-cpp[NVC_MFCDatabase#14](../../mfc/codesnippet/cpp/cdatabase-class_6.cpp)]  \n  \n##  <a name=\"cdatabase__openex\"></a>  CDatabase::OpenEx  \n Call this member function to initialize a newly constructed `CDatabase` object.  \n  \n```  \nvirtual BOOL OpenEx(\n    LPCTSTR lpszConnectString,  \n    DWORD dwOptions = 0);\n```  \n  \n### Parameters  \n `lpszConnectString`  \n Specifies an ODBC connection string. This includes the data source name as well as other optional information, such as a user ID and password. For example, \"DSN=SQLServer_Source;UID=SA;PWD=abc123\" is a possible connection string. Note that if you pass **NULL** for `lpszConnectString`, a Data Source dialog box will prompt the user to select a data source.  \n  \n `dwOptions`  \n A bitmask which specifies a combination of the following values. The default value is 0, meaning that the database will be opened as shared with write access, the ODBC Cursor Library DLL will not be loaded, and the ODBC connection dialog box will display only if there is not enough information to make the connection.  \n  \n- **CDatabase::openExclusive** Not supported in this version of the class library. A data source is always opened as shared (not exclusive). Currently, an assertion fails if you specify this option.  \n  \n- **CDatabase::openReadOnly** Open the data source as read-only.  \n  \n- **CDatabase::useCursorLib** Load the ODBC Cursor Library DLL. The cursor library masks some functionality of the underlying ODBC driver, effectively preventing the use of dynasets (if the driver supports them). The only cursors supported if the cursor library is loaded are static snapshots and forward-only cursors. If you plan to create a recordset object directly from `CRecordset` without deriving from it, you should not load the cursor library.  \n  \n- **CDatabase::noOdbcDialog** Do not display the ODBC connection dialog box, regardless of whether enough connection information is supplied.  \n  \n- **CDatabase::forceOdbcDialog** Always display the ODBC connection dialog box.  \n  \n### Return Value  \n Nonzero if the connection is successfully made; otherwise 0 if the user chooses Cancel when presented a dialog box asking for more connection information. In all other cases, the framework throws an exception.  \n  \n### Remarks  \n Your database object must be initialized before you can use it to construct a recordset object.  \n  \n If the `lpszConnectString` parameter in your `OpenEx` call does not contain enough information to make the connection, the ODBC driver opens a dialog box to obtain the necessary information from the user, provided you have not set **CDatabase::noOdbcDialog** or **CDatabase::forceOdbcDialog** in the `dwOptions` parameter. When you call `OpenEx`, your connection string, `lpszConnectString`, is stored privately in the `CDatabase` object and is available by calling the [GetConnect](#cdatabase__getconnect) member function.  \n  \n If you wish, you can open your own dialog box before you call `OpenEx` to get information from the user, such as a password, and then add that information to the connection string you pass to `OpenEx`. Or you might want to save the connection string you pass so you can reuse it the next time your application calls `OpenEx` on a `CDatabase` object.  \n  \n You can also use the connection string for multiple levels of login authorization (each for a different `CDatabase` object) or to convey other data source-specific information. For more information about connection strings, see Chapter 6 in the *ODBC Programmer's Reference*.  \n  \n It is possible for a connection attempt to time out if, for example, the DBMS host is unavailable. If the connection attempt fails, `OpenEx` throws a `CDBException`.  \n  \n### Example  \n [!code-cpp[NVC_MFCDatabase#11](../../mfc/codesnippet/cpp/cdatabase-class_7.cpp)]  \n  \n##  <a name=\"cdatabase__rollback\"></a>  CDatabase::Rollback  \n Call this member function to reverse the changes made during a transaction.  \n  \n```  \nBOOL Rollback();\n```  \n  \n### Return Value  \n Nonzero if the transaction was successfully reversed; otherwise 0. If a **Rollback** call fails, the data source and transaction states are undefined. If **Rollback** returns 0, you must check the data source to determine its state.  \n  \n### Remarks  \n All `CRecordset``AddNew`, **Edit**, **Delete**, and **Update** calls executed since the last [BeginTrans](#cdatabase__begintrans) are rolled back to the state that existed at the time of that call.  \n  \n After a call to **Rollback**, the transaction is over, and you must call **BeginTrans** again for another transaction. The record that was current before you called **BeginTrans** becomes the current record again after **Rollback**.  \n  \n After a rollback, the record that was current before the rollback remains current. For details about the state of the recordset and the data source after a rollback, see the article [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n### Example  \n  See the article [Transaction: Performing a Transaction in a Recordset (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md).  \n  \n##  <a name=\"cdatabase__setlogintimeout\"></a>  CDatabase::SetLoginTimeout  \n Call this member function â€” before you call `OpenEx` or **Open** â€” to override the default number of seconds allowed before an attempted data source connection times out.  \n  \n```  \nvoid SetLoginTimeout(DWORD dwSeconds);\n```  \n  \n### Parameters  \n `dwSeconds`  \n The number of seconds to allow before a connection attempt times out.  \n  \n### Remarks  \n A connection attempt might time out if, for example, the DBMS is not available. Call **SetLoginTimeout** after you construct the uninitialized `CDatabase` object but before you call `OpenEx` or **Open**.  \n  \n The default value for login timeouts is 15 seconds. Not all data sources support the ability to specify a login timeout value. If the data source does not support timeout, you get trace output but not an exception. A value of 0 means \"infinite.\"  \n  \n##  <a name=\"cdatabase__setquerytimeout\"></a>  CDatabase::SetQueryTimeout  \n Call this member function to override the default number of seconds to allow before subsequent operations on the connected data source time out.  \n  \n```  \nvoid SetQueryTimeout(DWORD dwSeconds);\n```  \n  \n### Parameters  \n `dwSeconds`  \n The number of seconds to allow before a query attempt times out.  \n  \n### Remarks  \n An operation might time out due to network access problems, excessive query processing time, and so on. Call `SetQueryTimeout` prior to opening your recordset or prior to calling the recordset's `AddNew`, **Update** or **Delete** member functions if you want to change the query timeout value. The setting affects all subsequent **Open**, `AddNew`, **Update**, and **Delete** calls to any recordsets associated with this `CDatabase` object. Changing the query timeout value for a recordset after opening does not change the value for the recordset. For example, subsequent **Move** operations do not use the new value.  \n  \n The default value for query timeouts is 15 seconds. Not all data sources support the ability to set a query timeout value. If you set a query timeout value of 0, no timeout occurs; the communication with the data source may stop responding. This behavior may be useful during development. If the data source does not support timeout, you get trace output but not an exception.  \n  \n## See Also  \n [CObject Class](../../mfc/reference/cobject-class.md)   \n [Hierarchy Chart](../../mfc/hierarchy-chart.md)   \n [CRecordset Class](../../mfc/reference/crecordset-class.md)\n"}