{"nodes":[{"pos":[12,68],"content":"Can an MFC DLL create multiple threads? | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Can an MFC DLL create multiple threads? | Microsoft Docs","pos":[0,56],"nodes":[{"content":"Can an MFC DLL create multiple threads?","pos":[0,39]},{"content":"| Microsoft Docs","pos":[40,56]}]}]},{"content":"Can an MFC DLL create multiple threads?","pos":[701,740]},{"content":"Except during initialization, an MFC DLL can safely create multiple threads as long as it uses the Win32 thread local storage (TLS) functions such as <bpt id=\"p1\">**</bpt>TlsAlloc<ept id=\"p1\">**</ept> to allocate thread local storage.","pos":[741,937],"source":"Except during initialization, an MFC DLL can safely create multiple threads as long as it uses the Win32 thread local storage (TLS) functions such as **TlsAlloc** to allocate thread local storage."},{"content":"However, if an MFC DLL uses <bpt id=\"p1\">**</bpt>__declspec(thread)<ept id=\"p1\">**</ept> to allocate thread local storage, the client application must be implicitly linked to the DLL.","pos":[938,1083],"source":" However, if an MFC DLL uses **__declspec(thread)** to allocate thread local storage, the client application must be implicitly linked to the DLL."},{"content":"If the client application explicitly links to the DLL, the call to <bpt id=\"p1\">**</bpt>LoadLibrary<ept id=\"p1\">**</ept> will not successfully load the DLL.","pos":[1084,1202],"source":" If the client application explicitly links to the DLL, the call to **LoadLibrary** will not successfully load the DLL."},{"content":"For more information about creating multiple threads inside MFC DLLs, see the Knowledge Base article, \"PRB: Calling LoadLibrary() to Load a DLL That Has Static TLS\" (Q118816).","pos":[1203,1378]},{"content":"An MFC DLL that creates a new MFC thread during startup will stop responding when it is loaded by an application.","pos":[1385,1498]},{"content":"This includes whenever a thread is created by calling <ph id=\"ph1\">`AfxBeginThread`</ph> or <ph id=\"ph2\">`CWinThread::CreateThread`</ph> inside:","pos":[1499,1607],"source":" This includes whenever a thread is created by calling `AfxBeginThread` or `CWinThread::CreateThread` inside:"},{"pos":[1617,1683],"content":"The <ph id=\"ph1\">`InitInstance`</ph> of a <ph id=\"ph2\">`CWinApp`</ph>-derived object in a regular DLL.","source":"The `InitInstance` of a `CWinApp`-derived object in a regular DLL."},{"pos":[1693,1758],"content":"A supplied <ph id=\"ph1\">`DllMain`</ph> or <bpt id=\"p1\">**</bpt>RawDllMain<ept id=\"p1\">**</ept> function in a regular DLL.","source":"A supplied `DllMain` or **RawDllMain** function in a regular DLL."},{"pos":[1768,1836],"content":"A supplied <ph id=\"ph1\">`DllMain`</ph> or <bpt id=\"p1\">**</bpt>RawDllMain<ept id=\"p1\">**</ept> function in an Extension DLL.","source":"A supplied `DllMain` or **RawDllMain** function in an Extension DLL."},{"content":"For more information about creating threads during initialization, see the Knowledge Base article, \"PRB: Cannot Create an MFC Thread During DLL Startup\" (Q142243).","pos":[1843,2006]},{"content":"See Also","pos":[2015,2023]},{"content":"DLL Frequently Asked Questions","pos":[2028,2058]}],"content":"---\ntitle: \"Can an MFC DLL create multiple threads? | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"DLLs [C++], multithreading\"\n  - \"MFC DLLs [C++], multithreading\"\n  - \"threading [MFC], DLLs\"\n  - \"multithreading [C++], DLLs\"\nms.assetid: 41d5b5e6-a7d3-42bf-b641-f1245abd1c59\ncaps.latest.revision: 8\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Can an MFC DLL create multiple threads?\nExcept during initialization, an MFC DLL can safely create multiple threads as long as it uses the Win32 thread local storage (TLS) functions such as **TlsAlloc** to allocate thread local storage. However, if an MFC DLL uses **__declspec(thread)** to allocate thread local storage, the client application must be implicitly linked to the DLL. If the client application explicitly links to the DLL, the call to **LoadLibrary** will not successfully load the DLL. For more information about creating multiple threads inside MFC DLLs, see the Knowledge Base article, \"PRB: Calling LoadLibrary() to Load a DLL That Has Static TLS\" (Q118816).  \n  \n An MFC DLL that creates a new MFC thread during startup will stop responding when it is loaded by an application. This includes whenever a thread is created by calling `AfxBeginThread` or `CWinThread::CreateThread` inside:  \n  \n-   The `InitInstance` of a `CWinApp`-derived object in a regular DLL.  \n  \n-   A supplied `DllMain` or **RawDllMain** function in a regular DLL.  \n  \n-   A supplied `DllMain` or **RawDllMain** function in an Extension DLL.  \n  \n For more information about creating threads during initialization, see the Knowledge Base article, \"PRB: Cannot Create an MFC Thread During DLL Startup\" (Q142243).  \n  \n## See Also  \n [DLL Frequently Asked Questions](../build/dll-frequently-asked-questions.md)"}