{"nodes":[{"pos":[12,77],"content":"Calling Conventions, Parameters, and Return Type | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Calling Conventions, Parameters, and Return Type | Microsoft Docs","pos":[0,65]}]},{"content":"Calling Conventions, Parameters, and Return Type","pos":[704,752]},{"content":"The helper routine's prototype is:","pos":[753,787]},{"content":"where:","pos":[907,913]},{"content":"A <ph id=\"ph1\">`const`</ph> pointer to a <ph id=\"ph2\">`ImgDelayDescr`</ph> (see delayimp.h) that contains the offsets of various import-related data, a timestamp for binding information, and a set of attributes that provide further information about the descriptor content.","pos":[930,1167],"source":" A `const` pointer to a `ImgDelayDescr` (see delayimp.h) that contains the offsets of various import-related data, a timestamp for binding information, and a set of attributes that provide further information about the descriptor content."},{"content":"Currently there is only one attribute, <ph id=\"ph1\">`dlattrRva`</ph>, which indicates that the addresses in the descriptor are relative virtual addresses (as opposed to virtual addresses).","pos":[1168,1338],"source":" Currently there is only one attribute, `dlattrRva`, which indicates that the addresses in the descriptor are relative virtual addresses (as opposed to virtual addresses)."},{"pos":[1345,1502],"content":"For the definition of the <ph id=\"ph1\">`PCImgDelayDescr`</ph> structure, see <bpt id=\"p1\">[</bpt>Structure and Constant Definitions<ept id=\"p1\">](../../build/reference/structure-and-constant-definitions.md)</ept>.","source":"For the definition of the `PCImgDelayDescr` structure, see [Structure and Constant Definitions](../../build/reference/structure-and-constant-definitions.md)."},{"content":"A pointer to the slot in the delay load import address table (IAT) to be updated with the address of the imported function.","pos":[1527,1650]},{"content":"The helper routine needs to store the same value that it will be returning into this location.","pos":[1651,1745]},{"content":"Expected Return Values","pos":[1754,1776]},{"content":"If the function is successful, it returns the address of the imported function.","pos":[1780,1859]},{"content":"If the function fails, it raises an exception and returns 0.","pos":[1866,1926]},{"content":"Three types of exceptions can be raised:","pos":[1927,1967]},{"pos":[1977,2065],"content":"Invalid parameter, which happens if the attributes in <ph id=\"ph1\">`pidd`</ph> aren't specified correctly.","source":"Invalid parameter, which happens if the attributes in `pidd` aren't specified correctly."},{"pos":[2089,2117],"content":"failed on the specified DLL."},{"pos":[2127,2155],"content":"Failure of <ph id=\"ph1\">`GetProcAddress`</ph>.","source":"Failure of `GetProcAddress`."},{"content":"It is your responsibility to handle these exceptions.","pos":[2162,2215]},{"content":"Remarks","pos":[2224,2231]},{"content":"The calling convention for the helper function is <ph id=\"ph1\">`__stdcall`</ph>.","pos":[2235,2297],"source":"The calling convention for the helper function is `__stdcall`."},{"content":"The type of the return value is not relevant, so FARPROC is used.","pos":[2298,2363]},{"content":"This function has C linkage.","pos":[2364,2392]},{"content":"The return value of the delay load helper needs to be stored in the passed-in function pointer location, unless you want your helper routine to be used as a notification hook.","pos":[2399,2574]},{"content":"In that case, your code is responsible for finding the appropriate function pointer to return.","pos":[2575,2669]},{"content":"The thunk code the linker generates then takes that return value as the real target of the import and jumps directly to it.","pos":[2670,2793]},{"content":"Sample","pos":[2802,2808]},{"content":"The following code shows how to implement a simple hook function.","pos":[2812,2877]},{"content":"See Also","pos":[5467,5475]},{"content":"Understanding the Helper Function","pos":[5480,5513]}],"content":"---\ntitle: \"Calling Conventions, Parameters, and Return Type | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"calling conventions, helper functions\"\n  - \"helper functions, calling conventions\"\n  - \"helper functions, return types\"\nms.assetid: 0ffa4558-6005-4803-be95-7a8ec8837660\ncaps.latest.revision: 9\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Calling Conventions, Parameters, and Return Type\nThe helper routine's prototype is:  \n  \n```  \nFARPROC WINAPI __delayLoadHelper2(   \n   PCImgDelayDescr pidd,  \n   FARPROC * ppfnIATEntry  \n);  \n```  \n  \n where:  \n  \n `pidd`  \n A `const` pointer to a `ImgDelayDescr` (see delayimp.h) that contains the offsets of various import-related data, a timestamp for binding information, and a set of attributes that provide further information about the descriptor content. Currently there is only one attribute, `dlattrRva`, which indicates that the addresses in the descriptor are relative virtual addresses (as opposed to virtual addresses).  \n  \n For the definition of the `PCImgDelayDescr` structure, see [Structure and Constant Definitions](../../build/reference/structure-and-constant-definitions.md).  \n  \n `ppfnIATEntry`  \n A pointer to the slot in the delay load import address table (IAT) to be updated with the address of the imported function. The helper routine needs to store the same value that it will be returning into this location.  \n  \n## Expected Return Values  \n If the function is successful, it returns the address of the imported function.  \n  \n If the function fails, it raises an exception and returns 0. Three types of exceptions can be raised:  \n  \n-   Invalid parameter, which happens if the attributes in `pidd` aren't specified correctly.  \n  \n-   `LoadLibrary` failed on the specified DLL.  \n  \n-   Failure of `GetProcAddress`.  \n  \n It is your responsibility to handle these exceptions.  \n  \n## Remarks  \n The calling convention for the helper function is `__stdcall`. The type of the return value is not relevant, so FARPROC is used. This function has C linkage.  \n  \n The return value of the delay load helper needs to be stored in the passed-in function pointer location, unless you want your helper routine to be used as a notification hook. In that case, your code is responsible for finding the appropriate function pointer to return. The thunk code the linker generates then takes that return value as the real target of the import and jumps directly to it.  \n  \n## Sample  \n The following code shows how to implement a simple hook function.  \n  \n```  \nFARPROC WINAPI delayHook(unsigned dliNotify, PDelayLoadInfo pdli)  \n{  \n    switch (dliNotify) {  \n        case dliStartProcessing :  \n  \n            // If you want to return control to the helper, return 0.  \n            // Otherwise, return a pointer to a FARPROC helper function  \n            // that will be used instead, thereby bypassing the rest   \n            // of the helper.  \n  \n            break;  \n  \n        case dliNotePreLoadLibrary :  \n  \n            // If you want to return control to the helper, return 0.  \n            // Otherwise, return your own HMODULE to be used by the   \n            // helper instead of having it call LoadLibrary itself.  \n  \n            break;  \n  \n        case dliNotePreGetProcAddress :  \n  \n            // If you want to return control to the helper, return 0.  \n            // If you choose you may supply your own FARPROC function   \n            // address and bypass the helper's call to GetProcAddress.  \n  \n            break;  \n  \n        case dliFailLoadLib :   \n  \n            // LoadLibrary failed.  \n            // If you don't want to handle this failure yourself, return 0.  \n            // In this case the helper will raise an exception   \n            // (ERROR_MOD_NOT_FOUND) and exit.  \n            // If you want to handle the failure by loading an alternate   \n            // DLL (for example), then return the HMODULE for   \n            // the alternate DLL. The helper will continue execution with   \n            // this alternate DLL and attempt to find the  \n            // requested entrypoint via GetProcAddress.  \n  \n            break;  \n  \n        case dliFailGetProc :  \n  \n            // GetProcAddress failed.  \n            // If you don't want to handle this failure yourself, return 0.  \n            // In this case the helper will raise an exception   \n            // (ERROR_PROC_NOT_FOUND) and exit.  \n            // If you choose you may handle the failure by returning   \n            // an alternate FARPROC function address.  \n  \n            break;  \n  \n        case dliNoteEndProcessing :   \n  \n            // This notification is called after all processing is done.   \n            // There is no opportunity for modifying the helper's behavior  \n            // at this point except by longjmp()/throw()/RaiseException.   \n            // No return value is processed.  \n  \n            break;  \n  \n        default :  \n  \n            return NULL;  \n    }  \n  \n    return NULL;  \n}  \n  \n/*   \nand then at global scope somewhere  \nPfnDliHook __pfnDliNotifyHook2 = delayHook;  \n*/  \n```  \n  \n## See Also  \n [Understanding the Helper Function](../../build/reference/understanding-the-helper-function.md)"}