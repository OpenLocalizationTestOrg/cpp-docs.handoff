{"nodes":[{"pos":[12,54],"content":"ISchedulerProxy Structure | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"ISchedulerProxy Structure | Microsoft Docs","pos":[0,42]}]},{"pos":[647,672],"content":"ISchedulerProxy Structure","linkify":"ISchedulerProxy Structure","nodes":[{"content":"ISchedulerProxy Structure","pos":[0,25]}]},{"content":"The interface by which schedulers communicate with the Concurrency Runtime's Resource Manager to negotiate resource allocation.","pos":[673,800]},{"pos":[809,815],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[861,868],"content":"Members","linkify":"Members","nodes":[{"content":"Members","pos":[0,7]}]},{"pos":[878,892],"content":"Public Methods","linkify":"Public Methods","nodes":[{"content":"Public Methods","pos":[0,14]}]},{"content":"Name","pos":[899,903]},{"content":"Description","pos":[904,915]},{"pos":[953,1004],"content":"<bpt id=\"p1\">[</bpt>ISchedulerProxy::BindContext Method<ept id=\"p1\">](#bindcontext)</ept>","source":"[ISchedulerProxy::BindContext Method](#bindcontext)"},{"content":"Associates an execution context with a thread proxy, if it is not already associated with one.","pos":[1005,1099]},{"pos":[1104,1173],"content":"<bpt id=\"p1\">[</bpt>ISchedulerProxy::CreateOversubscriber Method<ept id=\"p1\">](#createoversubscriber)</ept>","source":"[ISchedulerProxy::CreateOversubscriber Method](#createoversubscriber)"},{"content":"Creates a new virtual processor root on the hardware thread associated with an existing execution resource.","pos":[1174,1281]},{"pos":[1286,1377],"content":"<bpt id=\"p1\">[</bpt>ISchedulerProxy::RequestInitialVirtualProcessors Method<ept id=\"p1\">](#requestinitialvirtualprocessors)</ept>","source":"[ISchedulerProxy::RequestInitialVirtualProcessors Method](#requestinitialvirtualprocessors)"},{"content":"Requests an initial allocation of virtual processor roots.","pos":[1378,1436]},{"content":"Every virtual processor root represents the ability to execute one thread that can perform work for the scheduler.","pos":[1437,1551]},{"pos":[1556,1601],"content":"<bpt id=\"p1\">[</bpt>ISchedulerProxy::Shutdown Method<ept id=\"p1\">](#shutdown)</ept>","source":"[ISchedulerProxy::Shutdown Method](#shutdown)"},{"content":"Notifies the Resource Manager that the scheduler is shutting down.","pos":[1602,1668]},{"content":"This will cause the Resource Manager to immediately reclaim all resources granted to the scheduler.","pos":[1669,1768]},{"pos":[1773,1846],"content":"<bpt id=\"p1\">[</bpt>ISchedulerProxy::SubscribeCurrentThread Method<ept id=\"p1\">](#subscribecurrentthread)</ept>","source":"[ISchedulerProxy::SubscribeCurrentThread Method](#subscribecurrentthread)"},{"content":"Registers the current thread with the Resource Manager, associating it with this scheduler.","pos":[1847,1938]},{"pos":[1943,1998],"content":"<bpt id=\"p1\">[</bpt>ISchedulerProxy::UnbindContext Method<ept id=\"p1\">](#unbindcontext)</ept>","source":"[ISchedulerProxy::UnbindContext Method](#unbindcontext)"},{"content":"Disassociates a thread proxy from the execution context specified by the <ph id=\"ph1\">`pContext`</ph> parameter and returns it to the thread proxy factory's free pool.","pos":[1999,2148],"source":"Disassociates a thread proxy from the execution context specified by the `pContext` parameter and returns it to the thread proxy factory's free pool."},{"content":"This method may only be called on an execution context which was bound via the <bpt id=\"p1\">[</bpt>ISchedulerProxy::BindContext<ept id=\"p1\">](#bindcontext)</ept> method and has not yet been started via being the <ph id=\"ph1\">`pContext`</ph> parameter of an <bpt id=\"p2\">[</bpt>IThreadProxy::SwitchTo<ept id=\"p2\">](ithreadproxy-structure.md#switchto)</ept> method call.","pos":[2149,2423],"source":" This method may only be called on an execution context which was bound via the [ISchedulerProxy::BindContext](#bindcontext) method and has not yet been started via being the `pContext` parameter of an [IThreadProxy::SwitchTo](ithreadproxy-structure.md#switchto) method call."},{"pos":[2433,2440],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[2444,2648],"content":"The Resource Manager hands an <ph id=\"ph1\">`ISchedulerProxy`</ph> interface to every scheduler that registers with it using the <bpt id=\"p1\">[</bpt>IResourceManager::RegisterScheduler<ept id=\"p1\">](iresourcemanager-structure.md#registerscheduler)</ept> method.","source":"The Resource Manager hands an `ISchedulerProxy` interface to every scheduler that registers with it using the [IResourceManager::RegisterScheduler](iresourcemanager-structure.md#registerscheduler) method."},{"pos":[2657,2678],"content":"Inheritance Hierarchy","linkify":"Inheritance Hierarchy","nodes":[{"content":"Inheritance Hierarchy","pos":[0,21]}]},{"pos":[2708,2720],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[2724,2746],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> concrtrm.h","source":"**Header:** concrtrm.h"},{"pos":[2753,2779],"content":"<bpt id=\"p1\">**</bpt>Namespace:<ept id=\"p1\">**</ept> concurrency","source":"**Namespace:** concurrency"},{"pos":[2789,2852],"content":"<bpt id=\"p1\">&lt;a name=\"bindcontext\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  ISchedulerProxy::BindContext Method","linkify":"<a name=\"bindcontext\"></a>  ISchedulerProxy::BindContext Method","source":"<a name=\"bindcontext\"></a>  ISchedulerProxy::BindContext Method"},{"content":"Associates an execution context with a thread proxy, if it is not already associated with one.","pos":[2856,2950]},{"pos":[3040,3050],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"An interface to the execution context to associate with a thread proxy.","pos":[3068,3139]},{"pos":[3149,3156],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"Normally, the <bpt id=\"p1\">[</bpt>IThreadProxy::SwitchTo<ept id=\"p1\">](ithreadproxy-structure.md#switchto)</ept> method will bind a thread proxy to an execution context on demand.","pos":[3160,3301],"source":"Normally, the [IThreadProxy::SwitchTo](ithreadproxy-structure.md#switchto) method will bind a thread proxy to an execution context on demand."},{"content":"There are, however, circumstances where it is necessary to bind a context in advance to ensure that the <ph id=\"ph1\">`SwitchTo`</ph> method switches to an already bound context.","pos":[3302,3461],"source":" There are, however, circumstances where it is necessary to bind a context in advance to ensure that the `SwitchTo` method switches to an already bound context."},{"content":"This is the case on a UMS scheduling context as it cannot call methods that allocate memory, and binding a thread proxy may involve memory allocation if a thread proxy is not readily available in the free pool of the thread proxy factory.","pos":[3462,3700]},{"pos":[3707,3785],"content":"<ph id=\"ph1\">`invalid_argument`</ph> is thrown if the parameter <ph id=\"ph2\">`pContext`</ph> has the value <ph id=\"ph3\">`NULL`</ph>.","source":"`invalid_argument` is thrown if the parameter `pContext` has the value `NULL`."},{"pos":[3795,3876],"content":"<bpt id=\"p1\">&lt;a name=\"createoversubscriber\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  ISchedulerProxy::CreateOversubscriber Method","linkify":"<a name=\"createoversubscriber\"></a>  ISchedulerProxy::CreateOversubscriber Method","source":"<a name=\"createoversubscriber\"></a>  ISchedulerProxy::CreateOversubscriber Method"},{"content":"Creates a new virtual processor root on the hardware thread associated with an existing execution resource.","pos":[3880,3987]},{"pos":[4115,4125],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"An <ph id=\"ph1\">`IExecutionResource`</ph> interface that represents the hardware thread you want to oversubscribe.","pos":[4153,4249],"source":" An `IExecutionResource` interface that represents the hardware thread you want to oversubscribe."},{"pos":[4259,4271],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"pos":[4275,4312],"content":"An <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interface.","source":"An `IVirtualProcessorRoot` interface."},{"pos":[4322,4329],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"Use this method when your scheduler wants to oversubscribe a particular hardware thread for a limited amount of time.","pos":[4333,4450]},{"content":"Once you are done with the virtual processor root, you should return it to the resource manager by calling the <bpt id=\"p1\">[</bpt>Remove<ept id=\"p1\">](iexecutionresource-structure.md#remove)</ept> method on the <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interface.","pos":[4451,4659],"source":" Once you are done with the virtual processor root, you should return it to the resource manager by calling the [Remove](iexecutionresource-structure.md#remove) method on the `IVirtualProcessorRoot` interface."},{"pos":[4666,4824],"content":"You can even oversubscribe an existing virtual processor root, because the <ph id=\"ph1\">`IVirtualProcessorRoot`</ph> interface inherits from the <ph id=\"ph2\">`IExecutionResource`</ph> interface.","source":"You can even oversubscribe an existing virtual processor root, because the `IVirtualProcessorRoot` interface inherits from the `IExecutionResource` interface."},{"pos":[4834,4937],"content":"<bpt id=\"p1\">&lt;a name=\"requestinitialvirtualprocessors\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  ISchedulerProxy::RequestInitialVirtualProcessors Method","linkify":"<a name=\"requestinitialvirtualprocessors\"></a>  ISchedulerProxy::RequestInitialVirtualProcessors Method","source":"<a name=\"requestinitialvirtualprocessors\"></a>  ISchedulerProxy::RequestInitialVirtualProcessors Method"},{"content":"Requests an initial allocation of virtual processor roots.","pos":[4941,4999]},{"content":"Every virtual processor root represents the ability to execute one thread that can perform work for the scheduler.","pos":[5000,5114]},{"pos":[5233,5243],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"Whether to subscribe the current thread and account for it during resource allocation.","pos":[5277,5363]},{"pos":[5373,5385],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"content":"The <ph id=\"ph1\">`IExecutionResource`</ph> interface for the current thread, if the parameter <ph id=\"ph2\">`doSubscribeCurrentThread`</ph> has the value <ph id=\"ph3\">`true`</ph>.","pos":[5389,5513],"source":"The `IExecutionResource` interface for the current thread, if the parameter `doSubscribeCurrentThread` has the value `true`."},{"content":"If the value is <ph id=\"ph1\">`false`</ph>, the method returns <ph id=\"ph2\">`NULL`</ph>.","pos":[5514,5565],"source":" If the value is `false`, the method returns `NULL`."},{"pos":[5575,5582],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"Before a scheduler executes any work, it should use this method to request virtual processor roots from the Resource Manager.","pos":[5586,5711]},{"content":"The Resource Manager will access the scheduler's policy using <bpt id=\"p1\">[</bpt>IScheduler::GetPolicy<ept id=\"p1\">](ischeduler-structure.md#getpolicy)</ept> and use the values for the policy keys <ph id=\"ph1\">`MinConcurrency`</ph>, <ph id=\"ph2\">`MaxConcurrency`</ph> and <ph id=\"ph3\">`TargetOversubscriptionFactor`</ph> to determine how many hardware threads to assign to the scheduler initially and how many virtual processor roots to create for every hardware thread.","pos":[5712,6091],"source":" The Resource Manager will access the scheduler's policy using [IScheduler::GetPolicy](ischeduler-structure.md#getpolicy) and use the values for the policy keys `MinConcurrency`, `MaxConcurrency` and `TargetOversubscriptionFactor` to determine how many hardware threads to assign to the scheduler initially and how many virtual processor roots to create for every hardware thread."},{"content":"For more information on how scheduler policies are used to determine a scheduler's initial allocation, see <bpt id=\"p1\">[</bpt>PolicyElementKey<ept id=\"p1\">](concurrency-namespace-enums.md)</ept>.","pos":[6092,6250],"source":" For more information on how scheduler policies are used to determine a scheduler's initial allocation, see [PolicyElementKey](concurrency-namespace-enums.md)."},{"content":"The Resource Manager grants resources to a scheduler by calling the method <bpt id=\"p1\">[</bpt>IScheduler::AddVirtualProcessors<ept id=\"p1\">](ischeduler-structure.md#addvirtualprocessors)</ept> with a list of virtual processor roots.","pos":[6257,6452],"source":"The Resource Manager grants resources to a scheduler by calling the method [IScheduler::AddVirtualProcessors](ischeduler-structure.md#addvirtualprocessors) with a list of virtual processor roots."},{"content":"The method is invoked as a callback into the scheduler before this method returns.","pos":[6453,6535]},{"content":"If the scheduler requested subscription for the current thread by setting the parameter <ph id=\"ph1\">`doSubscribeCurrentThread`</ph> to <ph id=\"ph2\">`true`</ph>, the method returns an <ph id=\"ph3\">`IExecutionResource`</ph> interface.","pos":[6542,6721],"source":"If the scheduler requested subscription for the current thread by setting the parameter `doSubscribeCurrentThread` to `true`, the method returns an `IExecutionResource` interface."},{"content":"The subscription must be terminated at a later point by using the <bpt id=\"p1\">[</bpt>IExecutionResource::Remove<ept id=\"p1\">](iexecutionresource-structure.md#remove)</ept> method.","pos":[6722,6864],"source":" The subscription must be terminated at a later point by using the [IExecutionResource::Remove](iexecutionresource-structure.md#remove) method."},{"content":"When determining which hardware threads are selected, the Resource Manager will attempt to optimize for processor node affinity.","pos":[6871,6999]},{"content":"If subscription is requested for the current thread, it is an indication that the current thread intends to participate in the work assigned to this scheduler.","pos":[7000,7159]},{"content":"In such a case, the allocated virtual processors roots are located on the processor node the current thread is executing on, if possible.","pos":[7160,7297]},{"content":"The act of subscribing a thread increases the subscription level of the underlying hardware thread by one.","pos":[7304,7410]},{"content":"The subscription level is reduced by one when the subscription is terminated.","pos":[7411,7488]},{"content":"For more information on subscription levels, see <bpt id=\"p1\">[</bpt>IExecutionResource::CurrentSubscriptionLevel<ept id=\"p1\">](iexecutionresource-structure.md#currentsubscriptionlevel)</ept>.","pos":[7489,7643],"source":" For more information on subscription levels, see [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel)."},{"pos":[7653,7710],"content":"<bpt id=\"p1\">&lt;a name=\"shutdown\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  ISchedulerProxy::Shutdown Method","linkify":"<a name=\"shutdown\"></a>  ISchedulerProxy::Shutdown Method","source":"<a name=\"shutdown\"></a>  ISchedulerProxy::Shutdown Method"},{"content":"Notifies the Resource Manager that the scheduler is shutting down.","pos":[7714,7780]},{"content":"This will cause the Resource Manager to immediately reclaim all resources granted to the scheduler.","pos":[7781,7880]},{"pos":[7932,7939],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[7943,8274],"content":"All <ph id=\"ph1\">`IExecutionContext`</ph> interfaces the scheduler received as a result of subscribing an external thread using the methods <ph id=\"ph2\">`ISchedulerProxy::RequestInitialVirtualProcessors`</ph> or <ph id=\"ph3\">`ISchedulerProxy::SubscribeCurrentThread`</ph> must be returned to the Resource Manager using <ph id=\"ph4\">`IExecutionResource::Remove`</ph> before a scheduler shuts itself down.","source":"All `IExecutionContext` interfaces the scheduler received as a result of subscribing an external thread using the methods `ISchedulerProxy::RequestInitialVirtualProcessors` or `ISchedulerProxy::SubscribeCurrentThread` must be returned to the Resource Manager using `IExecutionResource::Remove` before a scheduler shuts itself down."},{"pos":[8281,8624],"content":"If your scheduler had any deactivated virtual processor roots, you must activate them using <bpt id=\"p1\">[</bpt>IVirtualProcessorRoot::Activate<ept id=\"p1\">](ivirtualprocessorroot-structure.md#activate)</ept>, and have the thread proxies executing on them leave the <ph id=\"ph1\">`Dispatch`</ph> method of the execution contexts they are dispatching before you invoke <ph id=\"ph2\">`Shutdown`</ph> on a scheduler proxy.","source":"If your scheduler had any deactivated virtual processor roots, you must activate them using [IVirtualProcessorRoot::Activate](ivirtualprocessorroot-structure.md#activate), and have the thread proxies executing on them leave the `Dispatch` method of the execution contexts they are dispatching before you invoke `Shutdown` on a scheduler proxy."},{"pos":[8631,8885],"content":"It is not necessary for the scheduler to individually return all of the virtual processor roots the Resource Manager granted to it via calls to the <ph id=\"ph1\">`Remove`</ph> method because all virtual processors roots will be returned to the Resource Manager at shutdown.","source":"It is not necessary for the scheduler to individually return all of the virtual processor roots the Resource Manager granted to it via calls to the `Remove` method because all virtual processors roots will be returned to the Resource Manager at shutdown."},{"pos":[8895,8980],"content":"<bpt id=\"p1\">&lt;a name=\"subscribecurrentthread\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  ISchedulerProxy::SubscribeCurrentThread Method","linkify":"<a name=\"subscribecurrentthread\"></a>  ISchedulerProxy::SubscribeCurrentThread Method","source":"<a name=\"subscribecurrentthread\"></a>  ISchedulerProxy::SubscribeCurrentThread Method"},{"content":"Registers the current thread with the Resource Manager, associating it with this scheduler.","pos":[8984,9075]},{"pos":[9156,9168],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"pos":[9172,9256],"content":"The <ph id=\"ph1\">`IExecutionResource`</ph> interfacing representing the current thread in the runtime.","source":"The `IExecutionResource` interfacing representing the current thread in the runtime."},{"pos":[9266,9273],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"Use this method if you want the Resource Manager to account for the current thread while allocating resources to your scheduler and other schedulers.","pos":[9277,9426]},{"content":"It is especially useful when the thread plans to participate in the work queued to your scheduler, along with the virtual processor roots the scheduler receives from the Resource Manager.","pos":[9427,9614]},{"content":"The Resource Manager uses information to prevent unnecessary oversubscription of hardware threads on the system.","pos":[9615,9727]},{"content":"The execution resource received via this method should be returned to the Resource Manager using the <bpt id=\"p1\">[</bpt>IExecutionResource::Remove<ept id=\"p1\">](iexecutionresource-structure.md#remove)</ept> method.","pos":[9734,9911],"source":"The execution resource received via this method should be returned to the Resource Manager using the [IExecutionResource::Remove](iexecutionresource-structure.md#remove) method."},{"content":"The thread that calls the <ph id=\"ph1\">`Remove`</ph> method must be the same thread that previously called the <ph id=\"ph2\">`SubscribeCurrentThread`</ph> method.","pos":[9912,10037],"source":" The thread that calls the `Remove` method must be the same thread that previously called the `SubscribeCurrentThread` method."},{"content":"The act of subscribing a thread increases the subscription level of the underlying hardware thread by one.","pos":[10044,10150]},{"content":"The subscription level is reduced by one when the subscription is terminated.","pos":[10151,10228]},{"content":"For more information on subscription levels, see <bpt id=\"p1\">[</bpt>IExecutionResource::CurrentSubscriptionLevel<ept id=\"p1\">](iexecutionresource-structure.md#currentsubscriptionlevel)</ept>.","pos":[10229,10383],"source":" For more information on subscription levels, see [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel)."},{"pos":[10393,10460],"content":"<bpt id=\"p1\">&lt;a name=\"unbindcontext\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  ISchedulerProxy::UnbindContext Method","linkify":"<a name=\"unbindcontext\"></a>  ISchedulerProxy::UnbindContext Method","source":"<a name=\"unbindcontext\"></a>  ISchedulerProxy::UnbindContext Method"},{"content":"Disassociates a thread proxy from the execution context specified by the <ph id=\"ph1\">`pContext`</ph> parameter and returns it to the thread proxy factory's free pool.","pos":[10464,10613],"source":"Disassociates a thread proxy from the execution context specified by the `pContext` parameter and returns it to the thread proxy factory's free pool."},{"content":"This method may only be called on an execution context which was bound via the <bpt id=\"p1\">[</bpt>ISchedulerProxy::BindContext<ept id=\"p1\">](#bindcontext)</ept> method and has not yet been started via being the <ph id=\"ph1\">`pContext`</ph> parameter of an <bpt id=\"p2\">[</bpt>IThreadProxy::SwitchTo<ept id=\"p2\">](ithreadproxy-structure.md#switchto)</ept> method call.","pos":[10614,10888],"source":" This method may only be called on an execution context which was bound via the [ISchedulerProxy::BindContext](#bindcontext) method and has not yet been started via being the `pContext` parameter of an [IThreadProxy::SwitchTo](ithreadproxy-structure.md#switchto) method call."},{"pos":[10980,10990],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"The execution context to disassociate from its thread proxy.","pos":[11008,11068]},{"pos":[11077,11085],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>concurrency Namespace<ept id=\"p1\">](concurrency-namespace.md)</ept><ph id=\"ph1\"> </ph>","pos":[11089,11139],"source":"[concurrency Namespace](concurrency-namespace.md) "},{"content":"<bpt id=\"p1\"> [</bpt>IScheduler Structure<ept id=\"p1\">](ischeduler-structure.md)</ept><ph id=\"ph1\"> </ph>","pos":[11142,11191],"source":" [IScheduler Structure](ischeduler-structure.md) "},{"content":"<bpt id=\"p1\"> [</bpt>IThreadProxy Structure<ept id=\"p1\">](ithreadproxy-structure.md)</ept><ph id=\"ph1\"> </ph>","pos":[11194,11247],"source":" [IThreadProxy Structure](ithreadproxy-structure.md) "},{"content":"<bpt id=\"p1\"> [</bpt>IVirtualProcessorRoot Structure<ept id=\"p1\">](ivirtualprocessorroot-structure.md)</ept><ph id=\"ph1\"> </ph>","pos":[11250,11321],"source":" [IVirtualProcessorRoot Structure](ivirtualprocessorroot-structure.md) "},{"content":"<bpt id=\"p1\"> [</bpt>IResourceManager Structure<ept id=\"p1\">](iresourcemanager-structure.md)</ept>","pos":[11324,11384],"source":" [IResourceManager Structure](iresourcemanager-structure.md)"}],"content":"---\ntitle: \"ISchedulerProxy Structure | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"concrtrm/concurrency::ISchedulerProxy\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"ISchedulerProxy structure\"\nms.assetid: af416973-7a1c-4c30-aa3b-4161c2aaea54\ncaps.latest.revision: 18\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# ISchedulerProxy Structure\nThe interface by which schedulers communicate with the Concurrency Runtime's Resource Manager to negotiate resource allocation.  \n  \n## Syntax  \n  \n```\nstruct ISchedulerProxy;\n```  \n  \n## Members  \n  \n### Public Methods  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[ISchedulerProxy::BindContext Method](#bindcontext)|Associates an execution context with a thread proxy, if it is not already associated with one.|  \n|[ISchedulerProxy::CreateOversubscriber Method](#createoversubscriber)|Creates a new virtual processor root on the hardware thread associated with an existing execution resource.|  \n|[ISchedulerProxy::RequestInitialVirtualProcessors Method](#requestinitialvirtualprocessors)|Requests an initial allocation of virtual processor roots. Every virtual processor root represents the ability to execute one thread that can perform work for the scheduler.|  \n|[ISchedulerProxy::Shutdown Method](#shutdown)|Notifies the Resource Manager that the scheduler is shutting down. This will cause the Resource Manager to immediately reclaim all resources granted to the scheduler.|  \n|[ISchedulerProxy::SubscribeCurrentThread Method](#subscribecurrentthread)|Registers the current thread with the Resource Manager, associating it with this scheduler.|  \n|[ISchedulerProxy::UnbindContext Method](#unbindcontext)|Disassociates a thread proxy from the execution context specified by the `pContext` parameter and returns it to the thread proxy factory's free pool. This method may only be called on an execution context which was bound via the [ISchedulerProxy::BindContext](#bindcontext) method and has not yet been started via being the `pContext` parameter of an [IThreadProxy::SwitchTo](ithreadproxy-structure.md#switchto) method call.|  \n  \n## Remarks  \n The Resource Manager hands an `ISchedulerProxy` interface to every scheduler that registers with it using the [IResourceManager::RegisterScheduler](iresourcemanager-structure.md#registerscheduler) method.  \n  \n## Inheritance Hierarchy  \n `ISchedulerProxy`  \n  \n## Requirements  \n **Header:** concrtrm.h  \n  \n **Namespace:** concurrency  \n  \n##  <a name=\"bindcontext\"></a>  ISchedulerProxy::BindContext Method  \n Associates an execution context with a thread proxy, if it is not already associated with one.  \n  \n```\nvirtual void BindContext(_Inout_ IExecutionContext* pContext) = 0;\n```  \n  \n### Parameters  \n `pContext`  \n An interface to the execution context to associate with a thread proxy.  \n  \n### Remarks  \n Normally, the [IThreadProxy::SwitchTo](ithreadproxy-structure.md#switchto) method will bind a thread proxy to an execution context on demand. There are, however, circumstances where it is necessary to bind a context in advance to ensure that the `SwitchTo` method switches to an already bound context. This is the case on a UMS scheduling context as it cannot call methods that allocate memory, and binding a thread proxy may involve memory allocation if a thread proxy is not readily available in the free pool of the thread proxy factory.  \n  \n `invalid_argument` is thrown if the parameter `pContext` has the value `NULL`.  \n  \n##  <a name=\"createoversubscriber\"></a>  ISchedulerProxy::CreateOversubscriber Method  \n Creates a new virtual processor root on the hardware thread associated with an existing execution resource.  \n  \n```\nvirtual IVirtualProcessorRoot* CreateOversubscriber(_Inout_ IExecutionResource* pExecutionResource) = 0;\n```  \n  \n### Parameters  \n `pExecutionResource`  \n An `IExecutionResource` interface that represents the hardware thread you want to oversubscribe.  \n  \n### Return Value  \n An `IVirtualProcessorRoot` interface.  \n  \n### Remarks  \n Use this method when your scheduler wants to oversubscribe a particular hardware thread for a limited amount of time. Once you are done with the virtual processor root, you should return it to the resource manager by calling the [Remove](iexecutionresource-structure.md#remove) method on the `IVirtualProcessorRoot` interface.  \n  \n You can even oversubscribe an existing virtual processor root, because the `IVirtualProcessorRoot` interface inherits from the `IExecutionResource` interface.  \n  \n##  <a name=\"requestinitialvirtualprocessors\"></a>  ISchedulerProxy::RequestInitialVirtualProcessors Method  \n Requests an initial allocation of virtual processor roots. Every virtual processor root represents the ability to execute one thread that can perform work for the scheduler.  \n  \n```\nvirtual IExecutionResource* RequestInitialVirtualProcessors(bool doSubscribeCurrentThread) = 0;\n```  \n  \n### Parameters  \n `doSubscribeCurrentThread`  \n Whether to subscribe the current thread and account for it during resource allocation.  \n  \n### Return Value  \n The `IExecutionResource` interface for the current thread, if the parameter `doSubscribeCurrentThread` has the value `true`. If the value is `false`, the method returns `NULL`.  \n  \n### Remarks  \n Before a scheduler executes any work, it should use this method to request virtual processor roots from the Resource Manager. The Resource Manager will access the scheduler's policy using [IScheduler::GetPolicy](ischeduler-structure.md#getpolicy) and use the values for the policy keys `MinConcurrency`, `MaxConcurrency` and `TargetOversubscriptionFactor` to determine how many hardware threads to assign to the scheduler initially and how many virtual processor roots to create for every hardware thread. For more information on how scheduler policies are used to determine a scheduler's initial allocation, see [PolicyElementKey](concurrency-namespace-enums.md).  \n  \n The Resource Manager grants resources to a scheduler by calling the method [IScheduler::AddVirtualProcessors](ischeduler-structure.md#addvirtualprocessors) with a list of virtual processor roots. The method is invoked as a callback into the scheduler before this method returns.  \n  \n If the scheduler requested subscription for the current thread by setting the parameter `doSubscribeCurrentThread` to `true`, the method returns an `IExecutionResource` interface. The subscription must be terminated at a later point by using the [IExecutionResource::Remove](iexecutionresource-structure.md#remove) method.  \n  \n When determining which hardware threads are selected, the Resource Manager will attempt to optimize for processor node affinity. If subscription is requested for the current thread, it is an indication that the current thread intends to participate in the work assigned to this scheduler. In such a case, the allocated virtual processors roots are located on the processor node the current thread is executing on, if possible.  \n  \n The act of subscribing a thread increases the subscription level of the underlying hardware thread by one. The subscription level is reduced by one when the subscription is terminated. For more information on subscription levels, see [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).  \n  \n##  <a name=\"shutdown\"></a>  ISchedulerProxy::Shutdown Method  \n Notifies the Resource Manager that the scheduler is shutting down. This will cause the Resource Manager to immediately reclaim all resources granted to the scheduler.  \n  \n```\nvirtual void Shutdown() = 0;\n```  \n  \n### Remarks  \n All `IExecutionContext` interfaces the scheduler received as a result of subscribing an external thread using the methods `ISchedulerProxy::RequestInitialVirtualProcessors` or `ISchedulerProxy::SubscribeCurrentThread` must be returned to the Resource Manager using `IExecutionResource::Remove` before a scheduler shuts itself down.  \n  \n If your scheduler had any deactivated virtual processor roots, you must activate them using [IVirtualProcessorRoot::Activate](ivirtualprocessorroot-structure.md#activate), and have the thread proxies executing on them leave the `Dispatch` method of the execution contexts they are dispatching before you invoke `Shutdown` on a scheduler proxy.  \n  \n It is not necessary for the scheduler to individually return all of the virtual processor roots the Resource Manager granted to it via calls to the `Remove` method because all virtual processors roots will be returned to the Resource Manager at shutdown.  \n  \n##  <a name=\"subscribecurrentthread\"></a>  ISchedulerProxy::SubscribeCurrentThread Method  \n Registers the current thread with the Resource Manager, associating it with this scheduler.  \n  \n```\nvirtual IExecutionResource* SubscribeCurrentThread() = 0;\n```  \n  \n### Return Value  \n The `IExecutionResource` interfacing representing the current thread in the runtime.  \n  \n### Remarks  \n Use this method if you want the Resource Manager to account for the current thread while allocating resources to your scheduler and other schedulers. It is especially useful when the thread plans to participate in the work queued to your scheduler, along with the virtual processor roots the scheduler receives from the Resource Manager. The Resource Manager uses information to prevent unnecessary oversubscription of hardware threads on the system.  \n  \n The execution resource received via this method should be returned to the Resource Manager using the [IExecutionResource::Remove](iexecutionresource-structure.md#remove) method. The thread that calls the `Remove` method must be the same thread that previously called the `SubscribeCurrentThread` method.  \n  \n The act of subscribing a thread increases the subscription level of the underlying hardware thread by one. The subscription level is reduced by one when the subscription is terminated. For more information on subscription levels, see [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).  \n  \n##  <a name=\"unbindcontext\"></a>  ISchedulerProxy::UnbindContext Method  \n Disassociates a thread proxy from the execution context specified by the `pContext` parameter and returns it to the thread proxy factory's free pool. This method may only be called on an execution context which was bound via the [ISchedulerProxy::BindContext](#bindcontext) method and has not yet been started via being the `pContext` parameter of an [IThreadProxy::SwitchTo](ithreadproxy-structure.md#switchto) method call.  \n  \n```\nvirtual void UnbindContext(_Inout_ IExecutionContext* pContext) = 0;\n```  \n  \n### Parameters  \n `pContext`  \n The execution context to disassociate from its thread proxy.  \n  \n## See Also  \n [concurrency Namespace](concurrency-namespace.md)   \n [IScheduler Structure](ischeduler-structure.md)   \n [IThreadProxy Structure](ithreadproxy-structure.md)   \n [IVirtualProcessorRoot Structure](ivirtualprocessorroot-structure.md)   \n [IResourceManager Structure](iresourcemanager-structure.md)\n"}