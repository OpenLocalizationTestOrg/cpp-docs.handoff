{"nodes":[{"pos":[12,66],"content":"Upgrading an Existing ActiveX Control | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Upgrading an Existing ActiveX Control | Microsoft Docs","pos":[0,54]}]},{"content":"Upgrading an Existing ActiveX Control","pos":[967,1004]},{"content":"Existing ActiveX controls (formerly OLE controls) can be used on the Internet without modification.","pos":[1005,1104]},{"content":"However, you may want to modify controls to improve their performance.","pos":[1105,1175]},{"content":"When using your control on a Web page, there are additional considerations.","pos":[1176,1251]},{"content":"The .ocx file and all supporting files must be on the target machine or be downloaded across the Internet.","pos":[1252,1358]},{"content":"This makes code size and download time an important consideration.","pos":[1359,1425]},{"content":"Downloads can be packaged in a signed .cab file.","pos":[1426,1474]},{"content":"You can mark your control as safe for scripting, and as safe for initializing.","pos":[1475,1553]},{"content":"This article discusses the following topics:","pos":[1560,1604]},{"content":"Packaging Code for Downloading","pos":[1613,1643]},{"content":"Marking a Control Safe for Scripting and Initializing","pos":[1692,1745]},{"content":"Licensing Issues","pos":[1817,1833]},{"content":"Signing Code","pos":[1868,1880]},{"content":"Managing the Palette","pos":[1911,1931]},{"content":"Internet Explorer Browser Safety Levels and Control Behavior","pos":[1970,2030]},{"content":"You can also add optimizations, as described in <bpt id=\"p1\">[</bpt>ActiveX Controls: Optimization<ept id=\"p1\">](../mfc/mfc-activex-controls-optimization.md)</ept>.","pos":[2107,2233],"source":"You can also add optimizations, as described in [ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md)."},{"content":"Monikers can be used to download properties and large BLOBs asynchronously, as described in <bpt id=\"p1\">[</bpt>ActiveX Controls on the Internet<ept id=\"p1\">](../mfc/activex-controls-on-the-internet.md)</ept>.","pos":[2234,2405],"source":" Monikers can be used to download properties and large BLOBs asynchronously, as described in [ActiveX Controls on the Internet](../mfc/activex-controls-on-the-internet.md)."},{"pos":[2467,2497],"content":"Packaging Code for Downloading"},{"content":"For more information on this subject, see the Knowledge Base article \"Packaging MFC Controls for Use Over the Internet\" (Q167158).","pos":[2501,2631]},{"content":"You can find Knowledge Base articles on the MSDN Library CD-ROM or at <bpt id=\"p1\">[</bpt>http://support.microsoft.com/support<ept id=\"p1\">](http://support.microsoft.com/support)</ept>.","pos":[2632,2779],"source":" You can find Knowledge Base articles on the MSDN Library CD-ROM or at [http://support.microsoft.com/support](http://support.microsoft.com/support)."},{"content":"The CODEBASE Tag","pos":[2789,2805]},{"content":"ActiveX controls are embedded in Web pages using the <ph id=\"ph1\">`&lt;OBJECT&gt;`</ph> tag.","pos":[2809,2877],"source":"ActiveX controls are embedded in Web pages using the `<OBJECT>` tag."},{"content":"The <ph id=\"ph1\">`CODEBASE`</ph> parameter of the <ph id=\"ph2\">`&lt;OBJECT&gt;`</ph> tag specifies the location from which to download the control.","pos":[2878,2983],"source":" The `CODEBASE` parameter of the `<OBJECT>` tag specifies the location from which to download the control."},{"content":"can point at a number of different file types successfully.","pos":[2995,3054]},{"content":"Using the CODEBASE Tag with an OCX File","pos":[3064,3103]},{"content":"This solution downloads only the control's .ocx file, and requires any supporting DLLs to already be installed on the client machine.","pos":[3216,3349]},{"content":"This will work for Internet Explorer and MFC ActiveX controls built with Visual C++, because Internet Explorer ships with the supporting DLLs for Visual C++ controls.","pos":[3350,3516]},{"content":"If another Internet browser that is ActiveX control-capable is used to view this control, this solution will not work.","pos":[3517,3635]},{"content":"Using the CODEBASE Tag with an INF File","pos":[3645,3684]},{"content":"An .inf file will control the installation of an .ocx and its supporting files.","pos":[3760,3839]},{"content":"This method is not recommended because it is not possible to sign an .inf file (see <bpt id=\"p1\">[</bpt>Signing Code<ept id=\"p1\">](#_core_signing_code)</ept> for pointers on code signing).","pos":[3840,3990],"source":" This method is not recommended because it is not possible to sign an .inf file (see [Signing Code](#_core_signing_code) for pointers on code signing)."},{"content":"Using the CODEBASE Tag with a CAB File","pos":[4000,4038]},{"content":"Cabinet files are the recommended way to package ActiveX controls that use MFC.","pos":[4146,4225]},{"content":"Packaging an MFC ActiveX control in a cabinet file allows an .inf file to be included to control installation of the ActiveX control and any dependent DLLs (such as the MFC DLLs).","pos":[4226,4405]},{"content":"Using a CAB file automatically compresses the code for quicker download.","pos":[4406,4478]},{"content":"If you are using a .cab file for component download, it is faster to sign the entire .cab file than each individual component.","pos":[4479,4605]},{"content":"Creating CAB Files","pos":[4615,4633]},{"content":"You can download the Cabinet Development Kit from the Knowledge Base article <bpt id=\"p1\">[</bpt>310618: Microsoft Cabinet Software Development Kit<ept id=\"p1\">](http://go.microsoft.com/fwlink/linkid=148204)</ept>.","pos":[4637,4813],"source":"You can download the Cabinet Development Kit from the Knowledge Base article [310618: Microsoft Cabinet Software Development Kit](http://go.microsoft.com/fwlink/linkid=148204)."},{"content":"In this kit you will find the necessary tools to construct cabinet files.","pos":[4814,4887]},{"content":"The cabinet file pointed to by <ph id=\"ph1\">`CODEBASE`</ph> should contain the .ocx file for your ActiveX control and an .inf file to control its installation.","pos":[4894,5035],"source":"The cabinet file pointed to by `CODEBASE` should contain the .ocx file for your ActiveX control and an .inf file to control its installation."},{"content":"You create the cabinet file by specifying the name of your control file and an .inf file.","pos":[5036,5125]},{"content":"Do not include dependent DLLs that may already exist on the system in this cabinet file.","pos":[5126,5214]},{"content":"For example, the MFC DLLs are packaged in a separate cabinet file and referred to by the controlling .inf file.","pos":[5215,5326]},{"pos":[5333,5470],"content":"For details on how to create a CAB file, see <bpt id=\"p1\">[</bpt>Creating a CAB File<ept id=\"p1\">](http://msdn.microsoft.com/en-us/cc52fd09-bdf6-4410-a693-149a308f36a3)</ept>.","source":"For details on how to create a CAB file, see [Creating a CAB File](http://msdn.microsoft.com/en-us/cc52fd09-bdf6-4410-a693-149a308f36a3)."},{"content":"The INF File","pos":[5480,5492]},{"content":"The following example, spindial.inf, lists the supporting files and the version information needed for the MFC Spindial control.","pos":[5496,5624]},{"content":"Notice the location for the MFC DLLs is a Microsoft Web site.","pos":[5625,5686]},{"content":"The mfc42.cab is provided and signed by Microsoft.","pos":[5687,5737]},{"content":"The <ph id=\"ph1\">\\&lt;</ph>OBJECT&gt; Tag","pos":[6045,6062],"source":"The \\<OBJECT> Tag"},{"pos":[6066,6168],"content":"The following example illustrates using the <ph id=\"ph1\">`&lt;OBJECT&gt;`</ph> tag to package the MFC Spindial sample control.","source":"The following example illustrates using the `<OBJECT>` tag to package the MFC Spindial sample control."},{"content":"In this case, spindial.cab will contain two files, spindial.ocx and spindial.inf.","pos":[6586,6667]},{"content":"The following command will build the cabinet file:","pos":[6668,6718]},{"pos":[6816,6887],"content":"The <ph id=\"ph1\">`–s 6144`</ph> parameter reserves space in the cabinet for code signing.","source":"The `–s 6144` parameter reserves space in the cabinet for code signing."},{"content":"The Version Tag","pos":[6897,6912]},{"pos":[6916,7066],"content":"Note here that the <ph id=\"ph1\">`#Version`</ph> information specified with a CAB file applies to the control specified by the <ph id=\"ph2\">`CLASSID`</ph> parameter of the <ph id=\"ph3\">`&lt;OBJECT&gt;`</ph> tag.","source":"Note here that the `#Version` information specified with a CAB file applies to the control specified by the `CLASSID` parameter of the `<OBJECT>` tag."},{"content":"Depending on the version specified, you can force download of your control.","pos":[7073,7148]},{"content":"For complete specifications of the <ph id=\"ph1\">`OBJECT`</ph> tag including the <ph id=\"ph2\">`CODEBASE`</ph> parameter, see the W3C reference.","pos":[7149,7255],"source":" For complete specifications of the `OBJECT` tag including the `CODEBASE` parameter, see the W3C reference."},{"pos":[7340,7393],"content":"Marking a Control Safe for Scripting and Initializing"},{"content":"ActiveX controls used in Web pages should be marked as safe for scripting and safe for initializing if they are in fact safe.","pos":[7397,7522]},{"content":"A safe control will not perform disk IO or access the memory or registers of a machine directly.","pos":[7523,7619]},{"content":"Controls can be marked as safe for scripting and safe for initializing via the registry.","pos":[7626,7714]},{"content":"Modify <ph id=\"ph1\">`DllRegisterServer`</ph> to add entries similar to the following to mark the control as safe for scripting and persistence in the registry.","pos":[7715,7856],"source":" Modify `DllRegisterServer` to add entries similar to the following to mark the control as safe for scripting and persistence in the registry."},{"content":"An alternative method is to implement <ph id=\"ph1\">`IObjectSafety`</ph>.","pos":[7857,7911],"source":" An alternative method is to implement `IObjectSafety`."},{"content":"You will define GUIDs (Globally Unique Identifiers) for your control to mark it safe for scripting and for persistence.","pos":[7918,8037]},{"content":"Controls that can be safely scripted will contain a registry entry similar to the following:","pos":[8038,8130]},{"content":"Controls that can be safely initialized from persistent data are marked safe for persistence with a registry entry similar to:","pos":[8232,8358]},{"pos":[8460,8640],"content":"Add entries similar to the following (substituting your control's class ID in place of <ph id=\"ph1\">`{06889605-B8D0-101A-91F1-00608CEAD5B3}`</ph>) to associate your keys with the following class ID:","source":"Add entries similar to the following (substituting your control's class ID in place of `{06889605-B8D0-101A-91F1-00608CEAD5B3}`) to associate your keys with the following class ID:"},{"pos":[8959,8975],"content":"Licensing Issues"},{"content":"If you want to use a licensed control on a Web page, you must verify that the license agreement allows its use on the Internet and create a license package file (LPK) for it.","pos":[8979,9153]},{"content":"A licensed ActiveX control will not load properly in an HTML page if the computer running Internet Explorer is not licensed to use the control.","pos":[9160,9303]},{"content":"For example, if a licensed control was built using Visual C++, the HTML page using the control will load properly on the computer where the control was built, but it will not load on a different computer unless licensing information is included.","pos":[9304,9549]},{"content":"To use a licensed ActiveX control in Internet Explorer, you must check the vendor's license agreement to verify that the license for the control permits:","pos":[9556,9709]},{"content":"Redistribution","pos":[9719,9733]},{"content":"Use of the control on the Internet","pos":[9743,9777]},{"content":"Use of the Codebase parameter","pos":[9787,9816]},{"content":"To use a licensed control in an HTML page on a nonlicensed machine, you must generate a license package file (LPK).","pos":[9823,9938]},{"content":"The LPK file contains run-time licenses for licensed controls in the HTML page.","pos":[9939,10018]},{"content":"This file is generated via LPK_TOOL.EXE which comes with the ActiveX SDK.","pos":[10019,10092]},{"content":"For more information, see the MSDN Web site at <bpt id=\"p1\">[</bpt>http://msdn.microsoft.com<ept id=\"p1\">](http://msdn.microsoft.com)</ept>.","pos":[10093,10195],"source":" For more information, see the MSDN Web site at [http://msdn.microsoft.com](http://msdn.microsoft.com)."},{"content":"To create an LPK file","pos":[10206,10227]},{"content":"Run LPK_TOOL.EXE on a computer that is licensed to use the control.","pos":[10237,10304]},{"pos":[10314,10498],"content":"In the <bpt id=\"p1\">**</bpt>License Package Authoring Tool<ept id=\"p1\">**</ept> dialog box, in the <bpt id=\"p2\">**</bpt>Available Controls<ept id=\"p2\">**</ept> list box, select each licensed ActiveX control that will be used on the HTML page and click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>.","source":"In the **License Package Authoring Tool** dialog box, in the **Available Controls** list box, select each licensed ActiveX control that will be used on the HTML page and click **Add**."},{"content":"Click <bpt id=\"p1\">**</bpt>Save &amp; Exit<ept id=\"p1\">**</ept> and type a name for the LPK file.","pos":[10508,10563],"source":"Click **Save & Exit** and type a name for the LPK file."},{"content":"This will create the LPK file and close the application.","pos":[10564,10620]},{"content":"To embed a licensed control on an HTML page","pos":[10631,10674]},{"content":"Edit your HTML page.","pos":[10684,10704]},{"content":"In the HTML page, insert an <ph id=\"ph1\">\\&lt;</ph>OBJECT&gt; tag for the License Manager object before any other <ph id=\"ph2\">\\&lt;</ph>OBJECT&gt; tags.","pos":[10705,10810],"source":" In the HTML page, insert an \\<OBJECT> tag for the License Manager object before any other \\<OBJECT> tags."},{"content":"The License Manager is an ActiveX control that is installed with Internet Explorer.","pos":[10811,10894]},{"content":"Its class ID is shown below.","pos":[10895,10923]},{"content":"Set the LPKPath property of the License Manager object to the path and name of the LPK file.","pos":[10924,11016]},{"content":"You can have only one LPK file per HTML page.","pos":[11017,11062]},{"content":"Insert the <ph id=\"ph1\">\\&lt;</ph>OBJECT&gt; tag for your licensed control after the License Manager tag.","pos":[11229,11310],"source":"Insert the \\<OBJECT> tag for your licensed control after the License Manager tag."},{"content":"For example, an HTML page that displays the Microsoft Masked Edit control is shown below.","pos":[11321,11410]},{"content":"The first class ID is for the License Manager control, the second class ID is for the Masked Edit control.","pos":[11411,11517]},{"content":"Change the tags to point to the relative path of the .lpk file you created earlier, and add an object tag including the class ID for your control.","pos":[11518,11664]},{"content":"Insert the <ph id=\"ph1\">\\&lt;</ph>EMBED&gt; attribute for your LPK file, if using the NCompass ActiveX plug-in.","pos":[11674,11761],"source":"Insert the \\<EMBED> attribute for your LPK file, if using the NCompass ActiveX plug-in."},{"content":"If your control may be viewed on other Active enabled browsers — for example, Netscape using the NCompass ActiveX plug-in — you must add the <ph id=\"ph1\">\\&lt;</ph>EMBED&gt; syntax as shown below.","pos":[11772,11944],"source":"If your control may be viewed on other Active enabled browsers — for example, Netscape using the NCompass ActiveX plug-in — you must add the \\<EMBED> syntax as shown below."},{"pos":[12227,12387],"content":"For more information about control licensing, see <bpt id=\"p1\">[</bpt>ActiveX Controls: Licensing an ActiveX Control<ept id=\"p1\">](../mfc/mfc-activex-controls-licensing-an-activex-control.md)</ept>.","source":"For more information about control licensing, see [ActiveX Controls: Licensing an ActiveX Control](../mfc/mfc-activex-controls-licensing-an-activex-control.md)."},{"pos":[12431,12443],"content":"Signing Code"},{"content":"Code signing is designed to identify the source of code, and to guarantee that the code has not changed since it was signed.","pos":[12447,12571]},{"content":"Depending on browser safety settings, users may be warned before the code is downloaded.","pos":[12572,12660]},{"content":"Users may choose to trust certain certificate owners or companies, in which case code signed by those trusted will be downloaded without warning.","pos":[12661,12806]},{"content":"Code is digitally signed to avoid tampering.","pos":[12807,12851]},{"content":"Make sure your final code is signed so that your control can be automatically downloaded without displaying trust warning messages.","pos":[12858,12989]},{"content":"For details on how to sign code, check the documentation on Authenticode in the ActiveX SDK and see <bpt id=\"p1\">[</bpt>Signing a CAB File<ept id=\"p1\">](http://msdn.microsoft.com/en-us/04d8b47a-8f1c-4b54-ab90-730fcdc03747)</ept>.","pos":[12990,13181],"source":" For details on how to sign code, check the documentation on Authenticode in the ActiveX SDK and see [Signing a CAB File](http://msdn.microsoft.com/en-us/04d8b47a-8f1c-4b54-ab90-730fcdc03747)."},{"content":"Depending on trust and browser safety level settings, a certificate may be displayed to identify the signing person or company.","pos":[13188,13315]},{"content":"If the safety level is none, or if the signed control's certificate owner is trusted, a certificate will not be displayed.","pos":[13316,13438]},{"content":"See <bpt id=\"p1\">[</bpt>Internet Explorer Browser Safety Levels and Control Behavior<ept id=\"p1\">](#_core_internet_explorer_browser_safety_levels_and_control_behavior)</ept> for details on how the browser safety setting will determine whether your control is downloaded and a certificate displayed.","pos":[13439,13699],"source":" See [Internet Explorer Browser Safety Levels and Control Behavior](#_core_internet_explorer_browser_safety_levels_and_control_behavior) for details on how the browser safety setting will determine whether your control is downloaded and a certificate displayed."},{"content":"Digital signing guarantees code has not changed since it's been signed.","pos":[13706,13777]},{"content":"A hash of the code is taken and embedded in the certificate.","pos":[13778,13838]},{"content":"This hash is later compared with a hash of the code taken after the code is downloaded but before it runs.","pos":[13839,13945]},{"content":"Companies such as Verisign can supply private and public keys needed to sign code.","pos":[13946,14028]},{"content":"The ActiveX SDK ships with MakeCert, a utility for creating test certificates.","pos":[14029,14107]},{"pos":[14159,14179],"content":"Managing the Palette"},{"content":"Containers determine the palette and make it available as an ambient property, <bpt id=\"p1\">**</bpt>DISPID_AMBIENT_PALETTE<ept id=\"p1\">**</ept>.","pos":[14183,14289],"source":"Containers determine the palette and make it available as an ambient property, **DISPID_AMBIENT_PALETTE**."},{"content":"A container (for example, Internet Explorer) chooses a palette that is used by all ActiveX controls on a page to determine their own palette.","pos":[14290,14431]},{"content":"This prevents display flickering and presents a consistent appearance.","pos":[14432,14502]},{"pos":[14509,14607],"content":"A control can override <ph id=\"ph1\">`OnAmbientPropertyChange`</ph> to handle notification of changes to the palette.","source":"A control can override `OnAmbientPropertyChange` to handle notification of changes to the palette."},{"content":"A control can override <ph id=\"ph1\">`OnGetColorSet`</ph> to return a color set to draw the palette.","pos":[14614,14695],"source":"A control can override `OnGetColorSet` to return a color set to draw the palette."},{"content":"Containers use the return value to determine if a control is palette-aware.","pos":[14696,14771]},{"content":"Under OCX 96 guidelines, a control must always realize its palette in the background.","pos":[14778,14863]},{"content":"Older containers that do not use the ambient palette property will send <ph id=\"ph1\">`WM_QUERYNEWPALETTE`</ph> and <ph id=\"ph2\">`WM_PALETTECHANGED`</ph> messages.","pos":[14870,14996],"source":"Older containers that do not use the ambient palette property will send `WM_QUERYNEWPALETTE` and `WM_PALETTECHANGED` messages."},{"content":"A control can override <ph id=\"ph1\">`OnQueryNewPalette`</ph> and <ph id=\"ph2\">`OnPaletteChanged`</ph> to handle these messages.","pos":[14997,15088],"source":" A control can override `OnQueryNewPalette` and `OnPaletteChanged` to handle these messages."},{"pos":[15180,15240],"content":"Internet Explorer Browser Safety Levels and Control Behavior"},{"content":"A browser has options for safety level, configurable by the user.","pos":[15244,15309]},{"content":"Because Web pages can contain active content that might potentially harm a user's computer, browsers allow the user to select options for safety level.","pos":[15310,15461]},{"content":"Depending on the way a browser implements safety levels, a control may not be downloaded at all, or will display a certificate or a warning message to allow the user to choose at run time whether or not to download the control.","pos":[15462,15689]},{"content":"The behavior of ActiveX controls under high, medium, and low safety levels on Internet Explorer is listed below.","pos":[15690,15802]},{"content":"High Safety Mode","pos":[15812,15828]},{"content":"Unsigned controls will not be downloaded.","pos":[15838,15879]},{"content":"Signed controls will display a certificate if untrusted (a user can choose an option to always trust code from this certificate owner from now on).","pos":[15889,16036]},{"content":"Only controls marked as safe will have persistent data and/or be scriptable.","pos":[16046,16122]},{"content":"Medium Safety Mode","pos":[16132,16150]},{"content":"Unsigned controls will display a warning before downloading.","pos":[16160,16220]},{"content":"Signed controls will display a certificate if untrusted.","pos":[16230,16286]},{"content":"Controls not marked as safe will display a warning.","pos":[16296,16347]},{"content":"Low Safety Mode","pos":[16357,16372]},{"content":"Controls are downloaded without warning.","pos":[16382,16422]},{"content":"Scripting and persistence occur without warning.","pos":[16432,16480]},{"content":"See Also","pos":[16489,16497]},{"content":"MFC Internet Programming Tasks","pos":[16502,16532]},{"content":"MFC Internet Programming Basics","pos":[16581,16612]},{"content":"MFC ActiveX Controls: Licensing an ActiveX Control","pos":[16662,16712]}],"content":"---\ntitle: \"Upgrading an Existing ActiveX Control | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"ActiveX controls [C++], Internet\"\n  - \"LPK files for Internet controls\"\n  - \"safe for scripting and initialization (controls)\"\n  - \"OLE controls [C++], upgrading to ActiveX\"\n  - \"CAB files, for ActiveX controls\"\n  - \"Internet applications [C++], ActiveX controls\"\n  - \"Internet applications [C++], packaging code for download\"\n  - \"upgrading ActiveX controls\"\n  - \"licensing ActiveX controls\"\nms.assetid: 4d12ddfa-b491-4f9f-a0b7-b51458e05651\ncaps.latest.revision: 15\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Upgrading an Existing ActiveX Control\nExisting ActiveX controls (formerly OLE controls) can be used on the Internet without modification. However, you may want to modify controls to improve their performance. When using your control on a Web page, there are additional considerations. The .ocx file and all supporting files must be on the target machine or be downloaded across the Internet. This makes code size and download time an important consideration. Downloads can be packaged in a signed .cab file. You can mark your control as safe for scripting, and as safe for initializing.  \n  \n This article discusses the following topics:  \n  \n- [Packaging Code for Downloading](#_core_packaging_code_for_downloading)  \n  \n- [Marking a Control Safe for Scripting and Initializing](#_core_marking_a_control_safe_for_scripting_and_initializing)  \n  \n- [Licensing Issues](#_core_licensing_issues)  \n  \n- [Signing Code](#_core_signing_code)  \n  \n- [Managing the Palette](#_core_managing_the_palette)  \n  \n- [Internet Explorer Browser Safety Levels and Control Behavior](#_core_internet_explorer_browser_safety_levels_and_control_behavior)  \n  \n You can also add optimizations, as described in [ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md). Monikers can be used to download properties and large BLOBs asynchronously, as described in [ActiveX Controls on the Internet](../mfc/activex-controls-on-the-internet.md).  \n  \n##  <a name=\"_core_packaging_code_for_downloading\"></a> Packaging Code for Downloading  \n For more information on this subject, see the Knowledge Base article \"Packaging MFC Controls for Use Over the Internet\" (Q167158). You can find Knowledge Base articles on the MSDN Library CD-ROM or at [http://support.microsoft.com/support](http://support.microsoft.com/support).  \n  \n### The CODEBASE Tag  \n ActiveX controls are embedded in Web pages using the `<OBJECT>` tag. The `CODEBASE` parameter of the `<OBJECT>` tag specifies the location from which to download the control. `CODEBASE` can point at a number of different file types successfully.  \n  \n### Using the CODEBASE Tag with an OCX File  \n  \n```  \nCODEBASE=\"http://example.microsoft.com/mycontrol.ocx#version=4,\n    70,\n    0,\n    1086\"  \n```  \n  \n This solution downloads only the control's .ocx file, and requires any supporting DLLs to already be installed on the client machine. This will work for Internet Explorer and MFC ActiveX controls built with Visual C++, because Internet Explorer ships with the supporting DLLs for Visual C++ controls. If another Internet browser that is ActiveX control-capable is used to view this control, this solution will not work.  \n  \n### Using the CODEBASE Tag with an INF File  \n  \n```  \nCODEBASE=\"http://example.microsoft.com/trustme.inf\"  \n```  \n  \n An .inf file will control the installation of an .ocx and its supporting files. This method is not recommended because it is not possible to sign an .inf file (see [Signing Code](#_core_signing_code) for pointers on code signing).  \n  \n### Using the CODEBASE Tag with a CAB File  \n  \n```  \nCODEBASE=\"http://example.microsoft.com/acontrol.cab#version=1,\n    2,\n    0,\n    0\"  \n```  \n  \n Cabinet files are the recommended way to package ActiveX controls that use MFC. Packaging an MFC ActiveX control in a cabinet file allows an .inf file to be included to control installation of the ActiveX control and any dependent DLLs (such as the MFC DLLs). Using a CAB file automatically compresses the code for quicker download. If you are using a .cab file for component download, it is faster to sign the entire .cab file than each individual component.  \n  \n### Creating CAB Files  \n You can download the Cabinet Development Kit from the Knowledge Base article [310618: Microsoft Cabinet Software Development Kit](http://go.microsoft.com/fwlink/linkid=148204). In this kit you will find the necessary tools to construct cabinet files.  \n  \n The cabinet file pointed to by `CODEBASE` should contain the .ocx file for your ActiveX control and an .inf file to control its installation. You create the cabinet file by specifying the name of your control file and an .inf file. Do not include dependent DLLs that may already exist on the system in this cabinet file. For example, the MFC DLLs are packaged in a separate cabinet file and referred to by the controlling .inf file.  \n  \n For details on how to create a CAB file, see [Creating a CAB File](http://msdn.microsoft.com/en-us/cc52fd09-bdf6-4410-a693-149a308f36a3).  \n  \n### The INF File  \n The following example, spindial.inf, lists the supporting files and the version information needed for the MFC Spindial control. Notice the location for the MFC DLLs is a Microsoft Web site. The mfc42.cab is provided and signed by Microsoft.  \n  \n```  \nContents of spindial.inf:  \n[mfc42installer]   \nfile-win32-x86=http://activex.microsoft.com/controls/vc/mfc42.cab   \n[Olepro32.dll] - FileVersion=5,\n    0,\n    4261,\n    0  \n[Mfc42.dll] - FileVersion=6,\n    0,\n    8168,\n    0  \n[Msvcrt.dll] - FileVersion=6,\n    0,\n    8168,\n    0  \n```  \n  \n### The \\<OBJECT> Tag  \n The following example illustrates using the `<OBJECT>` tag to package the MFC Spindial sample control.  \n  \n```  \n<OBJECT ID=\"Spindial1\" WIDTH=100 HEIGHT=51  \n    CLASSID=\"CLSID:06889605-B8D0-101A-91F1-00608CEAD5B3\" \n    CODEBASE=\"http://example.microsoft.com/spindial.cab#Version=1,0,0,001\"> \n <PARAM NAME=\"_Version\" VALUE=\"65536\">  \n <PARAM NAME=\"_ExtentX\" VALUE=\"2646\">  \n <PARAM NAME=\"_ExtentY\" VALUE=\"1323\">  \n <PARAM NAME=\"_StockProps\" VALUE=\"0\">  \n <PARAM NAME=\"NeedlePosition\" VALUE=\"2\">  \n</OBJECT>  \n```  \n  \n In this case, spindial.cab will contain two files, spindial.ocx and spindial.inf. The following command will build the cabinet file:  \n  \n```  \nC:\\CabDevKit\\cabarc.exe -s 6144 N spindial.cab spindial.ocx spindial.inf   \n```  \n  \n The `–s 6144` parameter reserves space in the cabinet for code signing.  \n  \n### The Version Tag  \n Note here that the `#Version` information specified with a CAB file applies to the control specified by the `CLASSID` parameter of the `<OBJECT>` tag.  \n  \n Depending on the version specified, you can force download of your control. For complete specifications of the `OBJECT` tag including the `CODEBASE` parameter, see the W3C reference.  \n  \n##  <a name=\"_core_marking_a_control_safe_for_scripting_and_initializing\"></a> Marking a Control Safe for Scripting and Initializing  \n ActiveX controls used in Web pages should be marked as safe for scripting and safe for initializing if they are in fact safe. A safe control will not perform disk IO or access the memory or registers of a machine directly.  \n  \n Controls can be marked as safe for scripting and safe for initializing via the registry. Modify `DllRegisterServer` to add entries similar to the following to mark the control as safe for scripting and persistence in the registry. An alternative method is to implement `IObjectSafety`.  \n  \n You will define GUIDs (Globally Unique Identifiers) for your control to mark it safe for scripting and for persistence. Controls that can be safely scripted will contain a registry entry similar to the following:  \n  \n```  \nHKEY_CLASSES_ROOT\\Component Categories\\{7DD95801-9882-11CF-9FA9-00AA006C42C4}  \n```  \n  \n Controls that can be safely initialized from persistent data are marked safe for persistence with a registry entry similar to:  \n  \n```  \nHKEY_CLASSES_ROOT\\Component Categories\\{7DD95802-9882-11CF-9FA9-00AA006C42C4}  \n```  \n  \n Add entries similar to the following (substituting your control's class ID in place of `{06889605-B8D0-101A-91F1-00608CEAD5B3}`) to associate your keys with the following class ID:  \n  \n```  \nHKEY_CLASSES_ROOT\\CLSID\\{06889605-B8D0-101A-91F1-00608CEAD5B3}\\Implemented Categories\\{7DD95801-9882-11CF-9FA9-00AA006C42C4}   \nHKEY_CLASSES_ROOT\\CLSID\\{06889605-B8D0-101A-91F1-00608CEAD5B3}\\Implemented Categories\\{7DD95802-9882-11CF-9FA9-00AA006C42C4}   \n```  \n  \n##  <a name=\"_core_licensing_issues\"></a> Licensing Issues  \n If you want to use a licensed control on a Web page, you must verify that the license agreement allows its use on the Internet and create a license package file (LPK) for it.  \n  \n A licensed ActiveX control will not load properly in an HTML page if the computer running Internet Explorer is not licensed to use the control. For example, if a licensed control was built using Visual C++, the HTML page using the control will load properly on the computer where the control was built, but it will not load on a different computer unless licensing information is included.  \n  \n To use a licensed ActiveX control in Internet Explorer, you must check the vendor's license agreement to verify that the license for the control permits:  \n  \n-   Redistribution  \n  \n-   Use of the control on the Internet  \n  \n-   Use of the Codebase parameter  \n  \n To use a licensed control in an HTML page on a nonlicensed machine, you must generate a license package file (LPK). The LPK file contains run-time licenses for licensed controls in the HTML page. This file is generated via LPK_TOOL.EXE which comes with the ActiveX SDK. For more information, see the MSDN Web site at [http://msdn.microsoft.com](http://msdn.microsoft.com).  \n  \n#### To create an LPK file  \n  \n1.  Run LPK_TOOL.EXE on a computer that is licensed to use the control.  \n  \n2.  In the **License Package Authoring Tool** dialog box, in the **Available Controls** list box, select each licensed ActiveX control that will be used on the HTML page and click **Add**.  \n  \n3.  Click **Save & Exit** and type a name for the LPK file. This will create the LPK file and close the application.  \n  \n#### To embed a licensed control on an HTML page  \n  \n1.  Edit your HTML page. In the HTML page, insert an \\<OBJECT> tag for the License Manager object before any other \\<OBJECT> tags. The License Manager is an ActiveX control that is installed with Internet Explorer. Its class ID is shown below. Set the LPKPath property of the License Manager object to the path and name of the LPK file. You can have only one LPK file per HTML page.  \n  \n ```  \n <OBJECT CLASSID = \"clsid:5220cb21-c88d-11cf-b347-00aa00a28331\">  \n <PARAM NAME=\"LPKPath\" VALUE=\"relative URL to .LPK file\">  \n </OBJECT>  \n ```  \n  \n2.  Insert the \\<OBJECT> tag for your licensed control after the License Manager tag.  \n  \n     For example, an HTML page that displays the Microsoft Masked Edit control is shown below. The first class ID is for the License Manager control, the second class ID is for the Masked Edit control. Change the tags to point to the relative path of the .lpk file you created earlier, and add an object tag including the class ID for your control.  \n  \n3.  Insert the \\<EMBED> attribute for your LPK file, if using the NCompass ActiveX plug-in.  \n  \n     If your control may be viewed on other Active enabled browsers — for example, Netscape using the NCompass ActiveX plug-in — you must add the \\<EMBED> syntax as shown below.  \n  \n ```  \n <OBJECT CLASSID=\"clsid:5220cb21-c88d-11cf-b347-00aa00a28331\">  \n <PARAM NAME=\"LPKPath\" VALUE=\"maskedit.lpk\">  \n \n <EMBED SRC = \"maskedit.LPK\">  \n \n </OBJECT>  \n <OBJECT CLASSID=\"clsid:C932BA85-4374-101B-A56C-00AA003668DC\" WIDTH=100 HEIGHT=25>  \n </OBJECT>  \n ```  \n  \n For more information about control licensing, see [ActiveX Controls: Licensing an ActiveX Control](../mfc/mfc-activex-controls-licensing-an-activex-control.md).  \n  \n##  <a name=\"_core_signing_code\"></a> Signing Code  \n Code signing is designed to identify the source of code, and to guarantee that the code has not changed since it was signed. Depending on browser safety settings, users may be warned before the code is downloaded. Users may choose to trust certain certificate owners or companies, in which case code signed by those trusted will be downloaded without warning. Code is digitally signed to avoid tampering.  \n  \n Make sure your final code is signed so that your control can be automatically downloaded without displaying trust warning messages. For details on how to sign code, check the documentation on Authenticode in the ActiveX SDK and see [Signing a CAB File](http://msdn.microsoft.com/en-us/04d8b47a-8f1c-4b54-ab90-730fcdc03747).  \n  \n Depending on trust and browser safety level settings, a certificate may be displayed to identify the signing person or company. If the safety level is none, or if the signed control's certificate owner is trusted, a certificate will not be displayed. See [Internet Explorer Browser Safety Levels and Control Behavior](#_core_internet_explorer_browser_safety_levels_and_control_behavior) for details on how the browser safety setting will determine whether your control is downloaded and a certificate displayed.  \n  \n Digital signing guarantees code has not changed since it's been signed. A hash of the code is taken and embedded in the certificate. This hash is later compared with a hash of the code taken after the code is downloaded but before it runs. Companies such as Verisign can supply private and public keys needed to sign code. The ActiveX SDK ships with MakeCert, a utility for creating test certificates.  \n  \n##  <a name=\"_core_managing_the_palette\"></a> Managing the Palette  \n Containers determine the palette and make it available as an ambient property, **DISPID_AMBIENT_PALETTE**. A container (for example, Internet Explorer) chooses a palette that is used by all ActiveX controls on a page to determine their own palette. This prevents display flickering and presents a consistent appearance.  \n  \n A control can override `OnAmbientPropertyChange` to handle notification of changes to the palette.  \n  \n A control can override `OnGetColorSet` to return a color set to draw the palette. Containers use the return value to determine if a control is palette-aware.  \n  \n Under OCX 96 guidelines, a control must always realize its palette in the background.  \n  \n Older containers that do not use the ambient palette property will send `WM_QUERYNEWPALETTE` and `WM_PALETTECHANGED` messages. A control can override `OnQueryNewPalette` and `OnPaletteChanged` to handle these messages.  \n  \n##  <a name=\"_core_internet_explorer_browser_safety_levels_and_control_behavior\"></a> Internet Explorer Browser Safety Levels and Control Behavior  \n A browser has options for safety level, configurable by the user. Because Web pages can contain active content that might potentially harm a user's computer, browsers allow the user to select options for safety level. Depending on the way a browser implements safety levels, a control may not be downloaded at all, or will display a certificate or a warning message to allow the user to choose at run time whether or not to download the control. The behavior of ActiveX controls under high, medium, and low safety levels on Internet Explorer is listed below.  \n  \n### High Safety Mode  \n  \n-   Unsigned controls will not be downloaded.  \n  \n-   Signed controls will display a certificate if untrusted (a user can choose an option to always trust code from this certificate owner from now on).  \n  \n-   Only controls marked as safe will have persistent data and/or be scriptable.  \n  \n### Medium Safety Mode  \n  \n-   Unsigned controls will display a warning before downloading.  \n  \n-   Signed controls will display a certificate if untrusted.  \n  \n-   Controls not marked as safe will display a warning.  \n  \n### Low Safety Mode  \n  \n-   Controls are downloaded without warning.  \n  \n-   Scripting and persistence occur without warning.  \n  \n## See Also  \n [MFC Internet Programming Tasks](../mfc/mfc-internet-programming-tasks.md)   \n [MFC Internet Programming Basics](../mfc/mfc-internet-programming-basics.md)   \n [MFC ActiveX Controls: Licensing an ActiveX Control](../mfc/mfc-activex-controls-licensing-an-activex-control.md)\n\n"}