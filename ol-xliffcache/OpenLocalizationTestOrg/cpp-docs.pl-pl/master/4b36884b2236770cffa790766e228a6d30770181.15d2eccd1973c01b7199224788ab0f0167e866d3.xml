{"nodes":[{"pos":[12,69],"content":"Using TCHAR.H Data Types with _MBCS Code | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Using TCHAR.H Data Types with _MBCS Code | Microsoft Docs","pos":[0,57]}]},{"content":"Using TCHAR.H Data Types with _MBCS Code","pos":[809,849]},{"pos":[850,975],"content":"When the manifest constant <bpt id=\"p1\">**</bpt>_MBCS<ept id=\"p1\">**</ept> is defined, a given generic-text routine maps to one of the following kinds of routines:","source":"When the manifest constant **_MBCS** is defined, a given generic-text routine maps to one of the following kinds of routines:"},{"content":"An SBCS routine that handles multibyte bytes, characters, and strings appropriately.","pos":[985,1069]},{"content":"In this case, the string arguments are expected to be of type <bpt id=\"p1\">**</bpt>char<ph id=\"ph1\">\\*</ph><ept id=\"p1\">**</ept>.","pos":[1070,1143],"source":" In this case, the string arguments are expected to be of type **char\\***."},{"content":"For example, <ph id=\"ph1\">`_tprintf`</ph> maps to <ph id=\"ph2\">`printf`</ph>; the string arguments to <ph id=\"ph3\">`printf`</ph> are of type <bpt id=\"p1\">**</bpt>char<ph id=\"ph4\">\\*</ph><ept id=\"p1\">**</ept>.","pos":[1144,1242],"source":" For example, `_tprintf` maps to `printf`; the string arguments to `printf` are of type **char\\***."},{"content":"If you use the <bpt id=\"p1\">**</bpt>_TCHAR<ept id=\"p1\">**</ept> generic-text data type for your string types, the formal and actual parameter types for <ph id=\"ph1\">`printf`</ph> match because <bpt id=\"p2\">**</bpt>_TCHAR<ept id=\"p2\">**</ept><ph id=\"ph2\">\\*</ph> maps to <bpt id=\"p3\">**</bpt>char<ph id=\"ph3\">\\*</ph><ept id=\"p3\">**</ept>.","pos":[1243,1412],"source":" If you use the **_TCHAR** generic-text data type for your string types, the formal and actual parameter types for `printf` match because **_TCHAR**\\* maps to **char\\***."},{"content":"An MBCS-specific routine.","pos":[1422,1447]},{"content":"In this case, the string arguments are expected to be of type <ph id=\"ph1\">`unsigned`</ph> <bpt id=\"p1\">**</bpt>char<ph id=\"ph2\">\\*</ph><ept id=\"p1\">**</ept>.","pos":[1448,1532],"source":" In this case, the string arguments are expected to be of type `unsigned` **char\\***."},{"content":"For example, <ph id=\"ph1\">`_tcsrev`</ph> maps to <ph id=\"ph2\">`_mbsrev`</ph>, which expects and returns a string of type <ph id=\"ph3\">`unsigned`</ph> <bpt id=\"p1\">**</bpt>char<ph id=\"ph4\">\\*</ph><ept id=\"p1\">**</ept>.","pos":[1533,1640],"source":" For example, `_tcsrev` maps to `_mbsrev`, which expects and returns a string of type `unsigned` **char\\***."},{"content":"If you use the <bpt id=\"p1\">**</bpt>_TCHAR<ept id=\"p1\">**</ept> generic-text data type for your string types, there is a potential type conflict because <bpt id=\"p2\">**</bpt>_TCHAR<ept id=\"p2\">**</ept> maps to type <ph id=\"ph1\">`char`</ph>.","pos":[1641,1787],"source":" If you use the **_TCHAR** generic-text data type for your string types, there is a potential type conflict because **_TCHAR** maps to type `char`."},{"content":"Following are three solutions for preventing this type conflict (and the C compiler warnings or C++ compiler errors that would result):","pos":[1794,1929]},{"content":"Use the default behavior.","pos":[1939,1964]},{"content":"Tchar.h provides generic-text routine prototypes for routines in the run-time libraries, as in the following example.","pos":[1965,2082]},{"content":"In the default case, the prototype for <ph id=\"ph1\">`_tcsrev`</ph> maps to <ph id=\"ph2\">`_mbsrev`</ph> through a thunk in Libc.lib.","pos":[2146,2241],"source":"In the default case, the prototype for `_tcsrev` maps to `_mbsrev` through a thunk in Libc.lib."},{"content":"This changes the types of the <ph id=\"ph1\">`_mbsrev`</ph> incoming parameters and outgoing return value from <bpt id=\"p1\">**</bpt>_TCHAR <ph id=\"ph2\">\\*</ph><ept id=\"p1\">**</ept> (that is, <ph id=\"ph3\">`char`</ph> <bpt id=\"p2\">**</bpt><ph id=\"ph4\">\\*</ph><ept id=\"p2\">**</ept>) to <ph id=\"ph5\">`unsigned`</ph> <ph id=\"ph6\">`char`</ph> <bpt id=\"p3\">**</bpt><ph id=\"ph7\">\\*</ph><ept id=\"p3\">**</ept>.","pos":[2242,2400],"source":" This changes the types of the `_mbsrev` incoming parameters and outgoing return value from **_TCHAR \\*** (that is, `char` **\\***) to `unsigned` `char` **\\***."},{"content":"This method ensures type matching when you are using <bpt id=\"p1\">**</bpt>_TCHAR<ept id=\"p1\">**</ept>, but it is relatively slow due to the function call overhead.","pos":[2401,2526],"source":" This method ensures type matching when you are using **_TCHAR**, but it is relatively slow due to the function call overhead."},{"content":"Use function inlining by incorporating the following preprocessor statement in your code.","pos":[2536,2625]},{"content":"This method causes an inline function thunk, provided in Tchar.h, to map the generic-text routine directly to the appropriate MBCS routine.","pos":[2687,2826]},{"content":"The following code excerpt from Tchar.h provides an example of how this is done.","pos":[2827,2907]},{"content":"If you can use inlining, this is the best solution, because it guarantees type matching and has no additional time cost.","pos":[3035,3155]},{"content":"Use direct mapping by incorporating the following preprocessor statement in your code.","pos":[3165,3251]},{"content":"This approach provides a fast alternative if you do not want to use the default behavior or cannot use inlining.","pos":[3314,3426]},{"content":"It causes the generic-text routine to be mapped by a macro directly to the MBCS version of the routine, as in the following example from Tchar.h.","pos":[3427,3572]},{"content":"When you take this approach, you must be careful to ensure use of appropriate data types for string arguments and string return values.","pos":[3636,3771]},{"content":"You can use type casting to ensure proper type matching or you can use the <bpt id=\"p1\">**</bpt>_TXCHAR<ept id=\"p1\">**</ept> generic-text data type.","pos":[3772,3882],"source":" You can use type casting to ensure proper type matching or you can use the **_TXCHAR** generic-text data type."},{"content":"<bpt id=\"p1\">**</bpt>_TXCHAR<ept id=\"p1\">**</ept> maps to type <ph id=\"ph1\">`char`</ph> in SBCS code but maps to type <ph id=\"ph2\">`unsigned`</ph> <ph id=\"ph3\">`char`</ph> in MBCS code.","pos":[3883,3976],"source":"**_TXCHAR** maps to type `char` in SBCS code but maps to type `unsigned` `char` in MBCS code."},{"content":"For more information about generic-text macros, see <bpt id=\"p1\">[</bpt>Generic-Text Mappings<ept id=\"p1\">](../c-runtime-library/generic-text-mappings.md)</ept> in the <bpt id=\"p2\">*</bpt>Run-Time Library Reference<ept id=\"p2\">*</ept>.","pos":[3977,4136],"source":" For more information about generic-text macros, see [Generic-Text Mappings](../c-runtime-library/generic-text-mappings.md) in the *Run-Time Library Reference*."},{"content":"See Also","pos":[4145,4153]},{"content":"Generic-Text Mappings in Tchar.h","pos":[4158,4190]}],"content":"---\ntitle: \"Using TCHAR.H Data Types with _MBCS Code | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"tchar.h\"\n  - \"TCHAR\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"mapping generic-text\"\n  - \"generic-text data types [C++]\"\n  - \"generic-text mappings [C++]\"\n  - \"MBCS [C++], generic-text mappings\"\n  - \"TCHAR.H data types, mapping\"\n  - \"mappings [C++], TCHAR.H\"\nms.assetid: 298583c5-22c3-40f6-920e-9ec96d42abd8\ncaps.latest.revision: 7\nauthor: \"ghogen\"\nms.author: \"ghogen\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Using TCHAR.H Data Types with _MBCS Code\nWhen the manifest constant **_MBCS** is defined, a given generic-text routine maps to one of the following kinds of routines:  \n  \n-   An SBCS routine that handles multibyte bytes, characters, and strings appropriately. In this case, the string arguments are expected to be of type **char\\***. For example, `_tprintf` maps to `printf`; the string arguments to `printf` are of type **char\\***. If you use the **_TCHAR** generic-text data type for your string types, the formal and actual parameter types for `printf` match because **_TCHAR**\\* maps to **char\\***.  \n  \n-   An MBCS-specific routine. In this case, the string arguments are expected to be of type `unsigned` **char\\***. For example, `_tcsrev` maps to `_mbsrev`, which expects and returns a string of type `unsigned` **char\\***. If you use the **_TCHAR** generic-text data type for your string types, there is a potential type conflict because **_TCHAR** maps to type `char`.  \n  \n Following are three solutions for preventing this type conflict (and the C compiler warnings or C++ compiler errors that would result):  \n  \n-   Use the default behavior. Tchar.h provides generic-text routine prototypes for routines in the run-time libraries, as in the following example.  \n  \n    ```  \n    char * _tcsrev(char *);  \n    ```  \n  \n     In the default case, the prototype for `_tcsrev` maps to `_mbsrev` through a thunk in Libc.lib. This changes the types of the `_mbsrev` incoming parameters and outgoing return value from **_TCHAR \\*** (that is, `char` **\\***) to `unsigned` `char` **\\***. This method ensures type matching when you are using **_TCHAR**, but it is relatively slow due to the function call overhead.  \n  \n-   Use function inlining by incorporating the following preprocessor statement in your code.  \n  \n    ```  \n    #define _USE_INLINING  \n    ```  \n  \n     This method causes an inline function thunk, provided in Tchar.h, to map the generic-text routine directly to the appropriate MBCS routine. The following code excerpt from Tchar.h provides an example of how this is done.  \n  \n    ```  \n    __inline char *_tcsrev(char *_s1)  \n    {return (char *)_mbsrev((unsigned char *)_s1);}  \n    ```  \n  \n     If you can use inlining, this is the best solution, because it guarantees type matching and has no additional time cost.  \n  \n-   Use direct mapping by incorporating the following preprocessor statement in your code.  \n  \n    ```  \n    #define _MB_MAP_DIRECT  \n    ```  \n  \n     This approach provides a fast alternative if you do not want to use the default behavior or cannot use inlining. It causes the generic-text routine to be mapped by a macro directly to the MBCS version of the routine, as in the following example from Tchar.h.  \n  \n    ```  \n    #define _tcschr _mbschr  \n    ```  \n  \n     When you take this approach, you must be careful to ensure use of appropriate data types for string arguments and string return values. You can use type casting to ensure proper type matching or you can use the **_TXCHAR** generic-text data type. **_TXCHAR** maps to type `char` in SBCS code but maps to type `unsigned` `char` in MBCS code. For more information about generic-text macros, see [Generic-Text Mappings](../c-runtime-library/generic-text-mappings.md) in the *Run-Time Library Reference*.  \n  \n## See Also  \n [Generic-Text Mappings in Tchar.h](../text/generic-text-mappings-in-tchar-h.md)"}