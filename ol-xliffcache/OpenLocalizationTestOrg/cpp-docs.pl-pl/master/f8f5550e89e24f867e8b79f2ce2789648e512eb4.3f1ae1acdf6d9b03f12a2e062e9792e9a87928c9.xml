{"nodes":[{"pos":[12,77],"content":"Migrating from OpenMP to the Concurrency Runtime | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Migrating from OpenMP to the Concurrency Runtime | Microsoft Docs","pos":[0,65]}]},{"content":"Migrating from OpenMP to the Concurrency Runtime","pos":[680,728]},{"content":"The Concurrency Runtime enables a variety of programming models.","pos":[729,793]},{"content":"These models may overlap or complement the models of other libraries.","pos":[794,863]},{"content":"The documents in this section compare <bpt id=\"p1\">[</bpt>OpenMP<ept id=\"p1\">](../../parallel/concrt/comparing-the-concurrency-runtime-to-other-concurrency-models.md#openmp)</ept> to the Concurrency Runtime and provide examples about how to migrate existing OpenMP code to use the Concurrency Runtime.","pos":[864,1127],"source":" The documents in this section compare [OpenMP](../../parallel/concrt/comparing-the-concurrency-runtime-to-other-concurrency-models.md#openmp) to the Concurrency Runtime and provide examples about how to migrate existing OpenMP code to use the Concurrency Runtime."},{"content":"The OpenMP programming model is defined by an open standard and has well-defined bindings to the Fortran and C/C++ programming languages.","pos":[1134,1271]},{"content":"OpenMP versions 2.0 and 2.5, which are supported by the Visual C++ compiler, are well-suited for parallel algorithms that are iterative; that is, they perform parallel iteration over an array of data.","pos":[1272,1472]},{"content":"OpenMP 3.0 supports non-iterative tasks in addition to iterative tasks.","pos":[1473,1544]},{"content":"OpenMP is most efficient when the degree of parallelism is pre-determined and matches the available resources on the system.","pos":[1551,1675]},{"content":"The OpenMP model is an especially good match for high-performance computing, where very large computational problems are distributed across the processing resources of one computer.","pos":[1676,1857]},{"content":"In this scenario, the hardware environment is generally fixed and the developer can reasonably expect to have exclusive access to all computing resources when the algorithm is executed.","pos":[1858,2043]},{"content":"However, less constrained computing environments may not be a good match for OpenMP.","pos":[2050,2134]},{"content":"For example, recursive problems (such as the quicksort algorithm or searching a tree of data) are more difficult to implement by using OpenMP 2.0 and 2.5.","pos":[2135,2289]},{"content":"The Concurrency Runtime complements the capabilities of OpenMP by providing the <bpt id=\"p1\">[</bpt>Asynchronous Agents Library<ept id=\"p1\">](../../parallel/concrt/asynchronous-agents-library.md)</ept> and the <bpt id=\"p2\">[</bpt>Parallel Patterns Library<ept id=\"p2\">](../../parallel/concrt/parallel-patterns-library-ppl.md)</ept> (PPL).","pos":[2290,2552],"source":" The Concurrency Runtime complements the capabilities of OpenMP by providing the [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) and the [Parallel Patterns Library](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL)."},{"content":"The Asynchronous Agents Library supports coarse-grained task parallelism; the PPL supports more fine-grained parallel tasks.","pos":[2553,2677]},{"content":"The Concurrency Runtime provides the infrastructure that is required to perform operations in parallel so that you can focus on the logic of your application.","pos":[2678,2836]},{"content":"However, because the Concurrency Runtime enables a variety of programming models, its scheduling overhead can be greater than other concurrency libraries such as OpenMP.","pos":[2837,3006]},{"content":"Therefore, we recommend that you test performance incrementally when you convert your existing OpenMP code to use the Concurrency Runtime.","pos":[3007,3145]},{"content":"When to Migrate from OpenMP to the Concurrency Runtime","pos":[3154,3208]},{"content":"It may be advantageous to migrate existing OpenMP code to use the Concurrency Runtime in the following cases.","pos":[3212,3321]},{"content":"Cases","pos":[3328,3333]},{"content":"Advantages of the Concurrency Runtime","pos":[3334,3371]},{"content":"You require an extensible concurrent programming framework.","pos":[3436,3495]},{"content":"Many of the features in the Concurrency Runtime can be extended.","pos":[3496,3560]},{"content":"You can also combine existing features to compose new ones.","pos":[3561,3620]},{"content":"Because OpenMP relies on compiler directives, it cannot be easily extended.","pos":[3621,3696]},{"content":"Your application would benefit from cooperative blocking.","pos":[3701,3758]},{"content":"When a task blocks because it requires a resource that is not yet available, the Concurrency Runtime can perform other tasks while the first task waits for the resource.","pos":[3759,3928]},{"content":"Your application would benefit from dynamic load balancing.","pos":[3933,3992]},{"content":"The Concurrency Runtime uses a scheduling algorithm that adjusts the allocation of computing resources as workloads change.","pos":[3993,4116]},{"content":"In OpenMP, when the scheduler allocates computing resources to a parallel region, those resource allocations are fixed throughout the computation.","pos":[4117,4263]},{"content":"You require exception handling support.","pos":[4268,4307]},{"content":"The PPL lets you catch exceptions both inside and outside of a parallel region or loop.","pos":[4308,4395]},{"content":"In OpenMP, you must handle the exception inside of the parallel region or loop.","pos":[4396,4475]},{"content":"You require a cancellation mechanism.","pos":[4480,4517]},{"content":"The PPL enables applications to cancel both individual tasks and parallel trees of work.","pos":[4518,4606]},{"content":"OpenMP requires the application to implement its own cancellation mechanism.","pos":[4607,4683]},{"content":"You require parallel code to finish in a different context from which it starts.","pos":[4688,4768]},{"content":"The Concurrency Runtime lets you start a task in one context, and then wait on or cancel that task in another context.","pos":[4769,4887]},{"content":"In OpenMP, all parallel work must finish in the context from which it starts.","pos":[4888,4965]},{"content":"You require enhanced debugging support.","pos":[4970,5009]},{"content":"Visual Studio provides the <bpt id=\"p1\">**</bpt>Parallel Stacks<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Parallel Tasks<ept id=\"p2\">**</ept> windows so that you can more easily debug multithreaded applications.","pos":[5010,5149],"source":"Visual Studio provides the **Parallel Stacks** and **Parallel Tasks** windows so that you can more easily debug multithreaded applications."},{"content":"For more information about debugging support for the Concurrency Runtime, see <bpt id=\"p1\">[</bpt>Using the Tasks Window<ept id=\"p1\">](/visualstudio/debugger/using-the-tasks-window)</ept>, <bpt id=\"p2\">[</bpt>Using the Parallel Stacks Window<ept id=\"p2\">](/visualstudio/debugger/using-the-parallel-stacks-window)</ept>, and <bpt id=\"p3\">[</bpt>Walkthrough: Debugging a Parallel Application<ept id=\"p3\">](http://msdn.microsoft.com/library/2820ac4c-c893-4d87-8c62-83981d561493)</ept>.","pos":[5162,5530],"source":" For more information about debugging support for the Concurrency Runtime, see [Using the Tasks Window](/visualstudio/debugger/using-the-tasks-window), [Using the Parallel Stacks Window](/visualstudio/debugger/using-the-parallel-stacks-window), and [Walkthrough: Debugging a Parallel Application](http://msdn.microsoft.com/library/2820ac4c-c893-4d87-8c62-83981d561493)."},{"content":"When Not to Migrate from OpenMP to the Concurrency Runtime","pos":[5540,5598]},{"content":"The following cases describe when it might not be appropriate to migrate existing OpenMP code to use the Concurrency Runtime.","pos":[5602,5727]},{"content":"Cases","pos":[5734,5739]},{"content":"Explanation","pos":[5740,5751]},{"content":"Your application already meets your requirements.","pos":[5790,5839]},{"content":"If you are satisfied with application performance and current debugging support, migration might not be appropriate.","pos":[5840,5956]},{"content":"Your parallel loop bodies perform little work.","pos":[5961,6007]},{"content":"The overhead of the Concurrency Runtime task scheduler might not overcome the benefits of executing the loop body in parallel, especially when the loop body is relatively small.","pos":[6008,6185]},{"content":"Your application is written in C.","pos":[6190,6223]},{"content":"Because the Concurrency Runtime uses many C++ features, it might not be suitable when you cannot write code that enables the C application to fully use it.","pos":[6224,6379]},{"content":"Related Topics","pos":[6389,6403]},{"content":"How to: Convert an OpenMP parallel for Loop to Use the Concurrency Runtime","pos":[6408,6482]},{"pos":[6588,6962],"content":"Given a basic loop that uses the OpenMP <bpt id=\"p1\">[</bpt>parallel<ept id=\"p1\">](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)</ept> and <bpt id=\"p2\">[</bpt>for<ept id=\"p2\">](../../parallel/openmp/reference/for-openmp.md)</ept> directives, demonstrates how to convert it to use the Concurrency Runtime <bpt id=\"p3\">[</bpt>concurrency::parallel_for<ept id=\"p3\">](reference/concurrency-namespace-functions.md#parallel_for)</ept> algorithm.","source":"Given a basic loop that uses the OpenMP [parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel) and [for](../../parallel/openmp/reference/for-openmp.md) directives, demonstrates how to convert it to use the Concurrency Runtime [concurrency::parallel_for](reference/concurrency-namespace-functions.md#parallel_for) algorithm."},{"content":"How to: Convert an OpenMP Loop that Uses Cancellation to Use the Concurrency Runtime","pos":[6971,7055]},{"content":"Given an OpenMP <bpt id=\"p1\">[</bpt>parallel<ept id=\"p1\">](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)</ept><bpt id=\"p2\">[</bpt>for<ept id=\"p2\">](../../parallel/openmp/reference/for-openmp.md)</ept> loop that does not require all iterations to run, demonstrates how to convert it to use the Concurrency Runtime cancellation mechanism.","pos":[7132,7441],"source":" Given an OpenMP [parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[for](../../parallel/openmp/reference/for-openmp.md) loop that does not require all iterations to run, demonstrates how to convert it to use the Concurrency Runtime cancellation mechanism."},{"content":"How to: Convert an OpenMP Loop that Uses Exception Handling to Use the Concurrency Runtime","pos":[7449,7539]},{"content":"Given an OpenMP <bpt id=\"p1\">[</bpt>parallel<ept id=\"p1\">](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)</ept><bpt id=\"p2\">[</bpt>for<ept id=\"p2\">](../../parallel/openmp/reference/for-openmp.md)</ept> loop that performs exception handling, demonstrates how to convert it to use the Concurrency Runtime exception handling mechanism.","pos":[7622,7926],"source":" Given an OpenMP [parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[for](../../parallel/openmp/reference/for-openmp.md) loop that performs exception handling, demonstrates how to convert it to use the Concurrency Runtime exception handling mechanism."},{"content":"How to: Convert an OpenMP Loop that Uses a Reduction Variable to Use the Concurrency Runtime","pos":[7934,8026]},{"content":"Given an OpenMP <bpt id=\"p1\">[</bpt>parallel<ept id=\"p1\">](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)</ept><bpt id=\"p2\">[</bpt>for<ept id=\"p2\">](../../parallel/openmp/reference/for-openmp.md)</ept> loop that uses the <bpt id=\"p3\">[</bpt>reduction<ept id=\"p3\">](../../parallel/openmp/reference/reduction.md)</ept> clause, demonstrates how to convert it to use the Concurrency Runtime.","pos":[8111,8432],"source":" Given an OpenMP [parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[for](../../parallel/openmp/reference/for-openmp.md) loop that uses the [reduction](../../parallel/openmp/reference/reduction.md) clause, demonstrates how to convert it to use the Concurrency Runtime."},{"content":"See Also","pos":[8441,8449]},{"content":"Concurrency Runtime","pos":[8454,8473]},{"content":"OpenMP","pos":[8526,8532]},{"content":"Parallel Patterns Library (PPL)","pos":[8634,8665]},{"content":"Asynchronous Agents Library","pos":[8728,8755]}],"content":"---\ntitle: \"Migrating from OpenMP to the Concurrency Runtime | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"Concurrency Runtime, migrating from OpenMP\"\n  - \"OpenMP, migrating to the Concurrency Runtime\"\nms.assetid: 9bab7bb1-e45d-44b2-8509-3b226be2c93b\ncaps.latest.revision: 12\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Migrating from OpenMP to the Concurrency Runtime\nThe Concurrency Runtime enables a variety of programming models. These models may overlap or complement the models of other libraries. The documents in this section compare [OpenMP](../../parallel/concrt/comparing-the-concurrency-runtime-to-other-concurrency-models.md#openmp) to the Concurrency Runtime and provide examples about how to migrate existing OpenMP code to use the Concurrency Runtime.  \n  \n The OpenMP programming model is defined by an open standard and has well-defined bindings to the Fortran and C/C++ programming languages. OpenMP versions 2.0 and 2.5, which are supported by the Visual C++ compiler, are well-suited for parallel algorithms that are iterative; that is, they perform parallel iteration over an array of data. OpenMP 3.0 supports non-iterative tasks in addition to iterative tasks.  \n  \n OpenMP is most efficient when the degree of parallelism is pre-determined and matches the available resources on the system. The OpenMP model is an especially good match for high-performance computing, where very large computational problems are distributed across the processing resources of one computer. In this scenario, the hardware environment is generally fixed and the developer can reasonably expect to have exclusive access to all computing resources when the algorithm is executed.  \n  \n However, less constrained computing environments may not be a good match for OpenMP. For example, recursive problems (such as the quicksort algorithm or searching a tree of data) are more difficult to implement by using OpenMP 2.0 and 2.5. The Concurrency Runtime complements the capabilities of OpenMP by providing the [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) and the [Parallel Patterns Library](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL). The Asynchronous Agents Library supports coarse-grained task parallelism; the PPL supports more fine-grained parallel tasks. The Concurrency Runtime provides the infrastructure that is required to perform operations in parallel so that you can focus on the logic of your application. However, because the Concurrency Runtime enables a variety of programming models, its scheduling overhead can be greater than other concurrency libraries such as OpenMP. Therefore, we recommend that you test performance incrementally when you convert your existing OpenMP code to use the Concurrency Runtime.  \n  \n## When to Migrate from OpenMP to the Concurrency Runtime  \n It may be advantageous to migrate existing OpenMP code to use the Concurrency Runtime in the following cases.  \n  \n|Cases|Advantages of the Concurrency Runtime|  \n|-----------|-------------------------------------------|  \n|You require an extensible concurrent programming framework.|Many of the features in the Concurrency Runtime can be extended. You can also combine existing features to compose new ones. Because OpenMP relies on compiler directives, it cannot be easily extended.|  \n|Your application would benefit from cooperative blocking.|When a task blocks because it requires a resource that is not yet available, the Concurrency Runtime can perform other tasks while the first task waits for the resource.|  \n|Your application would benefit from dynamic load balancing.|The Concurrency Runtime uses a scheduling algorithm that adjusts the allocation of computing resources as workloads change. In OpenMP, when the scheduler allocates computing resources to a parallel region, those resource allocations are fixed throughout the computation.|  \n|You require exception handling support.|The PPL lets you catch exceptions both inside and outside of a parallel region or loop. In OpenMP, you must handle the exception inside of the parallel region or loop.|  \n|You require a cancellation mechanism.|The PPL enables applications to cancel both individual tasks and parallel trees of work. OpenMP requires the application to implement its own cancellation mechanism.|  \n|You require parallel code to finish in a different context from which it starts.|The Concurrency Runtime lets you start a task in one context, and then wait on or cancel that task in another context. In OpenMP, all parallel work must finish in the context from which it starts.|  \n|You require enhanced debugging support.|Visual Studio provides the **Parallel Stacks** and **Parallel Tasks** windows so that you can more easily debug multithreaded applications.<br /><br /> For more information about debugging support for the Concurrency Runtime, see [Using the Tasks Window](/visualstudio/debugger/using-the-tasks-window), [Using the Parallel Stacks Window](/visualstudio/debugger/using-the-parallel-stacks-window), and [Walkthrough: Debugging a Parallel Application](http://msdn.microsoft.com/library/2820ac4c-c893-4d87-8c62-83981d561493).|  \n  \n## When Not to Migrate from OpenMP to the Concurrency Runtime  \n The following cases describe when it might not be appropriate to migrate existing OpenMP code to use the Concurrency Runtime.  \n  \n|Cases|Explanation|  \n|-----------|-----------------|  \n|Your application already meets your requirements.|If you are satisfied with application performance and current debugging support, migration might not be appropriate.|  \n|Your parallel loop bodies perform little work.|The overhead of the Concurrency Runtime task scheduler might not overcome the benefits of executing the loop body in parallel, especially when the loop body is relatively small.|  \n|Your application is written in C.|Because the Concurrency Runtime uses many C++ features, it might not be suitable when you cannot write code that enables the C application to fully use it.|  \n  \n## Related Topics  \n [How to: Convert an OpenMP parallel for Loop to Use the Concurrency Runtime](../../parallel/concrt/how-to-convert-an-openmp-parallel-for-loop-to-use-the-concurrency-runtime.md)  \n\n Given a basic loop that uses the OpenMP [parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel) and [for](../../parallel/openmp/reference/for-openmp.md) directives, demonstrates how to convert it to use the Concurrency Runtime [concurrency::parallel_for](reference/concurrency-namespace-functions.md#parallel_for) algorithm.  \n\n  \n [How to: Convert an OpenMP Loop that Uses Cancellation to Use the Concurrency Runtime](../../parallel/concrt/convert-an-openmp-loop-that-uses-cancellation.md)  \n Given an OpenMP [parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[for](../../parallel/openmp/reference/for-openmp.md) loop that does not require all iterations to run, demonstrates how to convert it to use the Concurrency Runtime cancellation mechanism.  \n  \n [How to: Convert an OpenMP Loop that Uses Exception Handling to Use the Concurrency Runtime](../../parallel/concrt/convert-an-openmp-loop-that uses-exception-handling.md)  \n Given an OpenMP [parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[for](../../parallel/openmp/reference/for-openmp.md) loop that performs exception handling, demonstrates how to convert it to use the Concurrency Runtime exception handling mechanism.  \n  \n [How to: Convert an OpenMP Loop that Uses a Reduction Variable to Use the Concurrency Runtime](../../parallel/concrt/convert-an-openmp-loop-that-uses-a-reduction-variable.md)  \n Given an OpenMP [parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[for](../../parallel/openmp/reference/for-openmp.md) loop that uses the [reduction](../../parallel/openmp/reference/reduction.md) clause, demonstrates how to convert it to use the Concurrency Runtime.  \n  \n## See Also  \n [Concurrency Runtime](../../parallel/concrt/concurrency-runtime.md)   \n [OpenMP](../../parallel/concrt/comparing-the-concurrency-runtime-to-other-concurrency-models.md#openmp)   \n [Parallel Patterns Library (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md)   \n [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md)\n\n"}