{"nodes":[{"pos":[12,63],"content":"CMyProviderSource (MyProviderDS.H) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"CMyProviderSource (MyProviderDS.H) | Microsoft Docs","pos":[0,51]}]},{"content":"CMyProviderSource (MyProviderDS.H)","pos":[720,754]},{"content":"The provider classes use multiple inheritance.","pos":[755,801]},{"content":"The following code shows the inheritance chain for the data source object:","pos":[802,876]},{"content":"All the COM components derive from <ph id=\"ph1\">`CComObjectRootEx`</ph> and <ph id=\"ph2\">`CComCoClass`</ph>.","pos":[1429,1501],"source":"All the COM components derive from `CComObjectRootEx` and `CComCoClass`."},{"content":"provides all the implementation for the <bpt id=\"p1\">**</bpt>IUnknown<ept id=\"p1\">**</ept> interface.","pos":[1521,1584],"source":" provides all the implementation for the **IUnknown** interface."},{"content":"It can handle any threading model.","pos":[1585,1619]},{"content":"handles any error support required.","pos":[1634,1669]},{"content":"If you want to send richer error information to the client, you can use some of the error APIs in <ph id=\"ph1\">`CComCoClass`</ph>.","pos":[1670,1782],"source":" If you want to send richer error information to the client, you can use some of the error APIs in `CComCoClass`."},{"content":"The data source object also inherits from several 'Impl' classes.","pos":[1789,1854]},{"content":"Each class provides the implementation for an interface.","pos":[1855,1911]},{"content":"The data source object implements the <ph id=\"ph1\">`IPersist`</ph>, <ph id=\"ph2\">`IDBProperties`</ph>, <bpt id=\"p1\">**</bpt>IDBInitialize<ept id=\"p1\">**</ept>, and <bpt id=\"p2\">**</bpt>IDBCreateSession<ept id=\"p2\">**</ept> interfaces.","pos":[1912,2034],"source":" The data source object implements the `IPersist`, `IDBProperties`, **IDBInitialize**, and **IDBCreateSession** interfaces."},{"content":"Each interface is required by OLE DB to implement the data source object.","pos":[2035,2108]},{"content":"You can choose to support or not support particular functionality by inheriting or not inheriting from one of these 'Impl' classes.","pos":[2109,2240]},{"content":"If you want to support the <bpt id=\"p1\">**</bpt>IDBDataSourceAdmin<ept id=\"p1\">**</ept> interface, you inherit from the <bpt id=\"p2\">**</bpt>IDBDataSourceAdminImpl<ept id=\"p2\">**</ept> class to get the functionality required.","pos":[2241,2390],"source":" If you want to support the **IDBDataSourceAdmin** interface, you inherit from the **IDBDataSourceAdminImpl** class to get the functionality required."},{"content":"COM Map","pos":[2399,2406]},{"pos":[2410,2528],"content":"Whenever the client calls <ph id=\"ph1\">`QueryInterface`</ph> for an interface on the data source, it goes through the following COM map:","source":"Whenever the client calls `QueryInterface` for an interface on the data source, it goes through the following COM map:"},{"pos":[2805,2956],"content":"The COM_INTERFACE_ENTRY macros are from ATL and tell the implementation of <ph id=\"ph1\">`QueryInterface`</ph> in <ph id=\"ph2\">`CComObjectRootEx`</ph> to return the appropriate interfaces.","source":"The COM_INTERFACE_ENTRY macros are from ATL and tell the implementation of `QueryInterface` in `CComObjectRootEx` to return the appropriate interfaces."},{"content":"Property Map","pos":[2965,2977]},{"content":"The property map specifies all the properties designated by the provider:","pos":[2981,3054]},{"content":"Properties in OLE DB are grouped.","pos":[6003,6036]},{"content":"The data source object has two groups of properties: one for the <bpt id=\"p1\">**</bpt>DBPROPSET_DATASOURCEINFO<ept id=\"p1\">**</ept> set and one for the <bpt id=\"p2\">**</bpt>DBPROPSET_DBINIT<ept id=\"p2\">**</ept> set.","pos":[6037,6176],"source":" The data source object has two groups of properties: one for the **DBPROPSET_DATASOURCEINFO** set and one for the **DBPROPSET_DBINIT** set."},{"content":"The <bpt id=\"p1\">**</bpt>DBPROPSET_DATASOURCEINFO<ept id=\"p1\">**</ept> set corresponds to properties about the provider and its data source.","pos":[6177,6279],"source":" The **DBPROPSET_DATASOURCEINFO** set corresponds to properties about the provider and its data source."},{"content":"The <bpt id=\"p1\">**</bpt>DBPROPSET_DBINIT<ept id=\"p1\">**</ept> set corresponds to properties used at initialization.","pos":[6280,6358],"source":" The **DBPROPSET_DBINIT** set corresponds to properties used at initialization."},{"content":"The OLE DB Provider Templates handle these sets with the PROPERTY_SET macros.","pos":[6359,6436]},{"content":"The macros create a block that contains an array of properties.","pos":[6437,6500]},{"content":"Whenever the client calls the <ph id=\"ph1\">`IDBProperties`</ph> interface, the provider uses the property map.","pos":[6501,6593],"source":" Whenever the client calls the `IDBProperties` interface, the provider uses the property map."},{"content":"You do not need to implement every property in the specification.","pos":[6600,6665]},{"content":"However, you must support the required properties; see the level 0 conformance specification for more information.","pos":[6666,6780]},{"content":"If you do not want to support a property, you can remove it from the map.","pos":[6781,6854]},{"content":"If you want to support a property, add it into the map by using a PROPERTY_INFO_ENTRY macro.","pos":[6855,6947]},{"content":"The macro corresponds to the <bpt id=\"p1\">**</bpt>UPROPINFO<ept id=\"p1\">**</ept> structure as shown in the following code:","pos":[6948,7032],"source":" The macro corresponds to the **UPROPINFO** structure as shown in the following code:"},{"content":"Each element in the structure represents information to handle the property.","pos":[7285,7361]},{"content":"It contains a <bpt id=\"p1\">**</bpt>DBPROPID<ept id=\"p1\">**</ept> to determine the GUID and ID for the property.","pos":[7362,7435],"source":" It contains a **DBPROPID** to determine the GUID and ID for the property."},{"content":"It also contains entries to determine the type and value of the property.","pos":[7436,7509]},{"content":"If you want to change the default value of a property (note that a consumer can change the value of a writable property at any time), you can use either the PROPERTY_INFO_ENTRY_VALUE or PROPERTY_INFO_ENTRY_EX macro.","pos":[7516,7731]},{"content":"These macros allow you to specify a value for a corresponding property.","pos":[7732,7803]},{"content":"The PROPERTY_INFO_ENTRY_VALUE macro is a shorthand notation that allows you to change the value.","pos":[7804,7900]},{"content":"The PROPERTY_INFO_ENTRY_VALUE macro calls the PROPERTY_INFO_ENTRY_EX macro.","pos":[7901,7976]},{"content":"This macro allows you to add or change all of the attributes in the <bpt id=\"p1\">**</bpt>UPROPINFO<ept id=\"p1\">**</ept> structure.","pos":[7977,8069],"source":" This macro allows you to add or change all of the attributes in the **UPROPINFO** structure."},{"content":"If you want to define your own property set, you can add one by making an additional BEGIN_PROPSET_MAP/END_PROPSET_MAP combination.","pos":[8076,8207]},{"content":"You need to define a GUID for the property set and then define your own properties.","pos":[8208,8291]},{"content":"If you have provider-specific properties, add them to a new property set instead of using an existing one.","pos":[8292,8398]},{"content":"This avoids problems in later versions of OLE DB.","pos":[8399,8448]},{"content":"User-Defined Property Sets","pos":[8457,8483]},{"content":"Visual C++ .NET supports user-defined property sets.","pos":[8487,8539]},{"content":"You no longer have to override <bpt id=\"p1\">**</bpt>GetProperties<ept id=\"p1\">**</ept> or <ph id=\"ph1\">`GetPropertyInfo`</ph>.","pos":[8540,8610],"source":" You no longer have to override **GetProperties** or `GetPropertyInfo`."},{"content":"Instead, the templates detect any user-defined property set and add it to the appropriate object.","pos":[8611,8708]},{"content":"If you have a user-defined property set that needs to be available at initialization time (that is, before the consumer calls <bpt id=\"p1\">**</bpt>IDBInitialize::Initialize<ept id=\"p1\">**</ept>), you can specify this by using the <bpt id=\"p2\">**</bpt>UPROPSET_USERINIT<ept id=\"p2\">**</ept> flag in conjunction with the BEGIN_PROPERTY_SET_EX macro.","pos":[8715,8986],"source":"If you have a user-defined property set that needs to be available at initialization time (that is, before the consumer calls **IDBInitialize::Initialize**), you can specify this by using the **UPROPSET_USERINIT** flag in conjunction with the BEGIN_PROPERTY_SET_EX macro."},{"content":"The property set must be in the data source object for this to work (as the OLE DB specification requires).","pos":[8987,9094]},{"content":"For example:","pos":[9095,9107]},{"content":"See Also","pos":[9278,9286]},{"content":"Provider Wizard-Generated Files","pos":[9291,9322]}],"content":"---\ntitle: \"CMyProviderSource (MyProviderDS.H) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"myproviderds.h\"\n  - \"cmyprovidersource\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"OLE DB providers, wizard-generated files\"\n  - \"CMyProviderSource class in MyProviderDS.H\"\nms.assetid: c143d48e-59c8-4f67-9141-3aab51859b92\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# CMyProviderSource (MyProviderDS.H)\nThe provider classes use multiple inheritance. The following code shows the inheritance chain for the data source object:  \n  \n```  \n/////////////////////////////////////////////////////////////////////////  \n// CMyProviderSource  \nclass ATL_NO_VTABLE CMyProviderSource :   \n   public CComObjectRootEx<CComSingleThreadModel>,  \n   public CComCoClass<CMyProviderSource, &CLSID_MyProvider>,  \n   public IDBCreateSessionImpl<CMyProviderSource, CMyProviderSession>,  \n   public IDBInitializeImpl<CMyProviderSource>,  \n   public IDBPropertiesImpl<CMyProviderSource>,  \n   public IPersistImpl<CMyProviderSource>,  \n   public IInternalConnectionImpl<CMyProviderSource>  \n```  \n  \n All the COM components derive from `CComObjectRootEx` and `CComCoClass`. `CComObjectRootEx` provides all the implementation for the **IUnknown** interface. It can handle any threading model. `CComCoClass` handles any error support required. If you want to send richer error information to the client, you can use some of the error APIs in `CComCoClass`.  \n  \n The data source object also inherits from several 'Impl' classes. Each class provides the implementation for an interface. The data source object implements the `IPersist`, `IDBProperties`, **IDBInitialize**, and **IDBCreateSession** interfaces. Each interface is required by OLE DB to implement the data source object. You can choose to support or not support particular functionality by inheriting or not inheriting from one of these 'Impl' classes. If you want to support the **IDBDataSourceAdmin** interface, you inherit from the **IDBDataSourceAdminImpl** class to get the functionality required.  \n  \n## COM Map  \n Whenever the client calls `QueryInterface` for an interface on the data source, it goes through the following COM map:  \n  \n```  \nBEGIN_COM_MAP(CMyProviderSource)  \n   COM_INTERFACE_ENTRY(IDBCreateSession)  \n   COM_INTERFACE_ENTRY(IDBInitialize)  \n   COM_INTERFACE_ENTRY(IDBProperties)  \n   COM_INTERFACE_ENTRY(IPersist)  \n   COM_INTERFACE_ENTRY(IInternalConnection)  \nEND_COM_MAP()  \n```  \n  \n The COM_INTERFACE_ENTRY macros are from ATL and tell the implementation of `QueryInterface` in `CComObjectRootEx` to return the appropriate interfaces.  \n  \n## Property Map  \n The property map specifies all the properties designated by the provider:  \n  \n```  \nBEGIN_PROPSET_MAP(CMyProviderSource)  \n   BEGIN_PROPERTY_SET(DBPROPSET_DATASOURCEINFO)  \n      PROPERTY_INFO_ENTRY(ACTIVESESSIONS)  \n      PROPERTY_INFO_ENTRY(ASYNCTXNABORT)  \n      PROPERTY_INFO_ENTRY(ASYNCTXNCOMMIT)  \n      PROPERTY_INFO_ENTRY(BYREFACCESSORS)  \n      PROPERTY_INFO_ENTRY_VALUE(CATALOGLOCATION, DBPROPVAL_CL_START)  \n      PROPERTY_INFO_ENTRY(CATALOGTERM)  \n      PROPERTY_INFO_ENTRY(CATALOGUSAGE)  \n      PROPERTY_INFO_ENTRY(COLUMNDEFINITION)  \n      PROPERTY_INFO_ENTRY(CONCATNULLBEHAVIOR)  \n      PROPERTY_INFO_ENTRY(DATASOURCENAME)  \n      PROPERTY_INFO_ENTRY(DATASOURCEREADONLY)  \n      PROPERTY_INFO_ENTRY(DBMSNAME)  \n      PROPERTY_INFO_ENTRY(DBMSVER)  \n      PROPERTY_INFO_ENTRY_VALUE(DSOTHREADMODEL, DBPROPVAL_RT_FREETHREAD)  \n      PROPERTY_INFO_ENTRY(GROUPBY)  \n      PROPERTY_INFO_ENTRY(HETEROGENEOUSTABLES)  \n      PROPERTY_INFO_ENTRY(IDENTIFIERCASE)  \n      PROPERTY_INFO_ENTRY(MAXINDEXSIZE)  \n      PROPERTY_INFO_ENTRY(MAXROWSIZE)  \n      PROPERTY_INFO_ENTRY(MAXROWSIZEINCLUDESBLOB)  \n      PROPERTY_INFO_ENTRY(MAXTABLESINSELECT)  \n      PROPERTY_INFO_ENTRY(MULTIPLEPARAMSETS)  \n      PROPERTY_INFO_ENTRY(MULTIPLERESULTS)  \n      PROPERTY_INFO_ENTRY(MULTIPLESTORAGEOBJECTS)  \n      PROPERTY_INFO_ENTRY(MULTITABLEUPDATE)  \n      PROPERTY_INFO_ENTRY(NULLCOLLATION)  \n      PROPERTY_INFO_ENTRY(OLEOBJECTS)  \n      PROPERTY_INFO_ENTRY(ORDERBYCOLUMNSINSELECT)  \n      PROPERTY_INFO_ENTRY(OUTPUTPARAMETERAVAILABILITY)  \n      PROPERTY_INFO_ENTRY(PERSISTENTIDTYPE)  \n      PROPERTY_INFO_ENTRY(PREPAREABORTBEHAVIOR)  \n      PROPERTY_INFO_ENTRY(PREPARECOMMITBEHAVIOR)  \n      PROPERTY_INFO_ENTRY(PROCEDURETERM)  \n      PROPERTY_INFO_ENTRY(PROVIDERNAME)  \n      PROPERTY_INFO_ENTRY(PROVIDEROLEDBVER)  \n      PROPERTY_INFO_ENTRY(PROVIDERVER)  \n      PROPERTY_INFO_ENTRY(QUOTEDIDENTIFIERCASE)  \n      PROPERTY_INFO_ENTRY(ROWSETCONVERSIONSONCOMMAND)  \n      PROPERTY_INFO_ENTRY(SCHEMATERM)  \n      PROPERTY_INFO_ENTRY(SCHEMAUSAGE)  \n      PROPERTY_INFO_ENTRY(STRUCTUREDSTORAGE)  \n      PROPERTY_INFO_ENTRY(SUBQUERIES)  \n      PROPERTY_INFO_ENTRY(TABLETERM)  \n      PROPERTY_INFO_ENTRY(USERNAME)  \n   END_PROPERTY_SET(DBPROPSET_DATASOURCEINFO)  \n   BEGIN_PROPERTY_SET(DBPROPSET_DBINIT)  \n      PROPERTY_INFO_ENTRY(AUTH_PASSWORD)  \n      PROPERTY_INFO_ENTRY(AUTH_PERSIST_SENSITIVE_AUTHINFO)  \n      PROPERTY_INFO_ENTRY(AUTH_USERID)  \n      PROPERTY_INFO_ENTRY(INIT_DATASOURCE)  \n      PROPERTY_INFO_ENTRY(INIT_HWND)  \n      PROPERTY_INFO_ENTRY(INIT_LCID)  \n      PROPERTY_INFO_ENTRY(INIT_LOCATION)  \n      PROPERTY_INFO_ENTRY(INIT_MODE)  \n      PROPERTY_INFO_ENTRY(INIT_PROMPT)  \n      PROPERTY_INFO_ENTRY(INIT_PROVIDERSTRING)  \n      PROPERTY_INFO_ENTRY(INIT_TIMEOUT)  \n   END_PROPERTY_SET(DBPROPSET_DBINIT)  \n   BEGIN_PROPERTY_SET(DBPROPSET_DATASOURCE)  \n      PROPERTY_INFO_ENTRY(CURRENTCATALOG)  \n   END_PROPERTY_SET(DBPROPSET_DATASOURCE)  \n   CHAIN_PROPERTY_SET(CMyProviderSession)  \nEND_PROPSET_MAP()  \n```  \n  \n Properties in OLE DB are grouped. The data source object has two groups of properties: one for the **DBPROPSET_DATASOURCEINFO** set and one for the **DBPROPSET_DBINIT** set. The **DBPROPSET_DATASOURCEINFO** set corresponds to properties about the provider and its data source. The **DBPROPSET_DBINIT** set corresponds to properties used at initialization. The OLE DB Provider Templates handle these sets with the PROPERTY_SET macros. The macros create a block that contains an array of properties. Whenever the client calls the `IDBProperties` interface, the provider uses the property map.  \n  \n You do not need to implement every property in the specification. However, you must support the required properties; see the level 0 conformance specification for more information. If you do not want to support a property, you can remove it from the map. If you want to support a property, add it into the map by using a PROPERTY_INFO_ENTRY macro. The macro corresponds to the **UPROPINFO** structure as shown in the following code:  \n  \n```  \nstruct UPROPINFO  \n{  \n   DBPROPID    dwPropId;  \n   ULONG       ulIDS;  \n   VARTYPE     VarType;  \n   DBPROPFLAGS dwFlags;  \n   union  \n   {  \n      DWORD dwVal;  \n      LPOLESTR szVal;  \n   };  \n   DBPROPOPTIONS dwOption;  \n};  \n```  \n  \n Each element in the structure represents information to handle the property. It contains a **DBPROPID** to determine the GUID and ID for the property. It also contains entries to determine the type and value of the property.  \n  \n If you want to change the default value of a property (note that a consumer can change the value of a writable property at any time), you can use either the PROPERTY_INFO_ENTRY_VALUE or PROPERTY_INFO_ENTRY_EX macro. These macros allow you to specify a value for a corresponding property. The PROPERTY_INFO_ENTRY_VALUE macro is a shorthand notation that allows you to change the value. The PROPERTY_INFO_ENTRY_VALUE macro calls the PROPERTY_INFO_ENTRY_EX macro. This macro allows you to add or change all of the attributes in the **UPROPINFO** structure.  \n  \n If you want to define your own property set, you can add one by making an additional BEGIN_PROPSET_MAP/END_PROPSET_MAP combination. You need to define a GUID for the property set and then define your own properties. If you have provider-specific properties, add them to a new property set instead of using an existing one. This avoids problems in later versions of OLE DB.  \n  \n## User-Defined Property Sets  \n Visual C++ .NET supports user-defined property sets. You no longer have to override **GetProperties** or `GetPropertyInfo`. Instead, the templates detect any user-defined property set and add it to the appropriate object.  \n  \n If you have a user-defined property set that needs to be available at initialization time (that is, before the consumer calls **IDBInitialize::Initialize**), you can specify this by using the **UPROPSET_USERINIT** flag in conjunction with the BEGIN_PROPERTY_SET_EX macro. The property set must be in the data source object for this to work (as the OLE DB specification requires). For example:  \n  \n```  \nBEGIN_PROPERTY_SET_EX(DBPROPSET_MYPROPSET, UPROPSET_USERINIT)  \n   PROPERTY_INFO_ENTRY(DBPROP_MYPROP)  \nEND_PROPERTY_SET_EX(DBPROPSET_MYPROPSET)  \n```  \n  \n## See Also  \n [Provider Wizard-Generated Files](../../data/oledb/provider-wizard-generated-files.md)"}