{"nodes":[{"pos":[12,66],"content":"Tree Control Drag-and-Drop Operations | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Tree Control Drag-and-Drop Operations | Microsoft Docs","pos":[0,54]}]},{"content":"Tree Control Drag-and-Drop Operations","pos":[694,731]},{"content":"A tree control (<bpt id=\"p1\">[</bpt>CTreeCtrl<ept id=\"p1\">](../mfc/reference/ctreectrl-class.md)</ept>) sends a notification when the user starts to drag an item.","pos":[732,856],"source":"A tree control ([CTreeCtrl](../mfc/reference/ctreectrl-class.md)) sends a notification when the user starts to drag an item."},{"content":"The control sends a <bpt id=\"p1\">[</bpt>TVN_BEGINDRAG<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/bb773504)</ept> notification message when the user begins dragging an item with the left mouse button and a <bpt id=\"p2\">[</bpt>TVN_BEGINRDRAG<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/bb773509)</ept> notification message when the user begins dragging with the right button.","pos":[857,1195],"source":" The control sends a [TVN_BEGINDRAG](http://msdn.microsoft.com/library/windows/desktop/bb773504) notification message when the user begins dragging an item with the left mouse button and a [TVN_BEGINRDRAG](http://msdn.microsoft.com/library/windows/desktop/bb773509) notification message when the user begins dragging with the right button."},{"content":"You can prevent a tree control from sending these notifications by giving the tree control the <bpt id=\"p1\">**</bpt>TVS_DISABLEDRAGDROP<ept id=\"p1\">**</ept> style.","pos":[1196,1321],"source":" You can prevent a tree control from sending these notifications by giving the tree control the **TVS_DISABLEDRAGDROP** style."},{"content":"You obtain an image to display during a drag operation by calling the <bpt id=\"p1\">[</bpt>CreateDragImage<ept id=\"p1\">](../mfc/reference/ctreectrl-class.md#ctreectrl__createdragimage)</ept> member function.","pos":[1328,1496],"source":"You obtain an image to display during a drag operation by calling the [CreateDragImage](../mfc/reference/ctreectrl-class.md#ctreectrl__createdragimage) member function."},{"content":"The tree control creates a dragging bitmap based on the label of the item being dragged.","pos":[1497,1585]},{"content":"Then the tree control creates an image list, adds the bitmap to it, and returns a pointer to the <bpt id=\"p1\">[</bpt>CImageList<ept id=\"p1\">](../mfc/reference/cimagelist-class.md)</ept> object.","pos":[1586,1741],"source":" Then the tree control creates an image list, adds the bitmap to it, and returns a pointer to the [CImageList](../mfc/reference/cimagelist-class.md) object."},{"content":"You must provide the code that actually drags the item.","pos":[1748,1803]},{"content":"This typically involves using the dragging capabilities of the image list functions and processing the <bpt id=\"p1\">[</bpt>WM_MOUSEMOVE<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms645616)</ept> and <bpt id=\"p2\">[</bpt>WM_LBUTTONUP<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/ms645608)</ept> (or <bpt id=\"p3\">[</bpt>WM_RBUTTONUP<ept id=\"p3\">](http://msdn.microsoft.com/library/windows/desktop/ms646243)</ept>) messages sent after the drag operation has begun.","pos":[1804,2190],"source":" This typically involves using the dragging capabilities of the image list functions and processing the [WM_MOUSEMOVE](http://msdn.microsoft.com/library/windows/desktop/ms645616) and [WM_LBUTTONUP](http://msdn.microsoft.com/library/windows/desktop/ms645608) (or [WM_RBUTTONUP](http://msdn.microsoft.com/library/windows/desktop/ms646243)) messages sent after the drag operation has begun."},{"content":"For more information about the image list functions, see <bpt id=\"p1\">[</bpt>CImageList<ept id=\"p1\">](../mfc/reference/cimagelist-class.md)</ept> in the <bpt id=\"p2\">*</bpt>MFC Reference<ept id=\"p2\">*</ept> and <bpt id=\"p3\">[</bpt>Image Lists<ept id=\"p3\">](http://msdn.microsoft.com/library/windows/desktop/bb761389)</ept> in the <ph id=\"ph1\">[!INCLUDE[winSDK](../atl/includes/winsdk_md.md)]</ph>.","pos":[2191,2456],"source":" For more information about the image list functions, see [CImageList](../mfc/reference/cimagelist-class.md) in the *MFC Reference* and [Image Lists](http://msdn.microsoft.com/library/windows/desktop/bb761389) in the [!INCLUDE[winSDK](../atl/includes/winsdk_md.md)]."},{"content":"For more information about dragging a tree control item, see <bpt id=\"p1\">[</bpt>Dragging the Tree View Item<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/bb760017)</ept>, also in the <ph id=\"ph1\">[!INCLUDE[winsdkshort](../atl-mfc-shared/reference/includes/winsdkshort_md.md)]</ph>.","pos":[2457,2701],"source":" For more information about dragging a tree control item, see [Dragging the Tree View Item](http://msdn.microsoft.com/library/windows/desktop/bb760017), also in the [!INCLUDE[winsdkshort](../atl-mfc-shared/reference/includes/winsdkshort_md.md)]."},{"content":"If items in a tree control are to be the targets of a drag-and-drop operation, you need to know when the mouse cursor is on a target item.","pos":[2708,2846]},{"content":"You can find out by calling the <bpt id=\"p1\">[</bpt>HitTest<ept id=\"p1\">](../mfc/reference/ctreectrl-class.md#ctreectrl__hittest)</ept> member function.","pos":[2847,2961],"source":" You can find out by calling the [HitTest](../mfc/reference/ctreectrl-class.md#ctreectrl__hittest) member function."},{"content":"You specify either a point and integer, or the address of a <bpt id=\"p1\">[</bpt>TVHITTESTINFO<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/bb773448)</ept> structure that contains the current coordinates of the mouse cursor.","pos":[2962,3166],"source":" You specify either a point and integer, or the address of a [TVHITTESTINFO](http://msdn.microsoft.com/library/windows/desktop/bb773448) structure that contains the current coordinates of the mouse cursor."},{"content":"When the function returns, the integer or structure contains a flag indicating the location of the mouse cursor relative to the tree control.","pos":[3167,3308]},{"content":"If the cursor is over an item in the tree control, the structure contains the handle of the item as well.","pos":[3309,3414]},{"content":"You can indicate that an item is the target of a drag-and-drop operation by calling the <bpt id=\"p1\">[</bpt>SetItem<ept id=\"p1\">](../mfc/reference/ctreectrl-class.md#ctreectrl__setitem)</ept> member function to set the state to the <ph id=\"ph1\">`TVIS_DROPHILITED`</ph> value.","pos":[3421,3640],"source":"You can indicate that an item is the target of a drag-and-drop operation by calling the [SetItem](../mfc/reference/ctreectrl-class.md#ctreectrl__setitem) member function to set the state to the `TVIS_DROPHILITED` value."},{"content":"An item that has this state is drawn in the style used to indicate a drag-and-drop target.","pos":[3641,3731]},{"content":"See Also","pos":[3740,3748]},{"content":"Using CTreeCtrl","pos":[3753,3768]},{"content":"Controls","pos":[3802,3810]}],"content":"---\ntitle: \"Tree Control Drag-and-Drop Operations | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CTreeCtrl class, drag and drop operations\"\n  - \"drag and drop, CTreeCtrl\"\n  - \"tree controls, drag and drop operations\"\nms.assetid: 3cf78b4c-4579-4fe1-9bc9-c5ab876e4af1\ncaps.latest.revision: 12\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Tree Control Drag-and-Drop Operations\nA tree control ([CTreeCtrl](../mfc/reference/ctreectrl-class.md)) sends a notification when the user starts to drag an item. The control sends a [TVN_BEGINDRAG](http://msdn.microsoft.com/library/windows/desktop/bb773504) notification message when the user begins dragging an item with the left mouse button and a [TVN_BEGINRDRAG](http://msdn.microsoft.com/library/windows/desktop/bb773509) notification message when the user begins dragging with the right button. You can prevent a tree control from sending these notifications by giving the tree control the **TVS_DISABLEDRAGDROP** style.  \n  \n You obtain an image to display during a drag operation by calling the [CreateDragImage](../mfc/reference/ctreectrl-class.md#ctreectrl__createdragimage) member function. The tree control creates a dragging bitmap based on the label of the item being dragged. Then the tree control creates an image list, adds the bitmap to it, and returns a pointer to the [CImageList](../mfc/reference/cimagelist-class.md) object.  \n  \n You must provide the code that actually drags the item. This typically involves using the dragging capabilities of the image list functions and processing the [WM_MOUSEMOVE](http://msdn.microsoft.com/library/windows/desktop/ms645616) and [WM_LBUTTONUP](http://msdn.microsoft.com/library/windows/desktop/ms645608) (or [WM_RBUTTONUP](http://msdn.microsoft.com/library/windows/desktop/ms646243)) messages sent after the drag operation has begun. For more information about the image list functions, see [CImageList](../mfc/reference/cimagelist-class.md) in the *MFC Reference* and [Image Lists](http://msdn.microsoft.com/library/windows/desktop/bb761389) in the [!INCLUDE[winSDK](../atl/includes/winsdk_md.md)]. For more information about dragging a tree control item, see [Dragging the Tree View Item](http://msdn.microsoft.com/library/windows/desktop/bb760017), also in the [!INCLUDE[winsdkshort](../atl-mfc-shared/reference/includes/winsdkshort_md.md)].  \n  \n If items in a tree control are to be the targets of a drag-and-drop operation, you need to know when the mouse cursor is on a target item. You can find out by calling the [HitTest](../mfc/reference/ctreectrl-class.md#ctreectrl__hittest) member function. You specify either a point and integer, or the address of a [TVHITTESTINFO](http://msdn.microsoft.com/library/windows/desktop/bb773448) structure that contains the current coordinates of the mouse cursor. When the function returns, the integer or structure contains a flag indicating the location of the mouse cursor relative to the tree control. If the cursor is over an item in the tree control, the structure contains the handle of the item as well.  \n  \n You can indicate that an item is the target of a drag-and-drop operation by calling the [SetItem](../mfc/reference/ctreectrl-class.md#ctreectrl__setitem) member function to set the state to the `TVIS_DROPHILITED` value. An item that has this state is drawn in the style used to indicate a drag-and-drop target.  \n  \n## See Also  \n [Using CTreeCtrl](../mfc/using-ctreectrl.md)   \n [Controls](../mfc/controls-mfc.md)\n\n"}