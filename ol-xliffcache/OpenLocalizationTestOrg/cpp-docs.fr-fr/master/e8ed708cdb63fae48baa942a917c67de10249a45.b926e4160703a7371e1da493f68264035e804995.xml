{"nodes":[{"pos":[12,47],"content":"CAccessToken Class | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"CAccessToken Class | Microsoft Docs","pos":[0,35]}]},{"content":"CAccessToken Class","pos":[688,706]},{"content":"This class is a wrapper for an access token.","pos":[707,751]},{"pos":[759,869],"content":"[!IMPORTANT]\n This class and its members cannot be used in applications that execute in the Windows Runtime.","leadings":["","> "],"nodes":[{"content":"This class and its members cannot be used in applications that execute in the Windows Runtime.","pos":[14,108]}]},{"content":"Syntax","pos":[878,884]},{"content":"Members","pos":[925,932]},{"content":"Public Constructors","pos":[942,961]},{"content":"Name","pos":[968,972]},{"content":"Description","pos":[973,984]},{"content":"CAccessToken::~CAccessToken","pos":[1023,1050]},{"content":"The destructor.","pos":[1086,1101]},{"content":"Public Methods","pos":[1112,1126]},{"content":"Name","pos":[1133,1137]},{"content":"Description","pos":[1138,1149]},{"content":"CAccessToken::Attach","pos":[1188,1208]},{"content":"Call this method to take ownership of the given access token handle.","pos":[1233,1301]},{"content":"CAccessToken::CheckTokenMembership","pos":[1307,1341]},{"pos":[1380,1469],"content":"Call this method to determine if a specified SID is enabled in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to determine if a specified SID is enabled in the `CAccessToken` object."},{"content":"CAccessToken::CreateImpersonationToken","pos":[1475,1513]},{"content":"Call this method to create a new impersonation access token.","pos":[1556,1616]},{"content":"CAccessToken::CreatePrimaryToken","pos":[1622,1654]},{"content":"Call this method to create a new primary token.","pos":[1691,1738]},{"content":"CAccessToken::CreateProcessAsUser","pos":[1744,1777]},{"pos":[1815,1941],"content":"Call this method to create a new process running in the security context of the user represented by the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to create a new process running in the security context of the user represented by the `CAccessToken` object."},{"content":"CAccessToken::CreateRestrictedToken","pos":[1947,1982]},{"pos":[2022,2089],"content":"Call this method to create a new, restricted <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to create a new, restricted `CAccessToken` object."},{"content":"CAccessToken::Detach","pos":[2095,2115]},{"content":"Call this method to revoke ownership of the access token.","pos":[2140,2197]},{"content":"CAccessToken::DisablePrivilege","pos":[2203,2233]},{"pos":[2268,2337],"content":"Call this method to disable a privilege in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to disable a privilege in the `CAccessToken` object."},{"content":"CAccessToken::DisablePrivileges","pos":[2343,2374]},{"pos":[2410,2490],"content":"Call this method to disable one or more privileges in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to disable one or more privileges in the `CAccessToken` object."},{"content":"CAccessToken::EnablePrivilege","pos":[2496,2525]},{"pos":[2559,2627],"content":"Call this method to enable a privilege in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to enable a privilege in the `CAccessToken` object."},{"content":"CAccessToken::EnablePrivileges","pos":[2633,2663]},{"pos":[2698,2777],"content":"Call this method to enable one or more privileges in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to enable one or more privileges in the `CAccessToken` object."},{"content":"CAccessToken::GetDefaultDacl","pos":[2783,2811]},{"pos":[2844,2912],"content":"Call this method to return the <ph id=\"ph1\">`CAccessToken`</ph> object's default DACL.","source":"Call this method to return the `CAccessToken` object's default DACL."},{"content":"CAccessToken::GetEffectiveToken","pos":[2918,2949]},{"pos":[2985,3094],"content":"Call this method to get the <ph id=\"ph1\">`CAccessToken`</ph> object equal to the access token in effect for the current thread.","source":"Call this method to get the `CAccessToken` object equal to the access token in effect for the current thread."},{"content":"CAccessToken::GetGroups","pos":[3100,3123]},{"pos":[3151,3219],"content":"Call this method to return the <ph id=\"ph1\">`CAccessToken`</ph> object's token groups.","source":"Call this method to return the `CAccessToken` object's token groups."},{"content":"CAccessToken::GetHandle","pos":[3225,3248]},{"content":"Call this method to retrieve a handle to the access token.","pos":[3276,3334]},{"content":"CAccessToken::GetImpersonationLevel","pos":[3340,3375]},{"content":"Call this method to get the impersonation level from the access token.","pos":[3415,3485]},{"content":"CAccessToken::GetLogonSessionId","pos":[3491,3522]},{"pos":[3558,3645],"content":"Call this method to get the Logon Session ID associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the Logon Session ID associated with the `CAccessToken` object."},{"content":"CAccessToken::GetLogonSid","pos":[3651,3676]},{"pos":[3706,3786],"content":"Call this method to get the Logon SID associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the Logon SID associated with the `CAccessToken` object."},{"content":"CAccessToken::GetOwner","pos":[3792,3814]},{"pos":[3841,3917],"content":"Call this method to get the owner associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the owner associated with the `CAccessToken` object."},{"content":"CAccessToken::GetPrimaryGroup","pos":[3923,3952]},{"pos":[3986,4070],"content":"Call this method to get the primary group associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the primary group associated with the `CAccessToken` object."},{"content":"CAccessToken::GetPrivileges","pos":[4076,4103]},{"pos":[4135,4216],"content":"Call this method to get the privileges associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the privileges associated with the `CAccessToken` object."},{"content":"CAccessToken::GetProcessToken","pos":[4222,4251]},{"pos":[4285,4380],"content":"Call this method to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the access token from the given process.","source":"Call this method to initialize the `CAccessToken` with the access token from the given process."},{"content":"CAccessToken::GetProfile","pos":[4386,4410]},{"pos":[4439,4545],"content":"Call this method to get the handle pointing to the user profile associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the handle pointing to the user profile associated with the `CAccessToken` object."},{"content":"CAccessToken::GetSource","pos":[4551,4574]},{"pos":[4602,4666],"content":"Call this method to get the source of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the source of the `CAccessToken` object."},{"content":"CAccessToken::GetStatistics","pos":[4672,4699]},{"pos":[4731,4809],"content":"Call this method to get information associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get information associated with the `CAccessToken` object."},{"content":"CAccessToken::GetTerminalServicesSessionId","pos":[4815,4857]},{"pos":[4904,5003],"content":"Call this method to get the Terminal Services Session ID associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the Terminal Services Session ID associated with the `CAccessToken` object."},{"content":"CAccessToken::GetThreadToken","pos":[5009,5037]},{"pos":[5070,5157],"content":"Call this method to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the token from the given thread.","source":"Call this method to initialize the `CAccessToken` with the token from the given thread."},{"content":"CAccessToken::GetTokenId","pos":[5163,5187]},{"pos":[5216,5295],"content":"Call this method to get the Token ID associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the Token ID associated with the `CAccessToken` object."},{"content":"CAccessToken::GetType","pos":[5301,5322]},{"pos":[5348,5416],"content":"Call this method to get the token type of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the token type of the `CAccessToken` object."},{"content":"CAccessToken::GetUser","pos":[5422,5443]},{"pos":[5469,5549],"content":"Call this method to identify the user associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to identify the user associated with the `CAccessToken` object."},{"content":"CAccessToken::HKeyCurrentUser","pos":[5555,5584]},{"pos":[5618,5724],"content":"Call this method to get the handle pointing to the user profile associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the handle pointing to the user profile associated with the `CAccessToken` object."},{"content":"CAccessToken::Impersonate","pos":[5730,5755]},{"pos":[5785,5856],"content":"Call this method to assign an impersonation <ph id=\"ph1\">`CAccessToken`</ph> to a thread.","source":"Call this method to assign an impersonation `CAccessToken` to a thread."},{"content":"CAccessToken::ImpersonateLoggedOnUser","pos":[5862,5899]},{"content":"Call this method to allow the calling thread to impersonate the security context of a logged-on user.","pos":[5941,6042]},{"content":"CAccessToken::IsTokenRestricted","pos":[6048,6079]},{"pos":[6115,6204],"content":"Call this method to test if the <ph id=\"ph1\">`CAccessToken`</ph> object contains a list of restricted SIDs.","source":"Call this method to test if the `CAccessToken` object contains a list of restricted SIDs."},{"content":"CAccessToken::LoadUserProfile","pos":[6210,6239]},{"pos":[6273,6357],"content":"Call this method to load the user profile associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to load the user profile associated with the `CAccessToken` object."},{"content":"CAccessToken::LogonUser","pos":[6363,6386]},{"content":"Call this method to create a logon session for the user associated with the given credentials.","pos":[6414,6508]},{"content":"CAccessToken::OpenCOMClientToken","pos":[6514,6546]},{"pos":[6583,6730],"content":"Call this method from within a COM server handling a call from a client to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the access token from the COM client.","source":"Call this method from within a COM server handling a call from a client to initialize the `CAccessToken` with the access token from the COM client."},{"content":"CAccessToken::OpenNamedPipeClientToken","pos":[6736,6774]},{"pos":[6817,6960],"content":"Call this method from within a server taking requests over a named pipe to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the access token from the client.","source":"Call this method from within a server taking requests over a named pipe to initialize the `CAccessToken` with the access token from the client."},{"content":"CAccessToken::OpenRPCClientToken","pos":[6966,6998]},{"pos":[7035,7179],"content":"Call this method from within a server handling a call from an RPC client to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the access token from the client.","source":"Call this method from within a server handling a call from an RPC client to initialize the `CAccessToken` with the access token from the client."},{"content":"CAccessToken::OpenThreadToken","pos":[7185,7214]},{"pos":[7248,7372],"content":"Call this method to set the impersonation level and then initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the token from the given thread.","source":"Call this method to set the impersonation level and then initialize the `CAccessToken` with the token from the given thread."},{"content":"CAccessToken::PrivilegeCheck","pos":[7378,7406]},{"pos":[7439,7550],"content":"Call this method to determine whether a specified set of privileges are enabled in the <bpt id=\"p1\">**</bpt>CAccessToken<ept id=\"p1\">**</ept> object.","source":"Call this method to determine whether a specified set of privileges are enabled in the **CAccessToken** object."},{"content":"CAccessToken::Revert","pos":[7556,7576]},{"content":"Call this method to stop a thread that is using an impersonation token.","pos":[7601,7672]},{"content":"CAccessToken::SetDefaultDacl","pos":[7678,7706]},{"pos":[7739,7809],"content":"Call this method to set the default DACL of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to set the default DACL of the `CAccessToken` object."},{"content":"CAccessToken::SetOwner","pos":[7815,7837]},{"pos":[7864,7927],"content":"Call this method to set the owner of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to set the owner of the `CAccessToken` object."},{"content":"CAccessToken::SetPrimaryGroup","pos":[7933,7962]},{"pos":[7996,8067],"content":"Call this method to set the primary group of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to set the primary group of the `CAccessToken` object."},{"content":"Remarks","pos":[8077,8084]},{"pos":[8088,8316],"content":"An <bpt id=\"p1\">[</bpt>access token<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa374909)</ept> is an object that describes the security context of a process or thread and is allocated to each user logged onto a Windows NT or Windows 2000 system.","source":"An [access token](http://msdn.microsoft.com/library/windows/desktop/aa374909) is an object that describes the security context of a process or thread and is allocated to each user logged onto a Windows NT or Windows 2000 system."},{"pos":[8323,8523],"content":"For an introduction to the access control model in Windows, see <bpt id=\"p1\">[</bpt>Access Control<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa374860)</ept> in the <ph id=\"ph1\">[!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]</ph>.","source":"For an introduction to the access control model in Windows, see [Access Control](http://msdn.microsoft.com/library/windows/desktop/aa374860) in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]."},{"content":"Requirements","pos":[8532,8544]},{"pos":[8548,8573],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> atlsecurity.h","source":"**Header:** atlsecurity.h"},{"pos":[8620,8640],"content":"CAccessToken::Attach"},{"content":"Call this method to take ownership of the given access token handle.","pos":[8644,8712]},{"content":"Parameters","pos":[8773,8783]},{"content":"hToken","pos":[8788,8794]},{"content":"A handle to the access token.","pos":[8799,8828]},{"content":"Remarks","pos":[8838,8845]},{"pos":[8849,8966],"content":"In debug builds, an assertion error will occur if the <ph id=\"ph1\">`CAccessToken`</ph> object already has ownership of an access token.","source":"In debug builds, an assertion error will occur if the `CAccessToken` object already has ownership of an access token."},{"pos":[9024,9051],"content":"CAccessToken::~CAccessToken"},{"content":"The destructor.","pos":[9055,9070]},{"content":"Remarks","pos":[9126,9133]},{"content":"Frees all allocated resources.","pos":[9137,9167]},{"pos":[9228,9262],"content":"CAccessToken::CheckTokenMembership"},{"pos":[9266,9355],"content":"Call this method to determine if a specified SID is enabled in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to determine if a specified SID is enabled in the `CAccessToken` object."},{"content":"Parameters","pos":[9467,9477]},{"content":"Reference to a <bpt id=\"p1\">[</bpt>CSid Class<ept id=\"p1\">](../../atl/reference/csid-class.md)</ept> object.","pos":[9491,9561],"source":" Reference to a [CSid Class](../../atl/reference/csid-class.md) object."},{"content":"Pointer to a variable that receives the results of the check.","pos":[9584,9645]},{"content":"Return Value","pos":[9655,9667]},{"content":"Returns true on success, false on failure.","pos":[9671,9713]},{"content":"Remarks","pos":[9723,9730]},{"content":"The <ph id=\"ph1\">`CheckTokenMembership`</ph> method checks for the presence of the SID in the user and group SIDs of the access token.","pos":[9734,9850],"source":"The `CheckTokenMembership` method checks for the presence of the SID in the user and group SIDs of the access token."},{"content":"If the SID is present and has the SE_GROUP_ENABLED attribute, <bpt id=\"p1\">*</bpt>pbIsMember<ept id=\"p1\">*</ept> is set to true; otherwise, it is set to false.","pos":[9851,9972],"source":" If the SID is present and has the SE_GROUP_ENABLED attribute, *pbIsMember* is set to true; otherwise, it is set to false."},{"pos":[9979,10065],"content":"In debug builds, an assertion error will occur if <ph id=\"ph1\">`pbIsMember`</ph> is not a valid pointer.","source":"In debug builds, an assertion error will occur if `pbIsMember` is not a valid pointer."},{"pos":[10073,10165],"content":"[!NOTE]\n The `CAccessToken` object must be an impersonation token and not a primary token.","leadings":["","> "],"nodes":[{"content":"The <ph id=\"ph1\">`CAccessToken`</ph> object must be an impersonation token and not a primary token.","pos":[9,90],"source":" The `CAccessToken` object must be an impersonation token and not a primary token."}]},{"pos":[10230,10268],"content":"CAccessToken::CreateImpersonationToken"},{"content":"Call this method to create an impersonation access token.","pos":[10272,10329]},{"content":"Parameters","pos":[10487,10497]},{"content":"Pointer to the new <ph id=\"ph1\">`CAccessToken`</ph> object.","pos":[10511,10552],"source":" Pointer to the new `CAccessToken` object."},{"content":"Specifies a <bpt id=\"p1\">[</bpt>SECURITY_IMPERSONATION_LEVEL<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379572)</ept> enumerated type that supplies the impersonation level of the new token.","pos":[10568,10742],"source":" Specifies a [SECURITY_IMPERSONATION_LEVEL](http://msdn.microsoft.com/library/windows/desktop/aa379572) enumerated type that supplies the impersonation level of the new token."},{"content":"Return Value","pos":[10752,10764]},{"content":"Returns true on success, false on failure.","pos":[10768,10810]},{"content":"Remarks","pos":[10820,10827]},{"pos":[10858,10977],"content":"calls <bpt id=\"p1\">[</bpt>DuplicateToken<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa446616)</ept> to create a new impersonation token.","source":" calls [DuplicateToken](http://msdn.microsoft.com/library/windows/desktop/aa446616) to create a new impersonation token."},{"pos":[11036,11068],"content":"CAccessToken::CreatePrimaryToken"},{"content":"Call this method to create a new primary token.","pos":[11072,11119]},{"content":"Parameters","pos":[11310,11320]},{"content":"pPri","pos":[11325,11329]},{"content":"Pointer to the new <ph id=\"ph1\">`CAccessToken`</ph> object.","pos":[11334,11375],"source":" Pointer to the new `CAccessToken` object."},{"content":"Specifies the requested access rights for the new token.","pos":[11403,11459]},{"content":"The default, MAXIMUM_ALLOWED, requests all access rights that are valid for the caller.","pos":[11460,11547]},{"content":"See <bpt id=\"p1\">[</bpt>Access Rights and Access Masks<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa374902)</ept> for more on access rights.","pos":[11548,11671],"source":" See [Access Rights and Access Masks](http://msdn.microsoft.com/library/windows/desktop/aa374902) for more on access rights."},{"content":"pTokenAttributes","pos":[11679,11695]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>SECURITY_ATTRIBUTES<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379560)</ept> structure that specifies a security descriptor for the new token and determines whether child processes can inherit the token.","pos":[11700,11921],"source":" Pointer to a [SECURITY_ATTRIBUTES](http://msdn.microsoft.com/library/windows/desktop/aa379560) structure that specifies a security descriptor for the new token and determines whether child processes can inherit the token."},{"content":"If <bpt id=\"p1\">*</bpt>pTokenAttributes<ept id=\"p1\">*</ept> is NULL, the token gets a default security descriptor and the handle cannot be inherited.","pos":[11922,12033],"source":" If *pTokenAttributes* is NULL, the token gets a default security descriptor and the handle cannot be inherited."},{"content":"Return Value","pos":[12043,12055]},{"content":"Returns true on success, false on failure.","pos":[12059,12101]},{"content":"Remarks","pos":[12111,12118]},{"pos":[12143,12258],"content":"calls <bpt id=\"p1\">[</bpt>DuplicateTokenEx<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa446617)</ept> to create a new primary token.","source":" calls [DuplicateTokenEx](http://msdn.microsoft.com/library/windows/desktop/aa446617) to create a new primary token."},{"pos":[12318,12351],"content":"CAccessToken::CreateProcessAsUser"},{"pos":[12355,12481],"content":"Call this method to create a new process running in the security context of the user represented by the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to create a new process running in the security context of the user represented by the `CAccessToken` object."},{"content":"Parameters","pos":[12935,12945]},{"content":"pApplicationName","pos":[12950,12966]},{"content":"Pointer to a null-terminated string that specifies the module to execute.","pos":[12971,13044]},{"content":"This parameter may not be NULL.","pos":[13045,13076]},{"content":"pCommandLine","pos":[13084,13096]},{"content":"Pointer to a null-terminated string that specifies the command line to execute.","pos":[13101,13180]},{"content":"pProcessInformation","pos":[13188,13207]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>PROCESS_INFORMATION<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms684873)</ept> structure that receives identification information about the new process.","pos":[13212,13380],"source":" Pointer to a [PROCESS_INFORMATION](http://msdn.microsoft.com/library/windows/desktop/ms684873) structure that receives identification information about the new process."},{"content":"pStartupInfo","pos":[13388,13400]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>STARTUPINFO<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms686331)</ept> structure that specifies how the main window for the new process should appear.","pos":[13405,13571],"source":" Pointer to a [STARTUPINFO](http://msdn.microsoft.com/library/windows/desktop/ms686331) structure that specifies how the main window for the new process should appear."},{"content":"Specifies additional flags that control the priority class and the creation of the process.","pos":[13599,13690]},{"content":"See the Win32 function <bpt id=\"p1\">[</bpt>CreateProcessAsUser<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms682429)</ept> for a list of flags.","pos":[13691,13816],"source":" See the Win32 function [CreateProcessAsUser](http://msdn.microsoft.com/library/windows/desktop/ms682429) for a list of flags."},{"content":"bLoadProfile","pos":[13824,13836]},{"content":"If true, the user's profile is loaded with <bpt id=\"p1\">[</bpt>LoadUserProfile<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/bb762281)</ept>.","pos":[13841,13962],"source":" If true, the user's profile is loaded with [LoadUserProfile](http://msdn.microsoft.com/library/windows/desktop/bb762281)."},{"content":"pProcessAttributes","pos":[13970,13988]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>SECURITY_ATTRIBUTES<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379560)</ept> structure that specifies a security descriptor for the new process and determines whether child processes can inherit the returned handle.","pos":[13993,14226],"source":" Pointer to a [SECURITY_ATTRIBUTES](http://msdn.microsoft.com/library/windows/desktop/aa379560) structure that specifies a security descriptor for the new process and determines whether child processes can inherit the returned handle."},{"content":"If <bpt id=\"p1\">*</bpt>pProcessAttributes<ept id=\"p1\">*</ept> is NULL, the process gets a default security descriptor and the handle cannot be inherited.","pos":[14227,14342],"source":" If *pProcessAttributes* is NULL, the process gets a default security descriptor and the handle cannot be inherited."},{"content":"pThreadAttributes","pos":[14350,14367]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>SECURITY_ATTRIBUTES<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379560)</ept> structure that specifies a security descriptor for the new thread and determines whether child processes can inherit the returned handle.","pos":[14372,14604],"source":" Pointer to a [SECURITY_ATTRIBUTES](http://msdn.microsoft.com/library/windows/desktop/aa379560) structure that specifies a security descriptor for the new thread and determines whether child processes can inherit the returned handle."},{"content":"If <bpt id=\"p1\">*</bpt>pThreadAttributes<ept id=\"p1\">*</ept> is NULL, the thread gets a default security descriptor and the handle cannot be inherited.","pos":[14605,14718],"source":" If *pThreadAttributes* is NULL, the thread gets a default security descriptor and the handle cannot be inherited."},{"content":"bInherit","pos":[14726,14734]},{"content":"Indicates whether the new process inherits handles from the calling process.","pos":[14739,14815]},{"content":"If true, each inheritable open handle in the calling process is inherited by the new process.","pos":[14816,14909]},{"content":"Inherited handles have the same value and access privileges as the original handles.","pos":[14910,14994]},{"content":"pCurrentDirectory","pos":[15002,15019]},{"content":"Pointer to a null-terminated string that specifies the current drive and directory for the new process.","pos":[15024,15127]},{"content":"The string must be a full path that includes a drive letter.","pos":[15128,15188]},{"content":"If this parameter is NULL, the new process will have the same current drive and directory as the calling process.","pos":[15189,15302]},{"content":"Return Value","pos":[15312,15324]},{"content":"Returns true on success, false on failure.","pos":[15328,15370]},{"content":"Remarks","pos":[15380,15387]},{"content":"<bpt id=\"p1\">**</bpt>CreateProcessAsUser<ept id=\"p1\">**</ept> uses the <ph id=\"ph1\">`CreateProcessAsUser`</ph> Win32 function to create a new process that runs in the security context of the user represented by the <ph id=\"ph2\">`CAccessToken`</ph> object.","pos":[15391,15572],"source":"**CreateProcessAsUser** uses the `CreateProcessAsUser` Win32 function to create a new process that runs in the security context of the user represented by the `CAccessToken` object."},{"content":"See the description of the <bpt id=\"p1\">[</bpt>CreateProcessAsUser<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms682429)</ept> function for a full discussion of the parameters required.","pos":[15573,15740],"source":" See the description of the [CreateProcessAsUser](http://msdn.microsoft.com/library/windows/desktop/ms682429) function for a full discussion of the parameters required."},{"pos":[15747,15893],"content":"For this method to succeed, the <ph id=\"ph1\">`CAccessToken`</ph> object must hold AssignPrimaryToken (unless it is a restricted token) and IncreaseQuota privileges.","source":"For this method to succeed, the `CAccessToken` object must hold AssignPrimaryToken (unless it is a restricted token) and IncreaseQuota privileges."},{"pos":[15955,15990],"content":"CAccessToken::CreateRestrictedToken"},{"pos":[15994,16061],"content":"Call this method to create a new, restricted <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to create a new, restricted `CAccessToken` object."},{"content":"Parameters","pos":[16314,16324]},{"content":"pRestrictedToken","pos":[16329,16345]},{"content":"The new, restricted <ph id=\"ph1\">`CAccessToken`</ph> object.","pos":[16350,16392],"source":" The new, restricted `CAccessToken` object."},{"content":"A <ph id=\"ph1\">`CTokenGroups`</ph> object that specifies the deny-only SIDs.","pos":[16418,16476],"source":" A `CTokenGroups` object that specifies the deny-only SIDs."},{"content":"SidsToRestrict","pos":[16484,16498]},{"content":"A <ph id=\"ph1\">`CTokenGroups`</ph> object that specifies the restricting SIDs.","pos":[16503,16563],"source":" A `CTokenGroups` object that specifies the restricting SIDs."},{"content":"A <ph id=\"ph1\">`CTokenPrivileges`</ph> object that specifies the privileges to delete in the restricted token.","pos":[16594,16686],"source":" A `CTokenPrivileges` object that specifies the privileges to delete in the restricted token."},{"content":"The default creates an empty object.","pos":[16687,16723]},{"content":"Return Value","pos":[16733,16745]},{"content":"Returns true on success, false on failure.","pos":[16749,16791]},{"content":"Remarks","pos":[16801,16808]},{"pos":[16836,17001],"content":"uses the <bpt id=\"p1\">[</bpt>CreateRestrictedToken<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa446583)</ept> Win32 function to create a new <ph id=\"ph1\">`CAccessToken`</ph> object, with restrictions.","source":" uses the [CreateRestrictedToken](http://msdn.microsoft.com/library/windows/desktop/aa446583) Win32 function to create a new `CAccessToken` object, with restrictions."},{"pos":[17009,17075],"content":"[!NOTE]\n This method is only available on Windows 2000 or later.","leadings":["","> "],"nodes":[{"content":"This method is only available on Windows 2000 or later.","pos":[9,64]}]},{"pos":[17083,17354],"content":"[!IMPORTANT]\n When using `CreateRestrictedToken`, ensure the following: the existing token is valid (and not entered by the user) and `SidsToDisable` and `PrivilegesToDelete` are both valid (and not entered by the user). If the method returns false, deny functionality.","leadings":["","> "],"nodes":[{"content":" When using `CreateRestrictedToken`, ensure the following: the existing token is valid (and not entered by the user) and `SidsToDisable` and `PrivilegesToDelete` are both valid (and not entered by the user). If the method returns false, deny functionality.","pos":[13,269],"nodes":[{"content":"When using <ph id=\"ph1\">`CreateRestrictedToken`</ph>, ensure the following: the existing token is valid (and not entered by the user) and <ph id=\"ph2\">`SidsToDisable`</ph> and <ph id=\"ph3\">`PrivilegesToDelete`</ph> are both valid (and not entered by the user).","pos":[1,207],"source":" When using `CreateRestrictedToken`, ensure the following: the existing token is valid (and not entered by the user) and `SidsToDisable` and `PrivilegesToDelete` are both valid (and not entered by the user)."},{"content":"If the method returns false, deny functionality.","pos":[208,256]}]}]},{"pos":[17401,17421],"content":"CAccessToken::Detach"},{"content":"Call this method to revoke ownership of the access token.","pos":[17425,17482]},{"content":"Return Value","pos":[17530,17542]},{"pos":[17546,17611],"content":"Returns the handle to the <ph id=\"ph1\">`CAccessToken`</ph> which has been detached.","source":"Returns the handle to the `CAccessToken` which has been detached."},{"content":"Remarks","pos":[17621,17628]},{"pos":[17632,17703],"content":"This method revokes the <ph id=\"ph1\">`CAccessToken`</ph>'s ownership of the access token.","source":"This method revokes the `CAccessToken`'s ownership of the access token."},{"pos":[17760,17790],"content":"CAccessToken::DisablePrivilege"},{"pos":[17794,17863],"content":"Call this method to disable a privilege in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to disable a privilege in the `CAccessToken` object."},{"content":"Parameters","pos":[17992,18002]},{"content":"Pointer to a string containing the privilege to disable in the <ph id=\"ph1\">`CAccessToken`</ph> object.","pos":[18024,18109],"source":" Pointer to a string containing the privilege to disable in the `CAccessToken` object."},{"content":"Pointer to a <ph id=\"ph1\">`CTokenPrivileges`</ph> object which will contain the previous state of the privileges.","pos":[18136,18231],"source":" Pointer to a `CTokenPrivileges` object which will contain the previous state of the privileges."},{"content":"Return Value","pos":[18241,18253]},{"content":"Returns true on success, false on failure.","pos":[18257,18299]},{"pos":[18357,18388],"content":"CAccessToken::DisablePrivileges"},{"pos":[18392,18472],"content":"Call this method to disable one or more privileges in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to disable one or more privileges in the `CAccessToken` object."},{"content":"Parameters","pos":[18619,18629]},{"content":"Pointer to an array of strings containing the privileges to disable in the <ph id=\"ph1\">`CAccessToken`</ph> object.","pos":[18650,18747],"source":" Pointer to an array of strings containing the privileges to disable in the `CAccessToken` object."},{"content":"Pointer to a <ph id=\"ph1\">`CTokenPrivileges`</ph> object which will contain the previous state of the privileges.","pos":[18774,18869],"source":" Pointer to a `CTokenPrivileges` object which will contain the previous state of the privileges."},{"content":"Return Value","pos":[18879,18891]},{"content":"Returns true on success, false on failure.","pos":[18895,18937]},{"pos":[18993,19022],"content":"CAccessToken::EnablePrivilege"},{"pos":[19026,19094],"content":"Call this method to enable a privilege in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to enable a privilege in the `CAccessToken` object."},{"content":"Parameters","pos":[19222,19232]},{"content":"Pointer to a string containing the privilege to enable in the <ph id=\"ph1\">`CAccessToken`</ph> object.","pos":[19254,19338],"source":" Pointer to a string containing the privilege to enable in the `CAccessToken` object."},{"content":"Pointer to a <ph id=\"ph1\">`CTokenPrivileges`</ph> object which will contain the previous state of the privileges.","pos":[19365,19460],"source":" Pointer to a `CTokenPrivileges` object which will contain the previous state of the privileges."},{"content":"Return Value","pos":[19470,19482]},{"content":"Returns true on success, false on failure.","pos":[19486,19528]},{"pos":[19585,19615],"content":"CAccessToken::EnablePrivileges"},{"pos":[19619,19698],"content":"Call this method to enable one or more privileges in the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to enable one or more privileges in the `CAccessToken` object."},{"content":"Parameters","pos":[19844,19854]},{"content":"Pointer to an array of strings containing the privileges to enable in the <ph id=\"ph1\">`CAccessToken`</ph> object.","pos":[19875,19971],"source":" Pointer to an array of strings containing the privileges to enable in the `CAccessToken` object."},{"content":"Pointer to a <ph id=\"ph1\">`CTokenPrivileges`</ph> object which will contain the previous state of the privileges.","pos":[19998,20093],"source":" Pointer to a `CTokenPrivileges` object which will contain the previous state of the privileges."},{"content":"Return Value","pos":[20103,20115]},{"content":"Returns true on success, false on failure.","pos":[20119,20161]},{"pos":[20216,20244],"content":"CAccessToken::GetDefaultDacl"},{"pos":[20248,20316],"content":"Call this method to return the <ph id=\"ph1\">`CAccessToken`</ph> object's default DACL.","source":"Call this method to return the `CAccessToken` object's default DACL."},{"content":"Parameters","pos":[20391,20401]},{"content":"Pointer to the <bpt id=\"p1\">[</bpt>CDacl Class<ept id=\"p1\">](../../atl/reference/cdacl-class.md)</ept> object which will receive the <bpt id=\"p2\">**</bpt>CAccessToken<ept id=\"p2\">**</ept> object's default DACL.","pos":[20416,20550],"source":" Pointer to the [CDacl Class](../../atl/reference/cdacl-class.md) object which will receive the **CAccessToken** object's default DACL."},{"content":"Return Value","pos":[20560,20572]},{"content":"Returns true if the default DACL has been recovered, false otherwise.","pos":[20576,20645]},{"pos":[20703,20734],"content":"CAccessToken::GetEffectiveToken"},{"pos":[20738,20847],"content":"Call this method to get the <ph id=\"ph1\">`CAccessToken`</ph> object equal to the access token in effect for the current thread.","source":"Call this method to get the `CAccessToken` object equal to the access token in effect for the current thread."},{"content":"Parameters","pos":[20927,20937]},{"content":"Specifies an access mask that specifies the requested types of access to the access token.","pos":[20962,21052]},{"content":"These requested access types are compared with the token's DACL to determine which accesses are granted or denied.","pos":[21053,21167]},{"content":"Return Value","pos":[21177,21189]},{"content":"Returns true on success, false on failure.","pos":[21193,21235]},{"pos":[21285,21308],"content":"CAccessToken::GetGroups"},{"pos":[21312,21380],"content":"Call this method to return the <ph id=\"ph1\">`CAccessToken`</ph> object's token groups.","source":"Call this method to return the `CAccessToken` object's token groups."},{"content":"Parameters","pos":[21459,21469]},{"content":"pGroups","pos":[21474,21481]},{"content":"Pointer to the <bpt id=\"p1\">[</bpt>CTokenGroups Class<ept id=\"p1\">](../../atl/reference/ctokengroups-class.md)</ept> object which will receive the group information.","pos":[21486,21613],"source":" Pointer to the [CTokenGroups Class](../../atl/reference/ctokengroups-class.md) object which will receive the group information."},{"content":"Return Value","pos":[21623,21635]},{"content":"Returns true on success, false on failure.","pos":[21639,21681]},{"pos":[21731,21754],"content":"CAccessToken::GetHandle"},{"content":"Call this method to retrieve a handle to the access token.","pos":[21758,21816]},{"content":"Return Value","pos":[21873,21885]},{"pos":[21889,21950],"content":"Returns a handle to the <ph id=\"ph1\">`CAccessToken`</ph> object's access token.","source":"Returns a handle to the `CAccessToken` object's access token."},{"pos":[22012,22047],"content":"CAccessToken::GetImpersonationLevel"},{"content":"Call this method to get the impersonation level from the access token.","pos":[22051,22121]},{"content":"Parameters","pos":[22240,22250]},{"content":"pImpersonationLevel","pos":[22255,22274]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>SECURITY_IMPERSONATION_LEVEL<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379572)</ept> enumeration type which will receive the impersonation level information.","pos":[22279,22455],"source":" Pointer to a [SECURITY_IMPERSONATION_LEVEL](http://msdn.microsoft.com/library/windows/desktop/aa379572) enumeration type which will receive the impersonation level information."},{"content":"Return Value","pos":[22465,22477]},{"content":"Returns true on success, false on failure.","pos":[22481,22523]},{"pos":[22581,22612],"content":"CAccessToken::GetLogonSessionId"},{"pos":[22616,22703],"content":"Call this method to get the Logon Session ID associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the Logon Session ID associated with the `CAccessToken` object."},{"content":"Parameters","pos":[22780,22790]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>LUID<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379261)</ept> which will receive the Logon Session ID.","pos":[22805,22925],"source":" Pointer to a [LUID](http://msdn.microsoft.com/library/windows/desktop/aa379261) which will receive the Logon Session ID."},{"content":"Return Value","pos":[22935,22947]},{"content":"Returns true on success, false on failure.","pos":[22951,22993]},{"content":"Remarks","pos":[23003,23010]},{"pos":[23014,23092],"content":"In debug builds, an assertion error will occur if <ph id=\"ph1\">`pluid`</ph> is an invalid value.","source":"In debug builds, an assertion error will occur if `pluid` is an invalid value."},{"pos":[23144,23169],"content":"CAccessToken::GetLogonSid"},{"pos":[23173,23253],"content":"Call this method to get the Logon SID associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the Logon SID associated with the `CAccessToken` object."},{"content":"Parameters","pos":[23323,23333]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>CSid Class<ept id=\"p1\">](../../atl/reference/csid-class.md)</ept> object.","pos":[23347,23415],"source":" Pointer to a [CSid Class](../../atl/reference/csid-class.md) object."},{"content":"Return Value","pos":[23425,23437]},{"content":"Returns true on success, false on failure.","pos":[23441,23483]},{"content":"Remarks","pos":[23493,23500]},{"pos":[23504,23581],"content":"In debug builds, an assertion error will occur if <bpt id=\"p1\">*</bpt>pSid<ept id=\"p1\">*</ept> is an invalid value.","source":"In debug builds, an assertion error will occur if *pSid* is an invalid value."},{"pos":[23630,23652],"content":"CAccessToken::GetOwner"},{"pos":[23656,23732],"content":"Call this method to get the owner associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the owner associated with the `CAccessToken` object."},{"content":"Parameters","pos":[23799,23809]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>CSid Class<ept id=\"p1\">](../../atl/reference/csid-class.md)</ept> object.","pos":[23823,23891],"source":" Pointer to a [CSid Class](../../atl/reference/csid-class.md) object."},{"content":"Return Value","pos":[23901,23913]},{"content":"Returns true on success, false on failure.","pos":[23917,23959]},{"content":"Remarks","pos":[23969,23976]},{"content":"The owner is set by default on any objects created while this access token is in effect.","pos":[23980,24068]},{"pos":[24124,24153],"content":"CAccessToken::GetPrimaryGroup"},{"pos":[24157,24241],"content":"Call this method to get the primary group associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the primary group associated with the `CAccessToken` object."},{"content":"Parameters","pos":[24315,24325]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>CSid Class<ept id=\"p1\">](../../atl/reference/csid-class.md)</ept> object.","pos":[24339,24407],"source":" Pointer to a [CSid Class](../../atl/reference/csid-class.md) object."},{"content":"Return Value","pos":[24417,24429]},{"content":"Returns true on success, false on failure.","pos":[24433,24475]},{"content":"Remarks","pos":[24485,24492]},{"content":"The group is set by default on any objects created while this access token is in effect.","pos":[24496,24584]},{"pos":[24638,24665],"content":"CAccessToken::GetPrivileges"},{"pos":[24669,24750],"content":"Call this method to get the privileges associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the privileges associated with the `CAccessToken` object."},{"content":"Parameters","pos":[24841,24851]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>CTokenPrivileges Class<ept id=\"p1\">](../../atl/reference/ctokenprivileges-class.md)</ept> object which will receive the privileges.","pos":[24872,24998],"source":" Pointer to a [CTokenPrivileges Class](../../atl/reference/ctokenprivileges-class.md) object which will receive the privileges."},{"content":"Return Value","pos":[25008,25020]},{"content":"Returns true on success, false on failure.","pos":[25024,25066]},{"pos":[25122,25151],"content":"CAccessToken::GetProcessToken"},{"pos":[25155,25250],"content":"Call this method to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the access token from the given process.","source":"Call this method to initialize the `CAccessToken` with the access token from the given process."},{"content":"Parameters","pos":[25359,25369]},{"content":"Specifies an access mask that specifies the requested types of access to the access token.","pos":[25394,25484]},{"content":"These requested access types are compared with the token's DACL to determine which accesses are granted or denied.","pos":[25485,25599]},{"content":"hProcess","pos":[25607,25615]},{"content":"Handle to the process whose access token is opened.","pos":[25620,25671]},{"content":"If the default value of <ph id=\"ph1\">`NULL`</ph> is used, the current process is used.","pos":[25672,25740],"source":" If the default value of `NULL` is used, the current process is used."},{"content":"Return Value","pos":[25750,25762]},{"pos":[25766,25812],"content":"Returns <ph id=\"ph1\">`true`</ph> on success, <ph id=\"ph2\">`false`</ph> on failure.","source":"Returns `true` on success, `false` on failure."},{"content":"Remarks","pos":[25822,25829]},{"pos":[25833,25935],"content":"Calls the <bpt id=\"p1\">[</bpt>OpenProcessToken<ept id=\"p1\">](http://msdn.microsoft.com/library/aa379295\\(vs.85\\).aspx)</ept> Win32 function.","source":"Calls the [OpenProcessToken](http://msdn.microsoft.com/library/aa379295\\(vs.85\\).aspx) Win32 function."},{"pos":[25986,26010],"content":"CAccessToken::GetProfile"},{"pos":[26014,26120],"content":"Call this method to get the handle pointing to the user profile associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the handle pointing to the user profile associated with the `CAccessToken` object."},{"content":"Return Value","pos":[26178,26190]},{"content":"Returns a handle pointing to the user profile, or NULL if no profile exists.","pos":[26194,26270]},{"pos":[26320,26343],"content":"CAccessToken::GetSource"},{"pos":[26347,26411],"content":"Call this method to get the source of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the source of the `CAccessToken` object."},{"content":"Parameters","pos":[26490,26500]},{"content":"pSource","pos":[26505,26512]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>TOKEN_SOURCE<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379631)</ept> structure.","pos":[26517,26615],"source":" Pointer to a [TOKEN_SOURCE](http://msdn.microsoft.com/library/windows/desktop/aa379631) structure."},{"content":"Return Value","pos":[26625,26637]},{"content":"Returns true on success, false on failure.","pos":[26641,26683]},{"pos":[26737,26764],"content":"CAccessToken::GetStatistics"},{"pos":[26768,26846],"content":"Call this method to get information associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get information associated with the `CAccessToken` object."},{"content":"Parameters","pos":[26937,26947]},{"content":"pStatistics","pos":[26952,26963]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>TOKEN_STATISTICS<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379632)</ept> structure.","pos":[26968,27070],"source":" Pointer to a [TOKEN_STATISTICS](http://msdn.microsoft.com/library/windows/desktop/aa379632) structure."},{"content":"Return Value","pos":[27080,27092]},{"content":"Returns true on success, false on failure.","pos":[27096,27138]},{"pos":[27207,27249],"content":"CAccessToken::GetTerminalServicesSessionId"},{"pos":[27253,27352],"content":"Call this method to get the Terminal Services Session ID associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the Terminal Services Session ID associated with the `CAccessToken` object."},{"content":"Parameters","pos":[27448,27458]},{"content":"pdwSessionId","pos":[27463,27475]},{"content":"The Terminal Services Session ID.","pos":[27480,27513]},{"content":"Return Value","pos":[27523,27535]},{"content":"Returns true on success, false on failure.","pos":[27539,27581]},{"pos":[27636,27664],"content":"CAccessToken::GetThreadToken"},{"pos":[27668,27755],"content":"Call this method to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the token from the given thread.","source":"Call this method to initialize the `CAccessToken` with the token from the given thread."},{"content":"Parameters","pos":[27891,27901]},{"content":"Specifies an access mask that specifies the requested types of access to the access token.","pos":[27926,28016]},{"content":"These requested access types are compared with the token's DACL to determine which accesses are granted or denied.","pos":[28017,28131]},{"content":"Handle to the thread whose access token is opened.","pos":[28151,28201]},{"content":"Indicates whether the access check is to be made against the security context of the thread calling the <ph id=\"ph1\">`GetThreadToken`</ph> method or against the security context of the process for the calling thread.","pos":[28225,28423],"source":" Indicates whether the access check is to be made against the security context of the thread calling the `GetThreadToken` method or against the security context of the process for the calling thread."},{"content":"If this parameter is false, the access check is performed using the security context for the calling thread.","pos":[28430,28538]},{"content":"If the thread is impersonating a client, this security context can be that of a client process.","pos":[28539,28634]},{"content":"If this parameter is true, the access check is made using the security context of the process for the calling thread.","pos":[28635,28752]},{"content":"Return Value","pos":[28762,28774]},{"content":"Returns true on success, false on failure.","pos":[28778,28820]},{"pos":[28871,28895],"content":"CAccessToken::GetTokenId"},{"pos":[28899,28978],"content":"Call this method to get the Token ID associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the Token ID associated with the `CAccessToken` object."},{"content":"Parameters","pos":[29048,29058]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>LUID<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379261)</ept> which will receive the Token ID.","pos":[29073,29185],"source":" Pointer to a [LUID](http://msdn.microsoft.com/library/windows/desktop/aa379261) which will receive the Token ID."},{"content":"Return Value","pos":[29195,29207]},{"content":"Returns true on success, false on failure.","pos":[29211,29253]},{"pos":[29301,29322],"content":"CAccessToken::GetType"},{"pos":[29326,29394],"content":"Call this method to get the token type of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the token type of the `CAccessToken` object."},{"content":"Parameters","pos":[29467,29477]},{"content":"Address of the <bpt id=\"p1\">[</bpt>TOKEN_TYPE<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379633)</ept> variable that, on success, receives the type of the token.","pos":[29492,29638],"source":" Address of the [TOKEN_TYPE](http://msdn.microsoft.com/library/windows/desktop/aa379633) variable that, on success, receives the type of the token."},{"content":"Return Value","pos":[29648,29660]},{"content":"Returns true on success, false on failure.","pos":[29664,29706]},{"content":"Remarks","pos":[29716,29723]},{"pos":[29727,29849],"content":"The <bpt id=\"p1\">**</bpt>TOKEN_TYPE<ept id=\"p1\">**</ept> enumeration type contains values that differentiate between a primary token and an impersonation token.","source":"The **TOKEN_TYPE** enumeration type contains values that differentiate between a primary token and an impersonation token."},{"pos":[29897,29918],"content":"CAccessToken::GetUser"},{"pos":[29922,30002],"content":"Call this method to identify the user associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to identify the user associated with the `CAccessToken` object."},{"content":"Parameters","pos":[30068,30078]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>CSid Class<ept id=\"p1\">](../../atl/reference/csid-class.md)</ept> object.","pos":[30092,30160],"source":" Pointer to a [CSid Class](../../atl/reference/csid-class.md) object."},{"content":"Return Value","pos":[30170,30182]},{"content":"Returns true on success, false on failure.","pos":[30186,30228]},{"pos":[30284,30313],"content":"CAccessToken::HKeyCurrentUser"},{"pos":[30317,30423],"content":"Call this method to get the handle pointing to the user profile associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to get the handle pointing to the user profile associated with the `CAccessToken` object."},{"content":"Return Value","pos":[30484,30496]},{"content":"Returns a handle pointing to the user profile, or NULL if no profile exists.","pos":[30500,30576]},{"pos":[30628,30653],"content":"CAccessToken::Impersonate"},{"pos":[30657,30728],"content":"Call this method to assign an impersonation <ph id=\"ph1\">`CAccessToken`</ph> to a thread.","source":"Call this method to assign an impersonation `CAccessToken` to a thread."},{"content":"Parameters","pos":[30811,30821]},{"content":"Handle to the thread to assign the impersonation token to.","pos":[30838,30896]},{"content":"This handle must have been opened with TOKEN_IMPERSONATE access rights.","pos":[30897,30968]},{"content":"If <ph id=\"ph1\">`hThread`</ph> is NULL, the method causes the thread to stop using an impersonation token.","pos":[30969,31057],"source":" If `hThread` is NULL, the method causes the thread to stop using an impersonation token."},{"content":"Return Value","pos":[31067,31079]},{"content":"Returns true on success, false on failure.","pos":[31083,31125]},{"content":"Remarks","pos":[31135,31142]},{"pos":[31146,31252],"content":"In debug builds, an assertion error will occur if <ph id=\"ph1\">`CAccessToken`</ph> does not have a valid pointer to a token.","source":"In debug builds, an assertion error will occur if `CAccessToken` does not have a valid pointer to a token."},{"pos":[31259,31414],"content":"The <bpt id=\"p1\">[</bpt>CAutoRevertImpersonation class<ept id=\"p1\">](../../atl/reference/cautorevertimpersonation-class.md)</ept> can be used to automatically revert impersonated access tokens.","source":"The [CAutoRevertImpersonation class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens."},{"pos":[31478,31515],"content":"CAccessToken::ImpersonateLoggedOnUser"},{"content":"Call this method to allow the calling thread to impersonate the security context of a logged-on user.","pos":[31519,31620]},{"content":"Return Value","pos":[31692,31704]},{"content":"Returns true on success, false on failure.","pos":[31708,31750]},{"content":"Remarks","pos":[31760,31767]},{"pos":[31775,32240],"content":"[!IMPORTANT]\n If a call to an impersonation function fails for any reason, the client is not impersonated and the client request is made in the security context of the process from which the call was made. If the process is running as a highly privileged account, or as a member of an administrative group, the user might be able to perform actions he or she would otherwise be disallowed. Therefore, the return value for this function should always be confirmed.","leadings":["","> "],"nodes":[{"content":" If a call to an impersonation function fails for any reason, the client is not impersonated and the client request is made in the security context of the process from which the call was made. If the process is running as a highly privileged account, or as a member of an administrative group, the user might be able to perform actions he or she would otherwise be disallowed. Therefore, the return value for this function should always be confirmed.","pos":[13,463],"nodes":[{"content":"If a call to an impersonation function fails for any reason, the client is not impersonated and the client request is made in the security context of the process from which the call was made.","pos":[1,192]},{"content":"If the process is running as a highly privileged account, or as a member of an administrative group, the user might be able to perform actions he or she would otherwise be disallowed.","pos":[193,376]},{"content":"Therefore, the return value for this function should always be confirmed.","pos":[377,450]}]}]},{"pos":[32298,32329],"content":"CAccessToken::IsTokenRestricted"},{"pos":[32333,32422],"content":"Call this method to test if the <ph id=\"ph1\">`CAccessToken`</ph> object contains a list of restricted SIDs.","source":"Call this method to test if the `CAccessToken` object contains a list of restricted SIDs."},{"content":"Return Value","pos":[32485,32497]},{"content":"Returns true if the object contains a list of restricting SIDs, false if there are no restricting SIDs or if the method fails.","pos":[32501,32627]},{"pos":[32683,32712],"content":"CAccessToken::LoadUserProfile"},{"pos":[32716,32800],"content":"Call this method to load the user profile associated with the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to load the user profile associated with the `CAccessToken` object."},{"content":"Return Value","pos":[32858,32870]},{"content":"Returns true on success, false on failure.","pos":[32874,32916]},{"content":"Remarks","pos":[32926,32933]},{"pos":[32937,33074],"content":"In debug builds, an assertion error will occur if the <ph id=\"ph1\">`CAccessToken`</ph> does not contain a valid token, or if a user profile already exists.","source":"In debug builds, an assertion error will occur if the `CAccessToken` does not contain a valid token, or if a user profile already exists."},{"pos":[33124,33147],"content":"CAccessToken::LogonUser"},{"content":"Call this method to create a logon session for the user associated with the given credentials.","pos":[33151,33245]},{"content":"Parameters","pos":[33471,33481]},{"content":"Pointer to a null-terminated string that specifies the user name.","pos":[33502,33567]},{"content":"This is the name of the user account to log on to.","pos":[33568,33618]},{"content":"pszDomain","pos":[33626,33635]},{"content":"Pointer to a null-terminated string that specifies the name of the domain or server whose account database contains the <ph id=\"ph1\">`pszUserName`</ph> account.","pos":[33640,33782],"source":" Pointer to a null-terminated string that specifies the name of the domain or server whose account database contains the `pszUserName` account."},{"content":"Pointer to a null-terminated string that specifies the clear-text password for the user account specified by <ph id=\"ph1\">`pszUserName`</ph>.","pos":[33806,33929],"source":" Pointer to a null-terminated string that specifies the clear-text password for the user account specified by `pszUserName`."},{"content":"dwLogonType","pos":[33937,33948]},{"content":"Specifies the type of logon operation to perform.","pos":[33953,34002]},{"content":"See <bpt id=\"p1\">[</bpt>LogonUser<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa378184)</ept> for more details.","pos":[34003,34096],"source":" See [LogonUser](http://msdn.microsoft.com/library/windows/desktop/aa378184) for more details."},{"content":"dwLogonProvider","pos":[34104,34119]},{"content":"Specifies the logon provider.","pos":[34124,34153]},{"content":"See <bpt id=\"p1\">[</bpt>LogonUser<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa378184)</ept> for more details.","pos":[34154,34247],"source":" See [LogonUser](http://msdn.microsoft.com/library/windows/desktop/aa378184) for more details."},{"content":"Return Value","pos":[34257,34269]},{"content":"Returns true on success, false on failure.","pos":[34273,34315]},{"content":"Remarks","pos":[34325,34332]},{"content":"The access token resulting from the logon will be associated with the <ph id=\"ph1\">`CAccessToken`</ph>.","pos":[34336,34421],"source":"The access token resulting from the logon will be associated with the `CAccessToken`."},{"content":"For this method to succeed, the <ph id=\"ph1\">`CAccessToken`</ph> object must hold SE_TCB_NAME privileges, identifying the holder as part of the trusted computer base.","pos":[34422,34570],"source":" For this method to succeed, the `CAccessToken` object must hold SE_TCB_NAME privileges, identifying the holder as part of the trusted computer base."},{"content":"See <bpt id=\"p1\">[</bpt>LogonUser<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa378184)</ept> for more information regarding the privileges required.","pos":[34571,34702],"source":" See [LogonUser](http://msdn.microsoft.com/library/windows/desktop/aa378184) for more information regarding the privileges required."},{"pos":[34761,34793],"content":"CAccessToken::OpenCOMClientToken"},{"pos":[34797,34944],"content":"Call this method from within a COM server handling a call from a client to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the access token from the COM client.","source":"Call this method from within a COM server handling a call from a client to initialize the `CAccessToken` with the access token from the COM client."},{"content":"Parameters","pos":[35091,35101]},{"content":"Specifies an access mask that specifies the requested types of access to the access token.","pos":[35126,35216]},{"content":"These requested access types are compared with the token's DACL to determine which accesses are granted or denied.","pos":[35217,35331]},{"content":"If true, the current thread will impersonate the calling COM client if this call completes successfully.","pos":[35356,35460]},{"content":"If false, the access token will be opened, but the thread will not have an impersonation token when this call completes.","pos":[35461,35581]},{"content":"Indicates whether the access check is to be made against the security context of the thread calling the <bpt id=\"p1\">[</bpt>GetThreadToken<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms683182)</ept> method or against the security context of the process for the calling thread.","pos":[35605,35863],"source":" Indicates whether the access check is to be made against the security context of the thread calling the [GetThreadToken](http://msdn.microsoft.com/library/windows/desktop/ms683182) method or against the security context of the process for the calling thread."},{"content":"If this parameter is false, the access check is performed using the security context for the calling thread.","pos":[35870,35978]},{"content":"If the thread is impersonating a client, this security context can be that of a client process.","pos":[35979,36074]},{"content":"If this parameter is true, the access check is made using the security context of the process for the calling thread.","pos":[36075,36192]},{"content":"Return Value","pos":[36202,36214]},{"content":"Returns true on success, false on failure.","pos":[36218,36260]},{"content":"Remarks","pos":[36270,36277]},{"pos":[36281,36489],"content":"The <bpt id=\"p1\">[</bpt>CAutoRevertImpersonation Class<ept id=\"p1\">](../../atl/reference/cautorevertimpersonation-class.md)</ept> can be used to automatically revert impersonated access tokens created by setting the <ph id=\"ph1\">`bImpersonate`</ph> flag to <bpt id=\"p2\">*</bpt>true<ept id=\"p2\">*</ept>.","source":"The [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens created by setting the `bImpersonate` flag to *true*."},{"pos":[36554,36592],"content":"CAccessToken::OpenNamedPipeClientToken"},{"pos":[36596,36739],"content":"Call this method from within a server taking requests over a named pipe to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the access token from the client.","source":"Call this method from within a server taking requests over a named pipe to initialize the `CAccessToken` with the access token from the client."},{"content":"Parameters","pos":[36910,36920]},{"content":"hPipe","pos":[36925,36930]},{"content":"Handle to a named pipe.","pos":[36935,36958]},{"content":"Specifies an access mask that specifies the requested types of access to the access token.","pos":[36986,37076]},{"content":"These requested access types are compared with the token's DACL to determine which accesses are granted or denied.","pos":[37077,37191]},{"content":"If true, the current thread will impersonate the calling pipe client if this call completes successfully.","pos":[37216,37321]},{"content":"If false, the access token will be opened, but the thread will not have an impersonation token when this call completes.","pos":[37322,37442]},{"content":"Indicates whether the access check is to be made against the security context of the thread calling the <bpt id=\"p1\">[</bpt>GetThreadToken<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms683182)</ept> method or against the security context of the process for the calling thread.","pos":[37466,37724],"source":" Indicates whether the access check is to be made against the security context of the thread calling the [GetThreadToken](http://msdn.microsoft.com/library/windows/desktop/ms683182) method or against the security context of the process for the calling thread."},{"content":"If this parameter is false, the access check is performed using the security context for the calling thread.","pos":[37731,37839]},{"content":"If the thread is impersonating a client, this security context can be that of a client process.","pos":[37840,37935]},{"content":"If this parameter is true, the access check is made using the security context of the process for the calling thread.","pos":[37936,38053]},{"content":"Return Value","pos":[38063,38075]},{"content":"Returns true on success, false on failure.","pos":[38079,38121]},{"content":"Remarks","pos":[38131,38138]},{"pos":[38142,38350],"content":"The <bpt id=\"p1\">[</bpt>CAutoRevertImpersonation Class<ept id=\"p1\">](../../atl/reference/cautorevertimpersonation-class.md)</ept> can be used to automatically revert impersonated access tokens created by setting the <ph id=\"ph1\">`bImpersonate`</ph> flag to <bpt id=\"p2\">*</bpt>true<ept id=\"p2\">*</ept>.","source":"The [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens created by setting the `bImpersonate` flag to *true*."},{"pos":[38409,38441],"content":"CAccessToken::OpenRPCClientToken"},{"pos":[38445,38589],"content":"Call this method from within a server handling a call from an RPC client to initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the access token from the client.","source":"Call this method from within a server handling a call from an RPC client to initialize the `CAccessToken` with the access token from the client."},{"content":"Parameters","pos":[38774,38784]},{"content":"BindingHandle","pos":[38789,38802]},{"content":"Binding handle on the server that represents a binding to a client.","pos":[38807,38874]},{"content":"Specifies an access mask that specifies the requested types of access to the access token.","pos":[38902,38992]},{"content":"These requested access types are compared with the token's DACL to determine which accesses are granted or denied.","pos":[38993,39107]},{"content":"If true, the current thread will impersonate the calling RPC client if this call completes successfully.","pos":[39132,39236]},{"content":"If false, the access token will be opened, but the thread will not have an impersonation token when this call completes.","pos":[39237,39357]},{"content":"Indicates whether the access check is to be made against the security context of the thread calling the <bpt id=\"p1\">[</bpt>GetThreadToken<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms683182)</ept> method or against the security context of the process for the calling thread.","pos":[39381,39639],"source":" Indicates whether the access check is to be made against the security context of the thread calling the [GetThreadToken](http://msdn.microsoft.com/library/windows/desktop/ms683182) method or against the security context of the process for the calling thread."},{"content":"If this parameter is false, the access check is performed using the security context for the calling thread.","pos":[39646,39754]},{"content":"If the thread is impersonating a client, this security context can be that of a client process.","pos":[39755,39850]},{"content":"If this parameter is true, the access check is made using the security context of the process for the calling thread.","pos":[39851,39968]},{"content":"Return Value","pos":[39978,39990]},{"content":"Returns true on success, false on failure.","pos":[39994,40036]},{"content":"Remarks","pos":[40046,40053]},{"pos":[40057,40265],"content":"The <bpt id=\"p1\">[</bpt>CAutoRevertImpersonation Class<ept id=\"p1\">](../../atl/reference/cautorevertimpersonation-class.md)</ept> can be used to automatically revert impersonated access tokens created by setting the <ph id=\"ph1\">`bImpersonate`</ph> flag to <bpt id=\"p2\">*</bpt>true<ept id=\"p2\">*</ept>.","source":"The [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens created by setting the `bImpersonate` flag to *true*."},{"pos":[40321,40350],"content":"CAccessToken::OpenThreadToken"},{"pos":[40354,40478],"content":"Call this method to set the impersonation level and then initialize the <ph id=\"ph1\">`CAccessToken`</ph> with the token from the given thread.","source":"Call this method to set the impersonation level and then initialize the `CAccessToken` with the token from the given thread."},{"content":"Parameters","pos":[40684,40694]},{"content":"Specifies an access mask that specifies the requested types of access to the access token.","pos":[40719,40809]},{"content":"These requested access types are compared with the token's DACL to determine which accesses are granted or denied.","pos":[40810,40924]},{"content":"If true, the thread will be left at the requested impersonation level after this method completes.","pos":[40949,41047]},{"content":"If false, the thread will revert to its original impersonation level.","pos":[41048,41117]},{"content":"Indicates whether the access check is to be made against the security context of the thread calling the <bpt id=\"p1\">[</bpt>GetThreadToken<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms683182)</ept> method or against the security context of the process for the calling thread.","pos":[41141,41399],"source":" Indicates whether the access check is to be made against the security context of the thread calling the [GetThreadToken](http://msdn.microsoft.com/library/windows/desktop/ms683182) method or against the security context of the process for the calling thread."},{"content":"If this parameter is false, the access check is performed using the security context for the calling thread.","pos":[41406,41514]},{"content":"If the thread is impersonating a client, this security context can be that of a client process.","pos":[41515,41610]},{"content":"If this parameter is true, the access check is made using the security context of the process for the calling thread.","pos":[41611,41728]},{"content":"Specifies a <bpt id=\"p1\">[</bpt>SECURITY_IMPERSONATION_LEVEL<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379572)</ept> enumerated type that supplies the impersonation level of the token.","pos":[41744,41914],"source":" Specifies a [SECURITY_IMPERSONATION_LEVEL](http://msdn.microsoft.com/library/windows/desktop/aa379572) enumerated type that supplies the impersonation level of the token."},{"content":"Return Value","pos":[41924,41936]},{"content":"Returns true on success, false on failure.","pos":[41940,41982]},{"content":"Remarks","pos":[41992,41999]},{"pos":[42021,42201],"content":"is similar to <bpt id=\"p1\">[</bpt>CAccessToken::GetThreadToken<ept id=\"p1\">](#caccesstoken__getthreadtoken)</ept>, but sets the impersonation level before initializing the <ph id=\"ph1\">`CAccessToken`</ph> from the thread's access token.","source":" is similar to [CAccessToken::GetThreadToken](#caccesstoken__getthreadtoken), but sets the impersonation level before initializing the `CAccessToken` from the thread's access token."},{"pos":[42208,42416],"content":"The <bpt id=\"p1\">[</bpt>CAutoRevertImpersonation Class<ept id=\"p1\">](../../atl/reference/cautorevertimpersonation-class.md)</ept> can be used to automatically revert impersonated access tokens created by setting the <ph id=\"ph1\">`bImpersonate`</ph> flag to <bpt id=\"p2\">*</bpt>true<ept id=\"p2\">*</ept>.","source":"The [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens created by setting the `bImpersonate` flag to *true*."},{"pos":[42471,42499],"content":"CAccessToken::PrivilegeCheck"},{"pos":[42503,42614],"content":"Call this method to determine whether a specified set of privileges are enabled in the <bpt id=\"p1\">**</bpt>CAccessToken<ept id=\"p1\">**</ept> object.","source":"Call this method to determine whether a specified set of privileges are enabled in the **CAccessToken** object."},{"content":"Parameters","pos":[42732,42742]},{"content":"RequiredPrivileges","pos":[42747,42765]},{"content":"Pointer to a <bpt id=\"p1\">[</bpt>PRIVILEGE_SET<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379307)</ept> structure.","pos":[42770,42869],"source":" Pointer to a [PRIVILEGE_SET](http://msdn.microsoft.com/library/windows/desktop/aa379307) structure."},{"content":"pbResult","pos":[42877,42885]},{"content":"Pointer to a value the method sets to indicate whether any or all of the specified privilege are enabled in the <ph id=\"ph1\">`CAccessToken`</ph> object.","pos":[42890,43024],"source":" Pointer to a value the method sets to indicate whether any or all of the specified privilege are enabled in the `CAccessToken` object."},{"content":"Return Value","pos":[43034,43046]},{"content":"Returns true on success, false on failure.","pos":[43050,43092]},{"content":"Remarks","pos":[43102,43109]},{"content":"When <ph id=\"ph1\">`PrivilegeCheck`</ph> returns, the <bpt id=\"p1\">**</bpt>Attributes<ept id=\"p1\">**</ept> member of each <bpt id=\"p2\">[</bpt>LUID_AND_ATTRIBUTES<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/aa379263)</ept> structure is set to SE_PRIVILEGE_USED_FOR_ACCESS if the corresponding privilege is enabled.","pos":[43113,43351],"source":"When `PrivilegeCheck` returns, the **Attributes** member of each [LUID_AND_ATTRIBUTES](http://msdn.microsoft.com/library/windows/desktop/aa379263) structure is set to SE_PRIVILEGE_USED_FOR_ACCESS if the corresponding privilege is enabled."},{"content":"This method calls the <bpt id=\"p1\">[</bpt>PrivilegeCheck<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa379304)</ept> Win32 function.","pos":[43352,43466],"source":" This method calls the [PrivilegeCheck](http://msdn.microsoft.com/library/windows/desktop/aa379304) Win32 function."},{"pos":[43513,43533],"content":"CAccessToken::Revert"},{"content":"Call this method to stop a thread from using an impersonation token.","pos":[43537,43605]},{"content":"Parameters","pos":[43680,43690]},{"content":"Handle to the thread to revert from impersonation.","pos":[43707,43757]},{"content":"If <bpt id=\"p1\">*</bpt>hThread<ept id=\"p1\">*</ept> is NULL, the current thread is assumed.","pos":[43758,43810],"source":" If *hThread* is NULL, the current thread is assumed."},{"content":"Return Value","pos":[43820,43832]},{"content":"Returns true on success, false on failure.","pos":[43836,43878]},{"content":"Remarks","pos":[43888,43895]},{"pos":[43899,44065],"content":"The reversion of impersonation tokens can be performed automatically with the <bpt id=\"p1\">[</bpt>CAutoRevertImpersonation Class<ept id=\"p1\">](../../atl/reference/cautorevertimpersonation-class.md)</ept>.","source":"The reversion of impersonation tokens can be performed automatically with the [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md)."},{"pos":[44120,44148],"content":"CAccessToken::SetDefaultDacl"},{"pos":[44152,44222],"content":"Call this method to set the default DACL of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to set the default DACL of the `CAccessToken` object."},{"content":"Parameters","pos":[44297,44307]},{"content":"The new default <bpt id=\"p1\">[</bpt>CDacl Class<ept id=\"p1\">](../../atl/reference/cdacl-class.md)</ept> information.","pos":[44322,44400],"source":" The new default [CDacl Class](../../atl/reference/cdacl-class.md) information."},{"content":"Return Value","pos":[44410,44422]},{"content":"Returns true on success, false on failure.","pos":[44426,44468]},{"content":"Remarks","pos":[44478,44485]},{"content":"The default DACL is the DACL that is used by default when new objects are created with this access token in effect.","pos":[44489,44604]},{"pos":[44653,44675],"content":"CAccessToken::SetOwner"},{"pos":[44679,44742],"content":"Call this method to set the owner of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to set the owner of the `CAccessToken` object."},{"content":"Parameters","pos":[44809,44819]},{"content":"The <bpt id=\"p1\">[</bpt>CSid Class<ept id=\"p1\">](../../atl/reference/csid-class.md)</ept> object containing the owner information.","pos":[44833,44925],"source":" The [CSid Class](../../atl/reference/csid-class.md) object containing the owner information."},{"content":"Return Value","pos":[44935,44947]},{"content":"Returns true on success, false on failure.","pos":[44951,44993]},{"content":"Remarks","pos":[45003,45010]},{"content":"The owner is the default owner that is used for new objects created while this access token is in effect.","pos":[45014,45119]},{"pos":[45175,45204],"content":"CAccessToken::SetPrimaryGroup"},{"pos":[45208,45279],"content":"Call this method to set the primary group of the <ph id=\"ph1\">`CAccessToken`</ph> object.","source":"Call this method to set the primary group of the `CAccessToken` object."},{"content":"Parameters","pos":[45353,45363]},{"content":"The <bpt id=\"p1\">[</bpt>CSid Class<ept id=\"p1\">](../../atl/reference/csid-class.md)</ept> object containing the primary group information.","pos":[45377,45477],"source":" The [CSid Class](../../atl/reference/csid-class.md) object containing the primary group information."},{"content":"Return Value","pos":[45487,45499]},{"content":"Returns true on success, false on failure.","pos":[45503,45545]},{"content":"Remarks","pos":[45555,45562]},{"content":"The primary group is the default group for new objects created while this access token is in effect.","pos":[45566,45666]},{"content":"See Also","pos":[45675,45683]},{"content":"ATLSecurity Sample","pos":[45688,45706]},{"content":"Access Tokens","pos":[45742,45755]},{"content":"Class Overview","pos":[45822,45836]}],"content":"---\ntitle: \"CAccessToken Class | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\nf1_keywords: \n  - \"ATLSECURITY/CAccessToken\"\n  - \"ATL.CAccessToken\"\n  - \"CAccessToken\"\n  - \"ATL::CAccessToken\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CAccessToken class\"\nms.assetid: bb5c5945-56a5-4083-b442-76573cee83ab\ncaps.latest.revision: 24\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# CAccessToken Class\nThis class is a wrapper for an access token.  \n  \n> [!IMPORTANT]\n>  This class and its members cannot be used in applications that execute in the Windows Runtime.  \n  \n## Syntax  \n  \n```\nclass CAccessToken\n```  \n  \n## Members  \n  \n### Public Constructors  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CAccessToken::~CAccessToken](#caccesstoken___dtorcaccesstoken)|The destructor.|  \n  \n### Public Methods  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CAccessToken::Attach](#caccesstoken__attach)|Call this method to take ownership of the given access token handle.|  \n|[CAccessToken::CheckTokenMembership](#caccesstoken__checktokenmembership)|Call this method to determine if a specified SID is enabled in the `CAccessToken` object.|  \n|[CAccessToken::CreateImpersonationToken](#caccesstoken__createimpersonationtoken)|Call this method to create a new impersonation access token.|  \n|[CAccessToken::CreatePrimaryToken](#caccesstoken__createprimarytoken)|Call this method to create a new primary token.|  \n|[CAccessToken::CreateProcessAsUser](#caccesstoken__createprocessasuser)|Call this method to create a new process running in the security context of the user represented by the `CAccessToken` object.|  \n|[CAccessToken::CreateRestrictedToken](#caccesstoken__createrestrictedtoken)|Call this method to create a new, restricted `CAccessToken` object.|  \n|[CAccessToken::Detach](#caccesstoken__detach)|Call this method to revoke ownership of the access token.|  \n|[CAccessToken::DisablePrivilege](#caccesstoken__disableprivilege)|Call this method to disable a privilege in the `CAccessToken` object.|  \n|[CAccessToken::DisablePrivileges](#caccesstoken__disableprivileges)|Call this method to disable one or more privileges in the `CAccessToken` object.|  \n|[CAccessToken::EnablePrivilege](#caccesstoken__enableprivilege)|Call this method to enable a privilege in the `CAccessToken` object.|  \n|[CAccessToken::EnablePrivileges](#caccesstoken__enableprivileges)|Call this method to enable one or more privileges in the `CAccessToken` object.|  \n|[CAccessToken::GetDefaultDacl](#caccesstoken__getdefaultdacl)|Call this method to return the `CAccessToken` object's default DACL.|  \n|[CAccessToken::GetEffectiveToken](#caccesstoken__geteffectivetoken)|Call this method to get the `CAccessToken` object equal to the access token in effect for the current thread.|  \n|[CAccessToken::GetGroups](#caccesstoken__getgroups)|Call this method to return the `CAccessToken` object's token groups.|  \n|[CAccessToken::GetHandle](#caccesstoken__gethandle)|Call this method to retrieve a handle to the access token.|  \n|[CAccessToken::GetImpersonationLevel](#caccesstoken__getimpersonationlevel)|Call this method to get the impersonation level from the access token.|  \n|[CAccessToken::GetLogonSessionId](#caccesstoken__getlogonsessionid)|Call this method to get the Logon Session ID associated with the `CAccessToken` object.|  \n|[CAccessToken::GetLogonSid](#caccesstoken__getlogonsid)|Call this method to get the Logon SID associated with the `CAccessToken` object.|  \n|[CAccessToken::GetOwner](#caccesstoken__getowner)|Call this method to get the owner associated with the `CAccessToken` object.|  \n|[CAccessToken::GetPrimaryGroup](#caccesstoken__getprimarygroup)|Call this method to get the primary group associated with the `CAccessToken` object.|  \n|[CAccessToken::GetPrivileges](#caccesstoken__getprivileges)|Call this method to get the privileges associated with the `CAccessToken` object.|  \n|[CAccessToken::GetProcessToken](#caccesstoken__getprocesstoken)|Call this method to initialize the `CAccessToken` with the access token from the given process.|  \n|[CAccessToken::GetProfile](#caccesstoken__getprofile)|Call this method to get the handle pointing to the user profile associated with the `CAccessToken` object.|  \n|[CAccessToken::GetSource](#caccesstoken__getsource)|Call this method to get the source of the `CAccessToken` object.|  \n|[CAccessToken::GetStatistics](#caccesstoken__getstatistics)|Call this method to get information associated with the `CAccessToken` object.|  \n|[CAccessToken::GetTerminalServicesSessionId](#caccesstoken__getterminalservicessessionid)|Call this method to get the Terminal Services Session ID associated with the `CAccessToken` object.|  \n|[CAccessToken::GetThreadToken](#caccesstoken__getthreadtoken)|Call this method to initialize the `CAccessToken` with the token from the given thread.|  \n|[CAccessToken::GetTokenId](#caccesstoken__gettokenid)|Call this method to get the Token ID associated with the `CAccessToken` object.|  \n|[CAccessToken::GetType](#caccesstoken__gettype)|Call this method to get the token type of the `CAccessToken` object.|  \n|[CAccessToken::GetUser](#caccesstoken__getuser)|Call this method to identify the user associated with the `CAccessToken` object.|  \n|[CAccessToken::HKeyCurrentUser](#caccesstoken__hkeycurrentuser)|Call this method to get the handle pointing to the user profile associated with the `CAccessToken` object.|  \n|[CAccessToken::Impersonate](#caccesstoken__impersonate)|Call this method to assign an impersonation `CAccessToken` to a thread.|  \n|[CAccessToken::ImpersonateLoggedOnUser](#caccesstoken__impersonateloggedonuser)|Call this method to allow the calling thread to impersonate the security context of a logged-on user.|  \n|[CAccessToken::IsTokenRestricted](#caccesstoken__istokenrestricted)|Call this method to test if the `CAccessToken` object contains a list of restricted SIDs.|  \n|[CAccessToken::LoadUserProfile](#caccesstoken__loaduserprofile)|Call this method to load the user profile associated with the `CAccessToken` object.|  \n|[CAccessToken::LogonUser](#caccesstoken__logonuser)|Call this method to create a logon session for the user associated with the given credentials.|  \n|[CAccessToken::OpenCOMClientToken](#caccesstoken__opencomclienttoken)|Call this method from within a COM server handling a call from a client to initialize the `CAccessToken` with the access token from the COM client.|  \n|[CAccessToken::OpenNamedPipeClientToken](#caccesstoken__opennamedpipeclienttoken)|Call this method from within a server taking requests over a named pipe to initialize the `CAccessToken` with the access token from the client.|  \n|[CAccessToken::OpenRPCClientToken](#caccesstoken__openrpcclienttoken)|Call this method from within a server handling a call from an RPC client to initialize the `CAccessToken` with the access token from the client.|  \n|[CAccessToken::OpenThreadToken](#caccesstoken__openthreadtoken)|Call this method to set the impersonation level and then initialize the `CAccessToken` with the token from the given thread.|  \n|[CAccessToken::PrivilegeCheck](#caccesstoken__privilegecheck)|Call this method to determine whether a specified set of privileges are enabled in the **CAccessToken** object.|  \n|[CAccessToken::Revert](#caccesstoken__revert)|Call this method to stop a thread that is using an impersonation token.|  \n|[CAccessToken::SetDefaultDacl](#caccesstoken__setdefaultdacl)|Call this method to set the default DACL of the `CAccessToken` object.|  \n|[CAccessToken::SetOwner](#caccesstoken__setowner)|Call this method to set the owner of the `CAccessToken` object.|  \n|[CAccessToken::SetPrimaryGroup](#caccesstoken__setprimarygroup)|Call this method to set the primary group of the `CAccessToken` object.|  \n  \n## Remarks  \n An [access token](http://msdn.microsoft.com/library/windows/desktop/aa374909) is an object that describes the security context of a process or thread and is allocated to each user logged onto a Windows NT or Windows 2000 system.  \n  \n For an introduction to the access control model in Windows, see [Access Control](http://msdn.microsoft.com/library/windows/desktop/aa374860) in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)].  \n  \n## Requirements  \n **Header:** atlsecurity.h  \n  \n##  <a name=\"caccesstoken__attach\"></a>  CAccessToken::Attach  \n Call this method to take ownership of the given access token handle.  \n  \n```\nvoid Attach(HANDLE   hToken) throw();\n```  \n  \n### Parameters  \n *hToken*  \n A handle to the access token.  \n  \n### Remarks  \n In debug builds, an assertion error will occur if the `CAccessToken` object already has ownership of an access token.  \n  \n##  <a name=\"caccesstoken___dtorcaccesstoken\"></a>  CAccessToken::~CAccessToken  \n The destructor.  \n  \n```\nvirtual ~CAccessToken() throw();\n```  \n  \n### Remarks  \n Frees all allocated resources.  \n  \n##  <a name=\"caccesstoken__checktokenmembership\"></a>  CAccessToken::CheckTokenMembership  \n Call this method to determine if a specified SID is enabled in the `CAccessToken` object.  \n  \n```\nbool CheckTokenMembership(\n    const CSid& rSid,\n    bool* pbIsMember) const throw(...);\n```  \n  \n### Parameters  \n `rSid`  \n Reference to a [CSid Class](../../atl/reference/csid-class.md) object.  \n  \n `pbIsMember`  \n Pointer to a variable that receives the results of the check.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The `CheckTokenMembership` method checks for the presence of the SID in the user and group SIDs of the access token. If the SID is present and has the SE_GROUP_ENABLED attribute, *pbIsMember* is set to true; otherwise, it is set to false.  \n  \n In debug builds, an assertion error will occur if `pbIsMember` is not a valid pointer.  \n  \n> [!NOTE]\n>  The `CAccessToken` object must be an impersonation token and not a primary token.  \n  \n##  <a name=\"caccesstoken__createimpersonationtoken\"></a>  CAccessToken::CreateImpersonationToken  \n Call this method to create an impersonation access token.  \n  \n```\nbool CreateImpersonationToken(\n    CAccessToken* pImp,\n    SECURITY_IMPERSONATION_LEVEL sil = SecurityImpersonation) const throw(...);\n```  \n  \n### Parameters  \n `pImp`  \n Pointer to the new `CAccessToken` object.  \n  \n `sil`  \n Specifies a [SECURITY_IMPERSONATION_LEVEL](http://msdn.microsoft.com/library/windows/desktop/aa379572) enumerated type that supplies the impersonation level of the new token.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n `CreateImpersonationToken` calls [DuplicateToken](http://msdn.microsoft.com/library/windows/desktop/aa446616) to create a new impersonation token.  \n  \n##  <a name=\"caccesstoken__createprimarytoken\"></a>  CAccessToken::CreatePrimaryToken  \n Call this method to create a new primary token.  \n  \n```\nbool CreatePrimaryToken(\n    CAccessToken* pPri,\n    DWORD dwDesiredAccess = MAXIMUM_ALLOWED,\n    const CSecurityAttributes* pTokenAttributes = NULL) const throw(...);\n```  \n  \n### Parameters  \n *pPri*  \n Pointer to the new `CAccessToken` object.  \n  \n `dwDesiredAccess`  \n Specifies the requested access rights for the new token. The default, MAXIMUM_ALLOWED, requests all access rights that are valid for the caller. See [Access Rights and Access Masks](http://msdn.microsoft.com/library/windows/desktop/aa374902) for more on access rights.  \n  \n *pTokenAttributes*  \n Pointer to a [SECURITY_ATTRIBUTES](http://msdn.microsoft.com/library/windows/desktop/aa379560) structure that specifies a security descriptor for the new token and determines whether child processes can inherit the token. If *pTokenAttributes* is NULL, the token gets a default security descriptor and the handle cannot be inherited.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n `CreatePrimaryToken` calls [DuplicateTokenEx](http://msdn.microsoft.com/library/windows/desktop/aa446617) to create a new primary token.  \n  \n##  <a name=\"caccesstoken__createprocessasuser\"></a>  CAccessToken::CreateProcessAsUser  \n Call this method to create a new process running in the security context of the user represented by the `CAccessToken` object.  \n  \n```\nbool CreateProcessAsUser(\n    LPCTSTR pApplicationName,\n    LPTSTR pCommandLine,\n    LPPROCESS_INFORMATION pProcessInformation,\n    LPSTARTUPINFO pStartupInfo,\n    DWORD dwCreationFlags = NORMAL_PRIORITY_CLASS,\n    bool bLoadProfile = false,\n    const CSecurityAttributes* pProcessAttributes = NULL,\n    const CSecurityAttributes* pThreadAttributes = NULL,\n    bool bInherit = false,\n    LPCTSTR pCurrentDirectory = NULL) throw();\n```  \n  \n### Parameters  \n *pApplicationName*  \n Pointer to a null-terminated string that specifies the module to execute. This parameter may not be NULL.  \n  \n *pCommandLine*  \n Pointer to a null-terminated string that specifies the command line to execute.  \n  \n *pProcessInformation*  \n Pointer to a [PROCESS_INFORMATION](http://msdn.microsoft.com/library/windows/desktop/ms684873) structure that receives identification information about the new process.  \n  \n *pStartupInfo*  \n Pointer to a [STARTUPINFO](http://msdn.microsoft.com/library/windows/desktop/ms686331) structure that specifies how the main window for the new process should appear.  \n  \n `dwCreationFlags`  \n Specifies additional flags that control the priority class and the creation of the process. See the Win32 function [CreateProcessAsUser](http://msdn.microsoft.com/library/windows/desktop/ms682429) for a list of flags.  \n  \n *bLoadProfile*  \n If true, the user's profile is loaded with [LoadUserProfile](http://msdn.microsoft.com/library/windows/desktop/bb762281).  \n  \n *pProcessAttributes*  \n Pointer to a [SECURITY_ATTRIBUTES](http://msdn.microsoft.com/library/windows/desktop/aa379560) structure that specifies a security descriptor for the new process and determines whether child processes can inherit the returned handle. If *pProcessAttributes* is NULL, the process gets a default security descriptor and the handle cannot be inherited.  \n  \n *pThreadAttributes*  \n Pointer to a [SECURITY_ATTRIBUTES](http://msdn.microsoft.com/library/windows/desktop/aa379560) structure that specifies a security descriptor for the new thread and determines whether child processes can inherit the returned handle. If *pThreadAttributes* is NULL, the thread gets a default security descriptor and the handle cannot be inherited.  \n  \n *bInherit*  \n Indicates whether the new process inherits handles from the calling process. If true, each inheritable open handle in the calling process is inherited by the new process. Inherited handles have the same value and access privileges as the original handles.  \n  \n *pCurrentDirectory*  \n Pointer to a null-terminated string that specifies the current drive and directory for the new process. The string must be a full path that includes a drive letter. If this parameter is NULL, the new process will have the same current drive and directory as the calling process.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n **CreateProcessAsUser** uses the `CreateProcessAsUser` Win32 function to create a new process that runs in the security context of the user represented by the `CAccessToken` object. See the description of the [CreateProcessAsUser](http://msdn.microsoft.com/library/windows/desktop/ms682429) function for a full discussion of the parameters required.  \n  \n For this method to succeed, the `CAccessToken` object must hold AssignPrimaryToken (unless it is a restricted token) and IncreaseQuota privileges.  \n  \n##  <a name=\"caccesstoken__createrestrictedtoken\"></a>  CAccessToken::CreateRestrictedToken  \n Call this method to create a new, restricted `CAccessToken` object.  \n  \n```\nbool CreateRestrictedToken(\n    CAccessToken* pRestrictedToken,\n    const CTokenGroups& SidsToDisable,\n    const CTokenGroups& SidsToRestrict,\n    const CTokenPrivileges& PrivilegesToDelete = CTokenPrivileges()) const throw(...);\n```  \n  \n### Parameters  \n *pRestrictedToken*  \n The new, restricted `CAccessToken` object.  \n  \n `SidsToDisable`  \n A `CTokenGroups` object that specifies the deny-only SIDs.  \n  \n *SidsToRestrict*  \n A `CTokenGroups` object that specifies the restricting SIDs.  \n  \n `PrivilegesToDelete`  \n A `CTokenPrivileges` object that specifies the privileges to delete in the restricted token. The default creates an empty object.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n `CreateRestrictedToken` uses the [CreateRestrictedToken](http://msdn.microsoft.com/library/windows/desktop/aa446583) Win32 function to create a new `CAccessToken` object, with restrictions.  \n  \n> [!NOTE]\n>  This method is only available on Windows 2000 or later.  \n  \n> [!IMPORTANT]\n>  When using `CreateRestrictedToken`, ensure the following: the existing token is valid (and not entered by the user) and `SidsToDisable` and `PrivilegesToDelete` are both valid (and not entered by the user). If the method returns false, deny functionality.  \n  \n##  <a name=\"caccesstoken__detach\"></a>  CAccessToken::Detach  \n Call this method to revoke ownership of the access token.  \n  \n```\nHANDLE Detach() throw();\n```  \n  \n### Return Value  \n Returns the handle to the `CAccessToken` which has been detached.  \n  \n### Remarks  \n This method revokes the `CAccessToken`'s ownership of the access token.  \n  \n##  <a name=\"caccesstoken__disableprivilege\"></a>  CAccessToken::DisablePrivilege  \n Call this method to disable a privilege in the `CAccessToken` object.  \n  \n```\nbool DisablePrivilege(\n    LPCTSTR pszPrivilege,\n    CTokenPrivileges* pPreviousState = NULL) throw(...);\n```  \n  \n### Parameters  \n `pszPrivilege`  \n Pointer to a string containing the privilege to disable in the `CAccessToken` object.  \n  \n `pPreviousState`  \n Pointer to a `CTokenPrivileges` object which will contain the previous state of the privileges.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__disableprivileges\"></a>  CAccessToken::DisablePrivileges  \n Call this method to disable one or more privileges in the `CAccessToken` object.  \n  \n```\nbool DisablePrivileges(\n    const CAtlArray<LPCTSTR>& rPrivileges,\n    CTokenPrivileges* pPreviousState = NULL) throw(...);\n```  \n  \n### Parameters  \n `rPrivileges`  \n Pointer to an array of strings containing the privileges to disable in the `CAccessToken` object.  \n  \n `pPreviousState`  \n Pointer to a `CTokenPrivileges` object which will contain the previous state of the privileges.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__enableprivilege\"></a>  CAccessToken::EnablePrivilege  \n Call this method to enable a privilege in the `CAccessToken` object.  \n  \n```\nbool EnablePrivilege(\n    LPCTSTR pszPrivilege,\n    CTokenPrivileges* pPreviousState = NULL) throw(...);\n```  \n  \n### Parameters  \n `pszPrivilege`  \n Pointer to a string containing the privilege to enable in the `CAccessToken` object.  \n  \n `pPreviousState`  \n Pointer to a `CTokenPrivileges` object which will contain the previous state of the privileges.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__enableprivileges\"></a>  CAccessToken::EnablePrivileges  \n Call this method to enable one or more privileges in the `CAccessToken` object.  \n  \n```\nbool EnablePrivileges(\n    const CAtlArray<LPCTSTR>& rPrivileges,\n    CTokenPrivileges* pPreviousState = NULL) throw(...);\n```  \n  \n### Parameters  \n `rPrivileges`  \n Pointer to an array of strings containing the privileges to enable in the `CAccessToken` object.  \n  \n `pPreviousState`  \n Pointer to a `CTokenPrivileges` object which will contain the previous state of the privileges.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__getdefaultdacl\"></a>  CAccessToken::GetDefaultDacl  \n Call this method to return the `CAccessToken` object's default DACL.  \n  \n```\nbool GetDefaultDacl(CDacl* pDacl) const throw(...);\n```  \n  \n### Parameters  \n `pDacl`  \n Pointer to the [CDacl Class](../../atl/reference/cdacl-class.md) object which will receive the **CAccessToken** object's default DACL.  \n  \n### Return Value  \n Returns true if the default DACL has been recovered, false otherwise.  \n  \n##  <a name=\"caccesstoken__geteffectivetoken\"></a>  CAccessToken::GetEffectiveToken  \n Call this method to get the `CAccessToken` object equal to the access token in effect for the current thread.  \n  \n```\nbool GetEffectiveToken(DWORD   dwDesiredAccess) throw();\n```  \n  \n### Parameters  \n `dwDesiredAccess`  \n Specifies an access mask that specifies the requested types of access to the access token. These requested access types are compared with the token's DACL to determine which accesses are granted or denied.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__getgroups\"></a>  CAccessToken::GetGroups  \n Call this method to return the `CAccessToken` object's token groups.  \n  \n```\nbool GetGroups(CTokenGroups* pGroups) const throw(...);\n```  \n  \n### Parameters  \n *pGroups*  \n Pointer to the [CTokenGroups Class](../../atl/reference/ctokengroups-class.md) object which will receive the group information.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__gethandle\"></a>  CAccessToken::GetHandle  \n Call this method to retrieve a handle to the access token.  \n  \n```\nHANDLE GetHandle() const throw();\n```  \n  \n### Return Value  \n Returns a handle to the `CAccessToken` object's access token.  \n  \n##  <a name=\"caccesstoken__getimpersonationlevel\"></a>  CAccessToken::GetImpersonationLevel  \n Call this method to get the impersonation level from the access token.  \n  \n```\nbool GetImpersonationLevel(SECURITY_IMPERSONATION_LEVEL* pImpersonationLevel) const throw(...);\n```  \n  \n### Parameters  \n *pImpersonationLevel*  \n Pointer to a [SECURITY_IMPERSONATION_LEVEL](http://msdn.microsoft.com/library/windows/desktop/aa379572) enumeration type which will receive the impersonation level information.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__getlogonsessionid\"></a>  CAccessToken::GetLogonSessionId  \n Call this method to get the Logon Session ID associated with the `CAccessToken` object.  \n  \n```\nbool GetLogonSessionId(LUID* pluid) const throw(...);\n```  \n  \n### Parameters  \n `pluid`  \n Pointer to a [LUID](http://msdn.microsoft.com/library/windows/desktop/aa379261) which will receive the Logon Session ID.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n In debug builds, an assertion error will occur if `pluid` is an invalid value.  \n  \n##  <a name=\"caccesstoken__getlogonsid\"></a>  CAccessToken::GetLogonSid  \n Call this method to get the Logon SID associated with the `CAccessToken` object.  \n  \n```\nbool GetLogonSid(CSid* pSid) const throw(...);\n```  \n  \n### Parameters  \n `pSid`  \n Pointer to a [CSid Class](../../atl/reference/csid-class.md) object.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n In debug builds, an assertion error will occur if *pSid* is an invalid value.  \n  \n##  <a name=\"caccesstoken__getowner\"></a>  CAccessToken::GetOwner  \n Call this method to get the owner associated with the `CAccessToken` object.  \n  \n```\nbool GetOwner(CSid* pSid) const throw(...);\n```  \n  \n### Parameters  \n `pSid`  \n Pointer to a [CSid Class](../../atl/reference/csid-class.md) object.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The owner is set by default on any objects created while this access token is in effect.  \n  \n##  <a name=\"caccesstoken__getprimarygroup\"></a>  CAccessToken::GetPrimaryGroup  \n Call this method to get the primary group associated with the `CAccessToken` object.  \n  \n```\nbool GetPrimaryGroup(CSid* pSid) const throw(...);\n```  \n  \n### Parameters  \n `pSid`  \n Pointer to a [CSid Class](../../atl/reference/csid-class.md) object.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The group is set by default on any objects created while this access token is in effect.  \n  \n##  <a name=\"caccesstoken__getprivileges\"></a>  CAccessToken::GetPrivileges  \n Call this method to get the privileges associated with the `CAccessToken` object.  \n  \n```\nbool GetPrivileges(CTokenPrivileges* pPrivileges) const throw(...);\n```  \n  \n### Parameters  \n `pPrivileges`  \n Pointer to a [CTokenPrivileges Class](../../atl/reference/ctokenprivileges-class.md) object which will receive the privileges.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__getprocesstoken\"></a>  CAccessToken::GetProcessToken  \n Call this method to initialize the `CAccessToken` with the access token from the given process.  \n  \n```\nbool GetProcessToken(\n    DWORD dwDesiredAccess,\n    HANDLE hProcess = NULL) throw();\n```  \n  \n### Parameters  \n `dwDesiredAccess`  \n Specifies an access mask that specifies the requested types of access to the access token. These requested access types are compared with the token's DACL to determine which accesses are granted or denied.  \n  \n *hProcess*  \n Handle to the process whose access token is opened. If the default value of `NULL` is used, the current process is used.  \n  \n### Return Value  \n Returns `true` on success, `false` on failure.  \n  \n### Remarks  \n Calls the [OpenProcessToken](http://msdn.microsoft.com/library/aa379295\\(vs.85\\).aspx) Win32 function.  \n  \n##  <a name=\"caccesstoken__getprofile\"></a>  CAccessToken::GetProfile  \n Call this method to get the handle pointing to the user profile associated with the `CAccessToken` object.  \n  \n```\nHANDLE GetProfile() const throw();\n```  \n  \n### Return Value  \n Returns a handle pointing to the user profile, or NULL if no profile exists.  \n  \n##  <a name=\"caccesstoken__getsource\"></a>  CAccessToken::GetSource  \n Call this method to get the source of the `CAccessToken` object.  \n  \n```\nbool GetSource(TOKEN_SOURCE* pSource) const throw(...);\n```  \n  \n### Parameters  \n *pSource*  \n Pointer to a [TOKEN_SOURCE](http://msdn.microsoft.com/library/windows/desktop/aa379631) structure.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__getstatistics\"></a>  CAccessToken::GetStatistics  \n Call this method to get information associated with the `CAccessToken` object.  \n  \n```\nbool GetStatistics(TOKEN_STATISTICS* pStatistics) const throw(...);\n```  \n  \n### Parameters  \n *pStatistics*  \n Pointer to a [TOKEN_STATISTICS](http://msdn.microsoft.com/library/windows/desktop/aa379632) structure.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__getterminalservicessessionid\"></a>  CAccessToken::GetTerminalServicesSessionId  \n Call this method to get the Terminal Services Session ID associated with the `CAccessToken` object.  \n  \n```\nbool GetTerminalServicesSessionId(DWORD* pdwSessionId) const throw(...);\n```  \n  \n### Parameters  \n *pdwSessionId*  \n The Terminal Services Session ID.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__getthreadtoken\"></a>  CAccessToken::GetThreadToken  \n Call this method to initialize the `CAccessToken` with the token from the given thread.  \n  \n```\nbool GetThreadToken(\n    DWORD dwDesiredAccess,\n    HANDLE hThread = NULL,\n    bool bOpenAsSelf = true) throw();\n```  \n  \n### Parameters  \n `dwDesiredAccess`  \n Specifies an access mask that specifies the requested types of access to the access token. These requested access types are compared with the token's DACL to determine which accesses are granted or denied.  \n  \n `hThread`  \n Handle to the thread whose access token is opened.  \n  \n `bOpenAsSelf`  \n Indicates whether the access check is to be made against the security context of the thread calling the `GetThreadToken` method or against the security context of the process for the calling thread.  \n  \n If this parameter is false, the access check is performed using the security context for the calling thread. If the thread is impersonating a client, this security context can be that of a client process. If this parameter is true, the access check is made using the security context of the process for the calling thread.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__gettokenid\"></a>  CAccessToken::GetTokenId  \n Call this method to get the Token ID associated with the `CAccessToken` object.  \n  \n```\nbool GetTokenId(LUID* pluid) const throw(...);\n```  \n  \n### Parameters  \n `pluid`  \n Pointer to a [LUID](http://msdn.microsoft.com/library/windows/desktop/aa379261) which will receive the Token ID.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__gettype\"></a>  CAccessToken::GetType  \n Call this method to get the token type of the `CAccessToken` object.  \n  \n```\nbool GetType(TOKEN_TYPE* pType) const throw(...);\n```  \n  \n### Parameters  \n `pType`  \n Address of the [TOKEN_TYPE](http://msdn.microsoft.com/library/windows/desktop/aa379633) variable that, on success, receives the type of the token.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The **TOKEN_TYPE** enumeration type contains values that differentiate between a primary token and an impersonation token.  \n  \n##  <a name=\"caccesstoken__getuser\"></a>  CAccessToken::GetUser  \n Call this method to identify the user associated with the `CAccessToken` object.  \n  \n```\nbool GetUser(CSid* pSid) const throw(...);\n```  \n  \n### Parameters  \n `pSid`  \n Pointer to a [CSid Class](../../atl/reference/csid-class.md) object.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n##  <a name=\"caccesstoken__hkeycurrentuser\"></a>  CAccessToken::HKeyCurrentUser  \n Call this method to get the handle pointing to the user profile associated with the `CAccessToken` object.  \n  \n```\nHKEY HKeyCurrentUser() const throw();\n```  \n  \n### Return Value  \n Returns a handle pointing to the user profile, or NULL if no profile exists.  \n  \n##  <a name=\"caccesstoken__impersonate\"></a>  CAccessToken::Impersonate  \n Call this method to assign an impersonation `CAccessToken` to a thread.  \n  \n```\nbool Impersonate(HANDLE   hThread = NULL) const throw(...);\n```  \n  \n### Parameters  \n `hThread`  \n Handle to the thread to assign the impersonation token to. This handle must have been opened with TOKEN_IMPERSONATE access rights. If `hThread` is NULL, the method causes the thread to stop using an impersonation token.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n In debug builds, an assertion error will occur if `CAccessToken` does not have a valid pointer to a token.  \n  \n The [CAutoRevertImpersonation class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens.  \n  \n##  <a name=\"caccesstoken__impersonateloggedonuser\"></a>  CAccessToken::ImpersonateLoggedOnUser  \n Call this method to allow the calling thread to impersonate the security context of a logged-on user.  \n  \n```\nbool ImpersonateLoggedOnUser() const throw(...);\n```  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n  \n> [!IMPORTANT]\n>  If a call to an impersonation function fails for any reason, the client is not impersonated and the client request is made in the security context of the process from which the call was made. If the process is running as a highly privileged account, or as a member of an administrative group, the user might be able to perform actions he or she would otherwise be disallowed. Therefore, the return value for this function should always be confirmed.  \n  \n##  <a name=\"caccesstoken__istokenrestricted\"></a>  CAccessToken::IsTokenRestricted  \n Call this method to test if the `CAccessToken` object contains a list of restricted SIDs.  \n  \n```\nbool IsTokenRestricted() const throw();\n```  \n  \n### Return Value  \n Returns true if the object contains a list of restricting SIDs, false if there are no restricting SIDs or if the method fails.  \n  \n##  <a name=\"caccesstoken__loaduserprofile\"></a>  CAccessToken::LoadUserProfile  \n Call this method to load the user profile associated with the `CAccessToken` object.  \n  \n```\nbool LoadUserProfile() throw(...);\n```  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n In debug builds, an assertion error will occur if the `CAccessToken` does not contain a valid token, or if a user profile already exists.  \n  \n##  <a name=\"caccesstoken__logonuser\"></a>  CAccessToken::LogonUser  \n Call this method to create a logon session for the user associated with the given credentials.  \n  \n```\nbool LogonUser(\n    LPCTSTR pszUserName,\n    LPCTSTR pszDomain,\n    LPCTSTR pszPassword,\n    DWORD dwLogonType = LOGON32_LOGON_INTERACTIVE,\n    DWORD dwLogonProvider = LOGON32_PROVIDER_DEFAULT) throw();\n```  \n  \n### Parameters  \n `pszUserName`  \n Pointer to a null-terminated string that specifies the user name. This is the name of the user account to log on to.  \n  \n *pszDomain*  \n Pointer to a null-terminated string that specifies the name of the domain or server whose account database contains the `pszUserName` account.  \n  \n `pszPassword`  \n Pointer to a null-terminated string that specifies the clear-text password for the user account specified by `pszUserName`.  \n  \n *dwLogonType*  \n Specifies the type of logon operation to perform. See [LogonUser](http://msdn.microsoft.com/library/windows/desktop/aa378184) for more details.  \n  \n *dwLogonProvider*  \n Specifies the logon provider. See [LogonUser](http://msdn.microsoft.com/library/windows/desktop/aa378184) for more details.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The access token resulting from the logon will be associated with the `CAccessToken`. For this method to succeed, the `CAccessToken` object must hold SE_TCB_NAME privileges, identifying the holder as part of the trusted computer base. See [LogonUser](http://msdn.microsoft.com/library/windows/desktop/aa378184) for more information regarding the privileges required.  \n  \n##  <a name=\"caccesstoken__opencomclienttoken\"></a>  CAccessToken::OpenCOMClientToken  \n Call this method from within a COM server handling a call from a client to initialize the `CAccessToken` with the access token from the COM client.  \n  \n```\nbool OpenCOMClientToken(\n    DWORD dwDesiredAccess,\n    bool bImpersonate = false,\n    bool bOpenAsSelf = true) throw(...);\n```  \n  \n### Parameters  \n `dwDesiredAccess`  \n Specifies an access mask that specifies the requested types of access to the access token. These requested access types are compared with the token's DACL to determine which accesses are granted or denied.  \n  \n `bImpersonate`  \n If true, the current thread will impersonate the calling COM client if this call completes successfully. If false, the access token will be opened, but the thread will not have an impersonation token when this call completes.  \n  \n `bOpenAsSelf`  \n Indicates whether the access check is to be made against the security context of the thread calling the [GetThreadToken](http://msdn.microsoft.com/library/windows/desktop/ms683182) method or against the security context of the process for the calling thread.  \n  \n If this parameter is false, the access check is performed using the security context for the calling thread. If the thread is impersonating a client, this security context can be that of a client process. If this parameter is true, the access check is made using the security context of the process for the calling thread.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens created by setting the `bImpersonate` flag to *true*.  \n  \n##  <a name=\"caccesstoken__opennamedpipeclienttoken\"></a>  CAccessToken::OpenNamedPipeClientToken  \n Call this method from within a server taking requests over a named pipe to initialize the `CAccessToken` with the access token from the client.  \n  \n```\nbool OpenNamedPipeClientToken(\n    HANDLE hPipe,\n    DWORD dwDesiredAccess,\n    bool bImpersonate = false,\n    bool bOpenAsSelf = true) throw(...);\n```  \n  \n### Parameters  \n *hPipe*  \n Handle to a named pipe.  \n  \n `dwDesiredAccess`  \n Specifies an access mask that specifies the requested types of access to the access token. These requested access types are compared with the token's DACL to determine which accesses are granted or denied.  \n  \n `bImpersonate`  \n If true, the current thread will impersonate the calling pipe client if this call completes successfully. If false, the access token will be opened, but the thread will not have an impersonation token when this call completes.  \n  \n `bOpenAsSelf`  \n Indicates whether the access check is to be made against the security context of the thread calling the [GetThreadToken](http://msdn.microsoft.com/library/windows/desktop/ms683182) method or against the security context of the process for the calling thread.  \n  \n If this parameter is false, the access check is performed using the security context for the calling thread. If the thread is impersonating a client, this security context can be that of a client process. If this parameter is true, the access check is made using the security context of the process for the calling thread.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens created by setting the `bImpersonate` flag to *true*.  \n  \n##  <a name=\"caccesstoken__openrpcclienttoken\"></a>  CAccessToken::OpenRPCClientToken  \n Call this method from within a server handling a call from an RPC client to initialize the `CAccessToken` with the access token from the client.  \n  \n```\nbool OpenRPCClientToken(\n    RPC_BINDING_HANDLE BindingHandle,\n    DWORD dwDesiredAccess,\n    bool bImpersonate = false,\n    bool bOpenAsSelf = true) throw(...);\n```  \n  \n### Parameters  \n *BindingHandle*  \n Binding handle on the server that represents a binding to a client.  \n  \n `dwDesiredAccess`  \n Specifies an access mask that specifies the requested types of access to the access token. These requested access types are compared with the token's DACL to determine which accesses are granted or denied.  \n  \n `bImpersonate`  \n If true, the current thread will impersonate the calling RPC client if this call completes successfully. If false, the access token will be opened, but the thread will not have an impersonation token when this call completes.  \n  \n `bOpenAsSelf`  \n Indicates whether the access check is to be made against the security context of the thread calling the [GetThreadToken](http://msdn.microsoft.com/library/windows/desktop/ms683182) method or against the security context of the process for the calling thread.  \n  \n If this parameter is false, the access check is performed using the security context for the calling thread. If the thread is impersonating a client, this security context can be that of a client process. If this parameter is true, the access check is made using the security context of the process for the calling thread.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens created by setting the `bImpersonate` flag to *true*.  \n  \n##  <a name=\"caccesstoken__openthreadtoken\"></a>  CAccessToken::OpenThreadToken  \n Call this method to set the impersonation level and then initialize the `CAccessToken` with the token from the given thread.  \n  \n```\nbool OpenThreadToken(\n    DWORD dwDesiredAccess,\n    bool bImpersonate = false,\n    bool bOpenAsSelf = true,\n    SECURITY_IMPERSONATION_LEVEL sil = SecurityImpersonation) throw(...);\n```  \n  \n### Parameters  \n `dwDesiredAccess`  \n Specifies an access mask that specifies the requested types of access to the access token. These requested access types are compared with the token's DACL to determine which accesses are granted or denied.  \n  \n `bImpersonate`  \n If true, the thread will be left at the requested impersonation level after this method completes. If false, the thread will revert to its original impersonation level.  \n  \n `bOpenAsSelf`  \n Indicates whether the access check is to be made against the security context of the thread calling the [GetThreadToken](http://msdn.microsoft.com/library/windows/desktop/ms683182) method or against the security context of the process for the calling thread.  \n  \n If this parameter is false, the access check is performed using the security context for the calling thread. If the thread is impersonating a client, this security context can be that of a client process. If this parameter is true, the access check is made using the security context of the process for the calling thread.  \n  \n `sil`  \n Specifies a [SECURITY_IMPERSONATION_LEVEL](http://msdn.microsoft.com/library/windows/desktop/aa379572) enumerated type that supplies the impersonation level of the token.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n `OpenThreadToken` is similar to [CAccessToken::GetThreadToken](#caccesstoken__getthreadtoken), but sets the impersonation level before initializing the `CAccessToken` from the thread's access token.  \n  \n The [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md) can be used to automatically revert impersonated access tokens created by setting the `bImpersonate` flag to *true*.  \n  \n##  <a name=\"caccesstoken__privilegecheck\"></a>  CAccessToken::PrivilegeCheck  \n Call this method to determine whether a specified set of privileges are enabled in the **CAccessToken** object.  \n  \n```\nbool PrivilegeCheck(\n    PPRIVILEGE_SET RequiredPrivileges,\n    bool* pbResult) const throw();\n```  \n  \n### Parameters  \n *RequiredPrivileges*  \n Pointer to a [PRIVILEGE_SET](http://msdn.microsoft.com/library/windows/desktop/aa379307) structure.  \n  \n *pbResult*  \n Pointer to a value the method sets to indicate whether any or all of the specified privilege are enabled in the `CAccessToken` object.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n When `PrivilegeCheck` returns, the **Attributes** member of each [LUID_AND_ATTRIBUTES](http://msdn.microsoft.com/library/windows/desktop/aa379263) structure is set to SE_PRIVILEGE_USED_FOR_ACCESS if the corresponding privilege is enabled. This method calls the [PrivilegeCheck](http://msdn.microsoft.com/library/windows/desktop/aa379304) Win32 function.  \n  \n##  <a name=\"caccesstoken__revert\"></a>  CAccessToken::Revert  \n Call this method to stop a thread from using an impersonation token.  \n  \n```\nbool Revert(HANDLE   hThread = NULL) const throw();\n```  \n  \n### Parameters  \n `hThread`  \n Handle to the thread to revert from impersonation. If *hThread* is NULL, the current thread is assumed.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The reversion of impersonation tokens can be performed automatically with the [CAutoRevertImpersonation Class](../../atl/reference/cautorevertimpersonation-class.md).  \n  \n##  <a name=\"caccesstoken__setdefaultdacl\"></a>  CAccessToken::SetDefaultDacl  \n Call this method to set the default DACL of the `CAccessToken` object.  \n  \n```\nbool SetDefaultDacl(const CDacl& rDacl) throw(...);\n```  \n  \n### Parameters  \n `rDacl`  \n The new default [CDacl Class](../../atl/reference/cdacl-class.md) information.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The default DACL is the DACL that is used by default when new objects are created with this access token in effect.  \n  \n##  <a name=\"caccesstoken__setowner\"></a>  CAccessToken::SetOwner  \n Call this method to set the owner of the `CAccessToken` object.  \n  \n```\nbool SetOwner(const CSid& rSid) throw(...);\n```  \n  \n### Parameters  \n `rSid`  \n The [CSid Class](../../atl/reference/csid-class.md) object containing the owner information.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The owner is the default owner that is used for new objects created while this access token is in effect.  \n  \n##  <a name=\"caccesstoken__setprimarygroup\"></a>  CAccessToken::SetPrimaryGroup  \n Call this method to set the primary group of the `CAccessToken` object.  \n  \n```\nbool SetPrimaryGroup(const CSid& rSid) throw(...);\n```  \n  \n### Parameters  \n `rSid`  \n The [CSid Class](../../atl/reference/csid-class.md) object containing the primary group information.  \n  \n### Return Value  \n Returns true on success, false on failure.  \n  \n### Remarks  \n The primary group is the default group for new objects created while this access token is in effect.  \n  \n## See Also  \n [ATLSecurity Sample](../../visual-cpp-samples.md)   \n [Access Tokens](http://msdn.microsoft.com/library/windows/desktop/aa374909)   \n [Class Overview](../../atl/atl-class-overview.md)\n"}