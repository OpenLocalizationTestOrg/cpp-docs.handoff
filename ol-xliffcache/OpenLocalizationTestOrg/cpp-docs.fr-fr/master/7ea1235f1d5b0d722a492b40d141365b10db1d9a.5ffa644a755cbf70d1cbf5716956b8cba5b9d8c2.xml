{"nodes":[{"pos":[12,68],"content":"Windows Sockets: Sequence of Operations | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Windows Sockets: Sequence of Operations | Microsoft Docs","pos":[0,56]}]},{"content":"Windows Sockets: Sequence of Operations","pos":[749,788]},{"content":"This article illustrates, side by side, the sequence of operations for a server socket and a client socket.","pos":[789,896]},{"content":"Because the sockets use <ph id=\"ph1\">`CArchive`</ph> objects, they are necessarily <bpt id=\"p1\">[</bpt>stream sockets<ept id=\"p1\">](../mfc/windows-sockets-stream-sockets.md)</ept>.","pos":[897,1021],"source":" Because the sockets use `CArchive` objects, they are necessarily [stream sockets](../mfc/windows-sockets-stream-sockets.md)."},{"content":"Sequence of Operations for a Stream Socket Communication","pos":[1030,1086]},{"content":"Up to the point of constructing a <ph id=\"ph1\">`CSocketFile`</ph> object, the following sequence is accurate (with a few parameter differences) for both <ph id=\"ph2\">`CAsyncSocket`</ph> and <ph id=\"ph3\">`CSocket`</ph>.","pos":[1090,1254],"source":"Up to the point of constructing a `CSocketFile` object, the following sequence is accurate (with a few parameter differences) for both `CAsyncSocket` and `CSocket`."},{"content":"From that point on, the sequence is strictly for <ph id=\"ph1\">`CSocket`</ph>.","pos":[1255,1314],"source":" From that point on, the sequence is strictly for `CSocket`."},{"content":"The following table illustrates the sequence of operations for setting up communication between a client and a server.","pos":[1315,1433]},{"content":"Setting Up Communication Between a Server and a Client","pos":[1443,1497]},{"content":"Server","pos":[1504,1510]},{"content":"Client","pos":[1511,1517]},{"content":"1,2","pos":[1730,1733]},{"content":"2","pos":[1792,1793]},{"content":"3,4","pos":[1931,1934]},{"content":"5","pos":[2084,2085]},{"content":"-or-","pos":[2330,2334]},{"content":"– or Both –","pos":[2403,2414]},{"content":"-or-","pos":[2508,2512]},{"content":"– or Both –","pos":[2581,2592]},{"content":"-or-","pos":[2675,2679]},{"content":"6","pos":[2711,2712]},{"content":"-or-","pos":[2791,2795]},{"content":"6","pos":[2827,2828]},{"content":"Where <ph id=\"ph1\">`nPort`</ph> is a port number.","pos":[2839,2870],"source":"Where `nPort` is a port number."},{"content":"See <bpt id=\"p1\">[</bpt>Windows Sockets: Ports and Socket Addresses<ept id=\"p1\">](../mfc/windows-sockets-ports-and-socket-addresses.md)</ept> for details about ports.","pos":[2871,2999],"source":" See [Windows Sockets: Ports and Socket Addresses](../mfc/windows-sockets-ports-and-socket-addresses.md) for details about ports."},{"content":"The server must always specify a port so clients can connect.","pos":[3009,3070]},{"content":"The <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept> call sometimes also specifies an address.","pos":[3071,3127],"source":" The **Create** call sometimes also specifies an address."},{"content":"On the client side, use the default parameters, which ask MFC to use any available port.","pos":[3128,3216]},{"pos":[3226,3329],"content":"Where <ph id=\"ph1\">`nPort`</ph> is a port number and <bpt id=\"p1\">*</bpt>strAddr<ept id=\"p1\">*</ept> is a machine address or an Internet Protocol (IP) address.","source":"Where `nPort` is a port number and *strAddr* is a machine address or an Internet Protocol (IP) address."},{"content":"Machine addresses can take several forms: \"ftp.microsoft.com\", \"microsoft.com\".","pos":[3339,3418]},{"content":"IP addresses use the \"dotted number\" form \"127.54.67.32\".","pos":[3419,3476]},{"content":"The <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept> function checks to see if the address is a dotted number (although it does not check to ensure the number is a valid machine on the network).","pos":[3477,3634],"source":" The **Connect** function checks to see if the address is a dotted number (although it does not check to ensure the number is a valid machine on the network)."},{"content":"If not, <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept> assumes a machine name of one of the other forms.","pos":[3635,3704],"source":" If not, **Connect** assumes a machine name of one of the other forms."},{"content":"When you call <bpt id=\"p1\">**</bpt>Accept<ept id=\"p1\">**</ept> on the server side, you pass a reference to a new socket object.","pos":[3714,3803],"source":"When you call **Accept** on the server side, you pass a reference to a new socket object."},{"content":"You must construct this object first, but do not call <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept> for it.","pos":[3804,3876],"source":" You must construct this object first, but do not call **Create** for it."},{"content":"Keep in mind that if this socket object goes out of scope, the connection closes.","pos":[3877,3958]},{"content":"MFC connects the new object to a <bpt id=\"p1\">**</bpt>SOCKET<ept id=\"p1\">**</ept> handle.","pos":[3959,4010],"source":" MFC connects the new object to a **SOCKET** handle."},{"content":"You can construct the socket on the stack, as shown, or on the heap.","pos":[4011,4079]},{"content":"The archive and the socket file are closed when they go out of scope.","pos":[4089,4158]},{"content":"The socket object's destructor also calls the <bpt id=\"p1\">[</bpt>Close<ept id=\"p1\">](../mfc/reference/casyncsocket-class.md#casyncsocket__close)</ept> member function for the socket object when the object goes out of scope or is deleted.","pos":[4159,4359],"source":" The socket object's destructor also calls the [Close](../mfc/reference/casyncsocket-class.md#casyncsocket__close) member function for the socket object when the object goes out of scope or is deleted."},{"content":"Additional Notes About the Sequence","pos":[4368,4403]},{"content":"The sequence of calls shown in the preceding table is for a stream socket.","pos":[4407,4481]},{"content":"Datagram sockets, which are connectionless, do not require the <bpt id=\"p1\">[</bpt>CAsyncSocket::Connect<ept id=\"p1\">](../mfc/reference/casyncsocket-class.md#casyncsocket__connect)</ept>, <bpt id=\"p2\">[</bpt>Listen<ept id=\"p2\">](../mfc/reference/casyncsocket-class.md#casyncsocket__listen)</ept>, and <bpt id=\"p3\">[</bpt>Accept<ept id=\"p3\">](../mfc/reference/casyncsocket-class.md#casyncsocket__accept)</ept> calls (although you can optionally use <bpt id=\"p4\">**</bpt>Connect<ept id=\"p4\">**</ept>).","pos":[4482,4829],"source":" Datagram sockets, which are connectionless, do not require the [CAsyncSocket::Connect](../mfc/reference/casyncsocket-class.md#casyncsocket__connect), [Listen](../mfc/reference/casyncsocket-class.md#casyncsocket__listen), and [Accept](../mfc/reference/casyncsocket-class.md#casyncsocket__accept) calls (although you can optionally use **Connect**)."},{"content":"Instead, if you are using class <ph id=\"ph1\">`CAsyncSocket`</ph>, datagram sockets use the <ph id=\"ph2\">`CAsyncSocket::SendTo`</ph> and <ph id=\"ph3\">`ReceiveFrom`</ph> member functions.","pos":[4830,4961],"source":" Instead, if you are using class `CAsyncSocket`, datagram sockets use the `CAsyncSocket::SendTo` and `ReceiveFrom` member functions."},{"content":"(If you use <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept> with a datagram socket, you use <bpt id=\"p2\">**</bpt>Send<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Receive<ept id=\"p3\">**</ept>.) Because <ph id=\"ph1\">`CArchive`</ph> does not work with datagrams, do not use <ph id=\"ph2\">`CSocket`</ph> with an archive if the socket is a datagram.","pos":[4962,5159],"source":" (If you use **Connect** with a datagram socket, you use **Send** and **Receive**.) Because `CArchive` does not work with datagrams, do not use `CSocket` with an archive if the socket is a datagram."},{"content":"<bpt id=\"p1\">[</bpt>CSocketFile<ept id=\"p1\">](../mfc/reference/csocketfile-class.md)</ept> does not support all of <ph id=\"ph1\">`CFile`</ph>'s functionality; <ph id=\"ph2\">`CFile`</ph> members such as <ph id=\"ph3\">`Seek`</ph>, which make no sense for a socket communication, are unavailable.","pos":[5166,5364],"source":"[CSocketFile](../mfc/reference/csocketfile-class.md) does not support all of `CFile`'s functionality; `CFile` members such as `Seek`, which make no sense for a socket communication, are unavailable."},{"content":"Because of this, some default MFC <ph id=\"ph1\">`Serialize`</ph> functions are not compatible with <ph id=\"ph2\">`CSocketFile`</ph>.","pos":[5365,5459],"source":" Because of this, some default MFC `Serialize` functions are not compatible with `CSocketFile`."},{"content":"This is particularly true of the <ph id=\"ph1\">`CEditView`</ph> class.","pos":[5460,5511],"source":" This is particularly true of the `CEditView` class."},{"content":"You should not try to serialize <ph id=\"ph1\">`CEditView`</ph> data through a <ph id=\"ph2\">`CArchive`</ph> object attached to a <ph id=\"ph3\">`CSocketFile`</ph> object using <ph id=\"ph4\">`CEditView::SerializeRaw`</ph>; use <bpt id=\"p1\">**</bpt>CEditView::Serialize<ept id=\"p1\">**</ept> instead (not documented).","pos":[5512,5711],"source":" You should not try to serialize `CEditView` data through a `CArchive` object attached to a `CSocketFile` object using `CEditView::SerializeRaw`; use **CEditView::Serialize** instead (not documented)."},{"content":"The <bpt id=\"p1\">[</bpt>SerializeRaw<ept id=\"p1\">](../mfc/reference/ceditview-class.md#ceditview__serializeraw)</ept> function expects the file object to have functions, such as <ph id=\"ph1\">`Seek`</ph>, that <ph id=\"ph2\">`CSocketFile`</ph> does not support.","pos":[5712,5896],"source":" The [SerializeRaw](../mfc/reference/ceditview-class.md#ceditview__serializeraw) function expects the file object to have functions, such as `Seek`, that `CSocketFile` does not support."},{"content":"For more information, see:","pos":[5903,5929]},{"content":"Windows Sockets: Using Sockets with Archives","pos":[5940,5984]},{"content":"Windows Sockets: Using Class CAsyncSocket","pos":[6051,6092]},{"content":"Windows Sockets: Ports and Socket Addresses","pos":[6156,6199]},{"content":"Windows Sockets: Stream Sockets","pos":[6265,6296]},{"content":"Windows Sockets: Datagram Sockets","pos":[6350,6383]},{"content":"See Also","pos":[6437,6445]},{"content":"Windows Sockets in MFC","pos":[6450,6472]},{"content":"CSocket Class","pos":[6513,6526]},{"content":"CAsyncSocket::Create","pos":[6568,6588]},{"content":"CAsyncSocket::Close","pos":[6656,6675]}],"content":"---\ntitle: \"Windows Sockets: Sequence of Operations | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"Windows Sockets [C++], operations\"\n  - \"Windows Sockets [C++], stream sockets\"\n  - \"sockets [C++], stream sockets\"\n  - \"sockets [C++], operations\"\n  - \"stream sockets [C++]\"\nms.assetid: 43ce76f5-aad3-4247-b8a6-16cc7d012796\ncaps.latest.revision: 9\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Windows Sockets: Sequence of Operations\nThis article illustrates, side by side, the sequence of operations for a server socket and a client socket. Because the sockets use `CArchive` objects, they are necessarily [stream sockets](../mfc/windows-sockets-stream-sockets.md).  \n  \n## Sequence of Operations for a Stream Socket Communication  \n Up to the point of constructing a `CSocketFile` object, the following sequence is accurate (with a few parameter differences) for both `CAsyncSocket` and `CSocket`. From that point on, the sequence is strictly for `CSocket`. The following table illustrates the sequence of operations for setting up communication between a client and a server.  \n  \n### Setting Up Communication Between a Server and a Client  \n  \n|Server|Client|  \n|------------|------------|  \n|`// construct a socket`<br /><br /> `CSocket sockSrvr;`|`// construct a socket`<br /><br /> `CSocket sockClient;`|  \n|`// create the SOCKET`<br /><br /> `sockSrvr.Create(nPort);`1,2|`// create the SOCKET`<br /><br /> `sockClient.Create( );`2|  \n|`// start listening`<br /><br /> `sockSrvr.Listen( );`||  \n||`// seek a connection`<br /><br /> `sockClient.Connect(strAddr, nPort);`3,4|  \n|`// construct a new, empty socket`<br /><br /> `CSocket sockRecv;`<br /><br /> `// accept connection`<br /><br /> `sockSrvr.Accept( sockRecv );` 5||  \n|`// construct file object`<br /><br /> `CSocketFile file(&sockRecv);`|`// construct file object`<br /><br /> `CSocketFile file(&sockClient);`|  \n|`// construct an archive`<br /><br /> `CArchive arIn(&file,`  `CArchive::load);`<br /><br /> -or-<br /><br /> `CArchive arOut(&file,` `CArchive::store);`<br /><br /> – or Both –|`// construct an archive`<br /><br /> `CArchive arIn(&file,`  `CArchive::load);`<br /><br /> -or-<br /><br /> `CArchive arOut(&file,` `CArchive::store);`<br /><br /> – or Both –|  \n|`// use the archive to pass data:`<br /><br /> `arIn >> dwValue;`<br /><br /> -or-<br /><br /> `arOut << dwValue;`6|`// use the archive to pass data:`<br /><br /> `arIn >> dwValue;`<br /><br /> -or-<br /><br /> `arOut << dwValue;`6|  \n  \n 1. Where `nPort` is a port number. See [Windows Sockets: Ports and Socket Addresses](../mfc/windows-sockets-ports-and-socket-addresses.md) for details about ports.  \n  \n 2. The server must always specify a port so clients can connect. The **Create** call sometimes also specifies an address. On the client side, use the default parameters, which ask MFC to use any available port.  \n  \n 3. Where `nPort` is a port number and *strAddr* is a machine address or an Internet Protocol (IP) address.  \n  \n 4. Machine addresses can take several forms: \"ftp.microsoft.com\", \"microsoft.com\". IP addresses use the \"dotted number\" form \"127.54.67.32\". The **Connect** function checks to see if the address is a dotted number (although it does not check to ensure the number is a valid machine on the network). If not, **Connect** assumes a machine name of one of the other forms.  \n  \n 5. When you call **Accept** on the server side, you pass a reference to a new socket object. You must construct this object first, but do not call **Create** for it. Keep in mind that if this socket object goes out of scope, the connection closes. MFC connects the new object to a **SOCKET** handle. You can construct the socket on the stack, as shown, or on the heap.  \n  \n 6. The archive and the socket file are closed when they go out of scope. The socket object's destructor also calls the [Close](../mfc/reference/casyncsocket-class.md#casyncsocket__close) member function for the socket object when the object goes out of scope or is deleted.  \n  \n## Additional Notes About the Sequence  \n The sequence of calls shown in the preceding table is for a stream socket. Datagram sockets, which are connectionless, do not require the [CAsyncSocket::Connect](../mfc/reference/casyncsocket-class.md#casyncsocket__connect), [Listen](../mfc/reference/casyncsocket-class.md#casyncsocket__listen), and [Accept](../mfc/reference/casyncsocket-class.md#casyncsocket__accept) calls (although you can optionally use **Connect**). Instead, if you are using class `CAsyncSocket`, datagram sockets use the `CAsyncSocket::SendTo` and `ReceiveFrom` member functions. (If you use **Connect** with a datagram socket, you use **Send** and **Receive**.) Because `CArchive` does not work with datagrams, do not use `CSocket` with an archive if the socket is a datagram.  \n  \n [CSocketFile](../mfc/reference/csocketfile-class.md) does not support all of `CFile`'s functionality; `CFile` members such as `Seek`, which make no sense for a socket communication, are unavailable. Because of this, some default MFC `Serialize` functions are not compatible with `CSocketFile`. This is particularly true of the `CEditView` class. You should not try to serialize `CEditView` data through a `CArchive` object attached to a `CSocketFile` object using `CEditView::SerializeRaw`; use **CEditView::Serialize** instead (not documented). The [SerializeRaw](../mfc/reference/ceditview-class.md#ceditview__serializeraw) function expects the file object to have functions, such as `Seek`, that `CSocketFile` does not support.  \n  \n For more information, see:  \n  \n-   [Windows Sockets: Using Sockets with Archives](../mfc/windows-sockets-using-sockets-with-archives.md)  \n  \n-   [Windows Sockets: Using Class CAsyncSocket](../mfc/windows-sockets-using-class-casyncsocket.md)  \n  \n-   [Windows Sockets: Ports and Socket Addresses](../mfc/windows-sockets-ports-and-socket-addresses.md)  \n  \n-   [Windows Sockets: Stream Sockets](../mfc/windows-sockets-stream-sockets.md)  \n  \n-   [Windows Sockets: Datagram Sockets](../mfc/windows-sockets-datagram-sockets.md)  \n  \n## See Also  \n [Windows Sockets in MFC](../mfc/windows-sockets-in-mfc.md)   \n [CSocket Class](../mfc/reference/csocket-class.md)   \n [CAsyncSocket::Create](../mfc/reference/casyncsocket-class.md#casyncsocket__create)   \n [CAsyncSocket::Close](../mfc/reference/casyncsocket-class.md#casyncsocket__close)\n\n"}