{"nodes":[{"pos":[12,59],"content":"CAutoRevertImpersonation Class | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"CAutoRevertImpersonation Class | Microsoft Docs","pos":[0,47]}]},{"pos":[682,712],"content":"CAutoRevertImpersonation Class","linkify":"CAutoRevertImpersonation Class","nodes":[{"content":"CAutoRevertImpersonation Class","pos":[0,30]}]},{"pos":[713,852],"content":"This class reverts <bpt id=\"p1\">[</bpt>CAccessToken<ept id=\"p1\">](../../atl/reference/caccesstoken-class.md)</ept> objects to a nonimpersonating state when it goes out of scope.","source":"This class reverts [CAccessToken](../../atl/reference/caccesstoken-class.md) objects to a nonimpersonating state when it goes out of scope."},{"pos":[861,867],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[920,927],"content":"Members","linkify":"Members","nodes":[{"content":"Members","pos":[0,7]}]},{"pos":[937,956],"content":"Public Constructors","linkify":"Public Constructors","nodes":[{"content":"Public Constructors","pos":[0,19]}]},{"content":"Name","pos":[963,967]},{"content":"Description","pos":[968,979]},{"pos":[1017,1122],"content":"<bpt id=\"p1\">[</bpt>CAutoRevertImpersonation::CAutoRevertImpersonation<ept id=\"p1\">](#cautorevertimpersonation__cautorevertimpersonation)</ept>","source":"[CAutoRevertImpersonation::CAutoRevertImpersonation](#cautorevertimpersonation__cautorevertimpersonation)"},{"pos":[1123,1170],"content":"Constructs an <ph id=\"ph1\">`CAutoRevertImpersonation`</ph> object","source":"Constructs an `CAutoRevertImpersonation` object"},{"pos":[1175,1286],"content":"<bpt id=\"p1\">[</bpt>CAutoRevertImpersonation::~CAutoRevertImpersonation<ept id=\"p1\">](#cautorevertimpersonation___dtorcautorevertimpersonation)</ept>","source":"[CAutoRevertImpersonation::~CAutoRevertImpersonation](#cautorevertimpersonation___dtorcautorevertimpersonation)"},{"content":"Destroys the object and reverts access token impersonation.","pos":[1287,1346]},{"pos":[1357,1371],"content":"Public Methods","linkify":"Public Methods","nodes":[{"content":"Public Methods","pos":[0,14]}]},{"content":"Name","pos":[1378,1382]},{"content":"Description","pos":[1383,1394]},{"pos":[1432,1501],"content":"<bpt id=\"p1\">[</bpt>CAutoRevertImpersonation::Attach<ept id=\"p1\">](#cautorevertimpersonation__attach)</ept>","source":"[CAutoRevertImpersonation::Attach](#cautorevertimpersonation__attach)"},{"content":"Automates the impersonation reversion of an access token.","pos":[1502,1559]},{"pos":[1564,1633],"content":"<bpt id=\"p1\">[</bpt>CAutoRevertImpersonation::Detach<ept id=\"p1\">](#cautorevertimpersonation__detach)</ept>","source":"[CAutoRevertImpersonation::Detach](#cautorevertimpersonation__detach)"},{"content":"Cancels the automatic impersonation reversion.","pos":[1634,1680]},{"pos":[1685,1770],"content":"<bpt id=\"p1\">[</bpt>CAutoRevertImpersonation::GetAccessToken<ept id=\"p1\">](#cautorevertimpersonation__getaccesstoken)</ept>","source":"[CAutoRevertImpersonation::GetAccessToken](#cautorevertimpersonation__getaccesstoken)"},{"content":"Retrieves the access token current associated with this object.","pos":[1771,1834]},{"pos":[1844,1851],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"An <bpt id=\"p1\">[</bpt>access token<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa374909)</ept> is an object that describes the security context of a process or thread and is allocated to each user logged onto a Windows NT or Windows 2000 system.","pos":[1855,2083],"source":"An [access token](http://msdn.microsoft.com/library/windows/desktop/aa374909) is an object that describes the security context of a process or thread and is allocated to each user logged onto a Windows NT or Windows 2000 system."},{"content":"These access tokens can be represented with the <ph id=\"ph1\">`CAccessToken`</ph> class.","pos":[2084,2153],"source":" These access tokens can be represented with the `CAccessToken` class."},{"content":"It is sometimes necessary to impersonate access tokens.","pos":[2160,2215]},{"content":"This class is provided as a convenience, but it does not perform the impersonation of access tokens; it only performs the automatic reversion to a nonimpersonated state.","pos":[2216,2385]},{"content":"This is because token access impersonation can be performed several different ways.","pos":[2386,2469]},{"pos":[2476,2676],"content":"For an introduction to the access control model in Windows, see <bpt id=\"p1\">[</bpt>Access Control<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa374860)</ept> in the <ph id=\"ph1\">[!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]</ph>.","source":"For an introduction to the access control model in Windows, see [Access Control](http://msdn.microsoft.com/library/windows/desktop/aa374860) in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)]."},{"pos":[2685,2697],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[2701,2726],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> atlsecurity.h","source":"**Header:** atlsecurity.h"},{"pos":[2736,2817],"content":"<bpt id=\"p1\">&lt;a name=\"cautorevertimpersonation__attach\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  CAutoRevertImpersonation::Attach","linkify":"<a name=\"cautorevertimpersonation__attach\"></a>  CAutoRevertImpersonation::Attach","source":"<a name=\"cautorevertimpersonation__attach\"></a>  CAutoRevertImpersonation::Attach"},{"content":"Automates the impersonation reversion of an access token.","pos":[2821,2878]},{"pos":[2947,2957],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"The address of the <bpt id=\"p1\">[</bpt>CAccessToken<ept id=\"p1\">](../../atl/reference/caccesstoken-class.md)</ept> object to be reverted automatically","pos":[2970,3082],"source":" The address of the [CAccessToken](../../atl/reference/caccesstoken-class.md) object to be reverted automatically"},{"pos":[3092,3099],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"This method should only be used if the <bpt id=\"p1\">[</bpt>CAutoRevertImpersonation<ept id=\"p1\">](../../atl/reference/cautorevertimpersonation-class.md)</ept> object was created with a NULL <ph id=\"ph1\">`CAccessToken`</ph> pointer, or if <bpt id=\"p2\">[</bpt>Detach<ept id=\"p2\">](#cautorevertimpersonation__detach)</ept> was called previously.","pos":[3103,3351],"source":"This method should only be used if the [CAutoRevertImpersonation](../../atl/reference/cautorevertimpersonation-class.md) object was created with a NULL `CAccessToken` pointer, or if [Detach](#cautorevertimpersonation__detach) was called previously."},{"content":"For simple cases, it is not necessary to use this method.","pos":[3352,3409]},{"pos":[3419,3536],"content":"<bpt id=\"p1\">&lt;a name=\"cautorevertimpersonation__cautorevertimpersonation\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  CAutoRevertImpersonation::CAutoRevertImpersonation","linkify":"<a name=\"cautorevertimpersonation__cautorevertimpersonation\"></a>  CAutoRevertImpersonation::CAutoRevertImpersonation","source":"<a name=\"cautorevertimpersonation__cautorevertimpersonation\"></a>  CAutoRevertImpersonation::CAutoRevertImpersonation"},{"pos":[3540,3587],"content":"Constructs a <ph id=\"ph1\">`CAutoRevertImpersonation`</ph> object.","source":"Constructs a `CAutoRevertImpersonation` object."},{"pos":[3669,3679],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"The address of the <bpt id=\"p1\">[</bpt>CAccessToken<ept id=\"p1\">](../../atl/reference/caccesstoken-class.md)</ept> object to be reverted automatically.","pos":[3692,3805],"source":" The address of the [CAccessToken](../../atl/reference/caccesstoken-class.md) object to be reverted automatically."},{"pos":[3815,3822],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"The actual impersonation of the access token should be performed separately from and preferably before the creation of a <ph id=\"ph1\">`CAutoRevertImpersonation`</ph> object.","pos":[3826,3981],"source":"The actual impersonation of the access token should be performed separately from and preferably before the creation of a `CAutoRevertImpersonation` object."},{"content":"This impersonation will be reverted automatically when the <ph id=\"ph1\">`CAutoRevertImpersonation`</ph> object goes out of scope.","pos":[3982,4093],"source":" This impersonation will be reverted automatically when the `CAutoRevertImpersonation` object goes out of scope."},{"pos":[4103,4226],"content":"<bpt id=\"p1\">&lt;a name=\"cautorevertimpersonation___dtorcautorevertimpersonation\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  CAutoRevertImpersonation::~CAutoRevertImpersonation","linkify":"<a name=\"cautorevertimpersonation___dtorcautorevertimpersonation\"></a>  CAutoRevertImpersonation::~CAutoRevertImpersonation","source":"<a name=\"cautorevertimpersonation___dtorcautorevertimpersonation\"></a>  CAutoRevertImpersonation::~CAutoRevertImpersonation"},{"content":"Destroys the object and reverts access token impersonation.","pos":[4230,4289]},{"pos":[4349,4356],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"Reverts any impersonation currently in effect for the <bpt id=\"p1\">[</bpt>CAccessToken<ept id=\"p1\">](../../atl/reference/caccesstoken-class.md)</ept> object provided either at construction or through the <bpt id=\"p2\">[</bpt>Attach<ept id=\"p2\">](#cautorevertimpersonation__attach)</ept> method.","pos":[4360,4577],"source":"Reverts any impersonation currently in effect for the [CAccessToken](../../atl/reference/caccesstoken-class.md) object provided either at construction or through the [Attach](#cautorevertimpersonation__attach) method."},{"content":"If no <ph id=\"ph1\">`CAccessToken`</ph> is associated, the destructor has no effect.","pos":[4578,4643],"source":" If no `CAccessToken` is associated, the destructor has no effect."},{"pos":[4653,4734],"content":"<bpt id=\"p1\">&lt;a name=\"cautorevertimpersonation__detach\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  CAutoRevertImpersonation::Detach","linkify":"<a name=\"cautorevertimpersonation__detach\"></a>  CAutoRevertImpersonation::Detach","source":"<a name=\"cautorevertimpersonation__detach\"></a>  CAutoRevertImpersonation::Detach"},{"content":"Cancels the automatic impersonation reversion.","pos":[4738,4784]},{"pos":[4845,4857],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"pos":[4861,4995],"content":"The address of the previously associated <bpt id=\"p1\">[</bpt>CAccessToken<ept id=\"p1\">](../../atl/reference/caccesstoken-class.md)</ept>, or NULL if no association existed.","source":"The address of the previously associated [CAccessToken](../../atl/reference/caccesstoken-class.md), or NULL if no association existed."},{"pos":[5005,5012],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"Calling <bpt id=\"p1\">**</bpt>Detach<ept id=\"p1\">**</ept> prevents the <ph id=\"ph1\">`CAutoRevertImpersonation`</ph> object from reverting any impersonation currently in effect for the <bpt id=\"p2\">[</bpt>CAccessToken<ept id=\"p2\">](../../atl/reference/caccesstoken-class.md)</ept> object associated with this object.","pos":[5016,5236],"source":"Calling **Detach** prevents the `CAutoRevertImpersonation` object from reverting any impersonation currently in effect for the [CAccessToken](../../atl/reference/caccesstoken-class.md) object associated with this object."},{"content":"<ph id=\"ph1\">`CAutoRevertImpersonation`</ph> can then be destroyed with no effect or reassociated to the same or another <ph id=\"ph2\">`CAccessToken`</ph> object using <bpt id=\"p1\">[</bpt>Attach<ept id=\"p1\">](#cautorevertimpersonation__attach)</ept>.","pos":[5237,5412],"source":"`CAutoRevertImpersonation` can then be destroyed with no effect or reassociated to the same or another `CAccessToken` object using [Attach](#cautorevertimpersonation__attach)."},{"pos":[5422,5519],"content":"<bpt id=\"p1\">&lt;a name=\"cautorevertimpersonation__getaccesstoken\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept>  CAutoRevertImpersonation::GetAccessToken","linkify":"<a name=\"cautorevertimpersonation__getaccesstoken\"></a>  CAutoRevertImpersonation::GetAccessToken","source":"<a name=\"cautorevertimpersonation__getaccesstoken\"></a>  CAutoRevertImpersonation::GetAccessToken"},{"content":"Retrieves the access token current associated with this object.","pos":[5523,5586]},{"pos":[5655,5667],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"pos":[5671,5805],"content":"The address of the previously associated <bpt id=\"p1\">[</bpt>CAccessToken<ept id=\"p1\">](../../atl/reference/caccesstoken-class.md)</ept>, or NULL if no association existed.","source":"The address of the previously associated [CAccessToken](../../atl/reference/caccesstoken-class.md), or NULL if no association existed."},{"pos":[5815,5822],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[5826,6023],"content":"If this method is called for the purposes that include the reversion of an impersonation of the <ph id=\"ph1\">`CAccessToken`</ph> object, the <bpt id=\"p1\">[</bpt>Detach<ept id=\"p1\">](#cautorevertimpersonation__detach)</ept> method should be used instead.","source":"If this method is called for the purposes that include the reversion of an impersonation of the `CAccessToken` object, the [Detach](#cautorevertimpersonation__detach) method should be used instead."},{"pos":[6032,6040],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>ATLSecurity Sample<ept id=\"p1\">](../../visual-cpp-samples.md)</ept><ph id=\"ph1\"> </ph>","pos":[6044,6094],"source":"[ATLSecurity Sample](../../visual-cpp-samples.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Access Tokens<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa374909)</ept><ph id=\"ph1\"> </ph>","pos":[6097,6174],"source":" [Access Tokens](http://msdn.microsoft.com/library/windows/desktop/aa374909) "},{"content":"<bpt id=\"p1\"> [</bpt>Class Overview<ept id=\"p1\">](../../atl/atl-class-overview.md)</ept>","pos":[6177,6227],"source":" [Class Overview](../../atl/atl-class-overview.md)"}],"content":"---\ntitle: \"CAutoRevertImpersonation Class | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\nf1_keywords: \n  - \"ATL::CAutoRevertImpersonation\"\n  - \"CAutoRevertImpersonation\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CAutoRevertImpersonation class\"\nms.assetid: 43732849-1940-4bd4-9d52-7a5698bb8838\ncaps.latest.revision: 22\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# CAutoRevertImpersonation Class\nThis class reverts [CAccessToken](../../atl/reference/caccesstoken-class.md) objects to a nonimpersonating state when it goes out of scope.  \n  \n## Syntax  \n  \n```\nclass CAutoRevertImpersonation\n```  \n  \n## Members  \n  \n### Public Constructors  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CAutoRevertImpersonation::CAutoRevertImpersonation](#cautorevertimpersonation__cautorevertimpersonation)|Constructs an `CAutoRevertImpersonation` object|  \n|[CAutoRevertImpersonation::~CAutoRevertImpersonation](#cautorevertimpersonation___dtorcautorevertimpersonation)|Destroys the object and reverts access token impersonation.|  \n  \n### Public Methods  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CAutoRevertImpersonation::Attach](#cautorevertimpersonation__attach)|Automates the impersonation reversion of an access token.|  \n|[CAutoRevertImpersonation::Detach](#cautorevertimpersonation__detach)|Cancels the automatic impersonation reversion.|  \n|[CAutoRevertImpersonation::GetAccessToken](#cautorevertimpersonation__getaccesstoken)|Retrieves the access token current associated with this object.|  \n  \n## Remarks  \n An [access token](http://msdn.microsoft.com/library/windows/desktop/aa374909) is an object that describes the security context of a process or thread and is allocated to each user logged onto a Windows NT or Windows 2000 system. These access tokens can be represented with the `CAccessToken` class.  \n  \n It is sometimes necessary to impersonate access tokens. This class is provided as a convenience, but it does not perform the impersonation of access tokens; it only performs the automatic reversion to a nonimpersonated state. This is because token access impersonation can be performed several different ways.  \n  \n For an introduction to the access control model in Windows, see [Access Control](http://msdn.microsoft.com/library/windows/desktop/aa374860) in the [!INCLUDE[winSDK](../../atl/includes/winsdk_md.md)].  \n  \n## Requirements  \n **Header:** atlsecurity.h  \n  \n##  <a name=\"cautorevertimpersonation__attach\"></a>  CAutoRevertImpersonation::Attach  \n Automates the impersonation reversion of an access token.  \n  \n```\nvoid Attach(const CAccessToken* pAT) throw();\n```  \n  \n### Parameters  \n `pAT`  \n The address of the [CAccessToken](../../atl/reference/caccesstoken-class.md) object to be reverted automatically  \n  \n### Remarks  \n This method should only be used if the [CAutoRevertImpersonation](../../atl/reference/cautorevertimpersonation-class.md) object was created with a NULL `CAccessToken` pointer, or if [Detach](#cautorevertimpersonation__detach) was called previously. For simple cases, it is not necessary to use this method.  \n  \n##  <a name=\"cautorevertimpersonation__cautorevertimpersonation\"></a>  CAutoRevertImpersonation::CAutoRevertImpersonation  \n Constructs a `CAutoRevertImpersonation` object.  \n  \n```\nCAutoRevertImpersonation(const CAccessToken* pAT) throw();\n```  \n  \n### Parameters  \n `pAT`  \n The address of the [CAccessToken](../../atl/reference/caccesstoken-class.md) object to be reverted automatically.  \n  \n### Remarks  \n The actual impersonation of the access token should be performed separately from and preferably before the creation of a `CAutoRevertImpersonation` object. This impersonation will be reverted automatically when the `CAutoRevertImpersonation` object goes out of scope.  \n  \n##  <a name=\"cautorevertimpersonation___dtorcautorevertimpersonation\"></a>  CAutoRevertImpersonation::~CAutoRevertImpersonation  \n Destroys the object and reverts access token impersonation.  \n  \n```\n~CAutoRevertImpersonation() throw();\n```  \n  \n### Remarks  \n Reverts any impersonation currently in effect for the [CAccessToken](../../atl/reference/caccesstoken-class.md) object provided either at construction or through the [Attach](#cautorevertimpersonation__attach) method. If no `CAccessToken` is associated, the destructor has no effect.  \n  \n##  <a name=\"cautorevertimpersonation__detach\"></a>  CAutoRevertImpersonation::Detach  \n Cancels the automatic impersonation reversion.  \n  \n```\nconst CAccessToken* Detach() throw();\n```  \n  \n### Return Value  \n The address of the previously associated [CAccessToken](../../atl/reference/caccesstoken-class.md), or NULL if no association existed.  \n  \n### Remarks  \n Calling **Detach** prevents the `CAutoRevertImpersonation` object from reverting any impersonation currently in effect for the [CAccessToken](../../atl/reference/caccesstoken-class.md) object associated with this object. `CAutoRevertImpersonation` can then be destroyed with no effect or reassociated to the same or another `CAccessToken` object using [Attach](#cautorevertimpersonation__attach).  \n  \n##  <a name=\"cautorevertimpersonation__getaccesstoken\"></a>  CAutoRevertImpersonation::GetAccessToken  \n Retrieves the access token current associated with this object.  \n  \n```\nconst CAccessToken* GetAccessToken() throw();\n```  \n  \n### Return Value  \n The address of the previously associated [CAccessToken](../../atl/reference/caccesstoken-class.md), or NULL if no association existed.  \n  \n### Remarks  \n If this method is called for the purposes that include the reversion of an impersonation of the `CAccessToken` object, the [Detach](#cautorevertimpersonation__detach) method should be used instead.  \n  \n## See Also  \n [ATLSecurity Sample](../../visual-cpp-samples.md)   \n [Access Tokens](http://msdn.microsoft.com/library/windows/desktop/aa374909)   \n [Class Overview](../../atl/atl-class-overview.md)\n"}