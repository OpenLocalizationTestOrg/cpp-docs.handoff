{"nodes":[{"pos":[12,94],"content":"-CLRSUPPORTLASTERROR (Preserve Last Error Code for PInvoke Calls) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"-CLRSUPPORTLASTERROR (Preserve Last Error Code for PInvoke Calls) | Microsoft Docs","pos":[0,82]}]},{"content":"/CLRSUPPORTLASTERROR (Preserve Last Error Code for PInvoke Calls)","pos":[720,785]},{"pos":[786,1002],"content":"<bpt id=\"p1\">**</bpt>/CLRSUPPORTLASTERROR<ept id=\"p1\">**</ept>, which is on by default, preserves the last error code of functions called through the P/Invoke mechanism, which allows you to call native functions in DLLS, from code compiled with <bpt id=\"p2\">**</bpt>/clr<ept id=\"p2\">**</ept>.","source":"**/CLRSUPPORTLASTERROR**, which is on by default, preserves the last error code of functions called through the P/Invoke mechanism, which allows you to call native functions in DLLS, from code compiled with **/clr**."},{"content":"Syntax","pos":[1011,1017]},{"content":"Remarks","pos":[1081,1088]},{"content":"Preserving the last error code implies a decrease in performance.","pos":[1092,1157]},{"content":"If you do not want to incur the performance impact of preserving the last error code, link with  <bpt id=\"p1\">**</bpt>/CLRSUPPORTLASTERROR:NO<ept id=\"p1\">**</ept>.","pos":[1159,1284],"source":"  If you do not want to incur the performance impact of preserving the last error code, link with  **/CLRSUPPORTLASTERROR:NO**."},{"content":"You can minimize the performance impact by linking with <bpt id=\"p1\">**</bpt>/CLRSUPPORTLASTERROR:SYSTEMDLL<ept id=\"p1\">**</ept>, which only preserves the last error code for functions in system DLLs.","pos":[1291,1453],"source":"You can minimize the performance impact by linking with **/CLRSUPPORTLASTERROR:SYSTEMDLL**, which only preserves the last error code for functions in system DLLs."},{"content":"A system DLL is defined as one of the following:","pos":[1455,1503]},{"content":"ACLUI.DLL","pos":[1530,1539]},{"content":"ACTIVEDS.DLL","pos":[1540,1552]},{"content":"ADPTIF.DLL","pos":[1553,1563]},{"content":"ADVAPI32.DLL","pos":[1564,1576]},{"content":"ASYCFILT.DLL","pos":[1581,1593]},{"content":"AUTHZ.DLL","pos":[1594,1603]},{"content":"AVICAP32.DLL","pos":[1604,1616]},{"content":"AVIFIL32.DLL","pos":[1617,1629]},{"content":"CABINET.DLL","pos":[1634,1645]},{"content":"CLUSAPI.DLL","pos":[1646,1657]},{"content":"COMCTL32.DLL","pos":[1658,1670]},{"content":"COMDLG32.DLL","pos":[1671,1683]},{"content":"COMSVCS.DLL","pos":[1688,1699]},{"content":"CREDUI.DLL","pos":[1700,1710]},{"content":"CRYPT32.DLL","pos":[1711,1722]},{"content":"CRYPTNET.DLL","pos":[1723,1735]},{"content":"CRYPTUI.DLL","pos":[1740,1751]},{"content":"D3D8THK.DLL","pos":[1752,1763]},{"content":"DBGENG.DLL","pos":[1764,1774]},{"content":"DBGHELP.DLL","pos":[1775,1786]},{"content":"DCIMAN32.DLL","pos":[1791,1803]},{"content":"DNSAPI.DLL","pos":[1804,1814]},{"content":"DSPROP.DLL","pos":[1815,1825]},{"content":"DSUIEXT.DLL","pos":[1826,1837]},{"content":"GDI32.DLL","pos":[1842,1851]},{"content":"GLU32.DLL","pos":[1852,1861]},{"content":"HLINK.DLL","pos":[1862,1871]},{"content":"ICM32.DLL","pos":[1872,1881]},{"content":"IMAGEHLP.DLL","pos":[1886,1898]},{"content":"IMM32.DLL","pos":[1899,1908]},{"content":"IPHLPAPI.DLL","pos":[1909,1921]},{"content":"IPROP.DLL","pos":[1922,1931]},{"content":"KERNEL32.DLL","pos":[1936,1948]},{"content":"KSUSER.DLL","pos":[1949,1959]},{"content":"LOADPERF.DLL","pos":[1960,1972]},{"content":"LZ32.DLL","pos":[1973,1981]},{"content":"MAPI32.DLL","pos":[1986,1996]},{"content":"MGMTAPI.DLL","pos":[1997,2008]},{"content":"MOBSYNC.DLL","pos":[2009,2020]},{"content":"MPR.DLL","pos":[2021,2028]},{"content":"MPRAPI.DLL","pos":[2033,2043]},{"content":"MQRT.DLL","pos":[2044,2052]},{"content":"MSACM32.DLL","pos":[2053,2064]},{"content":"MSCMS.DLL","pos":[2065,2074]},{"content":"MSI.DLL","pos":[2079,2086]},{"content":"MSIMG32.DLL","pos":[2087,2098]},{"content":"MSRATING.DLL","pos":[2099,2111]},{"content":"MSTASK.DLL","pos":[2112,2122]},{"content":"MSVFW32.DLL","pos":[2127,2138]},{"content":"MSWSOCK.DLL","pos":[2139,2150]},{"content":"MTXEX.DLL","pos":[2151,2160]},{"content":"NDDEAPI.DLL","pos":[2161,2172]},{"content":"NETAPI32.DLL","pos":[2177,2189]},{"content":"NPPTOOLS.DLL","pos":[2190,2202]},{"content":"NTDSAPI.DLL","pos":[2203,2214]},{"content":"NTDSBCLI.DLL","pos":[2215,2227]},{"content":"NTMSAPI.DLL","pos":[2232,2243]},{"content":"ODBC32.DLL","pos":[2244,2254]},{"content":"ODBCBCP.DLL","pos":[2255,2266]},{"content":"OLE32.DLL","pos":[2267,2276]},{"content":"OLEACC.DLL","pos":[2281,2291]},{"content":"OLEAUT32.DLL","pos":[2292,2304]},{"content":"OLEDLG.DLL","pos":[2305,2315]},{"content":"OPENGL32.DLL","pos":[2316,2328]},{"content":"PDH.DLL","pos":[2333,2340]},{"content":"POWRPROF.DLL","pos":[2341,2353]},{"content":"QOSNAME.DLL","pos":[2354,2365]},{"content":"QUERY.DLL","pos":[2366,2375]},{"content":"RASAPI32.DLL","pos":[2380,2392]},{"content":"RASDLG.DLL","pos":[2393,2403]},{"content":"RASSAPI.DLL","pos":[2404,2415]},{"content":"RESUTILS.DLL","pos":[2416,2428]},{"content":"RICHED20.DLL","pos":[2433,2445]},{"content":"RPCNS4.DLL","pos":[2446,2456]},{"content":"RPCRT4.DLL","pos":[2457,2467]},{"content":"RTM.DLL","pos":[2468,2475]},{"content":"RTUTILS.DLL","pos":[2480,2491]},{"content":"SCARDDLG.DLL","pos":[2492,2504]},{"content":"SECUR32.DLL","pos":[2505,2516]},{"content":"SENSAPI.DLL","pos":[2517,2528]},{"content":"SETUPAPI.DLL","pos":[2533,2545]},{"content":"SFC.DLL","pos":[2546,2553]},{"content":"SHELL32.DLL","pos":[2554,2565]},{"content":"SHFOLDER.DLL","pos":[2566,2578]},{"content":"SHLWAPI.DLL","pos":[2583,2594]},{"content":"SISBKUP.DLL","pos":[2595,2606]},{"content":"SNMPAPI.DLL","pos":[2607,2618]},{"content":"SRCLIENT.DLL","pos":[2619,2631]},{"content":"STI.DLL","pos":[2636,2643]},{"content":"TAPI32.DLL","pos":[2644,2654]},{"content":"TRAFFIC.DLL","pos":[2655,2666]},{"content":"URL.DLL","pos":[2667,2674]},{"content":"URLMON.DLL","pos":[2679,2689]},{"content":"USER32.DLL","pos":[2690,2700]},{"content":"USERENV.DLL","pos":[2701,2712]},{"content":"USP10.DLL","pos":[2713,2722]},{"content":"UXTHEME.DLL","pos":[2727,2738]},{"content":"VDMDBG.DLL","pos":[2739,2749]},{"content":"VERSION.DLL","pos":[2750,2761]},{"content":"WINFAX.DLL","pos":[2762,2772]},{"content":"WINHTTP.DLL","pos":[2777,2788]},{"content":"WININET.DLL","pos":[2789,2800]},{"content":"WINMM.DLL","pos":[2801,2810]},{"content":"WINSCARD.DLL","pos":[2811,2823]},{"content":"WINTRUST.DLL","pos":[2828,2840]},{"content":"WLDAP32.DLL","pos":[2841,2852]},{"content":"WOW32.DLL","pos":[2853,2862]},{"content":"WS2_32.DLL","pos":[2863,2873]},{"content":"WSNMP32.DLL","pos":[2878,2889]},{"content":"WSOCK32.DLL","pos":[2890,2901]},{"content":"WTSAPI32.DLL","pos":[2902,2914]},{"content":"XOLEHLP.DLL","pos":[2915,2926]},{"pos":[2935,3063],"content":"[!NOTE]\n Preserving the last error is not supported for unmanaged functions that are consumed by CLR code, in the same module.","leadings":["","> "],"nodes":[{"content":"Preserving the last error is not supported for unmanaged functions that are consumed by CLR code, in the same module.","pos":[9,126]}]},{"pos":[3073,3210],"content":"For more information, see <bpt id=\"p1\">[</bpt>/clr (Common Language Runtime Compilation)<ept id=\"p1\">](../../build/reference/clr-common-language-runtime-compilation.md)</ept>.","source":"For more information, see [/clr (Common Language Runtime Compilation)](../../build/reference/clr-common-language-runtime-compilation.md)."},{"content":"To set this linker option in the Visual Studio development environment","pos":[3220,3290]},{"content":"Open the project's <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box.","pos":[3300,3349],"source":"Open the project's **Property Pages** dialog box."},{"content":"For details, see <bpt id=\"p1\">[</bpt>Setting Visual C++ Project Properties<ept id=\"p1\">](../../ide/working-with-project-properties.md)</ept>.","pos":[3350,3453],"source":" For details, see [Setting Visual C++ Project Properties](../../ide/working-with-project-properties.md)."},{"pos":[3463,3491],"content":"Click the <bpt id=\"p1\">**</bpt>Linker<ept id=\"p1\">**</ept> folder.","source":"Click the **Linker** folder."},{"pos":[3501,3542],"content":"Click the <bpt id=\"p1\">**</bpt>Command Line<ept id=\"p1\">**</ept> property page.","source":"Click the **Command Line** property page."},{"pos":[3552,3604],"content":"Type the option into the <bpt id=\"p1\">**</bpt>Additional Options<ept id=\"p1\">**</ept> box.","source":"Type the option into the **Additional Options** box."},{"content":"To set this linker option programmatically","pos":[3614,3656]},{"content":"See &lt;xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.AdditionalOptions%2A&gt;.","pos":[3666,3750],"source":"See <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.AdditionalOptions%2A>."},{"content":"Example","pos":[3759,3766]},{"content":"The following sample defines a native DLL with one exported function that modifies last error.","pos":[3770,3864]},{"content":"Example","pos":[4124,4131]},{"pos":[4135,4224],"content":"The following sample consumes the DLL, demonstrating how to use <bpt id=\"p1\">**</bpt>/CLRSUPPORTLASTERROR<ept id=\"p1\">**</ept>.","source":"The following sample consumes the DLL, demonstrating how to use **/CLRSUPPORTLASTERROR**."},{"content":"See Also","pos":[5504,5512]},{"content":"Setting Linker Options","pos":[5517,5539]},{"content":"Linker Options","pos":[5595,5609]}],"content":"---\ntitle: \"-CLRSUPPORTLASTERROR (Preserve Last Error Code for PInvoke Calls) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"/CLRSUPPORTLASTERROR\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"/CLRSUPPORTLASTERROR linker option\"\n  - \"-CLRSUPPORTLASTERROR linker option\"\nms.assetid: b7057990-4154-4b1d-9fc9-6236f7be7575\ncaps.latest.revision: 16\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# /CLRSUPPORTLASTERROR (Preserve Last Error Code for PInvoke Calls)\n**/CLRSUPPORTLASTERROR**, which is on by default, preserves the last error code of functions called through the P/Invoke mechanism, which allows you to call native functions in DLLS, from code compiled with **/clr**.  \n  \n## Syntax  \n  \n```  \n/CLRSUPPORTLASTERROR{:NO | SYSTEMDLL}  \n```  \n  \n## Remarks  \n Preserving the last error code implies a decrease in performance.  If you do not want to incur the performance impact of preserving the last error code, link with  **/CLRSUPPORTLASTERROR:NO**.  \n  \n You can minimize the performance impact by linking with **/CLRSUPPORTLASTERROR:SYSTEMDLL**, which only preserves the last error code for functions in system DLLs.  A system DLL is defined as one of the following:  \n  \n|||||  \n|-|-|-|-|  \n|ACLUI.DLL|ACTIVEDS.DLL|ADPTIF.DLL|ADVAPI32.DLL|  \n|ASYCFILT.DLL|AUTHZ.DLL|AVICAP32.DLL|AVIFIL32.DLL|  \n|CABINET.DLL|CLUSAPI.DLL|COMCTL32.DLL|COMDLG32.DLL|  \n|COMSVCS.DLL|CREDUI.DLL|CRYPT32.DLL|CRYPTNET.DLL|  \n|CRYPTUI.DLL|D3D8THK.DLL|DBGENG.DLL|DBGHELP.DLL|  \n|DCIMAN32.DLL|DNSAPI.DLL|DSPROP.DLL|DSUIEXT.DLL|  \n|GDI32.DLL|GLU32.DLL|HLINK.DLL|ICM32.DLL|  \n|IMAGEHLP.DLL|IMM32.DLL|IPHLPAPI.DLL|IPROP.DLL|  \n|KERNEL32.DLL|KSUSER.DLL|LOADPERF.DLL|LZ32.DLL|  \n|MAPI32.DLL|MGMTAPI.DLL|MOBSYNC.DLL|MPR.DLL|  \n|MPRAPI.DLL|MQRT.DLL|MSACM32.DLL|MSCMS.DLL|  \n|MSI.DLL|MSIMG32.DLL|MSRATING.DLL|MSTASK.DLL|  \n|MSVFW32.DLL|MSWSOCK.DLL|MTXEX.DLL|NDDEAPI.DLL|  \n|NETAPI32.DLL|NPPTOOLS.DLL|NTDSAPI.DLL|NTDSBCLI.DLL|  \n|NTMSAPI.DLL|ODBC32.DLL|ODBCBCP.DLL|OLE32.DLL|  \n|OLEACC.DLL|OLEAUT32.DLL|OLEDLG.DLL|OPENGL32.DLL|  \n|PDH.DLL|POWRPROF.DLL|QOSNAME.DLL|QUERY.DLL|  \n|RASAPI32.DLL|RASDLG.DLL|RASSAPI.DLL|RESUTILS.DLL|  \n|RICHED20.DLL|RPCNS4.DLL|RPCRT4.DLL|RTM.DLL|  \n|RTUTILS.DLL|SCARDDLG.DLL|SECUR32.DLL|SENSAPI.DLL|  \n|SETUPAPI.DLL|SFC.DLL|SHELL32.DLL|SHFOLDER.DLL|  \n|SHLWAPI.DLL|SISBKUP.DLL|SNMPAPI.DLL|SRCLIENT.DLL|  \n|STI.DLL|TAPI32.DLL|TRAFFIC.DLL|URL.DLL|  \n|URLMON.DLL|USER32.DLL|USERENV.DLL|USP10.DLL|  \n|UXTHEME.DLL|VDMDBG.DLL|VERSION.DLL|WINFAX.DLL|  \n|WINHTTP.DLL|WININET.DLL|WINMM.DLL|WINSCARD.DLL|  \n|WINTRUST.DLL|WLDAP32.DLL|WOW32.DLL|WS2_32.DLL|  \n|WSNMP32.DLL|WSOCK32.DLL|WTSAPI32.DLL|XOLEHLP.DLL|  \n  \n> [!NOTE]\n>  Preserving the last error is not supported for unmanaged functions that are consumed by CLR code, in the same module.  \n  \n-   For more information, see [/clr (Common Language Runtime Compilation)](../../build/reference/clr-common-language-runtime-compilation.md).  \n  \n### To set this linker option in the Visual Studio development environment  \n  \n1.  Open the project's **Property Pages** dialog box. For details, see [Setting Visual C++ Project Properties](../../ide/working-with-project-properties.md).  \n  \n2.  Click the **Linker** folder.  \n  \n3.  Click the **Command Line** property page.  \n  \n4.  Type the option into the **Additional Options** box.  \n  \n### To set this linker option programmatically  \n  \n-   See <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.AdditionalOptions%2A>.  \n  \n## Example  \n The following sample defines a native DLL with one exported function that modifies last error.  \n  \n```  \n// CLRSUPPORTLASTERROR_dll.cpp  \n// compile with: /LD  \n#include <windows.h>  \n#include <math.h>  \n  \n#pragma unmanaged  \n__declspec(dllexport) double MySqrt(__int64 n) {  \n   SetLastError(DWORD(-1));  \n   return sqrt(double(n));  \n}  \n```  \n  \n## Example  \n The following sample consumes the DLL, demonstrating how to use **/CLRSUPPORTLASTERROR**.  \n  \n```  \n// CLRSUPPORTLASTERROR_client.cpp  \n// compile with: /clr CLRSUPPORTLASTERROR_dll.lib /link /clrsupportlasterror:systemdll  \n// processor: x86  \n#include <windows.h>  \n#include <wininet.h>  \n#include <stdio.h>  \n#include <math.h>  \n  \n#pragma comment(lib, \"wininet.lib\")  \n  \ndouble MySqrt(__int64 n);  \n  \n#pragma managed  \nint main() {  \n   double   d = 0.0;  \n   __int64 n = 65;  \n   HANDLE  hGroup = NULL;  \n   GROUPID groupID;  \n   DWORD   dwSet = 127, dwGet = 37;  \n  \n   SetLastError(dwSet);  \n   d = MySqrt(n);  \n   dwGet = GetLastError();  \n  \n   if (dwGet == DWORD(-1))  \n      printf_s(\"GetLastError for application call succeeded (%d).\\n\",  \n             dwGet);  \n   else  \n      printf_s(\"GetLastError for application call failed (%d).\\n\",  \n             dwGet);  \n  \n   hGroup = FindFirstUrlCacheGroup(0, CACHEGROUP_SEARCH_ALL,  \n                           0, 0, &groupID, 0);  \n   dwGet = GetLastError();  \n   if (dwGet == 183)  \n      printf_s(\"GetLastError for system call succeeded (%d).\\n\",  \n             dwGet);  \n   else  \n      printf_s(\"GetLastError for system call failed (%d).\\n\",  \n             dwGet);  \n}  \n```  \n  \n```Output  \nGetLastError for application call failed (127).  \nGetLastError for system call succeeded (183).  \n```  \n  \n## See Also  \n [Setting Linker Options](../../build/reference/setting-linker-options.md)   \n [Linker Options](../../build/reference/linker-options.md)"}