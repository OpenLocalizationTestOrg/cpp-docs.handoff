{"nodes":[{"pos":[12,84],"content":"Data Objects and Data Sources: Creation and Destruction | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Data Objects and Data Sources: Creation and Destruction | Microsoft Docs","pos":[0,72]}]},{"content":"Data Objects and Data Sources: Creation and Destruction","pos":[1046,1101]},{"content":"As explained in the article <bpt id=\"p1\">[</bpt>Data Objects and Data Sources (OLE)<ept id=\"p1\">](../mfc/data-objects-and-data-sources-ole.md)</ept>, data objects and data sources represent both sides of a data transfer.","pos":[1102,1284],"source":"As explained in the article [Data Objects and Data Sources (OLE)](../mfc/data-objects-and-data-sources-ole.md), data objects and data sources represent both sides of a data transfer."},{"content":"This article explains when to create and destroy these objects and sources to perform your data transfers properly, including:","pos":[1285,1411]},{"content":"Creating data objects","pos":[1422,1443]},{"content":"Destroying data objects","pos":[1485,1508]},{"content":"Creating data sources","pos":[1552,1573]},{"content":"Destroying data sources","pos":[1615,1638]},{"pos":[1724,1745],"content":"Creating Data Objects"},{"content":"Data objects are used by the destination application — either the client or the server.","pos":[1749,1836]},{"content":"A data object in the destination application is one end of a connection between the source application and the destination application.","pos":[1837,1972]},{"content":"A data object in the destination application is used to access and interact with the data in the data source.","pos":[1973,2082]},{"content":"There are two common situations where a data object is needed.","pos":[2089,2151]},{"content":"The first situation is when data is dropped in your application using drag and drop.","pos":[2152,2236]},{"content":"The second situation is when Paste or Paste Special is chosen from the Edit menu.","pos":[2237,2318]},{"content":"In a drag-and-drop situation, you do not need to create a data object.","pos":[2325,2395]},{"content":"A pointer to an existing data object will be passed to your <ph id=\"ph1\">`OnDrop`</ph> function.","pos":[2396,2474],"source":" A pointer to an existing data object will be passed to your `OnDrop` function."},{"content":"This data object is created by the framework as part of the drag-and-drop operation and will also be destroyed by it.","pos":[2475,2592]},{"content":"This is not always the case when pasting is done by another method.","pos":[2593,2660]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Destroying Data Objects<ept id=\"p1\">](#_core_destroying_data_objects)</ept>.","pos":[2661,2745],"source":" For more information, see [Destroying Data Objects](#_core_destroying_data_objects)."},{"content":"If the application is performing a paste or paste special operation, you should create a <ph id=\"ph1\">`COleDataObject`</ph> object and call its <ph id=\"ph2\">`AttachClipboard`</ph> member function.","pos":[2752,2912],"source":"If the application is performing a paste or paste special operation, you should create a `COleDataObject` object and call its `AttachClipboard` member function."},{"content":"This associates the data object with the data on the Clipboard.","pos":[2913,2976]},{"content":"You can then use this data object in your paste function.","pos":[2977,3034]},{"pos":[3089,3112],"content":"Destroying Data Objects"},{"content":"If you follow the scheme described in <bpt id=\"p1\">[</bpt>Creating Data Objects<ept id=\"p1\">](#_core_creating_data_objects)</ept>, destroying data objects is a trivial aspect of data transfers.","pos":[3116,3271],"source":"If you follow the scheme described in [Creating Data Objects](#_core_creating_data_objects), destroying data objects is a trivial aspect of data transfers."},{"content":"The data object that was created in your paste function will be destroyed by MFC when your paste function returns.","pos":[3272,3386]},{"content":"If you follow another method of handling paste operations, make sure the data object is destroyed after your paste operation is complete.","pos":[3393,3530]},{"content":"Until the data object is destroyed, it will be impossible for any application to successfully copy data to the Clipboard.","pos":[3531,3652]},{"pos":[3705,3726],"content":"Creating Data Sources"},{"content":"Data sources are used by the source of the data transfer, which can be either the client or the server side of the data transfer.","pos":[3730,3859]},{"content":"A data source in the source application is one end of a connection between the source application and the destination application.","pos":[3860,3990]},{"content":"A data object in the destination application is used to interact with the data in the data source.","pos":[3991,4089]},{"content":"Data sources are created when an application needs to copy data to the Clipboard.","pos":[4096,4177]},{"content":"A typical scenario runs like this:","pos":[4178,4212]},{"content":"The user selects some data.","pos":[4222,4249]},{"pos":[4259,4357],"content":"The user chooses <bpt id=\"p1\">**</bpt>Copy<ept id=\"p1\">**</ept> (or <bpt id=\"p2\">**</bpt>Cut<ept id=\"p2\">**</ept>) from the <bpt id=\"p3\">**</bpt>Edit<ept id=\"p3\">**</ept> menu or begins a drag-and-drop operation.","source":"The user chooses **Copy** (or **Cut**) from the **Edit** menu or begins a drag-and-drop operation."},{"pos":[4367,4520],"content":"Depending on the design of the program, the application creates either a <ph id=\"ph1\">`COleDataSource`</ph> object or an object from a class derived from <ph id=\"ph2\">`COleDataSource`</ph>.","source":"Depending on the design of the program, the application creates either a `COleDataSource` object or an object from a class derived from `COleDataSource`."},{"pos":[4530,4692],"content":"The selected data is inserted into the data source by calling one of the functions in the <ph id=\"ph1\">`COleDataSource::CacheData`</ph> or <ph id=\"ph2\">`COleDataSource::DelayRenderData`</ph> groups.","source":"The selected data is inserted into the data source by calling one of the functions in the `COleDataSource::CacheData` or `COleDataSource::DelayRenderData` groups."},{"pos":[4702,4876],"content":"The application calls the <ph id=\"ph1\">`SetClipboard`</ph> member function (or the <ph id=\"ph2\">`DoDragDrop`</ph> member function if this is a drag-and-drop operation) belonging to the object created in step 3.","source":"The application calls the `SetClipboard` member function (or the `DoDragDrop` member function if this is a drag-and-drop operation) belonging to the object created in step 3."},{"pos":[4886,5017],"content":"If this is a <bpt id=\"p1\">**</bpt>Cut<ept id=\"p1\">**</ept> operation or <ph id=\"ph1\">`DoDragDrop`</ph> returns <ph id=\"ph2\">`DROPEFFECT_MOVE`</ph>, the data selected in step 1 is deleted from the document.","source":"If this is a **Cut** operation or `DoDragDrop` returns `DROPEFFECT_MOVE`, the data selected in step 1 is deleted from the document."},{"content":"This scenario is implemented by the MFC OLE samples <bpt id=\"p1\">[</bpt>OCLIENT<ept id=\"p1\">](../visual-cpp-samples.md)</ept> and <bpt id=\"p2\">[</bpt>HIERSVR<ept id=\"p2\">](../visual-cpp-samples.md)</ept>.","pos":[5024,5152],"source":"This scenario is implemented by the MFC OLE samples [OCLIENT](../visual-cpp-samples.md) and [HIERSVR](../visual-cpp-samples.md)."},{"content":"Look at the source for each application's <ph id=\"ph1\">`CView`</ph>-derived class for all but the <ph id=\"ph2\">`GetClipboardData`</ph> and <ph id=\"ph3\">`OnGetClipboardData`</ph> functions.","pos":[5153,5287],"source":" Look at the source for each application's `CView`-derived class for all but the `GetClipboardData` and `OnGetClipboardData` functions."},{"content":"These two functions are in either the <ph id=\"ph1\">`COleClientItem`</ph> or <ph id=\"ph2\">`COleServerItem`</ph>-derived class implementations.","pos":[5288,5393],"source":" These two functions are in either the `COleClientItem` or `COleServerItem`-derived class implementations."},{"content":"These sample programs provide a good example of how to implement these concepts.","pos":[5394,5474]},{"content":"One other situation in which you might want to create a <ph id=\"ph1\">`COleDataSource`</ph> object occurs if you are modifying the default behavior of a drag-and-drop operation.","pos":[5481,5639],"source":"One other situation in which you might want to create a `COleDataSource` object occurs if you are modifying the default behavior of a drag-and-drop operation."},{"content":"For more information, see the <bpt id=\"p1\">[</bpt>Drag and Drop: Customizing<ept id=\"p1\">](../mfc/drag-and-drop-customizing.md)</ept> article.","pos":[5640,5744],"source":" For more information, see the [Drag and Drop: Customizing](../mfc/drag-and-drop-customizing.md) article."},{"pos":[5799,5822],"content":"Destroying Data Sources"},{"content":"Data sources must be destroyed by the application currently responsible for them.","pos":[5826,5907]},{"content":"In situations where you hand the data source to OLE, such as calling <bpt id=\"p1\">[</bpt>COleDataSource::DoDragDrop<ept id=\"p1\">](../mfc/reference/coledatasource-class.md#coledatasource__dodragdrop)</ept>, you need to call <bpt id=\"p2\">**</bpt>pDataSrc-&gt;InternalRelease<ept id=\"p2\">**</ept>.","pos":[5908,6123],"source":" In situations where you hand the data source to OLE, such as calling [COleDataSource::DoDragDrop](../mfc/reference/coledatasource-class.md#coledatasource__dodragdrop), you need to call **pDataSrc->InternalRelease**."},{"content":"For example:","pos":[6124,6136]},{"pos":[6154,6171],"content":"NVC_MFCListView#1"},{"content":"If you have not handed your data source to OLE, then you are responsible for destroying it, as with any typical C++ object.","pos":[6275,6398]},{"pos":[6405,6614],"content":"For more information, see <bpt id=\"p1\">[</bpt>Drag and Drop<ept id=\"p1\">](../mfc/drag-and-drop-ole.md)</ept>, <bpt id=\"p2\">[</bpt>Clipboard<ept id=\"p2\">](../mfc/clipboard.md)</ept>, and <bpt id=\"p3\">[</bpt>Manipulating Data Objects and Data Sources<ept id=\"p3\">](../mfc/data-objects-and-data-sources-manipulation.md)</ept>.","source":"For more information, see [Drag and Drop](../mfc/drag-and-drop-ole.md), [Clipboard](../mfc/clipboard.md), and [Manipulating Data Objects and Data Sources](../mfc/data-objects-and-data-sources-manipulation.md)."},{"content":"See Also","pos":[6623,6631]},{"content":"Data Objects and Data Sources (OLE)","pos":[6636,6671]},{"content":"COleDataObject Class","pos":[6723,6743]},{"content":"COleDataSource Class","pos":[6792,6812]}],"content":"---\ntitle: \"Data Objects and Data Sources: Creation and Destruction | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"destroying data objects\"\n  - \"object creation [C++], data source objects\"\n  - \"data sources [C++], and data objects\"\n  - \"data source objects [C++], creating\"\n  - \"destruction [C++], data sources\"\n  - \"data source objects [C++], destroying\"\n  - \"data objects [C++], creating\"\n  - \"data objects [C++], destroying\"\n  - \"data sources [C++], role\"\n  - \"data sources [C++], destroying\"\n  - \"destruction [C++], data objects\"\n  - \"data sources [C++], creating\"\nms.assetid: ac216d54-3ca5-4ce7-850d-cd1f6a90d4f1\ncaps.latest.revision: 14\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Data Objects and Data Sources: Creation and Destruction\nAs explained in the article [Data Objects and Data Sources (OLE)](../mfc/data-objects-and-data-sources-ole.md), data objects and data sources represent both sides of a data transfer. This article explains when to create and destroy these objects and sources to perform your data transfers properly, including:  \n  \n-   [Creating data objects](#_core_creating_data_objects)  \n  \n-   [Destroying data objects](#_core_destroying_data_objects)  \n  \n-   [Creating data sources](#_core_creating_data_sources)  \n  \n-   [Destroying data sources](#_core_destroying_data_sources)  \n  \n##  <a name=\"_core_creating_data_objects\"></a> Creating Data Objects  \n Data objects are used by the destination application — either the client or the server. A data object in the destination application is one end of a connection between the source application and the destination application. A data object in the destination application is used to access and interact with the data in the data source.  \n  \n There are two common situations where a data object is needed. The first situation is when data is dropped in your application using drag and drop. The second situation is when Paste or Paste Special is chosen from the Edit menu.  \n  \n In a drag-and-drop situation, you do not need to create a data object. A pointer to an existing data object will be passed to your `OnDrop` function. This data object is created by the framework as part of the drag-and-drop operation and will also be destroyed by it. This is not always the case when pasting is done by another method. For more information, see [Destroying Data Objects](#_core_destroying_data_objects).  \n  \n If the application is performing a paste or paste special operation, you should create a `COleDataObject` object and call its `AttachClipboard` member function. This associates the data object with the data on the Clipboard. You can then use this data object in your paste function.  \n  \n##  <a name=\"_core_destroying_data_objects\"></a> Destroying Data Objects  \n If you follow the scheme described in [Creating Data Objects](#_core_creating_data_objects), destroying data objects is a trivial aspect of data transfers. The data object that was created in your paste function will be destroyed by MFC when your paste function returns.  \n  \n If you follow another method of handling paste operations, make sure the data object is destroyed after your paste operation is complete. Until the data object is destroyed, it will be impossible for any application to successfully copy data to the Clipboard.  \n  \n##  <a name=\"_core_creating_data_sources\"></a> Creating Data Sources  \n Data sources are used by the source of the data transfer, which can be either the client or the server side of the data transfer. A data source in the source application is one end of a connection between the source application and the destination application. A data object in the destination application is used to interact with the data in the data source.  \n  \n Data sources are created when an application needs to copy data to the Clipboard. A typical scenario runs like this:  \n  \n1.  The user selects some data.  \n  \n2.  The user chooses **Copy** (or **Cut**) from the **Edit** menu or begins a drag-and-drop operation.  \n  \n3.  Depending on the design of the program, the application creates either a `COleDataSource` object or an object from a class derived from `COleDataSource`.  \n  \n4.  The selected data is inserted into the data source by calling one of the functions in the `COleDataSource::CacheData` or `COleDataSource::DelayRenderData` groups.  \n  \n5.  The application calls the `SetClipboard` member function (or the `DoDragDrop` member function if this is a drag-and-drop operation) belonging to the object created in step 3.  \n  \n6.  If this is a **Cut** operation or `DoDragDrop` returns `DROPEFFECT_MOVE`, the data selected in step 1 is deleted from the document.  \n  \n This scenario is implemented by the MFC OLE samples [OCLIENT](../visual-cpp-samples.md) and [HIERSVR](../visual-cpp-samples.md). Look at the source for each application's `CView`-derived class for all but the `GetClipboardData` and `OnGetClipboardData` functions. These two functions are in either the `COleClientItem` or `COleServerItem`-derived class implementations. These sample programs provide a good example of how to implement these concepts.  \n  \n One other situation in which you might want to create a `COleDataSource` object occurs if you are modifying the default behavior of a drag-and-drop operation. For more information, see the [Drag and Drop: Customizing](../mfc/drag-and-drop-customizing.md) article.  \n  \n##  <a name=\"_core_destroying_data_sources\"></a> Destroying Data Sources  \n Data sources must be destroyed by the application currently responsible for them. In situations where you hand the data source to OLE, such as calling [COleDataSource::DoDragDrop](../mfc/reference/coledatasource-class.md#coledatasource__dodragdrop), you need to call **pDataSrc->InternalRelease**. For example:  \n  \n [!code-cpp[NVC_MFCListView#1](../atl/reference/codesnippet/cpp/data-objects-and-data-sources-creation-and-destruction_1.cpp)]  \n  \n If you have not handed your data source to OLE, then you are responsible for destroying it, as with any typical C++ object.  \n  \n For more information, see [Drag and Drop](../mfc/drag-and-drop-ole.md), [Clipboard](../mfc/clipboard.md), and [Manipulating Data Objects and Data Sources](../mfc/data-objects-and-data-sources-manipulation.md).  \n  \n## See Also  \n [Data Objects and Data Sources (OLE)](../mfc/data-objects-and-data-sources-ole.md)   \n [COleDataObject Class](../mfc/reference/coledataobject-class.md)   \n [COleDataSource Class](../mfc/reference/coledatasource-class.md)\n"}