{"nodes":[{"pos":[12,65],"content":"Recordset: More About Updates (ODBC) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Recordset: More About Updates (ODBC) | Microsoft Docs","pos":[0,53]}]},{"content":"Recordset: More About Updates (ODBC)","pos":[808,844]},{"content":"This topic applies to the MFC ODBC classes.","pos":[845,888]},{"content":"This topic explains:","pos":[895,915]},{"pos":[925,1026],"content":"<bpt id=\"p1\">[</bpt>How other operations, such as transactions, affect updates<ept id=\"p1\">](#_core_how_transactions_affect_updates)</ept>.","source":"[How other operations, such as transactions, affect updates](#_core_how_transactions_affect_updates)."},{"pos":[1036,1128],"content":"<bpt id=\"p1\">[</bpt>Your updates and those of other users<ept id=\"p1\">](#_core_your_updates_and_the_updates_of_other_users)</ept>.","source":"[Your updates and those of other users](#_core_your_updates_and_the_updates_of_other_users)."},{"pos":[1138,1227],"content":"<bpt id=\"p1\">[</bpt>More about the Update and Delete member functions<ept id=\"p1\">](#_core_more_about_update_and_delete)</ept>.","source":"[More about the Update and Delete member functions](#_core_more_about_update_and_delete)."},{"pos":[1235,1730],"content":"[!NOTE]\n This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you have implemented bulk row fetching, some of the information does not apply. For example, you cannot call the `AddNew`, **Edit**, **Delete**, and **Update** member functions; however, you can perform transactions. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","leadings":["","> "],"nodes":[{"content":" This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you have implemented bulk row fetching, some of the information does not apply. For example, you cannot call the `AddNew`, **Edit**, **Delete**, and **Update** member functions; however, you can perform transactions. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","pos":[8,493],"nodes":[{"content":"This topic applies to objects derived from <ph id=\"ph1\">`CRecordset`</ph> in which bulk row fetching has not been implemented.","pos":[1,109],"source":" This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented."},{"content":"If you have implemented bulk row fetching, some of the information does not apply.","pos":[110,192]},{"content":"For example, you cannot call the <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept> member functions; however, you can perform transactions.","pos":[193,329],"source":" For example, you cannot call the `AddNew`, **Edit**, **Delete**, and **Update** member functions; however, you can perform transactions."},{"content":"For more information about bulk row fetching, see <bpt id=\"p1\">[</bpt>Recordset: Fetching Records in Bulk (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)</ept>.","pos":[330,485],"source":" For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)."}]}]},{"pos":[1797,1832],"content":"How Other Operations Affect Updates"},{"content":"Your updates are affected by transactions in effect at the time of the update, by closing the recordset before completing a transaction, and by scrolling before completing a transaction.","pos":[1836,2022]},{"pos":[2086,2117],"content":"How Transactions Affect Updates"},{"pos":[2121,2435],"content":"Beyond understanding how <ph id=\"ph1\">`AddNew`</ph>, <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, and <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept> work, it is important to understand how the <bpt id=\"p3\">**</bpt>BeginTrans<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>CommitTrans<ept id=\"p4\">**</ept>, and <bpt id=\"p5\">**</bpt>Rollback<ept id=\"p5\">**</ept> member functions of <bpt id=\"p6\">[</bpt>CDatabase<ept id=\"p6\">](../../mfc/reference/cdatabase-class.md)</ept> work with the update functions of <bpt id=\"p7\">[</bpt>CRecordset<ept id=\"p7\">](../../mfc/reference/crecordset-class.md)</ept>.","source":"Beyond understanding how `AddNew`, **Edit**, and **Delete** work, it is important to understand how the **BeginTrans**, **CommitTrans**, and **Rollback** member functions of [CDatabase](../../mfc/reference/cdatabase-class.md) work with the update functions of [CRecordset](../../mfc/reference/crecordset-class.md)."},{"content":"By default, calls to <ph id=\"ph1\">`AddNew`</ph> and <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> affect the data source immediately when you call <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>.","pos":[2442,2545],"source":"By default, calls to `AddNew` and **Edit** affect the data source immediately when you call **Update**."},{"content":"<bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> calls take effect immediately.","pos":[2546,2587],"source":"**Delete** calls take effect immediately."},{"content":"But you can establish a transaction and execute a batch of such calls.","pos":[2588,2658]},{"content":"The updates are not permanent until you commit them.","pos":[2659,2711]},{"content":"If you change your mind, you can roll back the transaction instead of committing it.","pos":[2712,2796]},{"pos":[2803,2906],"content":"For more information about transactions, see <bpt id=\"p1\">[</bpt>Transaction (ODBC)<ept id=\"p1\">](../../data/odbc/transaction-odbc.md)</ept>.","source":"For more information about transactions, see [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"pos":[2980,3021],"content":"How Closing the Recordset Affects Updates"},{"pos":[3025,3429],"content":"If you close a recordset, or its associated <ph id=\"ph1\">`CDatabase`</ph> object, with a transaction in progress (you have not called <bpt id=\"p1\">[</bpt>CDatabase::CommitTrans<ept id=\"p1\">](../../mfc/reference/cdatabase-class.md#cdatabase__committrans)</ept> or <bpt id=\"p2\">[</bpt>CDatabase::Rollback<ept id=\"p2\">](../../mfc/reference/cdatabase-class.md#cdatabase__rollback)</ept>), the transaction is rolled back automatically (unless your database backend is the Microsoft Jet database engine).","source":"If you close a recordset, or its associated `CDatabase` object, with a transaction in progress (you have not called [CDatabase::CommitTrans](../../mfc/reference/cdatabase-class.md#cdatabase__committrans) or [CDatabase::Rollback](../../mfc/reference/cdatabase-class.md#cdatabase__rollback)), the transaction is rolled back automatically (unless your database backend is the Microsoft Jet database engine)."},{"pos":[3437,3818],"content":"[!CAUTION]\n If you are using the Microsoft Jet database engine, closing a recordset inside an explicit transaction does not result in releasing any of the rows that were modified or locks that were placed until the explicit transaction is committed or rolled back. It is recommended that you always both open and close recordsets inside or outside of an explicit Jet transaction.","leadings":["","> "],"nodes":[{"content":" If you are using the Microsoft Jet database engine, closing a recordset inside an explicit transaction does not result in releasing any of the rows that were modified or locks that were placed until the explicit transaction is committed or rolled back. It is recommended that you always both open and close recordsets inside or outside of an explicit Jet transaction.","pos":[11,379],"nodes":[{"content":"If you are using the Microsoft Jet database engine, closing a recordset inside an explicit transaction does not result in releasing any of the rows that were modified or locks that were placed until the explicit transaction is committed or rolled back.","pos":[1,253]},{"content":"It is recommended that you always both open and close recordsets inside or outside of an explicit Jet transaction.","pos":[254,368]}]}]},{"pos":[3880,3909],"content":"How Scrolling Affects Updates"},{"content":"When you <bpt id=\"p1\">[</bpt>Recordset: Scrolling (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-scrolling-odbc.md)</ept> in a recordset, the edit buffer is filled with each new current record (the previous record is not stored first).","pos":[3913,4110],"source":"When you [Recordset: Scrolling (ODBC)](../../data/odbc/recordset-scrolling-odbc.md) in a recordset, the edit buffer is filled with each new current record (the previous record is not stored first)."},{"content":"Scrolling skips over records previously deleted.","pos":[4111,4159]},{"content":"If you scroll after an <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> call without calling <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>CommitTrans<ept id=\"p3\">**</ept>, or <bpt id=\"p4\">**</bpt>Rollback<ept id=\"p4\">**</ept> first, any changes are lost (with no warning to you) as a new record is brought into the edit buffer.","pos":[4160,4371],"source":" If you scroll after an `AddNew` or **Edit** call without calling **Update**, **CommitTrans**, or **Rollback** first, any changes are lost (with no warning to you) as a new record is brought into the edit buffer."},{"content":"The edit buffer is filled with the record scrolled to, the stored record is freed, and no change occurs on the data source.","pos":[4372,4495]},{"content":"This applies to both <ph id=\"ph1\">`AddNew`</ph> and <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>.","pos":[4496,4539],"source":" This applies to both `AddNew` and **Edit**."},{"pos":[4614,4657],"content":"Your Updates and the Updates of Other Users"},{"content":"When you use a recordset to update data, your updates affect other users.","pos":[4661,4734]},{"content":"Similarly, the updates of other users during the lifetime of your recordset affect you.","pos":[4735,4822]},{"content":"In a multiuser environment, other users can open recordsets that contain some of the same records you have selected in your recordset.","pos":[4829,4963]},{"content":"Changes to a record before you retrieve it are reflected in your recordset.","pos":[4964,5039]},{"content":"Because dynasets retrieve a record each time you scroll to it, dynasets reflect changes each time you scroll to a record.","pos":[5040,5161]},{"content":"Snapshots retrieve a record the first time you scroll to it, so snapshots reflect only those changes that occur before you scroll to the record initially.","pos":[5162,5316]},{"content":"Records added by other users after you open the recordset do not show up in your recordset unless you requery.","pos":[5323,5433]},{"content":"If your recordset is a dynaset, edits to existing records by other users do show up in your dynaset when you scroll to the affected record.","pos":[5434,5573]},{"content":"If your recordset is a snapshot, edits do not show up until you requery the snapshot.","pos":[5574,5659]},{"content":"If you want to see records added or deleted by other users in your snapshot, or records added by other users in your dynaset, call <bpt id=\"p1\">[</bpt>CRecordset::Requery<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__requery)</ept> to rebuild the recordset.","pos":[5660,5899],"source":" If you want to see records added or deleted by other users in your snapshot, or records added by other users in your dynaset, call [CRecordset::Requery](../../mfc/reference/crecordset-class.md#crecordset__requery) to rebuild the recordset."},{"content":"(Note that the deletions of other users show up in your dynaset.) You might also call <bpt id=\"p1\">**</bpt>Requery<ept id=\"p1\">**</ept> to see records you add, but not to see your deletions.","pos":[5900,6052],"source":" (Note that the deletions of other users show up in your dynaset.) You might also call **Requery** to see records you add, but not to see your deletions."},{"pos":[6060,6419],"content":"[!TIP]\n To force caching of an entire snapshot at once, call `MoveLast` immediately after you open the snapshot. Then call **MoveFirst** to begin working with the records. `MoveLast` is equivalent to scrolling over all the records, but it retrieves them all at once. Note, however, that this can lower performance and might not be required for some drivers.","leadings":["","> "],"nodes":[{"content":" To force caching of an entire snapshot at once, call `MoveLast` immediately after you open the snapshot. Then call **MoveFirst** to begin working with the records. `MoveLast` is equivalent to scrolling over all the records, but it retrieves them all at once. Note, however, that this can lower performance and might not be required for some drivers.","pos":[7,357],"nodes":[{"content":"To force caching of an entire snapshot at once, call <ph id=\"ph1\">`MoveLast`</ph> immediately after you open the snapshot.","pos":[1,105],"source":" To force caching of an entire snapshot at once, call `MoveLast` immediately after you open the snapshot."},{"content":"Then call <bpt id=\"p1\">**</bpt>MoveFirst<ept id=\"p1\">**</ept> to begin working with the records.","pos":[106,164],"source":" Then call **MoveFirst** to begin working with the records."},{"content":"is equivalent to scrolling over all the records, but it retrieves them all at once.","pos":[176,259]},{"content":"Note, however, that this can lower performance and might not be required for some drivers.","pos":[260,350]}]}]},{"content":"The effects of your updates on other users are similar to their effects on you.","pos":[6426,6505]},{"pos":[6565,6593],"content":"More About Update and Delete"},{"pos":[6597,6690],"content":"This section provides additional information to help you work with <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>.","source":"This section provides additional information to help you work with **Update** and **Delete**."},{"content":"Update Success and Failure","pos":[6700,6726]},{"content":"If <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> succeeds, the <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept> mode ends.","pos":[6730,6789],"source":"If **Update** succeeds, the `AddNew` or **Edit** mode ends."},{"content":"To begin an <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> mode again, call <ph id=\"ph2\">`AddNew`</ph> or <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept>.","pos":[6790,6861],"source":" To begin an `AddNew` or **Edit** mode again, call `AddNew` or **Edit**."},{"content":"If <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> fails (returns <bpt id=\"p2\">**</bpt>FALSE<ept id=\"p2\">**</ept> or throws an exception), you remain in <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p3\">**</bpt>Edit<ept id=\"p3\">**</ept> mode, depending on which function you called last.","pos":[6868,7017],"source":"If **Update** fails (returns **FALSE** or throws an exception), you remain in `AddNew` or **Edit** mode, depending on which function you called last."},{"content":"You can then do one of the following:","pos":[7018,7055]},{"pos":[7065,7121],"content":"Modify a field data member and try the <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> again.","source":"Modify a field data member and try the **Update** again."},{"pos":[7131,7259],"content":"Call <ph id=\"ph1\">`AddNew`</ph> to reset the field data members to Null, set the values of the field data members, and then call <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> again.","source":"Call `AddNew` to reset the field data members to Null, set the values of the field data members, and then call **Update** again."},{"content":"Call <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> to reload the values that were in the recordset before the first call to <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept>, set the values of the field data members, and then call <bpt id=\"p3\">**</bpt>Update<ept id=\"p3\">**</ept> again.","pos":[7269,7451],"source":"Call **Edit** to reload the values that were in the recordset before the first call to `AddNew` or **Edit**, set the values of the field data members, and then call **Update** again."},{"content":"After a successful <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> call (except after an <ph id=\"ph1\">`AddNew`</ph> call), the field data members retain their new values.","pos":[7452,7567],"source":" After a successful **Update** call (except after an `AddNew` call), the field data members retain their new values."},{"pos":[7577,7735],"content":"Call <bpt id=\"p1\">**</bpt>Move<ept id=\"p1\">**</ept> (including <bpt id=\"p2\">**</bpt>Move<ept id=\"p2\">**</ept> with a parameter of <bpt id=\"p3\">**</bpt>AFX_MOVE_REFRESH<ept id=\"p3\">**</ept>, or 0), which flushes any changes and ends any <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p4\">**</bpt>Edit<ept id=\"p4\">**</ept> mode in effect.","source":"Call **Move** (including **Move** with a parameter of **AFX_MOVE_REFRESH**, or 0), which flushes any changes and ends any `AddNew` or **Edit** mode in effect."},{"content":"Update and Delete","pos":[7745,7762]},{"pos":[7766,7821],"content":"This section applies to both <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>.","source":"This section applies to both **Update** and **Delete**."},{"content":"On an <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept> operation, one and only one record should be updated.","pos":[7828,7912],"source":"On an **Update** or **Delete** operation, one and only one record should be updated."},{"content":"That record is the current record, which corresponds to the data values in the fields of the recordset.","pos":[7913,8016]},{"content":"If for some reason no records are affected or more than one record is affected, an exception is thrown containing one of the following <bpt id=\"p1\">**</bpt>RETCODE<ept id=\"p1\">**</ept> values:","pos":[8017,8171],"source":" If for some reason no records are affected or more than one record is affected, an exception is thrown containing one of the following **RETCODE** values:"},{"content":"AFX_SQL_ERROR_NO_ROWS_AFFECTED","pos":[8183,8213]},{"content":"AFX_SQL_ERROR_MULTIPLE_ROWS_AFFECTED","pos":[8227,8263]},{"content":"When these exceptions are thrown, you remain in the <ph id=\"ph1\">`AddNew`</ph> or <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> state you were in when you called <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Delete<ept id=\"p3\">**</ept>.","pos":[8272,8404],"source":"When these exceptions are thrown, you remain in the `AddNew` or **Edit** state you were in when you called **Update** or **Delete**."},{"content":"Here are the most common scenarios in which you would see these exceptions.","pos":[8405,8480]},{"content":"You're most likely to see:","pos":[8481,8507]},{"pos":[8517,8729],"content":"<bpt id=\"p1\">**</bpt>AFX_SQL_ERROR_NO_ROWS_AFFECTED<ept id=\"p1\">**</ept> when you are using optimistic locking mode and another user has modified the record in a way that prevents the framework from identifying the correct record to update or delete.","source":"**AFX_SQL_ERROR_NO_ROWS_AFFECTED** when you are using optimistic locking mode and another user has modified the record in a way that prevents the framework from identifying the correct record to update or delete."},{"pos":[8739,8932],"content":"<bpt id=\"p1\">**</bpt>AFX_SQL_ERROR_MULTIPLE_ROWS_AFFECTED<ept id=\"p1\">**</ept> when the table you are updating has no primary key or unique index and you do not have enough columns in the recordset to uniquely identify a table row.","source":"**AFX_SQL_ERROR_MULTIPLE_ROWS_AFFECTED** when the table you are updating has no primary key or unique index and you do not have enough columns in the recordset to uniquely identify a table row."},{"content":"See Also","pos":[8941,8949]},{"content":"Recordset (ODBC)","pos":[8954,8970]},{"content":"Recordset: How Recordsets Select Records (ODBC)","pos":[9012,9059]},{"content":"Record Field Exchange (RFX)","pos":[9131,9158]},{"content":"SQL","pos":[9211,9214]},{"content":"Exceptions: Database Exceptions","pos":[9245,9276]}],"content":"---\ntitle: \"Recordset: More About Updates (ODBC) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"records, updating\"\n  - \"transactions, updating recordsets\"\n  - \"ODBC recordsets, updating\"\n  - \"multiuser environments, updates to recordsets\"\n  - \"scrolling, updates to recordsets\"\n  - \"updating recordsets\"\n  - \"recordsets, updating\"\nms.assetid: 0353a742-d226-4fe2-8881-a7daeffe86cd\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Recordset: More About Updates (ODBC)\nThis topic applies to the MFC ODBC classes.  \n  \n This topic explains:  \n  \n-   [How other operations, such as transactions, affect updates](#_core_how_transactions_affect_updates).  \n  \n-   [Your updates and those of other users](#_core_your_updates_and_the_updates_of_other_users).  \n  \n-   [More about the Update and Delete member functions](#_core_more_about_update_and_delete).  \n  \n> [!NOTE]\n>  This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you have implemented bulk row fetching, some of the information does not apply. For example, you cannot call the `AddNew`, **Edit**, **Delete**, and **Update** member functions; however, you can perform transactions. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  \n  \n##  <a name=\"_core_how_other_operations_affect_updates\"></a> How Other Operations Affect Updates  \n Your updates are affected by transactions in effect at the time of the update, by closing the recordset before completing a transaction, and by scrolling before completing a transaction.  \n  \n###  <a name=\"_core_how_transactions_affect_updates\"></a> How Transactions Affect Updates  \n Beyond understanding how `AddNew`, **Edit**, and **Delete** work, it is important to understand how the **BeginTrans**, **CommitTrans**, and **Rollback** member functions of [CDatabase](../../mfc/reference/cdatabase-class.md) work with the update functions of [CRecordset](../../mfc/reference/crecordset-class.md).  \n  \n By default, calls to `AddNew` and **Edit** affect the data source immediately when you call **Update**. **Delete** calls take effect immediately. But you can establish a transaction and execute a batch of such calls. The updates are not permanent until you commit them. If you change your mind, you can roll back the transaction instead of committing it.  \n  \n For more information about transactions, see [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n###  <a name=\"_core_how_closing_the_recordset_affects_updates\"></a> How Closing the Recordset Affects Updates  \n If you close a recordset, or its associated `CDatabase` object, with a transaction in progress (you have not called [CDatabase::CommitTrans](../../mfc/reference/cdatabase-class.md#cdatabase__committrans) or [CDatabase::Rollback](../../mfc/reference/cdatabase-class.md#cdatabase__rollback)), the transaction is rolled back automatically (unless your database backend is the Microsoft Jet database engine).  \n  \n> [!CAUTION]\n>  If you are using the Microsoft Jet database engine, closing a recordset inside an explicit transaction does not result in releasing any of the rows that were modified or locks that were placed until the explicit transaction is committed or rolled back. It is recommended that you always both open and close recordsets inside or outside of an explicit Jet transaction.  \n  \n###  <a name=\"_core_how_scrolling_affects_updates\"></a> How Scrolling Affects Updates  \n When you [Recordset: Scrolling (ODBC)](../../data/odbc/recordset-scrolling-odbc.md) in a recordset, the edit buffer is filled with each new current record (the previous record is not stored first). Scrolling skips over records previously deleted. If you scroll after an `AddNew` or **Edit** call without calling **Update**, **CommitTrans**, or **Rollback** first, any changes are lost (with no warning to you) as a new record is brought into the edit buffer. The edit buffer is filled with the record scrolled to, the stored record is freed, and no change occurs on the data source. This applies to both `AddNew` and **Edit**.  \n  \n##  <a name=\"_core_your_updates_and_the_updates_of_other_users\"></a> Your Updates and the Updates of Other Users  \n When you use a recordset to update data, your updates affect other users. Similarly, the updates of other users during the lifetime of your recordset affect you.  \n  \n In a multiuser environment, other users can open recordsets that contain some of the same records you have selected in your recordset. Changes to a record before you retrieve it are reflected in your recordset. Because dynasets retrieve a record each time you scroll to it, dynasets reflect changes each time you scroll to a record. Snapshots retrieve a record the first time you scroll to it, so snapshots reflect only those changes that occur before you scroll to the record initially.  \n  \n Records added by other users after you open the recordset do not show up in your recordset unless you requery. If your recordset is a dynaset, edits to existing records by other users do show up in your dynaset when you scroll to the affected record. If your recordset is a snapshot, edits do not show up until you requery the snapshot. If you want to see records added or deleted by other users in your snapshot, or records added by other users in your dynaset, call [CRecordset::Requery](../../mfc/reference/crecordset-class.md#crecordset__requery) to rebuild the recordset. (Note that the deletions of other users show up in your dynaset.) You might also call **Requery** to see records you add, but not to see your deletions.  \n  \n> [!TIP]\n>  To force caching of an entire snapshot at once, call `MoveLast` immediately after you open the snapshot. Then call **MoveFirst** to begin working with the records. `MoveLast` is equivalent to scrolling over all the records, but it retrieves them all at once. Note, however, that this can lower performance and might not be required for some drivers.  \n  \n The effects of your updates on other users are similar to their effects on you.  \n  \n##  <a name=\"_core_more_about_update_and_delete\"></a> More About Update and Delete  \n This section provides additional information to help you work with **Update** and **Delete**.  \n  \n### Update Success and Failure  \n If **Update** succeeds, the `AddNew` or **Edit** mode ends. To begin an `AddNew` or **Edit** mode again, call `AddNew` or **Edit**.  \n  \n If **Update** fails (returns **FALSE** or throws an exception), you remain in `AddNew` or **Edit** mode, depending on which function you called last. You can then do one of the following:  \n  \n-   Modify a field data member and try the **Update** again.  \n  \n-   Call `AddNew` to reset the field data members to Null, set the values of the field data members, and then call **Update** again.  \n  \n-   Call **Edit** to reload the values that were in the recordset before the first call to `AddNew` or **Edit**, set the values of the field data members, and then call **Update** again. After a successful **Update** call (except after an `AddNew` call), the field data members retain their new values.  \n  \n-   Call **Move** (including **Move** with a parameter of **AFX_MOVE_REFRESH**, or 0), which flushes any changes and ends any `AddNew` or **Edit** mode in effect.  \n  \n### Update and Delete  \n This section applies to both **Update** and **Delete**.  \n  \n On an **Update** or **Delete** operation, one and only one record should be updated. That record is the current record, which corresponds to the data values in the fields of the recordset. If for some reason no records are affected or more than one record is affected, an exception is thrown containing one of the following **RETCODE** values:  \n  \n-   **AFX_SQL_ERROR_NO_ROWS_AFFECTED**  \n  \n-   **AFX_SQL_ERROR_MULTIPLE_ROWS_AFFECTED**  \n  \n When these exceptions are thrown, you remain in the `AddNew` or **Edit** state you were in when you called **Update** or **Delete**. Here are the most common scenarios in which you would see these exceptions. You're most likely to see:  \n  \n-   **AFX_SQL_ERROR_NO_ROWS_AFFECTED** when you are using optimistic locking mode and another user has modified the record in a way that prevents the framework from identifying the correct record to update or delete.  \n  \n-   **AFX_SQL_ERROR_MULTIPLE_ROWS_AFFECTED** when the table you are updating has no primary key or unique index and you do not have enough columns in the recordset to uniquely identify a table row.  \n  \n## See Also  \n [Recordset (ODBC)](../../data/odbc/recordset-odbc.md)   \n [Recordset: How Recordsets Select Records (ODBC)](../../data/odbc/recordset-how-recordsets-select-records-odbc.md)   \n [Record Field Exchange (RFX)](../../data/odbc/record-field-exchange-rfx.md)   \n [SQL](../../data/odbc/sql.md)   \n [Exceptions: Database Exceptions](../../mfc/exceptions-database-exceptions.md)"}