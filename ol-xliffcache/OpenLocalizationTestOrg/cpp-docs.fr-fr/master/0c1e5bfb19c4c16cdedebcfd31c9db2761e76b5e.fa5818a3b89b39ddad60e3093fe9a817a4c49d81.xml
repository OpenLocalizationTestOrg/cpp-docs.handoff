{"nodes":[{"pos":[12,61],"content":"CAtlServiceModuleT::Run Function | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"CAtlServiceModuleT::Run Function | Microsoft Docs","pos":[0,49]}]},{"content":"CAtlServiceModuleT::Run Function","pos":[684,716]},{"content":"<bpt id=\"p1\">**</bpt>Run<ept id=\"p1\">**</ept> contains calls to <ph id=\"ph1\">`PreMessageLoop`</ph>, <ph id=\"ph2\">`RunMessageLoop`</ph>, and <ph id=\"ph3\">`PostMessageLoop`</ph>.","pos":[717,801],"source":"**Run** contains calls to `PreMessageLoop`, `RunMessageLoop`, and `PostMessageLoop`."},{"content":"After being called, <ph id=\"ph1\">`PreMessageLoop`</ph> first stores the service's thread ID.","pos":[802,876],"source":" After being called, `PreMessageLoop` first stores the service's thread ID."},{"content":"The service will use this ID to close itself by sending a <bpt id=\"p1\">**</bpt>WM_QUIT<ept id=\"p1\">**</ept> message using the Win32 API function, <bpt id=\"p2\">[</bpt>PostThreadMessage<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/ms644946)</ept>.","pos":[877,1065],"source":" The service will use this ID to close itself by sending a **WM_QUIT** message using the Win32 API function, [PostThreadMessage](http://msdn.microsoft.com/library/windows/desktop/ms644946)."},{"content":"then calls <ph id=\"ph1\">`InitializeSecurity`</ph>.","pos":[1089,1121],"source":" then calls `InitializeSecurity`."},{"content":"By default, <ph id=\"ph1\">`InitializeSecurity`</ph> calls <bpt id=\"p1\">[</bpt>CoInitializeSecurity<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms693736)</ept> with the security descriptor set to NULL, which means that any user has access to your object.","pos":[1122,1338],"source":" By default, `InitializeSecurity` calls [CoInitializeSecurity](http://msdn.microsoft.com/library/windows/desktop/ms693736) with the security descriptor set to NULL, which means that any user has access to your object."},{"content":"If you do not want the service to specify its own security, override <ph id=\"ph1\">`PreMessageLoop`</ph> and don't call <ph id=\"ph2\">`InitializeSecurity`</ph>, and COM will then determine the security settings from the registry.","pos":[1345,1536],"source":"If you do not want the service to specify its own security, override `PreMessageLoop` and don't call `InitializeSecurity`, and COM will then determine the security settings from the registry."},{"content":"A convenient way to configure registry settings is with the <bpt id=\"p1\">[</bpt>DCOMCNFG<ept id=\"p1\">](../atl/dcomcnfg.md)</ept> utility discussed later in this section.","pos":[1537,1668],"source":" A convenient way to configure registry settings is with the [DCOMCNFG](../atl/dcomcnfg.md) utility discussed later in this section."},{"content":"Once security is specified, the object is registered with COM so that new clients can connect to the program.","pos":[1675,1784]},{"content":"Finally, the program tells the service control manager (SCM) that it is running and the program enters a message loop.","pos":[1785,1903]},{"content":"The program remains running until it posts a quit message upon service shutdown.","pos":[1904,1984]},{"content":"See Also","pos":[1993,2001]},{"content":"Services","pos":[2006,2014]},{"content":"CSecurityDesc Class","pos":[2045,2064]},{"content":"CSid Class","pos":[2112,2122]},{"content":"CDacl Class","pos":[2161,2172]},{"content":"CAtlServiceModuleT::Run","pos":[2212,2235]}],"content":"---\ntitle: \"CAtlServiceModuleT::Run Function | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"CServiceModule::Run\"\n  - \"CServiceModule.Run\"\n  - \"CSecurityDescriptor\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"ATL services, security\"\nms.assetid: 42c010f0-e60e-459c-a63b-a53a24cda93b\ncaps.latest.revision: 12\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# CAtlServiceModuleT::Run Function\n**Run** contains calls to `PreMessageLoop`, `RunMessageLoop`, and `PostMessageLoop`. After being called, `PreMessageLoop` first stores the service's thread ID. The service will use this ID to close itself by sending a **WM_QUIT** message using the Win32 API function, [PostThreadMessage](http://msdn.microsoft.com/library/windows/desktop/ms644946).  \n  \n `PreMessageLoop` then calls `InitializeSecurity`. By default, `InitializeSecurity` calls [CoInitializeSecurity](http://msdn.microsoft.com/library/windows/desktop/ms693736) with the security descriptor set to NULL, which means that any user has access to your object.  \n  \n If you do not want the service to specify its own security, override `PreMessageLoop` and don't call `InitializeSecurity`, and COM will then determine the security settings from the registry. A convenient way to configure registry settings is with the [DCOMCNFG](../atl/dcomcnfg.md) utility discussed later in this section.  \n  \n Once security is specified, the object is registered with COM so that new clients can connect to the program. Finally, the program tells the service control manager (SCM) that it is running and the program enters a message loop. The program remains running until it posts a quit message upon service shutdown.  \n  \n## See Also  \n [Services](../atl/atl-services.md)   \n [CSecurityDesc Class](../atl/reference/csecuritydesc-class.md)   \n [CSid Class](../atl/reference/csid-class.md)   \n [CDacl Class](../atl/reference/cdacl-class.md)   \n [CAtlServiceModuleT::Run](../atl/reference/catlservicemodulet-class.md#catlservicemodulet__run)\n\n"}