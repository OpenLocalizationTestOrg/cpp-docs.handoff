{"nodes":[{"pos":[12,60],"content":"Providing Windowless Activation | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Providing Windowless Activation | Microsoft Docs","pos":[0,48]}]},{"content":"Providing Windowless Activation","pos":[746,777]},{"content":"Window creation code (that is, everything that happens when you call <bpt id=\"p1\">**</bpt>CreateWindow<ept id=\"p1\">**</ept>) is costly to execute.","pos":[778,886],"source":"Window creation code (that is, everything that happens when you call **CreateWindow**) is costly to execute."},{"content":"A control that maintains an on-screen window has to manage messages for the window.","pos":[887,970]},{"content":"Windowless controls are therefore faster than controls with windows.","pos":[971,1039]},{"content":"A further advantage of windowless controls is that, unlike windowed controls, windowless controls support transparent painting and nonrectangular screen regions.","pos":[1046,1207]},{"content":"A common example of a transparent control is a text control with a transparent background.","pos":[1208,1298]},{"content":"The controls paints the text but not the background, so whatever is under the text shows through.","pos":[1299,1396]},{"content":"Newer forms often make use of nonrectangular controls, such as arrows and round buttons.","pos":[1397,1485]},{"content":"Often, a control does not need a window of its own and, instead, can use the window services of its container, provided that the container has been written to support windowless objects.","pos":[1492,1678]},{"content":"Windowless controls are backward compatible with older containers.","pos":[1679,1745]},{"content":"In older containers not written to support windowless controls, the windowless controls create a window when active.","pos":[1746,1862]},{"content":"Because windowless controls do not have their own windows, the container (which does have a window) is responsible for providing services that would otherwise have been provided by the control's own window.","pos":[1869,2075]},{"content":"For example, if your control needs to query the keyboard focus, capture the mouse, or obtain a device context, these operations are managed by the container.","pos":[2076,2233]},{"content":"The container routes user input messages sent to its window to the appropriate windowless control, using the <ph id=\"ph1\">`IOleInPlaceObjectWindowless`</ph> interface.","pos":[2234,2383],"source":" The container routes user input messages sent to its window to the appropriate windowless control, using the `IOleInPlaceObjectWindowless` interface."},{"content":"(See the <bpt id=\"p1\">*</bpt>ActiveX SDK<ept id=\"p1\">*</ept> for a description of this interface.) <ph id=\"ph1\">`COleControl`</ph> member functions invoke these services from the container.","pos":[2384,2517],"source":" (See the *ActiveX SDK* for a description of this interface.) `COleControl` member functions invoke these services from the container."},{"content":"To make your control use windowless activation, include the <bpt id=\"p1\">**</bpt>windowlessActivate<ept id=\"p1\">**</ept> flag in the set of flags returned by <bpt id=\"p2\">[</bpt>COleControl::GetControlFlags<ept id=\"p2\">](../mfc/reference/colecontrol-class.md#colecontrol__getcontrolflags)</ept>.","pos":[2524,2743],"source":"To make your control use windowless activation, include the **windowlessActivate** flag in the set of flags returned by [COleControl::GetControlFlags](../mfc/reference/colecontrol-class.md#colecontrol__getcontrolflags)."},{"content":"For example:","pos":[2744,2756]},{"content":"NVC_MFC_AxOpt#5","pos":[2774,2789]},{"content":"NVC_MFC_AxOpt#6","pos":[2867,2882]},{"content":"NVC_MFC_AxOpt#7","pos":[2960,2975]},{"pos":[3046,3284],"content":"The code to include this flag is automatically generated if you select the <bpt id=\"p1\">**</bpt>Windowless activation<ept id=\"p1\">**</ept> option on the <bpt id=\"p2\">[</bpt>Control Settings<ept id=\"p2\">](../mfc/reference/control-settings-mfc-activex-control-wizard.md)</ept> page of the MFC ActiveX Control Wizard.","source":"The code to include this flag is automatically generated if you select the **Windowless activation** option on the [Control Settings](../mfc/reference/control-settings-mfc-activex-control-wizard.md) page of the MFC ActiveX Control Wizard."},{"content":"When windowless activation is enabled, the container will delegate input messages to the control's <ph id=\"ph1\">`IOleInPlaceObjectWindowless`</ph> interface.","pos":[3291,3430],"source":"When windowless activation is enabled, the container will delegate input messages to the control's `IOleInPlaceObjectWindowless` interface."},{"content":"'s implementation of this interface dispatches the messages through your control's message map, after adjusting the mouse coordinates appropriately.","pos":[3444,3592]},{"content":"You can process the messages like ordinary window messages, by adding the corresponding entries to the message map.","pos":[3593,3708]},{"content":"In your handlers for these messages, avoid using the <ph id=\"ph1\">`m_hWnd`</ph> member variable (or any member function that uses it) without first checking that its value is not <bpt id=\"p1\">**</bpt>NULL<ept id=\"p1\">**</ept>.","pos":[3709,3879],"source":" In your handlers for these messages, avoid using the `m_hWnd` member variable (or any member function that uses it) without first checking that its value is not **NULL**."},{"pos":[3900,4051],"content":"provides member functions that invoke mouse capture, keyboard focus, scrolling, and other window services from the container as appropriate, including:"},{"pos":[4061,4205],"content":"<bpt id=\"p1\">[</bpt>GetFocus<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__getfocus)</ept>, <bpt id=\"p2\">[</bpt>SetFocus<ept id=\"p2\">](../mfc/reference/colecontrol-class.md#colecontrol__setfocus)</ept>","source":"[GetFocus](../mfc/reference/colecontrol-class.md#colecontrol__getfocus), [SetFocus](../mfc/reference/colecontrol-class.md#colecontrol__setfocus)"},{"pos":[4215,4452],"content":"<bpt id=\"p1\">[</bpt>GetCapture<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__getcapture)</ept>, <bpt id=\"p2\">[</bpt>SetCapture<ept id=\"p2\">](../mfc/reference/colecontrol-class.md#colecontrol__setcapture)</ept>, <bpt id=\"p3\">[</bpt>ReleaseCapture<ept id=\"p3\">](../mfc/reference/colecontrol-class.md#colecontrol__releasecapture)</ept>","source":"[GetCapture](../mfc/reference/colecontrol-class.md#colecontrol__getcapture), [SetCapture](../mfc/reference/colecontrol-class.md#colecontrol__setcapture), [ReleaseCapture](../mfc/reference/colecontrol-class.md#colecontrol__releasecapture)"},{"pos":[4462,4602],"content":"<bpt id=\"p1\">[</bpt>GetDC<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__getdc)</ept>, <bpt id=\"p2\">[</bpt>ReleaseDC<ept id=\"p2\">](../mfc/reference/colecontrol-class.md#colecontrol__releasedc)</ept>","source":"[GetDC](../mfc/reference/colecontrol-class.md#colecontrol__getdc), [ReleaseDC](../mfc/reference/colecontrol-class.md#colecontrol__releasedc)"},{"content":"InvalidateRgn","pos":[4613,4626]},{"content":"ScrollWindow","pos":[4704,4716]},{"content":"GetClientRect","pos":[4793,4806]},{"pos":[4880,5051],"content":"In windowless controls, you should always use the <ph id=\"ph1\">`COleControl`</ph> member functions instead of the corresponding <ph id=\"ph2\">`CWnd`</ph> member functions or their related Win32 API functions.","source":"In windowless controls, you should always use the `COleControl` member functions instead of the corresponding `CWnd` member functions or their related Win32 API functions."},{"content":"You may want a windowless control to be the target of an OLE drag-and-drop operation.","pos":[5058,5143]},{"content":"Normally, this would require that the control's window be registered as a drop target.","pos":[5144,5230]},{"content":"Since the control has no window of its own, the container uses its own window as a drop target.","pos":[5231,5326]},{"content":"The control provides an implementation of the <ph id=\"ph1\">`IDropTarget`</ph> interface to which the container can delegate calls at the appropriate time.","pos":[5327,5463],"source":" The control provides an implementation of the `IDropTarget` interface to which the container can delegate calls at the appropriate time."},{"content":"To expose this interface to the container, override <bpt id=\"p1\">[</bpt>COleControl::GetWindowlessDropTarget<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__getwindowlessdroptarget)</ept>.","pos":[5464,5631],"source":" To expose this interface to the container, override [COleControl::GetWindowlessDropTarget](../mfc/reference/colecontrol-class.md#colecontrol__getwindowlessdroptarget)."},{"content":"For example:","pos":[5632,5644]},{"pos":[5662,5677],"content":"NVC_MFC_AxOpt#8"},{"content":"See Also","pos":[5750,5758]},{"content":"MFC ActiveX Controls: Optimization","pos":[5763,5797]}],"content":"---\ntitle: \"Providing Windowless Activation | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"windowless activation of MFC ActiveX controls\"\n  - \"activation [C++], MFC ActiveX controls\"\n  - \"MFC ActiveX controls [C++], activate options\"\n  - \"activation [C++], windowless\"\nms.assetid: 094903b5-c344-42fa-96ff-ce01e16891c5\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Providing Windowless Activation\nWindow creation code (that is, everything that happens when you call **CreateWindow**) is costly to execute. A control that maintains an on-screen window has to manage messages for the window. Windowless controls are therefore faster than controls with windows.  \n  \n A further advantage of windowless controls is that, unlike windowed controls, windowless controls support transparent painting and nonrectangular screen regions. A common example of a transparent control is a text control with a transparent background. The controls paints the text but not the background, so whatever is under the text shows through. Newer forms often make use of nonrectangular controls, such as arrows and round buttons.  \n  \n Often, a control does not need a window of its own and, instead, can use the window services of its container, provided that the container has been written to support windowless objects. Windowless controls are backward compatible with older containers. In older containers not written to support windowless controls, the windowless controls create a window when active.  \n  \n Because windowless controls do not have their own windows, the container (which does have a window) is responsible for providing services that would otherwise have been provided by the control's own window. For example, if your control needs to query the keyboard focus, capture the mouse, or obtain a device context, these operations are managed by the container. The container routes user input messages sent to its window to the appropriate windowless control, using the `IOleInPlaceObjectWindowless` interface. (See the *ActiveX SDK* for a description of this interface.) `COleControl` member functions invoke these services from the container.  \n  \n To make your control use windowless activation, include the **windowlessActivate** flag in the set of flags returned by [COleControl::GetControlFlags](../mfc/reference/colecontrol-class.md#colecontrol__getcontrolflags). For example:  \n  \n [!code-cpp[NVC_MFC_AxOpt#5](../mfc/codesnippet/cpp/providing-windowless-activation_1.cpp)]  \n[!code-cpp[NVC_MFC_AxOpt#6](../mfc/codesnippet/cpp/providing-windowless-activation_2.cpp)]  \n[!code-cpp[NVC_MFC_AxOpt#7](../mfc/codesnippet/cpp/providing-windowless-activation_3.cpp)]  \n  \n The code to include this flag is automatically generated if you select the **Windowless activation** option on the [Control Settings](../mfc/reference/control-settings-mfc-activex-control-wizard.md) page of the MFC ActiveX Control Wizard.  \n  \n When windowless activation is enabled, the container will delegate input messages to the control's `IOleInPlaceObjectWindowless` interface. `COleControl`'s implementation of this interface dispatches the messages through your control's message map, after adjusting the mouse coordinates appropriately. You can process the messages like ordinary window messages, by adding the corresponding entries to the message map. In your handlers for these messages, avoid using the `m_hWnd` member variable (or any member function that uses it) without first checking that its value is not **NULL**.  \n  \n `COleControl` provides member functions that invoke mouse capture, keyboard focus, scrolling, and other window services from the container as appropriate, including:  \n  \n-   [GetFocus](../mfc/reference/colecontrol-class.md#colecontrol__getfocus), [SetFocus](../mfc/reference/colecontrol-class.md#colecontrol__setfocus)  \n  \n-   [GetCapture](../mfc/reference/colecontrol-class.md#colecontrol__getcapture), [SetCapture](../mfc/reference/colecontrol-class.md#colecontrol__setcapture), [ReleaseCapture](../mfc/reference/colecontrol-class.md#colecontrol__releasecapture)  \n  \n-   [GetDC](../mfc/reference/colecontrol-class.md#colecontrol__getdc), [ReleaseDC](../mfc/reference/colecontrol-class.md#colecontrol__releasedc)  \n  \n-   [InvalidateRgn](../mfc/reference/colecontrol-class.md#colecontrol__invalidatergn)  \n  \n-   [ScrollWindow](../mfc/reference/colecontrol-class.md#colecontrol__scrollwindow)  \n  \n-   [GetClientRect](../mfc/reference/colecontrol-class.md#colecontrol__getclientrect)  \n  \n In windowless controls, you should always use the `COleControl` member functions instead of the corresponding `CWnd` member functions or their related Win32 API functions.  \n  \n You may want a windowless control to be the target of an OLE drag-and-drop operation. Normally, this would require that the control's window be registered as a drop target. Since the control has no window of its own, the container uses its own window as a drop target. The control provides an implementation of the `IDropTarget` interface to which the container can delegate calls at the appropriate time. To expose this interface to the container, override [COleControl::GetWindowlessDropTarget](../mfc/reference/colecontrol-class.md#colecontrol__getwindowlessdroptarget). For example:  \n  \n [!code-cpp[NVC_MFC_AxOpt#8](../mfc/codesnippet/cpp/providing-windowless-activation_4.cpp)]  \n  \n## See Also  \n [MFC ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md)\n\n"}