{"nodes":[{"pos":[12,73],"content":"-SAFESEH (Image has Safe Exception Handlers) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"-SAFESEH (Image has Safe Exception Handlers) | Microsoft Docs","pos":[0,61]}]},{"content":"/SAFESEH (Image has Safe Exception Handlers)","pos":[717,761]},{"content":"When <bpt id=\"p1\">**</bpt>/SAFESEH<ept id=\"p1\">**</ept> is specified, the linker will only produce an image if it can also produce a table of the image's safe exception handlers.","pos":[794,934],"source":"When **/SAFESEH** is specified, the linker will only produce an image if it can also produce a table of the image's safe exception handlers."},{"content":"This table specifies for the operating system which exception handlers are valid for the image.","pos":[935,1030]},{"content":"<bpt id=\"p1\">**</bpt>/SAFESEH<ept id=\"p1\">**</ept> is only valid when linking for x86 targets.","pos":[1037,1093],"source":"**/SAFESEH** is only valid when linking for x86 targets."},{"content":"<bpt id=\"p1\">**</bpt>/SAFESEH<ept id=\"p1\">**</ept> is not supported for platforms that already have the exception handlers noted.","pos":[1094,1185],"source":"**/SAFESEH** is not supported for platforms that already have the exception handlers noted."},{"content":"For example, on <ph id=\"ph1\">[!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)]</ph> and ARM, all exception handlers are noted in the PDATA.","pos":[1186,1324],"source":" For example, on [!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)] and ARM, all exception handlers are noted in the PDATA."},{"content":"ML64.exe has support for adding annotations that emit SEH information (XDATA and PDATA) into the image, allowing you to unwind through ml64 functions.","pos":[1325,1475]},{"content":"See <bpt id=\"p1\">[</bpt>MASM for x64 (ml64.exe)<ept id=\"p1\">](../../assembler/masm/masm-for-x64-ml64-exe.md)</ept> for more information.","pos":[1476,1574],"source":" See [MASM for x64 (ml64.exe)](../../assembler/masm/masm-for-x64-ml64-exe.md) for more information."},{"content":"If <bpt id=\"p1\">**</bpt>/SAFESEH<ept id=\"p1\">**</ept> is not specified, the linker will produce an image with a table of safe exceptions handlers if all modules are compatible with the safe exception handling feature.","pos":[1581,1760],"source":"If **/SAFESEH** is not specified, the linker will produce an image with a table of safe exceptions handlers if all modules are compatible with the safe exception handling feature."},{"content":"If any modules were not compatible with safe exception handling feature, the resulting image will not contain a table of safe exception handlers.","pos":[1761,1906]},{"content":"If <bpt id=\"p1\">[</bpt>/SUBSYSTEM<ept id=\"p1\">](../../build/reference/subsystem-specify-subsystem.md)</ept> specifies WINDOWSCE or one of the EFI_* options, the linker will not attempt to produce an image with a table of safe exceptions handlers, as neither of those subsystems can make use of the information.","pos":[1907,2179],"source":" If [/SUBSYSTEM](../../build/reference/subsystem-specify-subsystem.md) specifies WINDOWSCE or one of the EFI_* options, the linker will not attempt to produce an image with a table of safe exceptions handlers, as neither of those subsystems can make use of the information."},{"pos":[2186,2373],"content":"If <bpt id=\"p1\">**</bpt>/SAFESEH:NO<ept id=\"p1\">**</ept> is specified, the linker will not produce an image with a table of safe exceptions handlers even if all modules are compatible with the safe exception handling feature.","source":"If **/SAFESEH:NO** is specified, the linker will not produce an image with a table of safe exceptions handlers even if all modules are compatible with the safe exception handling feature."},{"content":"The most common reason for the linker not to be able to produce an image is because one or more of the input files (modules) to the linker was not compatible with the safe exception handlers feature.","pos":[2380,2579]},{"content":"A common reason for a module to not be compatible with safe exception handlers is because it was created with a compiler from a previous version of Visual C++.","pos":[2580,2739]},{"pos":[2746,2870],"content":"You can also register a function as a structured exception handler by using <bpt id=\"p1\">[</bpt>.SAFESEH<ept id=\"p1\">](../../assembler/masm/dot-safeseh.md)</ept>.","source":"You can also register a function as a structured exception handler by using [.SAFESEH](../../assembler/masm/dot-safeseh.md)."},{"content":"It is not possible to mark an existing binary as having safe exception handlers (or no exception handlers); information on safe exception handling must be added at build time.","pos":[2877,3052]},{"content":"The linker's ability to build a table of safe exception handlers depends on the application using the C runtime library.","pos":[3059,3179]},{"content":"If you link with <bpt id=\"p1\">[</bpt>/NODEFAULTLIB<ept id=\"p1\">](../../build/reference/nodefaultlib-ignore-libraries.md)</ept> and you want a table of safe exception handlers, you need to supply a load config struct (such as can be found in loadcfg.c CRT source file) that contains all the entries defined for Visual C++.","pos":[3180,3463],"source":" If you link with [/NODEFAULTLIB](../../build/reference/nodefaultlib-ignore-libraries.md) and you want a table of safe exception handlers, you need to supply a load config struct (such as can be found in loadcfg.c CRT source file) that contains all the entries defined for Visual C++."},{"content":"For example:","pos":[3464,3476]},{"content":"To set this linker option in the Visual Studio development environment","pos":[5150,5220]},{"content":"Open the project's <bpt id=\"p1\">**</bpt>Property Pages<ept id=\"p1\">**</ept> dialog box.","pos":[5230,5279],"source":"Open the project's **Property Pages** dialog box."},{"content":"For details, see <bpt id=\"p1\">[</bpt>Setting Visual C++ Project Properties<ept id=\"p1\">](../../ide/working-with-project-properties.md)</ept>.","pos":[5280,5383],"source":" For details, see [Setting Visual C++ Project Properties](../../ide/working-with-project-properties.md)."},{"pos":[5393,5422],"content":"Select the <bpt id=\"p1\">**</bpt>Linker<ept id=\"p1\">**</ept> folder.","source":"Select the **Linker** folder."},{"pos":[5432,5474],"content":"Select the <bpt id=\"p1\">**</bpt>Command Line<ept id=\"p1\">**</ept> property page.","source":"Select the **Command Line** property page."},{"pos":[5484,5537],"content":"Enter the option into the <bpt id=\"p1\">**</bpt>Additional Options<ept id=\"p1\">**</ept> box.","source":"Enter the option into the **Additional Options** box."},{"content":"To set this linker option programmatically","pos":[5547,5589]},{"content":"See &lt;xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.AdditionalOptions%2A&gt;.","pos":[5599,5683],"source":"See <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.AdditionalOptions%2A>."},{"content":"See Also","pos":[5692,5700]},{"content":"Setting Linker Options","pos":[5705,5727]},{"content":"Linker Options","pos":[5783,5797]}],"content":"---\ntitle: \"-SAFESEH (Image has Safe Exception Handlers) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"/SAFESEH\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"/SAFESEH linker option\"\n  - \"-SAFESEH linker option\"\n  - \"SAFESEH linker option\"\nms.assetid: 7722ff99-b833-4c65-a855-aaca902ffcb7\ncaps.latest.revision: 16\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"ru-ru\"\n  - \"zh-cn\"\n  - \"zh-tw\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# /SAFESEH (Image has Safe Exception Handlers)\n```  \n/SAFESEH[:NO]  \n```  \n  \n When **/SAFESEH** is specified, the linker will only produce an image if it can also produce a table of the image's safe exception handlers. This table specifies for the operating system which exception handlers are valid for the image.  \n  \n **/SAFESEH** is only valid when linking for x86 targets. **/SAFESEH** is not supported for platforms that already have the exception handlers noted. For example, on [!INCLUDE[vcprx64](../../assembler/inline/includes/vcprx64_md.md)] and ARM, all exception handlers are noted in the PDATA. ML64.exe has support for adding annotations that emit SEH information (XDATA and PDATA) into the image, allowing you to unwind through ml64 functions. See [MASM for x64 (ml64.exe)](../../assembler/masm/masm-for-x64-ml64-exe.md) for more information.  \n  \n If **/SAFESEH** is not specified, the linker will produce an image with a table of safe exceptions handlers if all modules are compatible with the safe exception handling feature. If any modules were not compatible with safe exception handling feature, the resulting image will not contain a table of safe exception handlers. If [/SUBSYSTEM](../../build/reference/subsystem-specify-subsystem.md) specifies WINDOWSCE or one of the EFI_* options, the linker will not attempt to produce an image with a table of safe exceptions handlers, as neither of those subsystems can make use of the information.  \n  \n If **/SAFESEH:NO** is specified, the linker will not produce an image with a table of safe exceptions handlers even if all modules are compatible with the safe exception handling feature.  \n  \n The most common reason for the linker not to be able to produce an image is because one or more of the input files (modules) to the linker was not compatible with the safe exception handlers feature. A common reason for a module to not be compatible with safe exception handlers is because it was created with a compiler from a previous version of Visual C++.  \n  \n You can also register a function as a structured exception handler by using [.SAFESEH](../../assembler/masm/dot-safeseh.md).  \n  \n It is not possible to mark an existing binary as having safe exception handlers (or no exception handlers); information on safe exception handling must be added at build time.  \n  \n The linker's ability to build a table of safe exception handlers depends on the application using the C runtime library. If you link with [/NODEFAULTLIB](../../build/reference/nodefaultlib-ignore-libraries.md) and you want a table of safe exception handlers, you need to supply a load config struct (such as can be found in loadcfg.c CRT source file) that contains all the entries defined for Visual C++. For example:  \n  \n```  \n#include <windows.h>  \nextern DWORD_PTR __security_cookie;  /* /GS security cookie */  \n  \n/*  \n * The following two names are automatically created by the linker for any  \n * image that has the safe exception table present.  \n*/  \n  \nextern PVOID __safe_se_handler_table[]; /* base of safe handler entry table */  \nextern BYTE  __safe_se_handler_count;  /* absolute symbol whose address is  \n                                           the count of table entries */  \ntypedef struct {  \n    DWORD       Size;  \n    DWORD       TimeDateStamp;  \n    WORD        MajorVersion;  \n    WORD        MinorVersion;  \n    DWORD       GlobalFlagsClear;  \n    DWORD       GlobalFlagsSet;  \n    DWORD       CriticalSectionDefaultTimeout;  \n    DWORD       DeCommitFreeBlockThreshold;  \n    DWORD       DeCommitTotalFreeThreshold;  \n    DWORD       LockPrefixTable;            // VA  \n    DWORD       MaximumAllocationSize;  \n    DWORD       VirtualMemoryThreshold;  \n    DWORD       ProcessHeapFlags;  \n    DWORD       ProcessAffinityMask;  \n    WORD        CSDVersion;  \n    WORD        Reserved1;  \n    DWORD       EditList;                   // VA  \n    DWORD_PTR   *SecurityCookie;  \n    PVOID       *SEHandlerTable;  \n    DWORD       SEHandlerCount;  \n} IMAGE_LOAD_CONFIG_DIRECTORY32_2;  \n  \nconst IMAGE_LOAD_CONFIG_DIRECTORY32_2 _load_config_used = {  \n    sizeof(IMAGE_LOAD_CONFIG_DIRECTORY32_2),  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    0,  \n    &__security_cookie,  \n    __safe_se_handler_table,  \n    (DWORD)(DWORD_PTR) &__safe_se_handler_count  \n};  \n```  \n  \n### To set this linker option in the Visual Studio development environment  \n  \n1.  Open the project's **Property Pages** dialog box. For details, see [Setting Visual C++ Project Properties](../../ide/working-with-project-properties.md).  \n  \n2.  Select the **Linker** folder.  \n  \n3.  Select the **Command Line** property page.  \n  \n4.  Enter the option into the **Additional Options** box.  \n  \n### To set this linker option programmatically  \n  \n-   See <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.AdditionalOptions%2A>.  \n  \n## See Also  \n [Setting Linker Options](../../build/reference/setting-linker-options.md)   \n [Linker Options](../../build/reference/linker-options.md)"}