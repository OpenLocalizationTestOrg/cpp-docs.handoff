{"nodes":[{"pos":[12,47],"content":"A.16   Using Locks | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"A.16   Using Locks | Microsoft Docs","pos":[0,35]}]},{"content":"A.16   Using Locks","pos":[527,545]},{"content":"In the following example, (for <bpt id=\"p1\">[</bpt>Section 3.2<ept id=\"p1\">](../../parallel/openmp/3-2-lock-functions.md)</ept> on page 41) note that the argument to the lock functions should have type <ph id=\"ph1\">`omp_lock_t`</ph>, and that there is no need to flush it.","pos":[546,762],"source":"In the following example, (for [Section 3.2](../../parallel/openmp/3-2-lock-functions.md) on page 41) note that the argument to the lock functions should have type `omp_lock_t`, and that there is no need to flush it."},{"content":"The lock functions cause the threads to be idle while waiting for entry to the first critical section, but to do other work while waiting for entry to the second.","pos":[764,926]},{"content":"The <ph id=\"ph1\">`omp_set_lock`</ph> function blocks, but the <ph id=\"ph2\">`omp_test_lock`</ph> function does not, allowing the work in skip() to be done.","pos":[928,1046],"source":"  The `omp_set_lock` function blocks, but the `omp_test_lock` function does not, allowing the work in skip() to be done."},{"content":"Example","pos":[1055,1062]},{"content":"Code","pos":[1072,1076]}],"content":"---\ntitle: \"A.16   Using Locks | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nms.assetid: 873bf32b-6cfe-4ce1-b994-bef80b50f399\ncaps.latest.revision: 8\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# A.16   Using Locks\nIn the following example, (for [Section 3.2](../../parallel/openmp/3-2-lock-functions.md) on page 41) note that the argument to the lock functions should have type `omp_lock_t`, and that there is no need to flush it.  The lock functions cause the threads to be idle while waiting for entry to the first critical section, but to do other work while waiting for entry to the second.  The `omp_set_lock` function blocks, but the `omp_test_lock` function does not, allowing the work in skip() to be done.  \n  \n## Example  \n  \n### Code  \n  \n```  \n// omp_using_locks.c  \n// compile with: /openmp /c  \n#include <stdio.h>  \n#include <omp.h>  \n  \nvoid work(int);  \nvoid skip(int);  \n  \nint main() {  \n   omp_lock_t lck;  \n   int id;  \n  \n   omp_init_lock(&lck);  \n   #pragma omp parallel shared(lck) private(id)  \n   {  \n      id = omp_get_thread_num();  \n  \n      omp_set_lock(&lck);  \n      printf_s(\"My thread id is %d.\\n\", id);  \n  \n      // only one thread at a time can execute this printf  \n      omp_unset_lock(&lck);  \n  \n      while (! omp_test_lock(&lck)) {  \n         skip(id);   // we do not yet have the lock,  \n                     // so we must do something else   \n      }  \n      work(id);     // we now have the lock  \n                    // and can do the work   \n      omp_unset_lock(&lck);  \n   }  \n   omp_destroy_lock(&lck);  \n}  \n```"}