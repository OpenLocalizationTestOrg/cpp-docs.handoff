{"nodes":[{"pos":[12,60],"content":"CComClassFactorySingleton Class | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"CComClassFactorySingleton Class | Microsoft Docs","pos":[0,48]}]},{"content":"CComClassFactorySingleton Class","pos":[801,832]},{"pos":[833,1027],"content":"This class derives from <bpt id=\"p1\">[</bpt>CComClassFactory<ept id=\"p1\">](../../atl/reference/ccomclassfactory-class.md)</ept> and uses <bpt id=\"p2\">[</bpt>CComObjectGlobal<ept id=\"p2\">](../../atl/reference/ccomobjectglobal-class.md)</ept> to construct a single object.","source":"This class derives from [CComClassFactory](../../atl/reference/ccomclassfactory-class.md) and uses [CComObjectGlobal](../../atl/reference/ccomobjectglobal-class.md) to construct a single object."},{"pos":[1035,1145],"content":"[!IMPORTANT]\n This class and its members cannot be used in applications that execute in the Windows Runtime.","leadings":["","> "],"nodes":[{"content":"This class and its members cannot be used in applications that execute in the Windows Runtime.","pos":[14,108]}]},{"content":"Syntax","pos":[1154,1160]},{"content":"Parameters","pos":[1262,1272]},{"content":"Your class.","pos":[1283,1294]},{"content":"derives from <bpt id=\"p1\">[</bpt>CComClassFactory<ept id=\"p1\">](../../atl/reference/ccomclassfactory-class.md)</ept> and uses <bpt id=\"p2\">[</bpt>CComObjectGlobal<ept id=\"p2\">](../../atl/reference/ccomobjectglobal-class.md)</ept> to construct a single object.","pos":[1329,1512],"source":" derives from [CComClassFactory](../../atl/reference/ccomclassfactory-class.md) and uses [CComObjectGlobal](../../atl/reference/ccomobjectglobal-class.md) to construct a single object."},{"content":"Each call to the <ph id=\"ph1\">`CreateInstance`</ph> method simply queries this object for an interface pointer.","pos":[1513,1606],"source":" Each call to the `CreateInstance` method simply queries this object for an interface pointer."},{"content":"Members","pos":[1615,1622]},{"content":"Public Methods","pos":[1632,1646]},{"content":"Name","pos":[1653,1657]},{"content":"Description","pos":[1658,1669]},{"content":"CComClassFactorySingleton::CreateInstance","pos":[1708,1749]},{"pos":[1795,1838],"content":"Queries <ph id=\"ph1\">`m_spObj`</ph> for an interface pointer.","source":"Queries `m_spObj` for an interface pointer."},{"content":"Public Data Members","pos":[1849,1868]},{"content":"Name","pos":[1875,1879]},{"content":"Description","pos":[1880,1891]},{"content":"CComClassFactorySingleton::m_spObj","pos":[1930,1964]},{"pos":[2003,2123],"content":"The <bpt id=\"p1\">[</bpt>CComObjectGlobal<ept id=\"p1\">](../../atl/reference/ccomobjectglobal-class.md)</ept> object constructed by <ph id=\"ph1\">`CComClassFactorySingleton`</ph>.","source":"The [CComObjectGlobal](../../atl/reference/ccomobjectglobal-class.md) object constructed by `CComClassFactorySingleton`."},{"content":"Remarks","pos":[2133,2140]},{"content":"ATL objects normally acquire a class factory by deriving from <bpt id=\"p1\">[</bpt>CComCoClass<ept id=\"p1\">](../../atl/reference/ccomcoclass-class.md)</ept>.","pos":[2144,2262],"source":"ATL objects normally acquire a class factory by deriving from [CComCoClass](../../atl/reference/ccomcoclass-class.md)."},{"content":"This class includes the macro <bpt id=\"p1\">[</bpt>DECLARE_CLASSFACTORY<ept id=\"p1\">](http://msdn.microsoft.com/library/51a6b925-07c0-4d3a-9174-0b8c808975e4)</ept>, which declares <ph id=\"ph1\">`CComClassFactory`</ph> as the default class factory.","pos":[2263,2452],"source":" This class includes the macro [DECLARE_CLASSFACTORY](http://msdn.microsoft.com/library/51a6b925-07c0-4d3a-9174-0b8c808975e4), which declares `CComClassFactory` as the default class factory."},{"content":"To use <ph id=\"ph1\">`CComClassFactorySingleton`</ph>, specify the <bpt id=\"p1\">[</bpt>DECLARE_CLASSFACTORY_SINGLETON<ept id=\"p1\">](http://msdn.microsoft.com/library/0e4a3964-c03d-463e-884c-fe3b416db478)</ept> macro in your object's class definition.","pos":[2453,2646],"source":" To use `CComClassFactorySingleton`, specify the [DECLARE_CLASSFACTORY_SINGLETON](http://msdn.microsoft.com/library/0e4a3964-c03d-463e-884c-fe3b416db478) macro in your object's class definition."},{"content":"For example:","pos":[2647,2659]},{"pos":[2677,2691],"content":"NVC_ATL_COM#10"},{"content":"Inheritance Hierarchy","pos":[2765,2786]},{"content":"CComObjectRootEx","pos":[2818,2834]},{"content":"CComClassFactory","pos":[2912,2928]},{"content":"Requirements","pos":[3019,3031]},{"pos":[3035,3055],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> atlcom.h","source":"**Header:** atlcom.h"},{"pos":[3123,3164],"content":"CComClassFactorySingleton::CreateInstance"},{"pos":[3168,3279],"content":"Calls <ph id=\"ph1\">`QueryInterface`</ph> through <bpt id=\"p1\">[</bpt>m_spObj<ept id=\"p1\">](#ccomclassfactorysingleton__m_spobj)</ept> to retrieve an interface pointer.","source":"Calls `QueryInterface` through [m_spObj](#ccomclassfactorysingleton__m_spobj) to retrieve an interface pointer."},{"content":"Parameters","pos":[3386,3396]},{"content":"[in] If the object is being created as part of an aggregate, then <ph id=\"ph1\">`pUnkOuter`</ph> must be the outer unknown.","pos":[3415,3519],"source":" [in] If the object is being created as part of an aggregate, then `pUnkOuter` must be the outer unknown."},{"content":"Otherwise, <ph id=\"ph1\">`pUnkOuter`</ph> must be <bpt id=\"p1\">**</bpt>NULL<ept id=\"p1\">**</ept>.","pos":[3520,3560],"source":" Otherwise, `pUnkOuter` must be **NULL**."},{"content":"[in] The IID of the requested interface.","pos":[3577,3617]},{"content":"If <ph id=\"ph1\">`pUnkOuter`</ph> is non- <bpt id=\"p1\">**</bpt>NULL<ept id=\"p1\">**</ept>, <ph id=\"ph2\">`riid`</ph> must be <bpt id=\"p2\">**</bpt>IID_IUnknown<ept id=\"p2\">**</ept>.","pos":[3618,3683],"source":" If `pUnkOuter` is non- **NULL**, `riid` must be **IID_IUnknown**."},{"content":"[out] A pointer to the interface pointer identified by <ph id=\"ph1\">`riid`</ph>.","pos":[3702,3764],"source":" [out] A pointer to the interface pointer identified by `riid`."},{"content":"If the object does not support this interface, <ph id=\"ph1\">`ppvObj`</ph> is set to <bpt id=\"p1\">**</bpt>NULL<ept id=\"p1\">**</ept>.","pos":[3765,3840],"source":" If the object does not support this interface, `ppvObj` is set to **NULL**."},{"content":"Return Value","pos":[3850,3862]},{"pos":[3866,3893],"content":"A standard <ph id=\"ph1\">`HRESULT`</ph> value.","source":"A standard `HRESULT` value."},{"pos":[3954,3988],"content":"CComClassFactorySingleton::m_spObj"},{"pos":[3992,4112],"content":"The <bpt id=\"p1\">[</bpt>CComObjectGlobal<ept id=\"p1\">](../../atl/reference/ccomobjectglobal-class.md)</ept> object constructed by <ph id=\"ph1\">`CComClassFactorySingleton`</ph>.","source":"The [CComObjectGlobal](../../atl/reference/ccomobjectglobal-class.md) object constructed by `CComClassFactorySingleton`."},{"content":"Remarks","pos":[4162,4169]},{"pos":[4173,4310],"content":"Each call to the <bpt id=\"p1\">[</bpt>CreateInstance<ept id=\"p1\">](#ccomclassfactorysingleton__createinstance)</ept> method simply queries this object for an interface pointer.","source":"Each call to the [CreateInstance](#ccomclassfactorysingleton__createinstance) method simply queries this object for an interface pointer."},{"content":"Note that the current form of <ph id=\"ph1\">`m_spObj`</ph> presents a breaking change from the way that <ph id=\"ph2\">`CComClassFactorySingleton`</ph> worked in previous versions of ATL.","pos":[4317,4465],"source":"Note that the current form of `m_spObj` presents a breaking change from the way that `CComClassFactorySingleton` worked in previous versions of ATL."},{"content":"In previous versions the <ph id=\"ph1\">`CComClassFactorySingleton`</ph> object was created at the same time as the class factory, during server initialization.","pos":[4466,4606],"source":" In previous versions the `CComClassFactorySingleton` object was created at the same time as the class factory, during server initialization."},{"content":"In Visual C++.NET 2003, the object is created lazily, on the first request.","pos":[4607,4682]},{"content":"This change could cause errors in programs that rely on early initialization.","pos":[4683,4760]},{"content":"See Also","pos":[4769,4777]},{"content":"IClassFactory","pos":[4782,4795]},{"content":"CComClassFactory2 Class","pos":[4862,4885]},{"content":"CComClassFactoryAutoThread Class","pos":[4940,4972]},{"content":"CComObjectRootEx Class","pos":[5036,5058]},{"content":"CComGlobalsThreadModel","pos":[5112,5134]},{"content":"Class Overview","pos":[5181,5195]}],"content":"---\ntitle: \"CComClassFactorySingleton Class | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\nf1_keywords: \n  - \"ATL.CComClassFactorySingleton\"\n  - \"ATL.CComClassFactorySingleton<T>\"\n  - \"ATL::CComClassFactorySingleton\"\n  - \"ATL::CComClassFactorySingleton<T>\"\n  - \"CComClassFactorySingleton\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CComClassFactorySingleton class\"\nms.assetid: debb983c-382b-487b-8d42-7ea26dc158b8\ncaps.latest.revision: 21\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# CComClassFactorySingleton Class\nThis class derives from [CComClassFactory](../../atl/reference/ccomclassfactory-class.md) and uses [CComObjectGlobal](../../atl/reference/ccomobjectglobal-class.md) to construct a single object.  \n  \n> [!IMPORTANT]\n>  This class and its members cannot be used in applications that execute in the Windows Runtime.  \n  \n## Syntax  \n  \n```\ntemplate<class T>  class CComClassFactorySingleton :  public CComClassFactory\n```  \n  \n#### Parameters  \n `T`  \n Your class.  \n  \n `CComClassFactorySingleton` derives from [CComClassFactory](../../atl/reference/ccomclassfactory-class.md) and uses [CComObjectGlobal](../../atl/reference/ccomobjectglobal-class.md) to construct a single object. Each call to the `CreateInstance` method simply queries this object for an interface pointer.  \n  \n## Members  \n  \n### Public Methods  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CComClassFactorySingleton::CreateInstance](#ccomclassfactorysingleton__createinstance)|Queries `m_spObj` for an interface pointer.|  \n  \n### Public Data Members  \n  \n|Name|Description|  \n|----------|-----------------|  \n|[CComClassFactorySingleton::m_spObj](#ccomclassfactorysingleton__m_spobj)|The [CComObjectGlobal](../../atl/reference/ccomobjectglobal-class.md) object constructed by `CComClassFactorySingleton`.|  \n  \n## Remarks  \n ATL objects normally acquire a class factory by deriving from [CComCoClass](../../atl/reference/ccomcoclass-class.md). This class includes the macro [DECLARE_CLASSFACTORY](http://msdn.microsoft.com/library/51a6b925-07c0-4d3a-9174-0b8c808975e4), which declares `CComClassFactory` as the default class factory. To use `CComClassFactorySingleton`, specify the [DECLARE_CLASSFACTORY_SINGLETON](http://msdn.microsoft.com/library/0e4a3964-c03d-463e-884c-fe3b416db478) macro in your object's class definition. For example:  \n  \n [!code-cpp[NVC_ATL_COM#10](../../atl/codesnippet/cpp/ccomclassfactorysingleton-class_1.h)]  \n  \n## Inheritance Hierarchy  \n `CComObjectRootBase`  \n  \n [CComObjectRootEx](../../atl/reference/ccomobjectrootex-class.md)  \n  \n `IClassFactory`  \n  \n [CComClassFactory](../../atl/reference/ccomclassfactory-class.md)  \n  \n `CComClassFactorySingleton`  \n  \n## Requirements  \n **Header:** atlcom.h  \n  \n##  <a name=\"ccomclassfactorysingleton__createinstance\"></a>  CComClassFactorySingleton::CreateInstance  \n Calls `QueryInterface` through [m_spObj](#ccomclassfactorysingleton__m_spobj) to retrieve an interface pointer.  \n  \n```\nSTDMETHOD(CreateInstance)(LPUNKNOWN pUnkOuter,\n    REFIID riid,\n    void** ppvObj);\n```  \n  \n### Parameters  \n `pUnkOuter`  \n [in] If the object is being created as part of an aggregate, then `pUnkOuter` must be the outer unknown. Otherwise, `pUnkOuter` must be **NULL**.  \n  \n `riid`  \n [in] The IID of the requested interface. If `pUnkOuter` is non- **NULL**, `riid` must be **IID_IUnknown**.  \n  \n `ppvObj`  \n [out] A pointer to the interface pointer identified by `riid`. If the object does not support this interface, `ppvObj` is set to **NULL**.  \n  \n### Return Value  \n A standard `HRESULT` value.  \n  \n##  <a name=\"ccomclassfactorysingleton__m_spobj\"></a>  CComClassFactorySingleton::m_spObj  \n The [CComObjectGlobal](../../atl/reference/ccomobjectglobal-class.md) object constructed by `CComClassFactorySingleton`.  \n  \n```\nCComPtr<IUnknown> m_spObj;\n```  \n  \n### Remarks  \n Each call to the [CreateInstance](#ccomclassfactorysingleton__createinstance) method simply queries this object for an interface pointer.  \n  \n Note that the current form of `m_spObj` presents a breaking change from the way that `CComClassFactorySingleton` worked in previous versions of ATL. In previous versions the `CComClassFactorySingleton` object was created at the same time as the class factory, during server initialization. In Visual C++.NET 2003, the object is created lazily, on the first request. This change could cause errors in programs that rely on early initialization.  \n  \n## See Also  \n [IClassFactory](http://msdn.microsoft.com/library/windows/desktop/ms694364)   \n [CComClassFactory2 Class](../../atl/reference/ccomclassfactory2-class.md)   \n [CComClassFactoryAutoThread Class](../../atl/reference/ccomclassfactoryautothread-class.md)   \n [CComObjectRootEx Class](../../atl/reference/ccomobjectrootex-class.md)   \n [CComGlobalsThreadModel](atl-typedefs.md#ccomglobalsthreadmodel)   \n [Class Overview](../../atl/atl-class-overview.md)\n"}