{"nodes":[{"pos":[12,87],"content":"MFC ActiveX Controls: Using Pictures in an ActiveX Control | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"MFC ActiveX Controls: Using Pictures in an ActiveX Control | Microsoft Docs","pos":[0,75]}]},{"content":"MFC ActiveX Controls: Using Pictures in an ActiveX Control","pos":[778,836]},{"content":"This article describes the common Picture type and how to implement it in your ActiveX control.","pos":[837,932]},{"content":"Topics include:","pos":[933,948]},{"content":"Overview of Custom Picture Properties","pos":[959,996]},{"content":"Implementing a Custom Picture Property in Your ActiveX Control","pos":[1054,1116]},{"content":"Additions to Your Control Project","pos":[1199,1232]},{"pos":[1344,1381],"content":"Overview of Custom Picture Properties"},{"content":"A Picture type is one of a group of types common to some ActiveX controls.","pos":[1385,1459]},{"content":"The Picture type handles metafiles, bitmaps, or icons and allows the user to specify a picture to be displayed in an ActiveX control.","pos":[1460,1593]},{"content":"Custom Picture properties are implemented using a picture object and Get/Set functions that allow the control user access to the Picture property.","pos":[1594,1740]},{"content":"Control users access the custom Picture property using the stock Picture property page.","pos":[1741,1828]},{"content":"In addition to the standard Picture type, Font and Color types are also available.","pos":[1835,1917]},{"content":"For more information on using the standard Font type in your ActiveX control, see the article <bpt id=\"p1\">[</bpt>MFC ActiveX Controls: Using Fonts<ept id=\"p1\">](../mfc/mfc-activex-controls-using-fonts.md)</ept>.","pos":[1918,2092],"source":" For more information on using the standard Font type in your ActiveX control, see the article [MFC ActiveX Controls: Using Fonts](../mfc/mfc-activex-controls-using-fonts.md)."},{"content":"The ActiveX control classes provide several components you can use to implement the Picture property within the control.","pos":[2099,2219]},{"content":"These components include:","pos":[2220,2245]},{"pos":[2255,2324],"content":"The <bpt id=\"p1\">[</bpt>CPictureHolder<ept id=\"p1\">](../mfc/reference/cpictureholder-class.md)</ept> class.","source":"The [CPictureHolder](../mfc/reference/cpictureholder-class.md) class."},{"content":"This class provides easy access to the picture object and functionality for the item displayed by the custom Picture property.","pos":[2335,2461]},{"pos":[2471,2556],"content":"Support for properties of type <bpt id=\"p1\">**</bpt>LPPICTUREDISP<ept id=\"p1\">**</ept>, implemented with Get/Set functions.","source":"Support for properties of type **LPPICTUREDISP**, implemented with Get/Set functions."},{"content":"Using Class View you can quickly add a custom property, or properties, that supports the Picture type.","pos":[2567,2669]},{"content":"For more information on adding ActiveX control properties with Class View, see the article <bpt id=\"p1\">[</bpt>MFC ActiveX Controls: Properties<ept id=\"p1\">](../mfc/mfc-activex-controls-properties.md)</ept>.","pos":[2670,2839],"source":" For more information on adding ActiveX control properties with Class View, see the article [MFC ActiveX Controls: Properties](../mfc/mfc-activex-controls-properties.md)."},{"content":"A property page that manipulates a control's Picture property or properties.","pos":[2849,2925]},{"content":"This property page is part of a group of stock property pages available to ActiveX controls.","pos":[2936,3028]},{"content":"For more information on ActiveX control property pages, see the article <bpt id=\"p1\">[</bpt>MFC ActiveX Controls: Using Stock Property Pages<ept id=\"p1\">](../mfc/mfc-activex-controls-using-stock-property-pages.md)</ept>","pos":[3029,3210],"source":" For more information on ActiveX control property pages, see the article [MFC ActiveX Controls: Using Stock Property Pages](../mfc/mfc-activex-controls-using-stock-property-pages.md)"},{"pos":[3304,3366],"content":"Implementing a Custom Picture Property in Your ActiveX Control"},{"content":"When you have completed the steps outlined in this section, the control can display pictures chosen by its user.","pos":[3370,3482]},{"content":"The user can change the displayed picture using a property page that shows the current picture and has a Browse button that allows the user to the select different pictures.","pos":[3483,3656]},{"content":"A custom Picture property is implemented using a process similar to that used for implementing other properties, the main difference being that the custom property must support a Picture type.","pos":[3663,3855]},{"content":"Because the item of the Picture property must be drawn by the ActiveX control, a number of additions and modifications must be made to the property before it can be fully implemented.","pos":[3856,4039]},{"content":"To implement a custom Picture property, you must do the following:","pos":[4046,4112]},{"pos":[4122,4199],"content":"<bpt id=\"p1\">[</bpt>Add code to your control project<ept id=\"p1\">](#_core_additions_to_your_control_project)</ept>.","source":"[Add code to your control project](#_core_additions_to_your_control_project)."},{"pos":[4210,4379],"content":"A standard Picture property page ID, a data member of type <ph id=\"ph1\">`CPictureHolder`</ph>, and a custom property of type <bpt id=\"p1\">**</bpt>LPPICTUREDISP<ept id=\"p1\">**</ept> with a Get/Set implementation must be added.","source":"A standard Picture property page ID, a data member of type `CPictureHolder`, and a custom property of type **LPPICTUREDISP** with a Get/Set implementation must be added."},{"pos":[4389,4484],"content":"<bpt id=\"p1\">[</bpt>Modify several functions in your control class<ept id=\"p1\">](#_core_modifications_to_your_control_project)</ept>.","source":"[Modify several functions in your control class](#_core_modifications_to_your_control_project)."},{"content":"These modifications will be made to several functions that are responsible for the drawing of your ActiveX control.","pos":[4495,4610]},{"pos":[4675,4708],"content":"Additions to Your Control Project"},{"pos":[4712,4884],"content":"To add the property page ID for the standard Picture property page, insert the following line after the <ph id=\"ph1\">`BEGIN_PROPPAGEIDS`</ph> macro in the control implementation file (.CPP):","source":"To add the property page ID for the standard Picture property page, insert the following line after the `BEGIN_PROPPAGEIDS` macro in the control implementation file (.CPP):"},{"pos":[4902,4917],"content":"NVC_MFC_AxPic#1"},{"content":"You must also increment the count parameter of your <ph id=\"ph1\">`BEGIN_PROPPAGEIDS`</ph> macro by one.","pos":[5014,5099],"source":"You must also increment the count parameter of your `BEGIN_PROPPAGEIDS` macro by one."},{"content":"The following line illustrates this:","pos":[5100,5136]},{"pos":[5154,5169],"content":"NVC_MFC_AxPic#2"},{"pos":[5266,5447],"content":"To add the <ph id=\"ph1\">`CPictureHolder`</ph> data member to the control class, insert the following line under the protected section of the control class declaration in the control header file (.H):","source":"To add the `CPictureHolder` data member to the control class, insert the following line under the protected section of the control class declaration in the control header file (.H):"},{"pos":[5465,5480],"content":"NVC_MFC_AxPic#3"},{"pos":[5575,5651],"content":"It is not necessary to name your data member <ph id=\"ph1\">`m_pic`</ph>; any name will suffice.","source":"It is not necessary to name your data member `m_pic`; any name will suffice."},{"content":"Next, add a custom property that supports a Picture type:","pos":[5658,5715]},{"content":"To add a custom picture property using the Add Property Wizard","pos":[5726,5788]},{"content":"Load your control's project.","pos":[5798,5826]},{"content":"In Class View, expand the library node of your control.","pos":[5836,5891]},{"content":"Right-click the interface node for your control (the second node of the library node) to open the shortcut menu.","pos":[5901,6013]},{"pos":[6023,6088],"content":"From the shortcut menu, choose <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> and then <bpt id=\"p2\">**</bpt>Add Property<ept id=\"p2\">**</ept>.","source":"From the shortcut menu, choose **Add** and then **Add Property**."},{"content":"In the <bpt id=\"p1\">**</bpt>Property Name<ept id=\"p1\">**</ept> box, type the property name.","pos":[6098,6151],"source":"In the **Property Name** box, type the property name."},{"content":"For example purposes, <ph id=\"ph1\">`ControlPicture`</ph> is used in this procedure.","pos":[6152,6217],"source":" For example purposes, `ControlPicture` is used in this procedure."},{"pos":[6227,6305],"content":"In the <bpt id=\"p1\">**</bpt>Property Type<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">**</bpt>IPictureDisp<ph id=\"ph1\">\\*</ph><ept id=\"p2\">**</ept> for the property type.","source":"In the **Property Type** box, select **IPictureDisp\\*** for the property type."},{"pos":[6315,6370],"content":"For <bpt id=\"p1\">**</bpt>Implementation Type<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Get/Set Methods<ept id=\"p2\">**</ept>.","source":"For **Implementation Type**, click **Get/Set Methods**."},{"content":"Type unique names for your Get and Set Functions or accept the default names.","pos":[6380,6457]},{"content":"(In this example, the default names <ph id=\"ph1\">`GetControlPicture`</ph> and <ph id=\"ph2\">`SetControlPicture`</ph> are used.)","pos":[6458,6548],"source":" (In this example, the default names `GetControlPicture` and `SetControlPicture` are used.)"},{"pos":[6557,6574],"content":"Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>.","source":"Click **Finish**."},{"content":"The Add Property Wizard adds the following code between the dispatch map comments in the control header (.H) file:","pos":[6581,6695]},{"pos":[6713,6728],"content":"NVC_MFC_AxPic#4"},{"content":"In addition, the following code was inserted in the dispatch map of the control implementation (.CPP) file:","pos":[6823,6930]},{"pos":[6948,6963],"content":"NVC_MFC_AxPic#5"},{"content":"The Add Property Wizard also adds the following two stub functions in the control implementation file:","pos":[7060,7162]},{"pos":[7180,7195],"content":"NVC_MFC_AxPic#6"},{"pos":[7293,7378],"content":"[!NOTE]\n Your control class and function names might differ from the example above.","leadings":["","> "],"nodes":[{"content":"Your control class and function names might differ from the example above.","pos":[9,83]}]},{"pos":[7448,7485],"content":"Modifications to Your Control Project"},{"content":"After you have made the necessary additions to your control project, you need to modify several functions that affect the rendering of your ActiveX control.","pos":[7489,7645]},{"content":"These functions, <ph id=\"ph1\">`OnResetState`</ph>, <ph id=\"ph2\">`OnDraw`</ph>, and the Get/Set functions of a custom Picture property, are located in the control implementation file.","pos":[7646,7792],"source":" These functions, `OnResetState`, `OnDraw`, and the Get/Set functions of a custom Picture property, are located in the control implementation file."},{"content":"(Note that in this example the control class is called <ph id=\"ph1\">`CSampleCtrl`</ph>, the <ph id=\"ph2\">`CPictureHolder`</ph> data member is called <ph id=\"ph3\">`m_pic`</ph>, and the custom picture property name is <ph id=\"ph4\">`ControlPicture`</ph>.)","pos":[7793,7973],"source":" (Note that in this example the control class is called `CSampleCtrl`, the `CPictureHolder` data member is called `m_pic`, and the custom picture property name is `ControlPicture`.)"},{"pos":[7980,8098],"content":"In the control <ph id=\"ph1\">`OnResetState`</ph> function, add the following optional line after the call to <ph id=\"ph2\">`COleControl::OnResetState`</ph>:","source":"In the control `OnResetState` function, add the following optional line after the call to `COleControl::OnResetState`:"},{"pos":[8116,8131],"content":"NVC_MFC_AxPic#7"},{"content":"This sets the control's picture to a blank picture.","pos":[8228,8279]},{"content":"To draw the picture properly, make a call to <bpt id=\"p1\">[</bpt>CPictureHolder::Render<ept id=\"p1\">](../mfc/reference/cpictureholder-class.md#cpictureholder__render)</ept> in the control <ph id=\"ph1\">`OnDraw`</ph> function.","pos":[8286,8454],"source":"To draw the picture properly, make a call to [CPictureHolder::Render](../mfc/reference/cpictureholder-class.md#cpictureholder__render) in the control `OnDraw` function."},{"content":"Modify your function to resemble the following example:","pos":[8455,8510]},{"pos":[8528,8543],"content":"NVC_MFC_AxPic#8"},{"content":"In the Get function of the control's custom picture property, add the following line:","pos":[8640,8725]},{"pos":[8743,8758],"content":"NVC_MFC_AxPic#9"},{"content":"In the Set function of the control's custom Picture property, add the following lines:","pos":[8855,8941]},{"pos":[8959,8975],"content":"NVC_MFC_AxPic#10"},{"content":"The picture property must be made persistent so that information added at design time will show up at run time.","pos":[9073,9184]},{"content":"Add the following line to the <ph id=\"ph1\">`COleControl`</ph>-derived class's <ph id=\"ph2\">`DoPropExchange`</ph> function:","pos":[9185,9271],"source":" Add the following line to the `COleControl`-derived class's `DoPropExchange` function:"},{"pos":[9289,9305],"content":"NVC_MFC_AxPic#11"},{"pos":[9404,9481],"content":"[!NOTE]\n Your class and function names might differ from the example above.","leadings":["","> "],"nodes":[{"content":"Your class and function names might differ from the example above.","pos":[9,75]}]},{"content":"After you complete the modifications, rebuild your project to incorporate the new functionality of the custom Picture property and use Test Container to test the new property.","pos":[9488,9663]},{"content":"See <bpt id=\"p1\">[</bpt>Testing Properties and Events with Test Container<ept id=\"p1\">](../mfc/testing-properties-and-events-with-test-container.md)</ept> for information on how to access the test container.","pos":[9664,9833],"source":" See [Testing Properties and Events with Test Container](../mfc/testing-properties-and-events-with-test-container.md) for information on how to access the test container."},{"content":"See Also","pos":[9842,9850]},{"content":"MFC ActiveX Controls","pos":[9855,9875]},{"content":"MFC ActiveX Controls: Using Fonts","pos":[9914,9947]},{"content":"MFC ActiveX Controls: Property Pages","pos":[9998,10034]}],"content":"---\ntitle: \"MFC ActiveX Controls: Using Pictures in an ActiveX Control | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"LPPICTUREDISP\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"OnDraw method, MFC ActiveX controls\"\n  - \"MFC ActiveX controls, pictures\"\n  - \"OnDraw method\"\n  - \"OnResetState method\"\n  - \"CLSID_CPicturePropPage\"\nms.assetid: 2e49735c-21b9-4442-bb3d-c82ef258eec9\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# MFC ActiveX Controls: Using Pictures in an ActiveX Control\nThis article describes the common Picture type and how to implement it in your ActiveX control. Topics include:  \n  \n-   [Overview of Custom Picture Properties](#_core_overview_of_custom_picture_properties)  \n  \n-   [Implementing a Custom Picture Property in Your ActiveX Control](#_core_implementing_a_custom_picture_property_in_your_activex_control)  \n  \n-   [Additions to Your Control Project](#_core_additions_to_your_control_project)  \n  \n##  <a name=\"_core_overview_of_custom_picture_properties\"></a> Overview of Custom Picture Properties  \n A Picture type is one of a group of types common to some ActiveX controls. The Picture type handles metafiles, bitmaps, or icons and allows the user to specify a picture to be displayed in an ActiveX control. Custom Picture properties are implemented using a picture object and Get/Set functions that allow the control user access to the Picture property. Control users access the custom Picture property using the stock Picture property page.  \n  \n In addition to the standard Picture type, Font and Color types are also available. For more information on using the standard Font type in your ActiveX control, see the article [MFC ActiveX Controls: Using Fonts](../mfc/mfc-activex-controls-using-fonts.md).  \n  \n The ActiveX control classes provide several components you can use to implement the Picture property within the control. These components include:  \n  \n-   The [CPictureHolder](../mfc/reference/cpictureholder-class.md) class.  \n  \n     This class provides easy access to the picture object and functionality for the item displayed by the custom Picture property.  \n  \n-   Support for properties of type **LPPICTUREDISP**, implemented with Get/Set functions.  \n  \n     Using Class View you can quickly add a custom property, or properties, that supports the Picture type. For more information on adding ActiveX control properties with Class View, see the article [MFC ActiveX Controls: Properties](../mfc/mfc-activex-controls-properties.md).  \n  \n-   A property page that manipulates a control's Picture property or properties.  \n  \n     This property page is part of a group of stock property pages available to ActiveX controls. For more information on ActiveX control property pages, see the article [MFC ActiveX Controls: Using Stock Property Pages](../mfc/mfc-activex-controls-using-stock-property-pages.md)  \n  \n##  <a name=\"_core_implementing_a_custom_picture_property_in_your_activex_control\"></a> Implementing a Custom Picture Property in Your ActiveX Control  \n When you have completed the steps outlined in this section, the control can display pictures chosen by its user. The user can change the displayed picture using a property page that shows the current picture and has a Browse button that allows the user to the select different pictures.  \n  \n A custom Picture property is implemented using a process similar to that used for implementing other properties, the main difference being that the custom property must support a Picture type. Because the item of the Picture property must be drawn by the ActiveX control, a number of additions and modifications must be made to the property before it can be fully implemented.  \n  \n To implement a custom Picture property, you must do the following:  \n  \n-   [Add code to your control project](#_core_additions_to_your_control_project).  \n  \n     A standard Picture property page ID, a data member of type `CPictureHolder`, and a custom property of type **LPPICTUREDISP** with a Get/Set implementation must be added.  \n  \n-   [Modify several functions in your control class](#_core_modifications_to_your_control_project).  \n  \n     These modifications will be made to several functions that are responsible for the drawing of your ActiveX control.  \n  \n##  <a name=\"_core_additions_to_your_control_project\"></a> Additions to Your Control Project  \n To add the property page ID for the standard Picture property page, insert the following line after the `BEGIN_PROPPAGEIDS` macro in the control implementation file (.CPP):  \n  \n [!code-cpp[NVC_MFC_AxPic#1](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_1.cpp)]  \n  \n You must also increment the count parameter of your `BEGIN_PROPPAGEIDS` macro by one. The following line illustrates this:  \n  \n [!code-cpp[NVC_MFC_AxPic#2](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_2.cpp)]  \n  \n To add the `CPictureHolder` data member to the control class, insert the following line under the protected section of the control class declaration in the control header file (.H):  \n  \n [!code-cpp[NVC_MFC_AxPic#3](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_3.h)]  \n  \n It is not necessary to name your data member `m_pic`; any name will suffice.  \n  \n Next, add a custom property that supports a Picture type:  \n  \n#### To add a custom picture property using the Add Property Wizard  \n  \n1.  Load your control's project.  \n  \n2.  In Class View, expand the library node of your control.  \n  \n3.  Right-click the interface node for your control (the second node of the library node) to open the shortcut menu.  \n  \n4.  From the shortcut menu, choose **Add** and then **Add Property**.  \n  \n5.  In the **Property Name** box, type the property name. For example purposes, `ControlPicture` is used in this procedure.  \n  \n6.  In the **Property Type** box, select **IPictureDisp\\*** for the property type.  \n  \n7.  For **Implementation Type**, click **Get/Set Methods**.  \n  \n8.  Type unique names for your Get and Set Functions or accept the default names. (In this example, the default names `GetControlPicture` and `SetControlPicture` are used.)  \n  \n9. Click **Finish**.  \n  \n The Add Property Wizard adds the following code between the dispatch map comments in the control header (.H) file:  \n  \n [!code-cpp[NVC_MFC_AxPic#4](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_4.h)]  \n  \n In addition, the following code was inserted in the dispatch map of the control implementation (.CPP) file:  \n  \n [!code-cpp[NVC_MFC_AxPic#5](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_5.cpp)]  \n  \n The Add Property Wizard also adds the following two stub functions in the control implementation file:  \n  \n [!code-cpp[NVC_MFC_AxPic#6](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_6.cpp)]  \n  \n> [!NOTE]\n>  Your control class and function names might differ from the example above.  \n  \n###  <a name=\"_core_modifications_to_your_control_project\"></a> Modifications to Your Control Project  \n After you have made the necessary additions to your control project, you need to modify several functions that affect the rendering of your ActiveX control. These functions, `OnResetState`, `OnDraw`, and the Get/Set functions of a custom Picture property, are located in the control implementation file. (Note that in this example the control class is called `CSampleCtrl`, the `CPictureHolder` data member is called `m_pic`, and the custom picture property name is `ControlPicture`.)  \n  \n In the control `OnResetState` function, add the following optional line after the call to `COleControl::OnResetState`:  \n  \n [!code-cpp[NVC_MFC_AxPic#7](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_7.cpp)]  \n  \n This sets the control's picture to a blank picture.  \n  \n To draw the picture properly, make a call to [CPictureHolder::Render](../mfc/reference/cpictureholder-class.md#cpictureholder__render) in the control `OnDraw` function. Modify your function to resemble the following example:  \n  \n [!code-cpp[NVC_MFC_AxPic#8](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_8.cpp)]  \n  \n In the Get function of the control's custom picture property, add the following line:  \n  \n [!code-cpp[NVC_MFC_AxPic#9](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_9.cpp)]  \n  \n In the Set function of the control's custom Picture property, add the following lines:  \n  \n [!code-cpp[NVC_MFC_AxPic#10](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_10.cpp)]  \n  \n The picture property must be made persistent so that information added at design time will show up at run time. Add the following line to the `COleControl`-derived class's `DoPropExchange` function:  \n  \n [!code-cpp[NVC_MFC_AxPic#11](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_11.cpp)]  \n  \n> [!NOTE]\n>  Your class and function names might differ from the example above.  \n  \n After you complete the modifications, rebuild your project to incorporate the new functionality of the custom Picture property and use Test Container to test the new property. See [Testing Properties and Events with Test Container](../mfc/testing-properties-and-events-with-test-container.md) for information on how to access the test container.  \n  \n## See Also  \n [MFC ActiveX Controls](../mfc/mfc-activex-controls.md)   \n [MFC ActiveX Controls: Using Fonts](../mfc/mfc-activex-controls-using-fonts.md)   \n [MFC ActiveX Controls: Property Pages](../mfc/mfc-activex-controls-property-pages.md)\n\n"}