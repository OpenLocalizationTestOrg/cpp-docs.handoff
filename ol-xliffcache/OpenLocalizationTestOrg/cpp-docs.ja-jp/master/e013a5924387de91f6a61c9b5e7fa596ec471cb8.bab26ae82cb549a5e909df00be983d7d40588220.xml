{"nodes":[{"pos":[12,55],"content":"Print Preview Architecture | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Print Preview Architecture | Microsoft Docs","pos":[0,43]}]},{"content":"Print Preview Architecture","pos":[725,751]},{"content":"This article explains how the MFC framework implements print preview functionality.","pos":[752,835]},{"content":"Topics covered include:","pos":[836,859]},{"content":"Print preview process","pos":[870,891]},{"content":"Modifying print preview","pos":[937,960]},{"content":"Print preview is somewhat different from screen display and printing because, instead of directly drawing an image on a device, the application must simulate the printer using the screen.","pos":[1000,1187]},{"content":"To accommodate this, the Microsoft Foundation Class Library defines a special (undocumented) class derived from <bpt id=\"p1\">[</bpt>CDC Class<ept id=\"p1\">](../mfc/reference/cdc-class.md)</ept>, called <bpt id=\"p2\">**</bpt>CPreviewDC<ept id=\"p2\">**</ept>.","pos":[1188,1366],"source":" To accommodate this, the Microsoft Foundation Class Library defines a special (undocumented) class derived from [CDC Class](../mfc/reference/cdc-class.md), called **CPreviewDC**."},{"content":"All <ph id=\"ph1\">`CDC`</ph> objects contain two device contexts, but usually they are identical.","pos":[1367,1445],"source":" All `CDC` objects contain two device contexts, but usually they are identical."},{"content":"In a <bpt id=\"p1\">**</bpt>CPreviewDC<ept id=\"p1\">**</ept> object, they are different: the first represents the printer being simulated, and the second represents the screen on which output is actually displayed.","pos":[1446,1619],"source":" In a **CPreviewDC** object, they are different: the first represents the printer being simulated, and the second represents the screen on which output is actually displayed."},{"pos":[1676,1701],"content":"The Print Preview Process"},{"content":"When the user selects the Print Preview command from the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, the framework creates a <bpt id=\"p2\">**</bpt>CPreviewDC<ept id=\"p2\">**</ept> object.","pos":[1705,1823],"source":"When the user selects the Print Preview command from the **File** menu, the framework creates a **CPreviewDC** object."},{"content":"Whenever your application performs an operation that sets a characteristic of the printer device context, the framework also performs a similar operation on the screen device context.","pos":[1824,2007]},{"content":"For example, if your application selects a font for printing, the framework selects a font for screen display that simulates the printer font.","pos":[2008,2150]},{"content":"Whenever your application would send output to the printer, the framework instead sends the output to the screen.","pos":[2151,2264]},{"content":"Print preview also differs from printing in the order that each draws the pages of a document.","pos":[2271,2365]},{"content":"During printing, the framework continues a print loop until a certain range of pages has been rendered.","pos":[2366,2469]},{"content":"During print preview, one or two pages are displayed at any time, and then the application waits; no further pages are displayed until the user responds.","pos":[2470,2623]},{"content":"During print preview, the application must also respond to <ph id=\"ph1\">`WM_PAINT`</ph> messages, just as it does during ordinary screen display.","pos":[2624,2751],"source":" During print preview, the application must also respond to `WM_PAINT` messages, just as it does during ordinary screen display."},{"content":"The <bpt id=\"p1\">[</bpt>CView::OnPreparePrinting<ept id=\"p1\">](../mfc/reference/cview-class.md#cview__onprepareprinting)</ept> function is called when preview mode is invoked, just as it is at the beginning of a print job.","pos":[2758,2942],"source":"The [CView::OnPreparePrinting](../mfc/reference/cview-class.md#cview__onprepareprinting) function is called when preview mode is invoked, just as it is at the beginning of a print job."},{"content":"The <bpt id=\"p1\">[</bpt>CPrintInfo Structure<ept id=\"p1\">](../mfc/reference/cprintinfo-structure.md)</ept> structure passed to the function contains several members whose values you can set to adjust certain characteristics of the print preview operation.","pos":[2943,3160],"source":" The [CPrintInfo Structure](../mfc/reference/cprintinfo-structure.md) structure passed to the function contains several members whose values you can set to adjust certain characteristics of the print preview operation."},{"content":"For example, you can set the <bpt id=\"p1\">**</bpt>m_nNumPreviewPages<ept id=\"p1\">**</ept> member to specify whether you want to preview the document in one-page or two-page mode.","pos":[3161,3301],"source":" For example, you can set the **m_nNumPreviewPages** member to specify whether you want to preview the document in one-page or two-page mode."},{"pos":[3356,3379],"content":"Modifying Print Preview"},{"content":"You can modify the behavior and appearance of print preview in a number of ways rather easily.","pos":[3383,3477]},{"content":"For example, you can, among other things:","pos":[3478,3519]},{"content":"Cause the print preview window to display a scroll bar for easy access to any page of the document.","pos":[3529,3628]},{"content":"Cause print preview to maintain the user's position in the document by beginning its display at the current page.","pos":[3638,3751]},{"content":"Cause different initialization to be performed for print preview and printing.","pos":[3761,3839]},{"content":"Cause print preview to display page numbers in your own formats.","pos":[3849,3913]},{"content":"If you know how long the document is and call <ph id=\"ph1\">`SetMaxPage`</ph> with the appropriate value, the framework can use this information in preview mode as well as during printing.","pos":[3920,4089],"source":"If you know how long the document is and call `SetMaxPage` with the appropriate value, the framework can use this information in preview mode as well as during printing."},{"content":"Once the framework knows the length of the document, it can provide the preview window with a scroll bar, allowing the user to page back and forth through the document in preview mode.","pos":[4090,4274]},{"content":"If you haven't set the length of the document, the framework cannot position the scroll box to indicate the current position, so the framework doesn't add a scroll bar.","pos":[4275,4443]},{"content":"In this case, the user must use the Next Page and Previous Page buttons on the preview window's control bar to page through the document.","pos":[4444,4581]},{"content":"For print preview, you may find it useful to assign a value to the <ph id=\"ph1\">`m_nCurPage`</ph> member of <ph id=\"ph2\">`CPrintInfo`</ph>, even though you would never do so for ordinary printing.","pos":[4588,4748],"source":"For print preview, you may find it useful to assign a value to the `m_nCurPage` member of `CPrintInfo`, even though you would never do so for ordinary printing."},{"content":"During ordinary printing, this member carries information from the framework to your view class.","pos":[4749,4845]},{"content":"This is how the framework tells the view which page should be printed.","pos":[4846,4916]},{"content":"By contrast, when print preview mode is started, the <ph id=\"ph1\">`m_nCurPage`</ph> member carries information in the opposite direction: from the view to the framework.","pos":[4923,5074],"source":"By contrast, when print preview mode is started, the `m_nCurPage` member carries information in the opposite direction: from the view to the framework."},{"content":"The framework uses the value of this member to determine which page should be previewed first.","pos":[5075,5169]},{"content":"The default value of this member is 1, so the first page of the document is displayed initially.","pos":[5170,5266]},{"content":"You can override <ph id=\"ph1\">`OnPreparePrinting`</ph> to set this member to the number of the page being viewed at the time the Print Preview command was invoked.","pos":[5267,5412],"source":" You can override `OnPreparePrinting` to set this member to the number of the page being viewed at the time the Print Preview command was invoked."},{"content":"This way, the application maintains the user's current position when moving from normal display mode to print preview mode.","pos":[5413,5536]},{"content":"Sometimes you may want <ph id=\"ph1\">`OnPreparePrinting`</ph> to perform different initialization depending on whether it is called for a print job or for print preview.","pos":[5543,5693],"source":"Sometimes you may want `OnPreparePrinting` to perform different initialization depending on whether it is called for a print job or for print preview."},{"content":"You can determine this by examining the <bpt id=\"p1\">**</bpt>m_bPreview<ept id=\"p1\">**</ept> member variable in the <ph id=\"ph1\">`CPrintInfo`</ph> structure.","pos":[5694,5795],"source":" You can determine this by examining the **m_bPreview** member variable in the `CPrintInfo` structure."},{"content":"This member is set to <bpt id=\"p1\">**</bpt>TRUE<ept id=\"p1\">**</ept> when print preview is invoked.","pos":[5796,5857],"source":" This member is set to **TRUE** when print preview is invoked."},{"content":"The <ph id=\"ph1\">`CPrintInfo`</ph> structure also contains a member named <bpt id=\"p1\">**</bpt>m_strPageDesc<ept id=\"p1\">**</ept>, which is used to format the strings displayed at the bottom of the screen in single-page and multiple-page modes.","pos":[5864,6052],"source":"The `CPrintInfo` structure also contains a member named **m_strPageDesc**, which is used to format the strings displayed at the bottom of the screen in single-page and multiple-page modes."},{"content":"By default these strings are of the form \"Page <bpt id=\"p1\">*</bpt>n<ept id=\"p1\">*</ept>\" and \"Pages <bpt id=\"p2\">*</bpt>n<ept id=\"p2\">*</ept><ph id=\"ph1\"> - </ph><bpt id=\"p3\">*</bpt>m<ept id=\"p3\">*</ept>,\" but you can modify <bpt id=\"p4\">**</bpt>m_strPageDesc<ept id=\"p4\">**</ept> from within <ph id=\"ph2\">`OnPreparePrinting`</ph> and set the strings to something more elaborate.","pos":[6053,6245],"source":" By default these strings are of the form \"Page *n*\" and \"Pages *n* - *m*,\" but you can modify **m_strPageDesc** from within `OnPreparePrinting` and set the strings to something more elaborate."},{"content":"See <bpt id=\"p1\">[</bpt>CPrintInfo Structure<ept id=\"p1\">](../mfc/reference/cprintinfo-structure.md)</ept> in the <bpt id=\"p2\">*</bpt>MFC Reference<ept id=\"p2\">*</ept> for more information.","pos":[6246,6359],"source":" See [CPrintInfo Structure](../mfc/reference/cprintinfo-structure.md) in the *MFC Reference* for more information."},{"content":"See Also","pos":[6368,6376]},{"content":"Printing and Print Preview","pos":[6381,6407]},{"content":"Printing","pos":[6452,6460]},{"content":"CView Class","pos":[6487,6498]},{"content":"CDC Class","pos":[6538,6547]}],"content":"---\ntitle: \"Print Preview Architecture | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"print preview, process\"\n  - \"previewing printing\"\n  - \"print preview, architecture\"\n  - \"printing [MFC], print preview\"\n  - \"print preview, modifications to MFC\"\nms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Print Preview Architecture\nThis article explains how the MFC framework implements print preview functionality. Topics covered include:  \n  \n-   [Print preview process](#_core_the_print_preview_process)  \n  \n-   [Modifying print preview](#_core_modifying_print_preview)  \n  \n Print preview is somewhat different from screen display and printing because, instead of directly drawing an image on a device, the application must simulate the printer using the screen. To accommodate this, the Microsoft Foundation Class Library defines a special (undocumented) class derived from [CDC Class](../mfc/reference/cdc-class.md), called **CPreviewDC**. All `CDC` objects contain two device contexts, but usually they are identical. In a **CPreviewDC** object, they are different: the first represents the printer being simulated, and the second represents the screen on which output is actually displayed.  \n  \n##  <a name=\"_core_the_print_preview_process\"></a> The Print Preview Process  \n When the user selects the Print Preview command from the **File** menu, the framework creates a **CPreviewDC** object. Whenever your application performs an operation that sets a characteristic of the printer device context, the framework also performs a similar operation on the screen device context. For example, if your application selects a font for printing, the framework selects a font for screen display that simulates the printer font. Whenever your application would send output to the printer, the framework instead sends the output to the screen.  \n  \n Print preview also differs from printing in the order that each draws the pages of a document. During printing, the framework continues a print loop until a certain range of pages has been rendered. During print preview, one or two pages are displayed at any time, and then the application waits; no further pages are displayed until the user responds. During print preview, the application must also respond to `WM_PAINT` messages, just as it does during ordinary screen display.  \n  \n The [CView::OnPreparePrinting](../mfc/reference/cview-class.md#cview__onprepareprinting) function is called when preview mode is invoked, just as it is at the beginning of a print job. The [CPrintInfo Structure](../mfc/reference/cprintinfo-structure.md) structure passed to the function contains several members whose values you can set to adjust certain characteristics of the print preview operation. For example, you can set the **m_nNumPreviewPages** member to specify whether you want to preview the document in one-page or two-page mode.  \n  \n##  <a name=\"_core_modifying_print_preview\"></a> Modifying Print Preview  \n You can modify the behavior and appearance of print preview in a number of ways rather easily. For example, you can, among other things:  \n  \n-   Cause the print preview window to display a scroll bar for easy access to any page of the document.  \n  \n-   Cause print preview to maintain the user's position in the document by beginning its display at the current page.  \n  \n-   Cause different initialization to be performed for print preview and printing.  \n  \n-   Cause print preview to display page numbers in your own formats.  \n  \n If you know how long the document is and call `SetMaxPage` with the appropriate value, the framework can use this information in preview mode as well as during printing. Once the framework knows the length of the document, it can provide the preview window with a scroll bar, allowing the user to page back and forth through the document in preview mode. If you haven't set the length of the document, the framework cannot position the scroll box to indicate the current position, so the framework doesn't add a scroll bar. In this case, the user must use the Next Page and Previous Page buttons on the preview window's control bar to page through the document.  \n  \n For print preview, you may find it useful to assign a value to the `m_nCurPage` member of `CPrintInfo`, even though you would never do so for ordinary printing. During ordinary printing, this member carries information from the framework to your view class. This is how the framework tells the view which page should be printed.  \n  \n By contrast, when print preview mode is started, the `m_nCurPage` member carries information in the opposite direction: from the view to the framework. The framework uses the value of this member to determine which page should be previewed first. The default value of this member is 1, so the first page of the document is displayed initially. You can override `OnPreparePrinting` to set this member to the number of the page being viewed at the time the Print Preview command was invoked. This way, the application maintains the user's current position when moving from normal display mode to print preview mode.  \n  \n Sometimes you may want `OnPreparePrinting` to perform different initialization depending on whether it is called for a print job or for print preview. You can determine this by examining the **m_bPreview** member variable in the `CPrintInfo` structure. This member is set to **TRUE** when print preview is invoked.  \n  \n The `CPrintInfo` structure also contains a member named **m_strPageDesc**, which is used to format the strings displayed at the bottom of the screen in single-page and multiple-page modes. By default these strings are of the form \"Page *n*\" and \"Pages *n* - *m*,\" but you can modify **m_strPageDesc** from within `OnPreparePrinting` and set the strings to something more elaborate. See [CPrintInfo Structure](../mfc/reference/cprintinfo-structure.md) in the *MFC Reference* for more information.  \n  \n## See Also  \n [Printing and Print Preview](../mfc/printing-and-print-preview.md)   \n [Printing](../mfc/printing.md)   \n [CView Class](../mfc/reference/cview-class.md)   \n [CDC Class](../mfc/reference/cdc-class.md)\n"}