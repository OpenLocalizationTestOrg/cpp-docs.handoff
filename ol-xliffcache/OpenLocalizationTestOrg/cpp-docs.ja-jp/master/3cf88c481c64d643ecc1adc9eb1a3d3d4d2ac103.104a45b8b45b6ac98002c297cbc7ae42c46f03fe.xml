{"nodes":[{"pos":[12,57],"content":"Security Features in the CRT | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Security Features in the CRT | Microsoft Docs","pos":[0,45]}]},{"content":"Security Features in the CRT","pos":[1239,1267]},{"content":"Many old CRT functions have newer, more secure versions.","pos":[1268,1324]},{"content":"If a secure function exists, the older, less secure version is marked as deprecated and the new version has the <ph id=\"ph1\">`_s`</ph> (\"secure\") suffix.","pos":[1325,1460],"source":" If a secure function exists, the older, less secure version is marked as deprecated and the new version has the `_s` (\"secure\") suffix."},{"content":"In this context, \"deprecated\" just means that a function's use is not recommended; it does not indicate that the function is scheduled to be removed from the CRT.","pos":[1467,1629]},{"content":"The secure functions do not prevent or correct security errors; rather, they catch errors when they occur.","pos":[1636,1742]},{"content":"They perform additional checks for error conditions, and in the case of an error, they invoke an error handler (see <bpt id=\"p1\">[</bpt>Parameter Validation<ept id=\"p1\">](../c-runtime-library/parameter-validation.md)</ept>).","pos":[1743,1929],"source":" They perform additional checks for error conditions, and in the case of an error, they invoke an error handler (see [Parameter Validation](../c-runtime-library/parameter-validation.md))."},{"content":"For example, the <ph id=\"ph1\">`strcpy`</ph> function has no way of telling if the string that it is copying is too big for its destination buffer.","pos":[1936,2064],"source":"For example, the `strcpy` function has no way of telling if the string that it is copying is too big for its destination buffer."},{"content":"However, its secure counterpart, <ph id=\"ph1\">`strcpy_s`</ph>, takes the size of the buffer as a parameter, so it can determine if a buffer overrun will occur.","pos":[2065,2206],"source":" However, its secure counterpart, `strcpy_s`, takes the size of the buffer as a parameter, so it can determine if a buffer overrun will occur."},{"content":"If you use <ph id=\"ph1\">`strcpy_s`</ph> to copy eleven characters into a ten-character buffer, that is an error on your part; <ph id=\"ph2\">`strcpy_s`</ph> cannot correct your mistake, but it can detect your error and inform you by invoking the invalid parameter handler.","pos":[2207,2441],"source":" If you use `strcpy_s` to copy eleven characters into a ten-character buffer, that is an error on your part; `strcpy_s` cannot correct your mistake, but it can detect your error and inform you by invoking the invalid parameter handler."},{"content":"Eliminating deprecation warnings","pos":[2450,2482]},{"content":"There are several ways to eliminate deprecation warnings for the older, less secure functions.","pos":[2486,2580]},{"content":"The simplest is simply to define <ph id=\"ph1\">`_CRT_SECURE_NO_WARNINGS`</ph> or use the <bpt id=\"p1\">[</bpt>warning<ept id=\"p1\">](../preprocessor/warning.md)</ept> pragma.","pos":[2581,2696],"source":" The simplest is simply to define `_CRT_SECURE_NO_WARNINGS` or use the [warning](../preprocessor/warning.md) pragma."},{"content":"Either will disable deprecation warnings, but of course the security issues that caused the warnings still exist.","pos":[2697,2810]},{"content":"It is far better to leave deprecation warnings enabled and take advantage of the new CRT security features.","pos":[2811,2918]},{"content":"In C++, the easiest way to do that is to use <bpt id=\"p1\">[</bpt>Secure Template Overloads<ept id=\"p1\">](../c-runtime-library/secure-template-overloads.md)</ept>, which in many cases will eliminate deprecation warnings by replacing calls to deprecated functions with calls to the new secure versions of those functions.","pos":[2925,3206],"source":"In C++, the easiest way to do that is to use [Secure Template Overloads](../c-runtime-library/secure-template-overloads.md), which in many cases will eliminate deprecation warnings by replacing calls to deprecated functions with calls to the new secure versions of those functions."},{"content":"For example, consider this deprecated call to <ph id=\"ph1\">`strcpy`</ph>:","pos":[3207,3262],"source":" For example, consider this deprecated call to `strcpy`:"},{"content":"Defining <ph id=\"ph1\">`_CRT_SECURE_CPP_OVERLOAD_STANDARD_NAMES`</ph> as 1 eliminates the warning by changing the <ph id=\"ph2\">`strcpy`</ph> call to <ph id=\"ph3\">`strcpy_s`</ph>, which prevents buffer overruns.","pos":[3352,3507],"source":"Defining `_CRT_SECURE_CPP_OVERLOAD_STANDARD_NAMES` as 1 eliminates the warning by changing the `strcpy` call to `strcpy_s`, which prevents buffer overruns."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Secure Template Overloads<ept id=\"p1\">](../c-runtime-library/secure-template-overloads.md)</ept>.","pos":[3508,3613],"source":" For more information, see [Secure Template Overloads](../c-runtime-library/secure-template-overloads.md)."},{"content":"For those deprecated functions without secure template overloads, you should definitely consider manually updating your code to use the secure versions.","pos":[3620,3772]},{"content":"Another source of deprecation warnings, unrelated to security, is the POSIX functions.","pos":[3779,3865]},{"content":"Replace POSIX function names with their standard equivalents (for example, change <bpt id=\"p1\">[</bpt>access<ept id=\"p1\">](../c-runtime-library/reference/access-crt.md)</ept> to <bpt id=\"p2\">[</bpt>_access<ept id=\"p2\">](../c-runtime-library/reference/access-waccess.md)</ept>), or disable POSIX-related deprecation warnings by defining <ph id=\"ph1\">`_CRT_NONSTDC_NO_WARNINGS`</ph>.","pos":[3866,4153],"source":" Replace POSIX function names with their standard equivalents (for example, change [access](../c-runtime-library/reference/access-crt.md) to [_access](../c-runtime-library/reference/access-waccess.md)), or disable POSIX-related deprecation warnings by defining `_CRT_NONSTDC_NO_WARNINGS`."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Deprecated CRT Functions<ept id=\"p1\">](http://msdn.microsoft.com/en-us/7e259932-c6c8-4c1a-9637-639e591681a5)</ept>.","pos":[4154,4277],"source":" For more information, see [Deprecated CRT Functions](http://msdn.microsoft.com/en-us/7e259932-c6c8-4c1a-9637-639e591681a5)."},{"content":"Additional Security Features","pos":[4286,4314]},{"content":"Some of the security features include the following:","pos":[4318,4370]},{"content":".","pos":[4402,4403]},{"content":"Parameters passed to CRT functions are validated, in both secure functions and in many preexisting versions of functions.","pos":[4404,4525]},{"content":"These validations include:","pos":[4526,4552]},{"pos":[4566,4617],"content":"Checking for <ph id=\"ph1\">`NULL`</ph> values passed to the functions.","source":"Checking for `NULL` values passed to the functions."},{"content":"Checking enumerated values for validity.","pos":[4631,4671]},{"content":"Checking that integral values are in valid ranges.","pos":[4685,4735]},{"pos":[4745,4840],"content":"For more information, see <bpt id=\"p1\">[</bpt>Parameter Validation<ept id=\"p1\">](../c-runtime-library/parameter-validation.md)</ept>.","source":"For more information, see [Parameter Validation](../c-runtime-library/parameter-validation.md)."},{"content":"A handler for invalid parameters is also accessible to the developer.","pos":[4850,4919]},{"content":"When an encountering an invalid parameter, instead of asserting and exiting the application, the CRT provides a way to check these problems with the <bpt id=\"p1\">[</bpt>_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler<ept id=\"p1\">](../c-runtime-library/reference/set-invalid-parameter-handler-set-thread-local-invalid-parameter-handler.md)</ept> function.","pos":[4920,5264],"source":" When an encountering an invalid parameter, instead of asserting and exiting the application, the CRT provides a way to check these problems with the [_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler](../c-runtime-library/reference/set-invalid-parameter-handler-set-thread-local-invalid-parameter-handler.md) function."},{"content":".","pos":[5289,5290]},{"content":"The secure functions require that the buffer size be passed to any function that writes to a buffer.","pos":[5291,5391]},{"content":"The secure versions validate that the buffer is large enough before writing to it, helping to avoid dangerous buffer overrun errors that could allow malicious code to execute.","pos":[5392,5567]},{"content":"These functions usually return an <ph id=\"ph1\">`errno`</ph> type of error code and invoke the invalid parameter handler if the size of the buffer is too small.","pos":[5568,5709],"source":" These functions usually return an `errno` type of error code and invoke the invalid parameter handler if the size of the buffer is too small."},{"content":"Functions that read from input buffers, such as <ph id=\"ph1\">`gets`</ph>, have secure versions that require you to specify a maximum size.","pos":[5710,5830],"source":" Functions that read from input buffers, such as `gets`, have secure versions that require you to specify a maximum size."},{"content":".","pos":[5858,5859]},{"content":"Some functions that left potentially non-terminated strings have secure versions which ensure that strings are properly null terminated.","pos":[5860,5996]},{"content":".","pos":[6032,6033]},{"content":"The secure functions return error codes with more error information than was available with the preexisting functions.","pos":[6034,6152]},{"content":"The secure functions and many of the preexisting functions now set <ph id=\"ph1\">`errno`</ph> and often return an <ph id=\"ph2\">`errno`</ph> code type as well, to provide better error reporting.","pos":[6153,6309],"source":" The secure functions and many of the preexisting functions now set `errno` and often return an `errno` code type as well, to provide better error reporting."},{"content":".","pos":[6340,6341]},{"content":"Secure file I/O APIs support secure file access in the default case.","pos":[6342,6410]},{"content":".","pos":[6438,6439]},{"content":"Secure process APIs enforce security policies and allow ACLs to be specified.","pos":[6440,6517]},{"content":".","pos":[6558,6559]},{"content":"Invalid strings are detected, for example, using incorrect type field characters in <ph id=\"ph1\">`printf`</ph> format strings.","pos":[6560,6668],"source":" Invalid strings are detected, for example, using incorrect type field characters in `printf` format strings."},{"content":"See Also","pos":[6677,6685]},{"content":"Parameter Validation","pos":[6690,6710]},{"content":"Secure Template Overloads","pos":[6763,6788]},{"content":"CRT Library Features","pos":[6846,6866]}],"content":"---\ntitle: \"Security Features in the CRT | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"_CRT_SECURE_NO_DEPRECATE\"\n  - \"_CRT_NONSTDC_NO_WARNINGS\"\n  - \"_CRT_SECURE_NO_WARNINGS\"\ndev_langs: \n  - \"C++\"\n  - \"C\"\nhelpviewer_keywords: \n  - \"security deprecation warnings [C++]\"\n  - \"CRT_NONSTDC_NO_DEPRECATE\"\n  - \"buffers [C++], buffer overruns\"\n  - \"deprecation warnings (security-related), disabling\"\n  - \"_CRT_NONSTDC_NO_WARNINGS\"\n  - \"security [CRT]\"\n  - \"_CRT_SECURE_NO_WARNINGS\"\n  - \"_CRT_NONSTDC_NO_DEPRECATE\"\n  - \"_CRT_SECURE_NO_DEPRECATE\"\n  - \"security-enhanced CRT\"\n  - \"CRT_SECURE_NO_WARNINGS\"\n  - \"CRT_SECURE_NO_DEPRECATE\"\n  - \"deprecation warnings (security-related)\"\n  - \"buffer overruns\"\n  - \"CRT_NONSTDC_NO_WARNINGS\"\n  - \"CRT, security enhancements\"\n  - \"parameters [C++], validation\"\nms.assetid: d9568b08-9514-49cd-b3dc-2454ded195a3\ncaps.latest.revision: 23\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Security Features in the CRT\nMany old CRT functions have newer, more secure versions. If a secure function exists, the older, less secure version is marked as deprecated and the new version has the `_s` (\"secure\") suffix.  \n  \n In this context, \"deprecated\" just means that a function's use is not recommended; it does not indicate that the function is scheduled to be removed from the CRT.  \n  \n The secure functions do not prevent or correct security errors; rather, they catch errors when they occur. They perform additional checks for error conditions, and in the case of an error, they invoke an error handler (see [Parameter Validation](../c-runtime-library/parameter-validation.md)).  \n  \n For example, the `strcpy` function has no way of telling if the string that it is copying is too big for its destination buffer. However, its secure counterpart, `strcpy_s`, takes the size of the buffer as a parameter, so it can determine if a buffer overrun will occur. If you use `strcpy_s` to copy eleven characters into a ten-character buffer, that is an error on your part; `strcpy_s` cannot correct your mistake, but it can detect your error and inform you by invoking the invalid parameter handler.  \n  \n## Eliminating deprecation warnings  \n There are several ways to eliminate deprecation warnings for the older, less secure functions. The simplest is simply to define `_CRT_SECURE_NO_WARNINGS` or use the [warning](../preprocessor/warning.md) pragma. Either will disable deprecation warnings, but of course the security issues that caused the warnings still exist. It is far better to leave deprecation warnings enabled and take advantage of the new CRT security features.  \n  \n In C++, the easiest way to do that is to use [Secure Template Overloads](../c-runtime-library/secure-template-overloads.md), which in many cases will eliminate deprecation warnings by replacing calls to deprecated functions with calls to the new secure versions of those functions. For example, consider this deprecated call to `strcpy`:  \n  \n```  \nchar szBuf[10];   \nstrcpy(szBuf, \"test\"); // warning: deprecated   \n```  \n  \n Defining `_CRT_SECURE_CPP_OVERLOAD_STANDARD_NAMES` as 1 eliminates the warning by changing the `strcpy` call to `strcpy_s`, which prevents buffer overruns. For more information, see [Secure Template Overloads](../c-runtime-library/secure-template-overloads.md).  \n  \n For those deprecated functions without secure template overloads, you should definitely consider manually updating your code to use the secure versions.  \n  \n Another source of deprecation warnings, unrelated to security, is the POSIX functions. Replace POSIX function names with their standard equivalents (for example, change [access](../c-runtime-library/reference/access-crt.md) to [_access](../c-runtime-library/reference/access-waccess.md)), or disable POSIX-related deprecation warnings by defining `_CRT_NONSTDC_NO_WARNINGS`. For more information, see [Deprecated CRT Functions](http://msdn.microsoft.com/en-us/7e259932-c6c8-4c1a-9637-639e591681a5).  \n  \n## Additional Security Features  \n Some of the security features include the following:  \n  \n-   `Parameter Validation`. Parameters passed to CRT functions are validated, in both secure functions and in many preexisting versions of functions. These validations include:  \n  \n    -   Checking for `NULL` values passed to the functions.  \n  \n    -   Checking enumerated values for validity.  \n  \n    -   Checking that integral values are in valid ranges.  \n  \n-   For more information, see [Parameter Validation](../c-runtime-library/parameter-validation.md).  \n  \n-   A handler for invalid parameters is also accessible to the developer. When an encountering an invalid parameter, instead of asserting and exiting the application, the CRT provides a way to check these problems with the [_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler](../c-runtime-library/reference/set-invalid-parameter-handler-set-thread-local-invalid-parameter-handler.md) function.  \n  \n-   `Sized Buffers`. The secure functions require that the buffer size be passed to any function that writes to a buffer. The secure versions validate that the buffer is large enough before writing to it, helping to avoid dangerous buffer overrun errors that could allow malicious code to execute. These functions usually return an `errno` type of error code and invoke the invalid parameter handler if the size of the buffer is too small. Functions that read from input buffers, such as `gets`, have secure versions that require you to specify a maximum size.  \n  \n-   `Null termination`. Some functions that left potentially non-terminated strings have secure versions which ensure that strings are properly null terminated.  \n  \n-   `Enhanced error reporting`. The secure functions return error codes with more error information than was available with the preexisting functions. The secure functions and many of the preexisting functions now set `errno` and often return an `errno` code type as well, to provide better error reporting.  \n  \n-   `Filesystem security`. Secure file I/O APIs support secure file access in the default case.  \n  \n-   `Windows security`. Secure process APIs enforce security policies and allow ACLs to be specified.  \n  \n-   `Format string syntax checking`. Invalid strings are detected, for example, using incorrect type field characters in `printf` format strings.  \n  \n## See Also  \n [Parameter Validation](../c-runtime-library/parameter-validation.md)   \n [Secure Template Overloads](../c-runtime-library/secure-template-overloads.md)   \n [CRT Library Features](../c-runtime-library/crt-library-features.md)"}