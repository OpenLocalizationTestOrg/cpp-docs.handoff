{"nodes":[{"pos":[12,61],"content":"ActiveX Controls on the Internet | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"ActiveX Controls on the Internet | Microsoft Docs","pos":[0,49]}]},{"content":"ActiveX Controls on the Internet","pos":[842,874]},{"content":"ActiveX controls are the updated version of the OLE control specification.","pos":[875,949]},{"content":"Controls are a primary architecture for developing programmable software components that can be used in a variety of different containers, including COM-aware Web browsers on the Internet.","pos":[950,1138]},{"content":"Any ActiveX control can be an Internet control and can add its functionality to an Active document or be part of a Web page.","pos":[1139,1263]},{"content":"Controls on a Web page can communicate with each other using scripting.","pos":[1264,1335]},{"content":"ActiveX controls are not limited to the Internet.","pos":[1342,1391]},{"content":"An ActiveX control can also be used in any container, as long as the control supports the interfaces required by that container.","pos":[1392,1520]},{"content":"ActiveX controls have several advantages, including:","pos":[1529,1581]},{"content":"Fewer required interfaces than previous OLE controls.","pos":[1593,1646]},{"content":"The ability to be windowless and always in-place active.","pos":[1656,1712]},{"content":"In order to be an ActiveX control, a control must:","pos":[1721,1771]},{"pos":[1783,1818],"content":"Support the <bpt id=\"p1\">**</bpt>IUnknown<ept id=\"p1\">**</ept> interface.","source":"Support the **IUnknown** interface."},{"content":"Be a COM object.","pos":[1828,1844]},{"pos":[1854,1911],"content":"Export <bpt id=\"p1\">**</bpt>DLLRegisterServer<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>DLLUnRegisterServer<ept id=\"p2\">**</ept>.","source":"Export **DLLRegisterServer** and **DLLUnRegisterServer**."},{"content":"Support additional interfaces as needed for functionality.","pos":[1921,1979]},{"content":"Making Your Existing Controls Internet-Friendly","pos":[1988,2035]},{"content":"Designing a control that will work well in an Internet environment requires consideration for the relatively low transmission rates on the Internet.","pos":[2039,2187]},{"content":"You can use your existing controls; however, there are steps you should take to make your code size smaller and to make your control properties download asynchronously.","pos":[2188,2356]},{"content":"To improve performance of your controls, follow these tips on efficiency considerations:","pos":[2363,2451]},{"pos":[2461,2589],"content":"Implement the techniques described in the article <bpt id=\"p1\">[</bpt>ActiveX Controls: Optimization<ept id=\"p1\">](../mfc/mfc-activex-controls-optimization.md)</ept>.","source":"Implement the techniques described in the article [ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md)."},{"content":"Consider how a control is instantiated.","pos":[2599,2638]},{"content":"Be asynchronous; don't hold up other programs.","pos":[2648,2694]},{"content":"Download data in small blocks.","pos":[2704,2734]},{"content":"When downloading large streams such as bitmaps or video data, access a control's data asynchronously in cooperation with the container.","pos":[2745,2880]},{"content":"Retrieve the data in an incremental or progressive fashion, working cooperatively with other controls that may also be retrieving data.","pos":[2881,3016]},{"content":"Code can also be downloading asynchronously.","pos":[3017,3061]},{"content":"Download code and properties in the background.","pos":[3071,3118]},{"content":"Become user-interface active as quickly as possible.","pos":[3128,3180]},{"content":"Consider how persistent data is stored, both properties and large data BLOBs (such as a bitmap image or video data).","pos":[3190,3306]},{"content":"Controls with significant amounts of persistent data, such as large bitmaps or AVI files, require careful attention to downloading method.","pos":[3317,3455]},{"content":"A document or page can become visible as soon as possible, and allow the user to interact with the page while controls retrieve data in the background.","pos":[3456,3607]},{"content":"Write efficient routines to keep code size and run time down.","pos":[3617,3678]},{"content":"Small button and label controls, with only a few bytes of persistent data, are suitable for use in the Internet environment and work well inside browsers.","pos":[3689,3843]},{"content":"Consider progress is communicated to the container.","pos":[3853,3904]},{"content":"Notify the container of progress in the asynchronous download, including when the user can start to interact with a page, and when the download is complete.","pos":[3915,4071]},{"content":"The container can display progress (such as percent complete) to the user.","pos":[4072,4146]},{"content":"Consider how controls are registered on the client computer.","pos":[4156,4216]},{"content":"Creating a New ActiveX Control","pos":[4225,4255]},{"content":"When creating a new control using the Application Wizard, you can choose to enable support for asynchronous monikers as well as other optimizations.","pos":[4259,4407]},{"content":"To add support to download control properties asynchronously, follow these steps:","pos":[4408,4489]},{"content":"To create your project using the MFC ActiveX Control Wizard","pos":[4500,4559]},{"pos":[4569,4602],"content":"Click <ph id=\"ph1\">`New`</ph> on the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu.","source":"Click `New` on the **File** menu."},{"pos":[4612,4701],"content":"Select <bpt id=\"p1\">**</bpt>MFC ActiveX Control Wizard<ept id=\"p1\">**</ept> from the Visual C++ projects and name your project.","source":"Select **MFC ActiveX Control Wizard** from the Visual C++ projects and name your project."},{"content":"On the <bpt id=\"p1\">**</bpt>Control Settings<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>Loads properties asynchronously<ept id=\"p2\">**</ept>.","pos":[4711,4788],"source":"On the **Control Settings** page, select **Loads properties asynchronously**."},{"content":"Selecting this option sets up the ready state property and the ready state changed event for you.","pos":[4789,4886]},{"pos":[4897,5073],"content":"You can also select other optimizations, such as <bpt id=\"p1\">**</bpt>Windowless activation<ept id=\"p1\">**</ept>, which is described in <bpt id=\"p2\">[</bpt>ActiveX Controls: Optimization<ept id=\"p2\">](../mfc/mfc-activex-controls-optimization.md)</ept>.","source":"You can also select other optimizations, such as **Windowless activation**, which is described in [ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md)."},{"pos":[5083,5123],"content":"Choose <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept> to create the project.","source":"Choose **Finish** to create the project."},{"content":"To create a class derived from CDataPathProperty","pos":[5134,5182]},{"pos":[5192,5240],"content":"Create a class derived from <ph id=\"ph1\">`CDataPathProperty`</ph>.","source":"Create a class derived from `CDataPathProperty`."},{"content":"In each of your source files that includes the header file for your control, add the header file for this class before it.","pos":[5250,5372]},{"content":"In this class, override <ph id=\"ph1\">`OnDataAvailable`</ph>.","pos":[5382,5424],"source":"In this class, override `OnDataAvailable`."},{"content":"This function is called whenever data is available for display.","pos":[5425,5488]},{"content":"As data becomes available, you can handle it any way you choose, for example by progressively rendering it.","pos":[5489,5596]},{"content":"The code excerpt below is a simple example of progressively displaying data in an edit control.","pos":[5607,5702]},{"content":"Note the use of flag <bpt id=\"p1\">**</bpt>BSCF_FIRSTDATANOTIFICATION<ept id=\"p1\">**</ept> to clear the edit control.","pos":[5703,5781],"source":" Note the use of flag **BSCF_FIRSTDATANOTIFICATION** to clear the edit control."},{"pos":[5803,5826],"content":"NVC_MFCActiveXControl#1"},{"pos":[5902,5967],"content":"Note that you must include AFXCMN.H to use the <ph id=\"ph1\">`CListCtrl`</ph> class.","source":"Note that you must include AFXCMN.H to use the `CListCtrl` class."},{"content":"When your control's overall state changes (for example, from loading to initialized or user interactive), call <ph id=\"ph1\">`COleControl::InternalSetReadyState`</ph>.","pos":[5977,6125],"source":"When your control's overall state changes (for example, from loading to initialized or user interactive), call `COleControl::InternalSetReadyState`."},{"content":"If your control has only one data path property, you can add code on <bpt id=\"p1\">**</bpt>BSCF_LASTDATANOTIFICATION<ept id=\"p1\">**</ept> to notify the container that your download is complete.","pos":[6126,6280],"source":" If your control has only one data path property, you can add code on **BSCF_LASTDATANOTIFICATION** to notify the container that your download is complete."},{"content":"For example:","pos":[6281,6293]},{"pos":[6315,6338],"content":"NVC_MFCActiveXControl#2"},{"content":"Override <ph id=\"ph1\">`OnProgress`</ph>.","pos":[6413,6435],"source":"Override `OnProgress`."},{"content":"In <ph id=\"ph1\">`OnProgress`</ph>, you are passed a number showing the maximum range and a number showing how far along the current download is.","pos":[6436,6562],"source":" In `OnProgress`, you are passed a number showing the maximum range and a number showing how far along the current download is."},{"content":"You can use these numbers to display status such as percent complete to the user.","pos":[6563,6644]},{"content":"The next procedure adds a property to the control to use the class just derived.","pos":[6651,6731]},{"content":"To add a property","pos":[6742,6759]},{"content":"In <bpt id=\"p1\">**</bpt>Class View<ept id=\"p1\">**</ept>, right-click the interface underneath the library node and select <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, then <bpt id=\"p3\">**</bpt>Add Property<ept id=\"p3\">**</ept>.","pos":[6769,6884],"source":"In **Class View**, right-click the interface underneath the library node and select **Add**, then **Add Property**."},{"content":"This will start the <bpt id=\"p1\">**</bpt>Add Property Wizard<ept id=\"p1\">**</ept>.","pos":[6885,6929],"source":" This will start the **Add Property Wizard**."},{"pos":[6939,7115],"content":"In the <bpt id=\"p1\">**</bpt>Add Property Wizard<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>Set/Get Methods<ept id=\"p2\">**</ept> radio button, type the <bpt id=\"p3\">**</bpt>Property Name<ept id=\"p3\">**</ept>, for example, EditControlText, and select BSTR as the <bpt id=\"p4\">**</bpt>Property type<ept id=\"p4\">**</ept>.","source":"In the **Add Property Wizard**, select the **Set/Get Methods** radio button, type the **Property Name**, for example, EditControlText, and select BSTR as the **Property type**."},{"pos":[7125,7142],"content":"Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>.","source":"Click **Finish**."},{"pos":[7152,7250],"content":"Declare a member variable of your <ph id=\"ph1\">`CDataPathProperty`</ph>-derived class to your ActiveX control class.","source":"Declare a member variable of your `CDataPathProperty`-derived class to your ActiveX control class."},{"pos":[7272,7295],"content":"NVC_MFCActiveXControl#3"},{"content":"Implement the <bpt id=\"p1\">**</bpt>Get/Set<ept id=\"p1\">**</ept> methods.","pos":[7368,7402],"source":"Implement the **Get/Set** methods."},{"content":"For <bpt id=\"p1\">**</bpt>Get<ept id=\"p1\">**</ept>, return the string.","pos":[7403,7434],"source":" For **Get**, return the string."},{"content":"For <ph id=\"ph1\">`Set`</ph>, load the property and call <ph id=\"ph2\">`SetModifiedFlag`</ph>.","pos":[7435,7491],"source":" For `Set`, load the property and call `SetModifiedFlag`."},{"pos":[7513,7536],"content":"NVC_MFCActiveXControl#4"},{"pos":[7611,7722],"content":"In <bpt id=\"p1\">[</bpt>DoPropExchange<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange)</ept>, add the following line:","source":"In [DoPropExchange](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange), add the following line:"},{"pos":[7744,7767],"content":"NVC_MFCActiveXControl#5"},{"pos":[7842,8001],"content":"Override <bpt id=\"p1\">[</bpt>ResetData<ept id=\"p1\">](../mfc/reference/cdatapathproperty-class.md#cdatapathproperty__resetdata)</ept> to notify the property to reset its control by adding this line:","source":"Override [ResetData](../mfc/reference/cdatapathproperty-class.md#cdatapathproperty__resetdata) to notify the property to reset its control by adding this line:"},{"pos":[8023,8046],"content":"NVC_MFCActiveXControl#6"},{"content":"Deciding Whether to Derive from CDataPathProperty or CCachedDataPathProperty","pos":[8120,8196]},{"content":"The previous example describes steps for deriving your control's property from <ph id=\"ph1\">`CDataPathProperty`</ph>.","pos":[8200,8299],"source":"The previous example describes steps for deriving your control's property from `CDataPathProperty`."},{"content":"This is a good choice if you are downloading real-time data that frequently changes, and for which you do not need to keep all the data, but only the current value.","pos":[8300,8464]},{"content":"An example is a stock ticker control.","pos":[8465,8502]},{"content":"You can also derive from <ph id=\"ph1\">`CCachedDataPathProperty`</ph>.","pos":[8509,8560],"source":"You can also derive from `CCachedDataPathProperty`."},{"content":"In this case, the downloaded data is cached in a memory file.","pos":[8561,8622]},{"content":"This is a good choice if you need to keep all the downloaded data — for example, a control that progressively renders a bitmap.","pos":[8623,8750]},{"content":"In this case, the class has a member variable containing your data:","pos":[8751,8818]},{"content":"In your ActiveX control class, you can use this memory mapped file in <ph id=\"ph1\">`OnDraw`</ph> to display the data.","pos":[8851,8950],"source":"In your ActiveX control class, you can use this memory mapped file in `OnDraw` to display the data."},{"content":"In your ActiveX control <ph id=\"ph1\">`CCachedDataPathProperty`</ph>-derived class, override the member function <ph id=\"ph2\">`OnDataAvailable`</ph> and invalidate the control, after calling the base class implementation.","pos":[8951,9135],"source":" In your ActiveX control `CCachedDataPathProperty`-derived class, override the member function `OnDataAvailable` and invalidate the control, after calling the base class implementation."},{"pos":[9153,9176],"content":"NVC_MFCActiveXControl#7"},{"content":"Downloading Data Asynchronously Using ActiveX Controls","pos":[9250,9304]},{"content":"Downloading data over a network should be done asynchronously.","pos":[9308,9370]},{"content":"The advantage of doing so is that if a large amount of data is transferred or if the connection is slow, the download process will not block other processes on the client.","pos":[9371,9542]},{"content":"Asynchronous monikers provide a way to download data asynchronously over a network.","pos":[9549,9632]},{"content":"A Read operation on an Asynchronous moniker returns immediately, even if the operation has not been completed.","pos":[9633,9743]},{"content":"For example, if only 10 bytes are available and Read is called asynchronously on a 1K file, Read does not block, but returns with the currently available 10 bytes.","pos":[9750,9913]},{"content":"You implement <bpt id=\"p1\">[</bpt>asynchronous monikers<ept id=\"p1\">](../mfc/asynchronous-monikers-on-the-internet.md)</ept> using the <ph id=\"ph1\">`CAsyncMonikerFile`</ph> class.","pos":[9920,10043],"source":"You implement [asynchronous monikers](../mfc/asynchronous-monikers-on-the-internet.md) using the `CAsyncMonikerFile` class."},{"content":"However, ActiveX controls can use the <ph id=\"ph1\">`CDataPathProperty`</ph> class, which is derived from <ph id=\"ph2\">`CAsyncMonikerFile`</ph>, to help implement asynchronous control properties.","pos":[10044,10202],"source":" However, ActiveX controls can use the `CDataPathProperty` class, which is derived from `CAsyncMonikerFile`, to help implement asynchronous control properties."},{"content":"The ASYNDOWN sample demonstrates how to set up an asynchronous loop using timers to read the data.","pos":[10209,10307]},{"content":"ASYNDOWN is described in detail in the Knowledge Base article \"HOWTO: AsyncDown Demonstrates Asynchronous Data Download\" (Q177244) and is available for download from the Microsoft Download Center.","pos":[10308,10504]},{"content":"(For more information about downloading files from the Microsoft Download Center, see the article \"How to Obtain Microsoft Support Files from Online Services\" (Q119591) in the Microsoft Knowledge Base.) You can find Knowledge Base articles on the MSDN Library CD-ROM or at <bpt id=\"p1\">[</bpt>http://support.microsoft.com/support<ept id=\"p1\">](http://support.microsoft.com/support)</ept>.","pos":[10505,10855],"source":" (For more information about downloading files from the Microsoft Download Center, see the article \"How to Obtain Microsoft Support Files from Online Services\" (Q119591) in the Microsoft Knowledge Base.) You can find Knowledge Base articles on the MSDN Library CD-ROM or at [http://support.microsoft.com/support](http://support.microsoft.com/support)."},{"content":"The basic technique used in ASYNDOWN is to set a timer in <bpt id=\"p1\">**</bpt>CDataPathProperty::OnDataAvailable<ept id=\"p1\">**</ept> to indicate when data is available.","pos":[10862,10994],"source":"The basic technique used in ASYNDOWN is to set a timer in **CDataPathProperty::OnDataAvailable** to indicate when data is available."},{"content":"When the timer message is received, the application reads in 128-byte blocks of data and fills an edit control.","pos":[10995,11106]},{"content":"If data is not available when the timer message is handled, the timer is turned off.","pos":[11107,11191]},{"content":"turns on the timer if more data arrives later.","pos":[11210,11256]},{"content":"Displaying a Control on a Web Page","pos":[11265,11299]},{"content":"Here is an example of an object tag and attributes for inserting a control on a Web page.","pos":[11303,11392]},{"content":"Updating an Existing OLE Control to Use New ActiveX Control Features","pos":[11832,11900]},{"content":"If your OLE control was created with a version of Visual C++ prior to 4.2, there are steps you can take to improve its performance and enhance its functionality.","pos":[11904,12065]},{"content":"For a detailed discussion of these changes, see <bpt id=\"p1\">[</bpt>ActiveX Controls: Optimization<ept id=\"p1\">](../mfc/mfc-activex-controls-optimization.md)</ept>.","pos":[12066,12192],"source":" For a detailed discussion of these changes, see [ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md)."},{"content":"If you are adding asynchronous property support to an existing control, you will need to add the ready state property and the <ph id=\"ph1\">`ReadyStateChange`</ph> event yourself.","pos":[12199,12359],"source":"If you are adding asynchronous property support to an existing control, you will need to add the ready state property and the `ReadyStateChange` event yourself."},{"content":"In the constructor for your control, add:","pos":[12360,12401]},{"pos":[12419,12442],"content":"NVC_MFCActiveXControl#8"},{"content":"You will update the ready state as your code is downloaded by calling <bpt id=\"p1\">[</bpt>COleControl::InternalSetReadyState<ept id=\"p1\">](../mfc/reference/colecontrol-class.md#colecontrol__internalsetreadystate)</ept>.","pos":[12514,12695],"source":"You will update the ready state as your code is downloaded by calling [COleControl::InternalSetReadyState](../mfc/reference/colecontrol-class.md#colecontrol__internalsetreadystate)."},{"content":"One place you could call <ph id=\"ph1\">`InternalSetReadyState`</ph> is from the <ph id=\"ph2\">`OnProgress`</ph> override of <ph id=\"ph3\">`CDataPathProperty`</ph>-derived class.","pos":[12696,12816],"source":" One place you could call `InternalSetReadyState` is from the `OnProgress` override of `CDataPathProperty`-derived class."},{"content":"See Also","pos":[12829,12837]},{"content":"MFC Internet Programming Tasks","pos":[12842,12872]},{"content":"MFC Internet Programming Basics","pos":[12921,12952]}],"content":"---\ntitle: \"ActiveX Controls on the Internet | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"ActiveX controls [C++], creating\"\n  - \"ActiveX controls [C++], Internet\"\n  - \"downloading data with ActiveX controls\"\n  - \"OLE controls [C++], upgrading to ActiveX\"\n  - \"Internet applications [C++], ActiveX controls\"\n  - \"networks [C++], downloading with ActiveX controls\"\nms.assetid: 7ab943c8-2022-41df-9065-d629b616eeec\ncaps.latest.revision: 14\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# ActiveX Controls on the Internet\nActiveX controls are the updated version of the OLE control specification. Controls are a primary architecture for developing programmable software components that can be used in a variety of different containers, including COM-aware Web browsers on the Internet. Any ActiveX control can be an Internet control and can add its functionality to an Active document or be part of a Web page. Controls on a Web page can communicate with each other using scripting.  \n  \n ActiveX controls are not limited to the Internet. An ActiveX control can also be used in any container, as long as the control supports the interfaces required by that container.  \n  \n **ActiveX controls have several advantages, including:**  \n  \n-   Fewer required interfaces than previous OLE controls.  \n  \n-   The ability to be windowless and always in-place active.  \n  \n **In order to be an ActiveX control, a control must:**  \n  \n-   Support the **IUnknown** interface.  \n  \n-   Be a COM object.  \n  \n-   Export **DLLRegisterServer** and **DLLUnRegisterServer**.  \n  \n-   Support additional interfaces as needed for functionality.  \n  \n## Making Your Existing Controls Internet-Friendly  \n Designing a control that will work well in an Internet environment requires consideration for the relatively low transmission rates on the Internet. You can use your existing controls; however, there are steps you should take to make your code size smaller and to make your control properties download asynchronously.  \n  \n To improve performance of your controls, follow these tips on efficiency considerations:  \n  \n-   Implement the techniques described in the article [ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md).  \n  \n-   Consider how a control is instantiated.  \n  \n-   Be asynchronous; don't hold up other programs.  \n  \n-   Download data in small blocks.  \n  \n     When downloading large streams such as bitmaps or video data, access a control's data asynchronously in cooperation with the container. Retrieve the data in an incremental or progressive fashion, working cooperatively with other controls that may also be retrieving data. Code can also be downloading asynchronously.  \n  \n-   Download code and properties in the background.  \n  \n-   Become user-interface active as quickly as possible.  \n  \n-   Consider how persistent data is stored, both properties and large data BLOBs (such as a bitmap image or video data).  \n  \n     Controls with significant amounts of persistent data, such as large bitmaps or AVI files, require careful attention to downloading method. A document or page can become visible as soon as possible, and allow the user to interact with the page while controls retrieve data in the background.  \n  \n-   Write efficient routines to keep code size and run time down.  \n  \n     Small button and label controls, with only a few bytes of persistent data, are suitable for use in the Internet environment and work well inside browsers.  \n  \n-   Consider progress is communicated to the container.  \n  \n     Notify the container of progress in the asynchronous download, including when the user can start to interact with a page, and when the download is complete. The container can display progress (such as percent complete) to the user.  \n  \n-   Consider how controls are registered on the client computer.  \n  \n## Creating a New ActiveX Control  \n When creating a new control using the Application Wizard, you can choose to enable support for asynchronous monikers as well as other optimizations. To add support to download control properties asynchronously, follow these steps:  \n  \n#### To create your project using the MFC ActiveX Control Wizard  \n  \n1.  Click `New` on the **File** menu.  \n  \n2.  Select **MFC ActiveX Control Wizard** from the Visual C++ projects and name your project.  \n  \n3.  On the **Control Settings** page, select **Loads properties asynchronously**. Selecting this option sets up the ready state property and the ready state changed event for you.  \n  \n     You can also select other optimizations, such as **Windowless activation**, which is described in [ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md).  \n  \n4.  Choose **Finish** to create the project.  \n  \n#### To create a class derived from CDataPathProperty  \n  \n1.  Create a class derived from `CDataPathProperty`.  \n  \n2.  In each of your source files that includes the header file for your control, add the header file for this class before it.  \n  \n3.  In this class, override `OnDataAvailable`. This function is called whenever data is available for display. As data becomes available, you can handle it any way you choose, for example by progressively rendering it.  \n  \n     The code excerpt below is a simple example of progressively displaying data in an edit control. Note the use of flag **BSCF_FIRSTDATANOTIFICATION** to clear the edit control.  \n  \n     [!code-cpp[NVC_MFCActiveXControl#1](../mfc/codesnippet/cpp/activex-controls-on-the-internet_1.cpp)]  \n  \n     Note that you must include AFXCMN.H to use the `CListCtrl` class.  \n  \n4.  When your control's overall state changes (for example, from loading to initialized or user interactive), call `COleControl::InternalSetReadyState`. If your control has only one data path property, you can add code on **BSCF_LASTDATANOTIFICATION** to notify the container that your download is complete. For example:  \n  \n     [!code-cpp[NVC_MFCActiveXControl#2](../mfc/codesnippet/cpp/activex-controls-on-the-internet_2.cpp)]  \n  \n5.  Override `OnProgress`. In `OnProgress`, you are passed a number showing the maximum range and a number showing how far along the current download is. You can use these numbers to display status such as percent complete to the user.  \n  \n The next procedure adds a property to the control to use the class just derived.  \n  \n#### To add a property  \n  \n1.  In **Class View**, right-click the interface underneath the library node and select **Add**, then **Add Property**. This will start the **Add Property Wizard**.  \n  \n2.  In the **Add Property Wizard**, select the **Set/Get Methods** radio button, type the **Property Name**, for example, EditControlText, and select BSTR as the **Property type**.  \n  \n3.  Click **Finish**.  \n  \n4.  Declare a member variable of your `CDataPathProperty`-derived class to your ActiveX control class.  \n  \n     [!code-cpp[NVC_MFCActiveXControl#3](../mfc/codesnippet/cpp/activex-controls-on-the-internet_3.h)]  \n  \n5.  Implement the **Get/Set** methods. For **Get**, return the string. For `Set`, load the property and call `SetModifiedFlag`.  \n  \n     [!code-cpp[NVC_MFCActiveXControl#4](../mfc/codesnippet/cpp/activex-controls-on-the-internet_4.cpp)]  \n  \n6.  In [DoPropExchange](../mfc/reference/colecontrol-class.md#colecontrol__dopropexchange), add the following line:  \n  \n     [!code-cpp[NVC_MFCActiveXControl#5](../mfc/codesnippet/cpp/activex-controls-on-the-internet_5.cpp)]  \n  \n7.  Override [ResetData](../mfc/reference/cdatapathproperty-class.md#cdatapathproperty__resetdata) to notify the property to reset its control by adding this line:  \n  \n     [!code-cpp[NVC_MFCActiveXControl#6](../mfc/codesnippet/cpp/activex-controls-on-the-internet_6.cpp)]  \n  \n## Deciding Whether to Derive from CDataPathProperty or CCachedDataPathProperty  \n The previous example describes steps for deriving your control's property from `CDataPathProperty`. This is a good choice if you are downloading real-time data that frequently changes, and for which you do not need to keep all the data, but only the current value. An example is a stock ticker control.  \n  \n You can also derive from `CCachedDataPathProperty`. In this case, the downloaded data is cached in a memory file. This is a good choice if you need to keep all the downloaded data — for example, a control that progressively renders a bitmap. In this case, the class has a member variable containing your data:  \n  \n `CMemFile m_Cache;`  \n  \n In your ActiveX control class, you can use this memory mapped file in `OnDraw` to display the data. In your ActiveX control `CCachedDataPathProperty`-derived class, override the member function `OnDataAvailable` and invalidate the control, after calling the base class implementation.  \n  \n [!code-cpp[NVC_MFCActiveXControl#7](../mfc/codesnippet/cpp/activex-controls-on-the-internet_7.cpp)]  \n  \n## Downloading Data Asynchronously Using ActiveX Controls  \n Downloading data over a network should be done asynchronously. The advantage of doing so is that if a large amount of data is transferred or if the connection is slow, the download process will not block other processes on the client.  \n  \n Asynchronous monikers provide a way to download data asynchronously over a network. A Read operation on an Asynchronous moniker returns immediately, even if the operation has not been completed.  \n  \n For example, if only 10 bytes are available and Read is called asynchronously on a 1K file, Read does not block, but returns with the currently available 10 bytes.  \n  \n You implement [asynchronous monikers](../mfc/asynchronous-monikers-on-the-internet.md) using the `CAsyncMonikerFile` class. However, ActiveX controls can use the `CDataPathProperty` class, which is derived from `CAsyncMonikerFile`, to help implement asynchronous control properties.  \n  \n The ASYNDOWN sample demonstrates how to set up an asynchronous loop using timers to read the data. ASYNDOWN is described in detail in the Knowledge Base article \"HOWTO: AsyncDown Demonstrates Asynchronous Data Download\" (Q177244) and is available for download from the Microsoft Download Center. (For more information about downloading files from the Microsoft Download Center, see the article \"How to Obtain Microsoft Support Files from Online Services\" (Q119591) in the Microsoft Knowledge Base.) You can find Knowledge Base articles on the MSDN Library CD-ROM or at [http://support.microsoft.com/support](http://support.microsoft.com/support).  \n  \n The basic technique used in ASYNDOWN is to set a timer in **CDataPathProperty::OnDataAvailable** to indicate when data is available. When the timer message is received, the application reads in 128-byte blocks of data and fills an edit control. If data is not available when the timer message is handled, the timer is turned off. `OnDataAvailable` turns on the timer if more data arrives later.  \n  \n## Displaying a Control on a Web Page  \n Here is an example of an object tag and attributes for inserting a control on a Web page.  \n  \n `<OBJECT`  \n  \n `CLASSID=\"clsid:FC25B780-75BE-11CF-8B01-444553540000\"`  \n  \n `CODEBASE=\"/ie/download/activex/iechart.ocx\"`  \n  \n `ID=chart1`  \n  \n `WIDTH=400`  \n  \n `HEIGHT=200`  \n  \n `ALIGN=center`  \n  \n `HSPACE=0`  \n  \n `VSPACE=0`  \n  \n `>`  \n  \n `<PARAM NAME=\"BackColor\" value=\"#ffffff\">`  \n  \n `<PARAM NAME=\"ForeColor\" value=\"#0000ff\">`  \n  \n `<PARAM NAME=\"url\" VALUE=\"/ie/controls/chart/mychart.txt\">`  \n  \n `</OBJECT>`  \n  \n## Updating an Existing OLE Control to Use New ActiveX Control Features  \n If your OLE control was created with a version of Visual C++ prior to 4.2, there are steps you can take to improve its performance and enhance its functionality. For a detailed discussion of these changes, see [ActiveX Controls: Optimization](../mfc/mfc-activex-controls-optimization.md).  \n  \n If you are adding asynchronous property support to an existing control, you will need to add the ready state property and the `ReadyStateChange` event yourself. In the constructor for your control, add:  \n  \n [!code-cpp[NVC_MFCActiveXControl#8](../mfc/codesnippet/cpp/activex-controls-on-the-internet_8.cpp)]  \n  \n You will update the ready state as your code is downloaded by calling [COleControl::InternalSetReadyState](../mfc/reference/colecontrol-class.md#colecontrol__internalsetreadystate). One place you could call `InternalSetReadyState` is from the `OnProgress` override of `CDataPathProperty`-derived class.  \n  \n\n  \n## See Also  \n [MFC Internet Programming Tasks](../mfc/mfc-internet-programming-tasks.md)   \n [MFC Internet Programming Basics](../mfc/mfc-internet-programming-basics.md)\n\n"}