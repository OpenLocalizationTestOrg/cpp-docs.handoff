{"nodes":[{"pos":[12,67],"content":"Adding an Event (ATL Tutorial, Part 5) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Adding an Event (ATL Tutorial, Part 5) | Microsoft Docs","pos":[0,55]}]},{"content":"Adding an Event (ATL Tutorial, Part 5)","pos":[560,598]},{"content":"In this step, you will add a <ph id=\"ph1\">`ClickIn`</ph> and a <ph id=\"ph2\">`ClickOut`</ph> event to your ATL control.","pos":[599,681],"source":"In this step, you will add a `ClickIn` and a `ClickOut` event to your ATL control."},{"content":"You will fire the <ph id=\"ph1\">`ClickIn`</ph> event if the user clicks within the polygon and fire <ph id=\"ph2\">`ClickOut`</ph> if the user clicks outside.","pos":[682,801],"source":" You will fire the `ClickIn` event if the user clicks within the polygon and fire `ClickOut` if the user clicks outside."},{"content":"The tasks to add an event are as follows:","pos":[802,843]},{"pos":[853,896],"content":"Adding the <ph id=\"ph1\">`ClickIn`</ph> and <ph id=\"ph2\">`ClickOut`</ph> methods","source":"Adding the `ClickIn` and `ClickOut` methods"},{"content":"Generating the Type Library","pos":[906,933]},{"content":"Implementing the Connection Point Interfaces","pos":[943,987]},{"content":"Adding the ClickIn and ClickOut Methods","pos":[996,1035]},{"content":"When you created the ATL control in step 2, you selected the <bpt id=\"p1\">**</bpt>Connection points<ept id=\"p1\">**</ept> check box.","pos":[1039,1132],"source":"When you created the ATL control in step 2, you selected the **Connection points** check box."},{"content":"This created the <ph id=\"ph1\">`_IPolyCtlEvents`</ph> interface in the Polygon.idl file.","pos":[1133,1202],"source":" This created the `_IPolyCtlEvents` interface in the Polygon.idl file."},{"content":"Note that the interface name starts with an underscore.","pos":[1203,1258]},{"content":"This is a convention to indicate that the interface is an internal interface.","pos":[1259,1336]},{"content":"Thus, programs that allow you to browse COM objects can choose not to display the interface to the user.","pos":[1337,1441]},{"content":"Also note that selecting <bpt id=\"p1\">**</bpt>Connection points<ept id=\"p1\">**</ept> added the following line in the Polygon.idl file to indicate that <ph id=\"ph1\">`_IPolyCtlEvents`</ph> is the default source interface:","pos":[1442,1605],"source":" Also note that selecting **Connection points** added the following line in the Polygon.idl file to indicate that `_IPolyCtlEvents` is the default source interface:"},{"content":"The source attribute indicates that the control is the source of the notifications, so it will call this interface on the container.","pos":[1669,1801]},{"pos":[1808,1888],"content":"Now add the <ph id=\"ph1\">`ClickIn`</ph> and <ph id=\"ph2\">`ClickOut`</ph> methods to the <ph id=\"ph3\">`_IPolyCtlEvents`</ph> interface.","source":"Now add the `ClickIn` and `ClickOut` methods to the `_IPolyCtlEvents` interface."},{"content":"To add the ClickIn and ClickOut methods","pos":[1899,1938]},{"content":"In Class View, expand Polygon and PolygonLib to display _IPolyCtlEvents.","pos":[1948,2020]},{"content":"Right-click _IPolyCtlEvents.","pos":[2030,2058]},{"content":"On the shortcut menu, click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Add Method<ept id=\"p2\">**</ept>.","pos":[2059,2126],"source":" On the shortcut menu, click **Add**, and then click **Add Method**."},{"pos":[2136,2171],"content":"Select a <bpt id=\"p1\">**</bpt>Return Type<ept id=\"p1\">**</ept> of <ph id=\"ph1\">`void`</ph>.","source":"Select a **Return Type** of `void`."},{"pos":[2181,2224],"content":"Enter <ph id=\"ph1\">`ClickIn`</ph> in the <bpt id=\"p1\">**</bpt>Method name<ept id=\"p1\">**</ept> box.","source":"Enter `ClickIn` in the **Method name** box."},{"pos":[2234,2288],"content":"Under <bpt id=\"p1\">**</bpt>Parameter attributes<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>in<ept id=\"p2\">**</ept> box.","source":"Under **Parameter attributes**, select the **in** box."},{"pos":[2298,2336],"content":"Select a <bpt id=\"p1\">**</bpt>Parameter type<ept id=\"p1\">**</ept> of <ph id=\"ph1\">`LONG`</ph>.","source":"Select a **Parameter type** of `LONG`."},{"pos":[2346,2400],"content":"Type <ph id=\"ph1\">`x`</ph> as the <bpt id=\"p1\">**</bpt>Parameter name<ept id=\"p1\">**</ept>, and click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>.","source":"Type `x` as the **Parameter name**, and click **Add**."},{"pos":[2410,2478],"content":"Repeat steps 5 through 7, this time for a <bpt id=\"p1\">**</bpt>Parameter name<ept id=\"p1\">**</ept> of <ph id=\"ph1\">`y`</ph>.","source":"Repeat steps 5 through 7, this time for a **Parameter name** of `y`."},{"pos":[2487,2502],"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","source":"Click **Next**."},{"pos":[2512,2556],"content":"Type <ph id=\"ph1\">`method ClickIn`</ph> as the <bpt id=\"p1\">**</bpt>helpstring<ept id=\"p1\">**</ept>.","source":"Type `method ClickIn` as the **helpstring**."},{"pos":[2566,2583],"content":"Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>.","source":"Click **Finish**."},{"pos":[2593,2757],"content":"Repeat the steps above to define a <ph id=\"ph1\">`ClickOut`</ph> method with the same <ph id=\"ph2\">`LONG`</ph> parameters <ph id=\"ph3\">`x`</ph> and <ph id=\"ph4\">`y`</ph>, the same <bpt id=\"p1\">**</bpt>Parameter attributes<ept id=\"p1\">**</ept> and the same <ph id=\"ph5\">`void`</ph> return type.","source":"Repeat the steps above to define a `ClickOut` method with the same `LONG` parameters `x` and `y`, the same **Parameter attributes** and the same `void` return type."},{"pos":[2764,2861],"content":"Check the Polygon.idl file to see that the code was added to the <ph id=\"ph1\">`_IPolyCtlEvents`</ph> dispinterface.","source":"Check the Polygon.idl file to see that the code was added to the `_IPolyCtlEvents` dispinterface."},{"pos":[2868,2955],"content":"The <ph id=\"ph1\">`_IPolyCtlEvents`</ph> dispinterface in your Polygon.idl file should now look like this:","source":"The `_IPolyCtlEvents` dispinterface in your Polygon.idl file should now look like this:"},{"pos":[2973,2993],"content":"NVC_ATL_Windowing#56"},{"pos":[3068,3169],"content":"The <ph id=\"ph1\">`ClickIn`</ph> and <ph id=\"ph2\">`ClickOut`</ph> methods take the x and y coordinates of the clicked point as parameters.","source":"The `ClickIn` and `ClickOut` methods take the x and y coordinates of the clicked point as parameters."},{"content":"Generating the Type Library","pos":[3178,3205]},{"content":"Generate the type library at this point, because the Connection Point Wizard will use it to obtain the information it needs to construct a connection point interface and a connection point container interface for your control.","pos":[3209,3435]},{"content":"To generate the type library","pos":[3446,3474]},{"content":"Rebuild your project.","pos":[3484,3505]},{"content":"-or-","pos":[3516,3520]},{"pos":[3530,3627],"content":"Right-click the Polygon.idl file in Solution Explorer and click <bpt id=\"p1\">**</bpt>Compile<ept id=\"p1\">**</ept> on the shortcut menu.","source":"Right-click the Polygon.idl file in Solution Explorer and click **Compile** on the shortcut menu."},{"content":"This will create the Polygon.tlb file, which is your type library.","pos":[3634,3700]},{"content":"The Polygon.tlb file is not visible from Solution Explorer, because it is a binary file and cannot be viewed or edited directly.","pos":[3701,3829]},{"content":"Implementing the Connection Point Interfaces","pos":[3838,3882]},{"content":"Implement a connection point interface and a connection point container interface for your control.","pos":[3886,3985]},{"content":"In COM, events are implemented through the mechanism of connection points.","pos":[3986,4060]},{"content":"To receive events from a COM object, a container establishes an advisory connection to the connection point that the COM object implements.","pos":[4061,4200]},{"content":"Because a COM object can have multiple connection points, the COM object also implements a connection point container interface.","pos":[4201,4329]},{"content":"Through this interface, the container can determine which connection points are supported.","pos":[4330,4420]},{"pos":[4427,4607],"content":"The interface that implements a connection point is called <ph id=\"ph1\">`IConnectionPoint`</ph>, and the interface that implements a connection point container is called <ph id=\"ph2\">`IConnectionPointContainer`</ph>.","source":"The interface that implements a connection point is called `IConnectionPoint`, and the interface that implements a connection point container is called `IConnectionPointContainer`."},{"content":"To help implement <ph id=\"ph1\">`IConnectionPoint`</ph>, you will use the Implement Connection Point Wizard.","pos":[4614,4703],"source":"To help implement `IConnectionPoint`, you will use the Implement Connection Point Wizard."},{"content":"This wizard generates the <ph id=\"ph1\">`IConnectionPoint`</ph> interface by reading your type library and implementing a function for each event that can be fired.","pos":[4704,4849],"source":" This wizard generates the `IConnectionPoint` interface by reading your type library and implementing a function for each event that can be fired."},{"content":"To use the Implement Connection Point Wizard","pos":[4860,4904]},{"pos":[4914,4988],"content":"In Class View, right-click your control's implementation class <ph id=\"ph1\">`CPolyCtl`</ph>.","source":"In Class View, right-click your control's implementation class `CPolyCtl`."},{"pos":[4998,5075],"content":"On the shortcut menu, click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Add Connection Point<ept id=\"p2\">**</ept>.","source":"On the shortcut menu, click **Add**, and then click **Add Connection Point**."},{"content":"Select <ph id=\"ph1\">`_IPolyCtlEvents`</ph> from the <bpt id=\"p1\">**</bpt>Source Interfaces<ept id=\"p1\">**</ept> list and double-click it to add it to the <bpt id=\"p2\">**</bpt>Implement connection points<ept id=\"p2\">**</ept> column.","pos":[5085,5222],"source":"Select `_IPolyCtlEvents` from the **Source Interfaces** list and double-click it to add it to the **Implement connection points** column."},{"content":"Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>.","pos":[5223,5240],"source":" Click **Finish**."},{"content":"A proxy class for the connection point will be generated, in this case,  <ph id=\"ph1\">`CProxy_IPolyCtlEvents`</ph>.","pos":[5241,5338],"source":" A proxy class for the connection point will be generated, in this case,  `CProxy_IPolyCtlEvents`."},{"content":"If you look at the generated _IPolyCtlEvents_CP.h file in Solution Explorer, you will see that it has a class called <ph id=\"ph1\">`CProxy_IPolyCtlEvents`</ph> that derives from <ph id=\"ph2\">`IConnectionPointImpl`</ph>.","pos":[5345,5527],"source":"If you look at the generated _IPolyCtlEvents_CP.h file in Solution Explorer, you will see that it has a class called `CProxy_IPolyCtlEvents` that derives from `IConnectionPointImpl`."},{"content":"_IPolyCtlEvents_CP.h also defines the two methods <ph id=\"ph1\">`Fire_ClickIn`</ph> and <ph id=\"ph2\">`Fire_ClickOut`</ph>, which take the two coordinate parameters.","pos":[5528,5655],"source":" _IPolyCtlEvents_CP.h also defines the two methods `Fire_ClickIn` and `Fire_ClickOut`, which take the two coordinate parameters."},{"content":"You call these methods when you want to fire an event from your control.","pos":[5656,5728]},{"content":"The wizard also added <ph id=\"ph1\">`CProxy_PolyEvents`</ph> and <ph id=\"ph2\">`IConnectionPointContainerImpl`</ph> to your control's multiple inheritance list.","pos":[5735,5857],"source":"The wizard also added `CProxy_PolyEvents` and `IConnectionPointContainerImpl` to your control's multiple inheritance list."},{"content":"The wizard also exposed <ph id=\"ph1\">`IConnectionPointContainer`</ph> for you by adding appropriate entries to the COM map.","pos":[5858,5963],"source":" The wizard also exposed `IConnectionPointContainer` for you by adding appropriate entries to the COM map."},{"content":"You are finished implementing the code to support events.","pos":[5970,6027]},{"content":"Now, add some code to fire the events at the appropriate moment.","pos":[6028,6092]},{"content":"Remember, you are going to fire a <ph id=\"ph1\">`ClickIn`</ph> or <ph id=\"ph2\">`ClickOut`</ph> event when the user clicks the left mouse button in the control.","pos":[6093,6215],"source":" Remember, you are going to fire a `ClickIn` or `ClickOut` event when the user clicks the left mouse button in the control."},{"content":"To find out when the user clicks the button, add a handler for the <ph id=\"ph1\">`WM_LBUTTONDOWN`</ph> message.","pos":[6216,6308],"source":" To find out when the user clicks the button, add a handler for the `WM_LBUTTONDOWN` message."},{"content":"To add a handler for the WM_LBUTTONDOWN message","pos":[6319,6366]},{"pos":[6376,6468],"content":"In Class View, right-click the CPolyCtl class and click <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> on the shortcut menu.","source":"In Class View, right-click the CPolyCtl class and click **Properties** on the shortcut menu."},{"pos":[6478,6594],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, click the <bpt id=\"p2\">**</bpt>Messages<ept id=\"p2\">**</ept> icon and then click <ph id=\"ph1\">`WM_LBUTTONDOWN`</ph> from the list on the left.","source":"In the **Properties** window, click the **Messages** icon and then click `WM_LBUTTONDOWN` from the list on the left."},{"content":"From the drop-down list that appears, click <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\&lt;</ph>Add&gt; OnLButtonDown<ept id=\"p1\">**</ept>.","pos":[6604,6673],"source":"From the drop-down list that appears, click **\\<Add> OnLButtonDown**."},{"content":"The <ph id=\"ph1\">`OnLButtonDown`</ph> handler declaration will be added to PolyCtl.h, and the handler implementation will be added to PolyCtl.cpp.","pos":[6674,6802],"source":" The `OnLButtonDown` handler declaration will be added to PolyCtl.h, and the handler implementation will be added to PolyCtl.cpp."},{"content":"Next, modify the handler.","pos":[6809,6834]},{"content":"To modify the OnLButtonDown method","pos":[6845,6879]},{"pos":[6889,7031],"content":"Change the code which comprises the <ph id=\"ph1\">`OnLButtonDown`</ph> method in PolyCtl.cpp (deleting any code placed by the wizard) so that it looks like this:","source":"Change the code which comprises the `OnLButtonDown` method in PolyCtl.cpp (deleting any code placed by the wizard) so that it looks like this:"},{"pos":[7053,7073],"content":"NVC_ATL_Windowing#57"},{"pos":[7148,7304],"content":"This code makes use of the points calculated in the <ph id=\"ph1\">`OnDraw`</ph> function to create a region that detects the user's mouse clicks with the call to <ph id=\"ph2\">`PtInRegion`</ph>.","source":"This code makes use of the points calculated in the `OnDraw` function to create a region that detects the user's mouse clicks with the call to `PtInRegion`."},{"content":"The <ph id=\"ph1\">`uMsg`</ph> parameter is the ID of the Windows message being handled.","pos":[7311,7379],"source":"The `uMsg` parameter is the ID of the Windows message being handled."},{"content":"This allows you to have one function that handles a range of messages.","pos":[7380,7450]},{"content":"The <ph id=\"ph1\">`wParam`</ph> and the <ph id=\"ph2\">`lParam`</ph> parameters are the standard values for the message being handled.","pos":[7451,7546],"source":" The `wParam` and the `lParam` parameters are the standard values for the message being handled."},{"content":"The parameter bHandled allows you to specify whether the function handled the message or not.","pos":[7547,7640]},{"content":"By default, the value is set to <ph id=\"ph1\">`TRUE`</ph> to indicate that the function handled the message, but you can set it to <ph id=\"ph2\">`FALSE`</ph>.","pos":[7641,7761],"source":" By default, the value is set to `TRUE` to indicate that the function handled the message, but you can set it to `FALSE`."},{"content":"This will cause ATL to continue looking for another message handler function to send the message to.","pos":[7762,7862]},{"content":"Building and Testing the Control","pos":[7871,7903]},{"content":"Now try out your events.","pos":[7907,7931]},{"content":"Build the control and start the ActiveX Control Test Container again.","pos":[7932,8001]},{"content":"This time, view the event log window.","pos":[8002,8039]},{"content":"To route events to the output window, click <bpt id=\"p1\">**</bpt>Logging<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Options<ept id=\"p2\">**</ept> menu and select <bpt id=\"p3\">**</bpt>Log to output window<ept id=\"p3\">**</ept>.","pos":[8040,8158],"source":" To route events to the output window, click **Logging** from the **Options** menu and select **Log to output window**."},{"content":"Insert the control and try clicking in the window.","pos":[8159,8209]},{"content":"Note that <ph id=\"ph1\">`ClickIn`</ph> is fired if you click within the filled polygon, and <ph id=\"ph2\">`ClickOut`</ph> is fired when you click outside of it.","pos":[8210,8332],"source":" Note that `ClickIn` is fired if you click within the filled polygon, and `ClickOut` is fired when you click outside of it."},{"content":"Next, you will add a property page.","pos":[8339,8374]},{"pos":[8381,8530],"content":"<bpt id=\"p1\">[</bpt>Back to Step 4<ept id=\"p1\">](../atl/changing-the-drawing-code-atl-tutorial-part-4.md)</ept> &amp;#124; <bpt id=\"p2\">[</bpt>On to Step 6<ept id=\"p2\">](../atl/adding-a-property-page-atl-tutorial-part-6.md)</ept>","source":"[Back to Step 4](../atl/changing-the-drawing-code-atl-tutorial-part-4.md) &#124; [On to Step 6](../atl/adding-a-property-page-atl-tutorial-part-6.md)"},{"content":"See Also","pos":[8539,8547]},{"content":"Tutorial","pos":[8552,8560]}],"content":"---\ntitle: \"Adding an Event (ATL Tutorial, Part 5) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"get-started-article\"\ndev_langs: \n  - \"C++\"\nms.assetid: 2de12022-3148-4ce3-8606-8a9d4274f0e9\ncaps.latest.revision: 13\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Adding an Event (ATL Tutorial, Part 5)\nIn this step, you will add a `ClickIn` and a `ClickOut` event to your ATL control. You will fire the `ClickIn` event if the user clicks within the polygon and fire `ClickOut` if the user clicks outside. The tasks to add an event are as follows:  \n  \n-   Adding the `ClickIn` and `ClickOut` methods  \n  \n-   Generating the Type Library  \n  \n-   Implementing the Connection Point Interfaces  \n  \n## Adding the ClickIn and ClickOut Methods  \n When you created the ATL control in step 2, you selected the **Connection points** check box. This created the `_IPolyCtlEvents` interface in the Polygon.idl file. Note that the interface name starts with an underscore. This is a convention to indicate that the interface is an internal interface. Thus, programs that allow you to browse COM objects can choose not to display the interface to the user. Also note that selecting **Connection points** added the following line in the Polygon.idl file to indicate that `_IPolyCtlEvents` is the default source interface:  \n  \n `[default, source] dispinterface _IPolyCtlEvents;`  \n  \n The source attribute indicates that the control is the source of the notifications, so it will call this interface on the container.  \n  \n Now add the `ClickIn` and `ClickOut` methods to the `_IPolyCtlEvents` interface.  \n  \n#### To add the ClickIn and ClickOut methods  \n  \n1.  In Class View, expand Polygon and PolygonLib to display _IPolyCtlEvents.  \n  \n2.  Right-click _IPolyCtlEvents. On the shortcut menu, click **Add**, and then click **Add Method**.  \n  \n3.  Select a **Return Type** of `void`.  \n  \n4.  Enter `ClickIn` in the **Method name** box.  \n  \n5.  Under **Parameter attributes**, select the **in** box.  \n  \n6.  Select a **Parameter type** of `LONG`.  \n  \n7.  Type `x` as the **Parameter name**, and click **Add**.  \n  \n8.  Repeat steps 5 through 7, this time for a **Parameter name** of `y`.  \n  \n9. Click **Next**.  \n  \n10. Type `method ClickIn` as the **helpstring**.  \n  \n11. Click **Finish**.  \n  \n12. Repeat the steps above to define a `ClickOut` method with the same `LONG` parameters `x` and `y`, the same **Parameter attributes** and the same `void` return type.  \n  \n Check the Polygon.idl file to see that the code was added to the `_IPolyCtlEvents` dispinterface.  \n  \n The `_IPolyCtlEvents` dispinterface in your Polygon.idl file should now look like this:  \n  \n [!code-cpp[NVC_ATL_Windowing#56](../atl/codesnippet/cpp/adding-an-event-atl-tutorial-part-5_1.idl)]  \n  \n The `ClickIn` and `ClickOut` methods take the x and y coordinates of the clicked point as parameters.  \n  \n## Generating the Type Library  \n Generate the type library at this point, because the Connection Point Wizard will use it to obtain the information it needs to construct a connection point interface and a connection point container interface for your control.  \n  \n#### To generate the type library  \n  \n1.  Rebuild your project.  \n  \n     -or-  \n  \n2.  Right-click the Polygon.idl file in Solution Explorer and click **Compile** on the shortcut menu.  \n  \n This will create the Polygon.tlb file, which is your type library. The Polygon.tlb file is not visible from Solution Explorer, because it is a binary file and cannot be viewed or edited directly.  \n  \n## Implementing the Connection Point Interfaces  \n Implement a connection point interface and a connection point container interface for your control. In COM, events are implemented through the mechanism of connection points. To receive events from a COM object, a container establishes an advisory connection to the connection point that the COM object implements. Because a COM object can have multiple connection points, the COM object also implements a connection point container interface. Through this interface, the container can determine which connection points are supported.  \n  \n The interface that implements a connection point is called `IConnectionPoint`, and the interface that implements a connection point container is called `IConnectionPointContainer`.  \n  \n To help implement `IConnectionPoint`, you will use the Implement Connection Point Wizard. This wizard generates the `IConnectionPoint` interface by reading your type library and implementing a function for each event that can be fired.  \n  \n#### To use the Implement Connection Point Wizard  \n  \n1.  In Class View, right-click your control's implementation class `CPolyCtl`.  \n  \n2.  On the shortcut menu, click **Add**, and then click **Add Connection Point**.  \n  \n3.  Select `_IPolyCtlEvents` from the **Source Interfaces** list and double-click it to add it to the **Implement connection points** column. Click **Finish**. A proxy class for the connection point will be generated, in this case,  `CProxy_IPolyCtlEvents`.  \n  \n If you look at the generated _IPolyCtlEvents_CP.h file in Solution Explorer, you will see that it has a class called `CProxy_IPolyCtlEvents` that derives from `IConnectionPointImpl`. _IPolyCtlEvents_CP.h also defines the two methods `Fire_ClickIn` and `Fire_ClickOut`, which take the two coordinate parameters. You call these methods when you want to fire an event from your control.  \n  \n The wizard also added `CProxy_PolyEvents` and `IConnectionPointContainerImpl` to your control's multiple inheritance list. The wizard also exposed `IConnectionPointContainer` for you by adding appropriate entries to the COM map.  \n  \n You are finished implementing the code to support events. Now, add some code to fire the events at the appropriate moment. Remember, you are going to fire a `ClickIn` or `ClickOut` event when the user clicks the left mouse button in the control. To find out when the user clicks the button, add a handler for the `WM_LBUTTONDOWN` message.  \n  \n#### To add a handler for the WM_LBUTTONDOWN message  \n  \n1.  In Class View, right-click the CPolyCtl class and click **Properties** on the shortcut menu.  \n  \n2.  In the **Properties** window, click the **Messages** icon and then click `WM_LBUTTONDOWN` from the list on the left.  \n  \n3.  From the drop-down list that appears, click **\\<Add> OnLButtonDown**. The `OnLButtonDown` handler declaration will be added to PolyCtl.h, and the handler implementation will be added to PolyCtl.cpp.  \n  \n Next, modify the handler.  \n  \n#### To modify the OnLButtonDown method  \n  \n1.  Change the code which comprises the `OnLButtonDown` method in PolyCtl.cpp (deleting any code placed by the wizard) so that it looks like this:  \n  \n     [!code-cpp[NVC_ATL_Windowing#57](../atl/codesnippet/cpp/adding-an-event-atl-tutorial-part-5_2.cpp)]  \n  \n This code makes use of the points calculated in the `OnDraw` function to create a region that detects the user's mouse clicks with the call to `PtInRegion`.  \n  \n The `uMsg` parameter is the ID of the Windows message being handled. This allows you to have one function that handles a range of messages. The `wParam` and the `lParam` parameters are the standard values for the message being handled. The parameter bHandled allows you to specify whether the function handled the message or not. By default, the value is set to `TRUE` to indicate that the function handled the message, but you can set it to `FALSE`. This will cause ATL to continue looking for another message handler function to send the message to.  \n  \n## Building and Testing the Control  \n Now try out your events. Build the control and start the ActiveX Control Test Container again. This time, view the event log window. To route events to the output window, click **Logging** from the **Options** menu and select **Log to output window**. Insert the control and try clicking in the window. Note that `ClickIn` is fired if you click within the filled polygon, and `ClickOut` is fired when you click outside of it.  \n  \n Next, you will add a property page.  \n  \n [Back to Step 4](../atl/changing-the-drawing-code-atl-tutorial-part-4.md) &#124; [On to Step 6](../atl/adding-a-property-page-atl-tutorial-part-6.md)  \n  \n## See Also  \n [Tutorial](../atl/active-template-library-atl-tutorial.md)\n\n"}