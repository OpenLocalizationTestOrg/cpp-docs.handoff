{"nodes":[{"pos":[12,62],"content":"Recordset: Locking Records (ODBC) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Recordset: Locking Records (ODBC) | Microsoft Docs","pos":[0,50]}]},{"content":"Recordset: Locking Records (ODBC)","pos":[795,828]},{"content":"This topic applies to the MFC ODBC classes.","pos":[829,872]},{"content":"This topic explains:","pos":[879,899]},{"pos":[909,981],"content":"<bpt id=\"p1\">[</bpt>The kinds of record locking available<ept id=\"p1\">](#_core_record.2d.locking_modes)</ept>.","source":"[The kinds of record locking available](#_core_record.2d.locking_modes)."},{"pos":[991,1088],"content":"<bpt id=\"p1\">[</bpt>How to lock records in your recordset during updates<ept id=\"p1\">](#_core_locking_records_in_your_recordset)</ept>.","source":"[How to lock records in your recordset during updates](#_core_locking_records_in_your_recordset)."},{"content":"When you use a recordset to update a record on the data source, your application can lock the record so no other user can update the record at the same time.","pos":[1095,1252]},{"content":"The state of a record updated by two users at the same time is undefined unless the system can guarantee that two users cannot update a record simultaneously.","pos":[1253,1411]},{"pos":[1419,1852],"content":"[!NOTE]\n This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you have implemented bulk row fetching, some of the information does not apply. For example, you cannot call the **Edit** and **Update** member functions. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","leadings":["","> "],"nodes":[{"content":" This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you have implemented bulk row fetching, some of the information does not apply. For example, you cannot call the **Edit** and **Update** member functions. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).","pos":[8,431],"nodes":[{"content":"This topic applies to objects derived from <ph id=\"ph1\">`CRecordset`</ph> in which bulk row fetching has not been implemented.","pos":[1,109],"source":" This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented."},{"content":"If you have implemented bulk row fetching, some of the information does not apply.","pos":[110,192]},{"content":"For example, you cannot call the <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept> member functions.","pos":[193,267],"source":" For example, you cannot call the **Edit** and **Update** member functions."},{"content":"For more information about bulk row fetching, see <bpt id=\"p1\">[</bpt>Recordset: Fetching Records in Bulk (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)</ept>.","pos":[268,423],"source":" For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)."}]}]},{"pos":[1907,1927],"content":"Record-Locking Modes"},{"pos":[1931,2055],"content":"The database classes provide two <bpt id=\"p1\">[</bpt>record-locking modes<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__setlockingmode)</ept>:","source":"The database classes provide two [record-locking modes](../../mfc/reference/crecordset-class.md#crecordset__setlockingmode):"},{"content":"Optimistic locking (the default)","pos":[2065,2097]},{"content":"Pessimistic locking","pos":[2107,2126]},{"content":"Updating a record occurs in three steps:","pos":[2133,2173]},{"pos":[2183,2303],"content":"You begin the operation by calling the <bpt id=\"p1\">[</bpt>Edit<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__edit)</ept> member function.","source":"You begin the operation by calling the [Edit](../../mfc/reference/crecordset-class.md#crecordset__edit) member function."},{"content":"You change the appropriate fields of the current record.","pos":[2313,2369]},{"pos":[2379,2536],"content":"You end the operation — and normally commit the update — by calling the <bpt id=\"p1\">[</bpt>Update<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__update)</ept> member function.","source":"You end the operation — and normally commit the update — by calling the [Update](../../mfc/reference/crecordset-class.md#crecordset__update) member function."},{"content":"Optimistic locking locks the record on the data source only during the <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> call.","pos":[2543,2630],"source":"Optimistic locking locks the record on the data source only during the **Update** call."},{"content":"If you use optimistic locking in a multiuser environment, the application should handle an <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> failure condition.","pos":[2631,2751],"source":" If you use optimistic locking in a multiuser environment, the application should handle an **Update** failure condition."},{"content":"Pessimistic locking locks the record as soon as you call <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> and does not release it until you call <bpt id=\"p2\">**</bpt>Update<ept id=\"p2\">**</ept> (failures are indicated through the <ph id=\"ph1\">`CDBException`</ph> mechanism, not by a value of <bpt id=\"p3\">**</bpt>FALSE<ept id=\"p3\">**</ept> returned by <bpt id=\"p4\">**</bpt>Update<ept id=\"p4\">**</ept>).","pos":[2752,2982],"source":" Pessimistic locking locks the record as soon as you call **Edit** and does not release it until you call **Update** (failures are indicated through the `CDBException` mechanism, not by a value of **FALSE** returned by **Update**)."},{"content":"Pessimistic locking has a potential performance penalty for other users, because concurrent access to the same record might have to wait until completion of your application's <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept> process.","pos":[2983,3178],"source":" Pessimistic locking has a potential performance penalty for other users, because concurrent access to the same record might have to wait until completion of your application's **Update** process."},{"pos":[3243,3276],"content":"Locking Records in Your Recordset"},{"pos":[3280,3438],"content":"If you want to change a recordset object's <bpt id=\"p1\">[</bpt>locking mode<ept id=\"p1\">](#_core_record.2d.locking_modes)</ept> from the default, you must change the mode before you call <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept>.","source":"If you want to change a recordset object's [locking mode](#_core_record.2d.locking_modes) from the default, you must change the mode before you call **Edit**."},{"content":"To change the current locking mode for your recordset","pos":[3449,3502]},{"pos":[3512,3699],"content":"Call the <bpt id=\"p1\">[</bpt>SetLockingMode<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__setlockingmode)</ept> member function, specifying either <bpt id=\"p2\">**</bpt>CRecordset::pessimistic<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>CRecordset::optimistic<ept id=\"p3\">**</ept>.","source":"Call the [SetLockingMode](../../mfc/reference/crecordset-class.md#crecordset__setlockingmode) member function, specifying either **CRecordset::pessimistic** or **CRecordset::optimistic**."},{"content":"The new locking mode remains in effect until you change it again or the recordset is closed.","pos":[3706,3798]},{"pos":[3806,3883],"content":"[!NOTE]\n Relatively few ODBC drivers currently support pessimistic locking.","leadings":["","> "],"nodes":[{"content":"Relatively few ODBC drivers currently support pessimistic locking.","pos":[9,75]}]},{"content":"See Also","pos":[3892,3900]},{"content":"Recordset (ODBC)","pos":[3905,3921]},{"content":"Recordset: Performing a Join (ODBC)","pos":[3963,3998]},{"content":"Recordset: Adding, Updating, and Deleting Records (ODBC)","pos":[4058,4114]}],"content":"---\ntitle: \"Recordset: Locking Records (ODBC) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"locks [C++], recordsets\"\n  - \"optimistic locking\"\n  - \"pessimistic locking in ODBC\"\n  - \"recordsets [C++], locking records\"\n  - \"optimistic locking, ODBC\"\n  - \"ODBC recordsets [C++], locking records\"\n  - \"data [C++], locking\"\nms.assetid: 8fe8fcfe-b55a-41a8-9136-94a7cd1e4806\ncaps.latest.revision: 8\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Recordset: Locking Records (ODBC)\nThis topic applies to the MFC ODBC classes.  \n  \n This topic explains:  \n  \n-   [The kinds of record locking available](#_core_record.2d.locking_modes).  \n  \n-   [How to lock records in your recordset during updates](#_core_locking_records_in_your_recordset).  \n  \n When you use a recordset to update a record on the data source, your application can lock the record so no other user can update the record at the same time. The state of a record updated by two users at the same time is undefined unless the system can guarantee that two users cannot update a record simultaneously.  \n  \n> [!NOTE]\n>  This topic applies to objects derived from `CRecordset` in which bulk row fetching has not been implemented. If you have implemented bulk row fetching, some of the information does not apply. For example, you cannot call the **Edit** and **Update** member functions. For more information about bulk row fetching, see [Recordset: Fetching Records in Bulk (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).  \n  \n##  <a name=\"_core_record.2d.locking_modes\"></a> Record-Locking Modes  \n The database classes provide two [record-locking modes](../../mfc/reference/crecordset-class.md#crecordset__setlockingmode):  \n  \n-   Optimistic locking (the default)  \n  \n-   Pessimistic locking  \n  \n Updating a record occurs in three steps:  \n  \n1.  You begin the operation by calling the [Edit](../../mfc/reference/crecordset-class.md#crecordset__edit) member function.  \n  \n2.  You change the appropriate fields of the current record.  \n  \n3.  You end the operation — and normally commit the update — by calling the [Update](../../mfc/reference/crecordset-class.md#crecordset__update) member function.  \n  \n Optimistic locking locks the record on the data source only during the **Update** call. If you use optimistic locking in a multiuser environment, the application should handle an **Update** failure condition. Pessimistic locking locks the record as soon as you call **Edit** and does not release it until you call **Update** (failures are indicated through the `CDBException` mechanism, not by a value of **FALSE** returned by **Update**). Pessimistic locking has a potential performance penalty for other users, because concurrent access to the same record might have to wait until completion of your application's **Update** process.  \n  \n##  <a name=\"_core_locking_records_in_your_recordset\"></a> Locking Records in Your Recordset  \n If you want to change a recordset object's [locking mode](#_core_record.2d.locking_modes) from the default, you must change the mode before you call **Edit**.  \n  \n#### To change the current locking mode for your recordset  \n  \n1.  Call the [SetLockingMode](../../mfc/reference/crecordset-class.md#crecordset__setlockingmode) member function, specifying either **CRecordset::pessimistic** or **CRecordset::optimistic**.  \n  \n The new locking mode remains in effect until you change it again or the recordset is closed.  \n  \n> [!NOTE]\n>  Relatively few ODBC drivers currently support pessimistic locking.  \n  \n## See Also  \n [Recordset (ODBC)](../../data/odbc/recordset-odbc.md)   \n [Recordset: Performing a Join (ODBC)](../../data/odbc/recordset-performing-a-join-odbc.md)   \n [Recordset: Adding, Updating, and Deleting Records (ODBC)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)"}