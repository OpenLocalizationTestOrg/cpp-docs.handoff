{"nodes":[{"pos":[12,79],"content":"How to: Complete Asynchronous Operations Using WRL | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Complete Asynchronous Operations Using WRL | Microsoft Docs","pos":[0,67]}]},{"content":"How to: Complete Asynchronous Operations Using WRL","pos":[562,612]},{"pos":[613,847],"content":"This document shows how to use the <ph id=\"ph1\">[!INCLUDE[cppwrl](../windows/includes/cppwrl_md.md)]</ph> (<ph id=\"ph2\">[!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)]</ph>) to start asynchronous operations and perform work when the operations complete.","source":"This document shows how to use the [!INCLUDE[cppwrl](../windows/includes/cppwrl_md.md)] ([!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)]) to start asynchronous operations and perform work when the operations complete."},{"content":"This document shows two examples.","pos":[854,887]},{"content":"The first example starts an asynchronous timer and waits for the timer to expire.","pos":[888,969]},{"content":"In this example, you specify the asynchronous action when you create the timer object.","pos":[970,1056]},{"content":"The second example runs a background worker thread.","pos":[1057,1108]},{"content":"This example shows how to work with a <ph id=\"ph1\">[!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]</ph> method that returns an <ph id=\"ph2\">`IAsyncInfo`</ph> interface.","pos":[1109,1246],"source":" This example shows how to work with a [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)] method that returns an `IAsyncInfo` interface."},{"content":"The <bpt id=\"p1\">[</bpt>Callback<ept id=\"p1\">](../windows/callback-function-windows-runtime-cpp-template-library.md)</ept> function is an important part of both examples because it enables them to specify an event handler to process the results of the asynchronous operations.","pos":[1247,1485],"source":" The [Callback](../windows/callback-function-windows-runtime-cpp-template-library.md) function is an important part of both examples because it enables them to specify an event handler to process the results of the asynchronous operations."},{"pos":[1492,1728],"content":"For a more basic example that creates an instance of that component and retrieves a property value, see <bpt id=\"p1\">[</bpt>How to: Activate and Use a Windows Runtime Component<ept id=\"p1\">](../windows/how-to-activate-and-use-a-windows-runtime-component-using-wrl.md)</ept>.","source":"For a more basic example that creates an instance of that component and retrieves a property value, see [How to: Activate and Use a Windows Runtime Component](../windows/how-to-activate-and-use-a-windows-runtime-component-using-wrl.md)."},{"pos":[1736,2054],"content":"[!TIP]\n These examples use lambda expressions to define the callbacks. You can also use function objects (functors), function pointers, or [std::function](../standard-library/function-class.md) objects. For more information about C++ lambda expressions, see [Lambda Expressions](../cpp/lambda-expressions-in-cpp.md).","leadings":["","> "],"nodes":[{"content":" These examples use lambda expressions to define the callbacks. You can also use function objects (functors), function pointers, or [std::function](../standard-library/function-class.md) objects. For more information about C++ lambda expressions, see [Lambda Expressions](../cpp/lambda-expressions-in-cpp.md).","pos":[7,316],"nodes":[{"content":"These examples use lambda expressions to define the callbacks.","pos":[1,63]},{"content":"You can also use function objects (functors), function pointers, or <bpt id=\"p1\">[</bpt>std::function<ept id=\"p1\">](../standard-library/function-class.md)</ept> objects.","pos":[64,195],"source":" You can also use function objects (functors), function pointers, or [std::function](../standard-library/function-class.md) objects."},{"content":"For more information about C++ lambda expressions, see <bpt id=\"p1\">[</bpt>Lambda Expressions<ept id=\"p1\">](../cpp/lambda-expressions-in-cpp.md)</ept>.","pos":[196,309],"source":" For more information about C++ lambda expressions, see [Lambda Expressions](../cpp/lambda-expressions-in-cpp.md)."}]}]},{"content":"Example: Working with a Timer","pos":[2063,2092]},{"content":"The following steps start an asynchronous timer and wait for the timer to expire.","pos":[2096,2177]},{"content":"The complete example follows.","pos":[2178,2207]},{"pos":[2215,2950],"content":"[!WARNING]\n Although you typically use the [!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)] in a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app, this example uses a console app for illustration. Functions such as `wprintf_s` are not available from a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app. For more information about the types and functions that you can use in a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app, see [CRT functions not supported by /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx) and [Win32 and COM for Windows Store apps](http://msdn.microsoft.com/library/windows/apps/br205757.aspx).","leadings":["","> "],"nodes":[{"content":" Although you typically use the [!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)] in a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app, this example uses a console app for illustration. Functions such as `wprintf_s` are not available from a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app. For more information about the types and functions that you can use in a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app, see [CRT functions not supported by /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx) and [Win32 and COM for Windows Store apps](http://msdn.microsoft.com/library/windows/apps/br205757.aspx).","pos":[11,733],"nodes":[{"content":"Although you typically use the <ph id=\"ph1\">[!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)]</ph> in a <ph id=\"ph2\">[!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)]</ph> app, this example uses a console app for illustration.","pos":[1,229],"source":" Although you typically use the [!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)] in a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app, this example uses a console app for illustration."},{"content":"Functions such as <ph id=\"ph1\">`wprintf_s`</ph> are not available from a <ph id=\"ph2\">[!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)]</ph> app.","pos":[230,362],"source":" Functions such as `wprintf_s` are not available from a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app."},{"content":"For more information about the types and functions that you can use in a <ph id=\"ph1\">[!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)]</ph> app, see <bpt id=\"p1\">[</bpt>CRT functions not supported by /ZW<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx)</ept> and <bpt id=\"p2\">[</bpt>Win32 and COM for Windows Store apps<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/apps/br205757.aspx)</ept>.","pos":[363,722],"source":" For more information about the types and functions that you can use in a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app, see [CRT functions not supported by /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx) and [Win32 and COM for Windows Store apps](http://msdn.microsoft.com/library/windows/apps/br205757.aspx)."}]}]},{"pos":[2960,3146],"content":"Include (<ph id=\"ph1\">`#include`</ph>) any required <ph id=\"ph2\">[!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]</ph>, <ph id=\"ph3\">[!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)]</ph>, or standard C++ library headers.","source":"Include (`#include`) any required [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)], [!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)], or standard C++ library headers."},{"pos":[3168,3187],"content":"wrl-consume-async#2"},{"content":"Windows.System.Threading.h declares the types that are required to use an asynchronous timer.","pos":[3284,3377]},{"pos":[3388,3499],"content":"We recommend that you utilize the <ph id=\"ph1\">`using namespace`</ph> directive in your .cpp file to make the code more readable.","source":"We recommend that you utilize the `using namespace` directive in your .cpp file to make the code more readable."},{"pos":[3509,3577],"content":"Initialize the <ph id=\"ph1\">[!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]</ph>.","source":"Initialize the [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]."},{"pos":[3599,3618],"content":"wrl-consume-async#3"},{"pos":[3714,3813],"content":"Create an activation factory for the <ph id=\"ph1\">`ABI::Windows::System::Threading::IThreadPoolTimer`</ph> interface.","source":"Create an activation factory for the `ABI::Windows::System::Threading::IThreadPoolTimer` interface."},{"pos":[3835,3854],"content":"wrl-consume-async#4"},{"content":"The <ph id=\"ph1\">[!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]</ph> uses fully-qualified names to identify types.","pos":[3951,4053],"source":"The [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)] uses fully-qualified names to identify types."},{"content":"The <ph id=\"ph1\">`RuntimeClass_Windows_System_Threading_ThreadPoolTimer`</ph> parameter is a string that's provided by the <ph id=\"ph2\">[!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]</ph> and contains the required runtime class name.","pos":[4054,4257],"source":" The `RuntimeClass_Windows_System_Threading_ThreadPoolTimer` parameter is a string that's provided by the [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)] and contains the required runtime class name."},{"pos":[4267,4409],"content":"Create an <bpt id=\"p1\">[</bpt>Event<ept id=\"p1\">](../windows/event-class-windows-runtime-cpp-template-library.md)</ept> object that synchronizes the timer callback to the main app.","source":"Create an [Event](../windows/event-class-windows-runtime-cpp-template-library.md) object that synchronizes the timer callback to the main app."},{"pos":[4431,4450],"content":"wrl-consume-async#5"},{"pos":[4548,4792],"content":"[!NOTE]\n This event is for demonstration only as part of a console app. This example uses the event to ensure that an async operation completes before the app exits. In most apps, you typically don’t wait for async operations to complete.","leadings":["","    > "],"nodes":[{"content":" This event is for demonstration only as part of a console app. This example uses the event to ensure that an async operation completes before the app exits. In most apps, you typically don’t wait for async operations to complete.","pos":[8,238],"nodes":[{"content":"This event is for demonstration only as part of a console app.","pos":[1,63]},{"content":"This example uses the event to ensure that an async operation completes before the app exits.","pos":[64,157]},{"content":"In most apps, you typically don’t wait for async operations to complete.","pos":[158,230]}]}]},{"content":"Create an <ph id=\"ph1\">`IThreadPoolTimer`</ph> object that expires after two seconds.","pos":[4802,4869],"source":"Create an `IThreadPoolTimer` object that expires after two seconds."},{"content":"Use the <ph id=\"ph1\">`Callback`</ph> function to create the event handler (an <ph id=\"ph2\">`ABI::Windows::System::Threading::ITimerElapsedHandler`</ph> object).","pos":[4870,4994],"source":" Use the `Callback` function to create the event handler (an `ABI::Windows::System::Threading::ITimerElapsedHandler` object)."},{"pos":[5016,5035],"content":"wrl-consume-async#6"},{"content":"Print a message to the console and wait for the timer callback to complete.","pos":[5131,5206]},{"content":"All <ph id=\"ph1\">`ComPtr`</ph> and RAII objects leave scope and are released automatically.","pos":[5207,5280],"source":" All `ComPtr` and RAII objects leave scope and are released automatically."},{"pos":[5302,5321],"content":"wrl-consume-async#7"},{"content":"Here is the complete example:","pos":[5414,5443]},{"pos":[5461,5480],"content":"wrl-consume-async#1"},{"content":"Compiling the Code","pos":[5576,5594]},{"pos":[5598,5809],"content":"To compile the code, copy it and then paste it in a Visual Studio project, or paste it in a file that is named <ph id=\"ph1\">`wrl-consume-async.cpp`</ph> and then run the following command in a Visual Studio Command Prompt window.","source":"To compile the code, copy it and then paste it in a Visual Studio project, or paste it in a file that is named `wrl-consume-async.cpp` and then run the following command in a Visual Studio Command Prompt window."},{"content":"cl.exe wrl-consume-async.cpp runtimeobject.lib","pos":[5818,5864]},{"content":"Example: Working with a Background Thread","pos":[5875,5916]},{"content":"The following steps start a worker thread and define the action that's performed by that thread.","pos":[5920,6016]},{"content":"The complete example follows.","pos":[6017,6046]},{"pos":[6054,6333],"content":"[!TIP]\n This example demonstrates how to work with the `ABI::Windows::Foundation::IAsyncAction` interface. You can apply this pattern to any interface that implements `IAsyncInfo`: `IAsyncAction`, `IAsyncActionWithProgress`, `IAsyncOperation`, and`IAsyncOperationWithProgress`.","leadings":["","> "],"nodes":[{"content":" This example demonstrates how to work with the `ABI::Windows::Foundation::IAsyncAction` interface. You can apply this pattern to any interface that implements `IAsyncInfo`: `IAsyncAction`, `IAsyncActionWithProgress`, `IAsyncOperation`, and`IAsyncOperationWithProgress`.","pos":[7,277],"nodes":[{"content":"This example demonstrates how to work with the <ph id=\"ph1\">`ABI::Windows::Foundation::IAsyncAction`</ph> interface.","pos":[1,99],"source":" This example demonstrates how to work with the `ABI::Windows::Foundation::IAsyncAction` interface."},{"content":"You can apply this pattern to any interface that implements <ph id=\"ph1\">`IAsyncInfo`</ph>: <ph id=\"ph2\">`IAsyncAction`</ph>, <ph id=\"ph3\">`IAsyncActionWithProgress`</ph>, <ph id=\"ph4\">`IAsyncOperation`</ph>, and<ph id=\"ph5\">`IAsyncOperationWithProgress`</ph>.","pos":[100,270],"source":" You can apply this pattern to any interface that implements `IAsyncInfo`: `IAsyncAction`, `IAsyncActionWithProgress`, `IAsyncOperation`, and`IAsyncOperationWithProgress`."}]}]},{"pos":[6343,6529],"content":"Include (<ph id=\"ph1\">`#include`</ph>) any required <ph id=\"ph2\">[!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]</ph>, <ph id=\"ph3\">[!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)]</ph>, or standard C++ library headers.","source":"Include (`#include`) any required [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)], [!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)], or standard C++ library headers."},{"pos":[6551,6572],"content":"wrl-consume-asyncOp#2"},{"content":"Windows.System.Threading.h declares the types that are required to use a worker thread.","pos":[6669,6756]},{"pos":[6767,6874],"content":"We recommend that you use the <ph id=\"ph1\">`using namespace`</ph> directive in your .cpp file to make the code more readable.","source":"We recommend that you use the `using namespace` directive in your .cpp file to make the code more readable."},{"pos":[6884,6952],"content":"Initialize the <ph id=\"ph1\">[!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]</ph>.","source":"Initialize the [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)]."},{"pos":[6974,6995],"content":"wrl-consume-asyncOp#3"},{"pos":[7091,7192],"content":"Create an activation factory for the <ph id=\"ph1\">`ABI::Windows::System::Threading::IThreadPoolStatics`</ph> interface.","source":"Create an activation factory for the `ABI::Windows::System::Threading::IThreadPoolStatics` interface."},{"pos":[7214,7235],"content":"wrl-consume-asyncOp#4"},{"pos":[7332,7487],"content":"Create an <bpt id=\"p1\">[</bpt>Event<ept id=\"p1\">](../windows/event-class-windows-runtime-cpp-template-library.md)</ept> object that synchronizes completion of the worker thread to the main app.","source":"Create an [Event](../windows/event-class-windows-runtime-cpp-template-library.md) object that synchronizes completion of the worker thread to the main app."},{"pos":[7509,7530],"content":"wrl-consume-asyncOp#5"},{"pos":[7629,7873],"content":"[!NOTE]\n This event is for demonstration only as part of a console app. This example uses the event to ensure that an async operation completes before the app exits. In most apps, you typically don’t wait for async operations to complete.","leadings":["","    > "],"nodes":[{"content":" This event is for demonstration only as part of a console app. This example uses the event to ensure that an async operation completes before the app exits. In most apps, you typically don’t wait for async operations to complete.","pos":[8,238],"nodes":[{"content":"This event is for demonstration only as part of a console app.","pos":[1,63]},{"content":"This example uses the event to ensure that an async operation completes before the app exits.","pos":[64,157]},{"content":"In most apps, you typically don’t wait for async operations to complete.","pos":[158,230]}]}]},{"content":"Call the <ph id=\"ph1\">`IThreadPoolStatics::RunAsync`</ph> method to create a worker thread.","pos":[7883,7956],"source":"Call the `IThreadPoolStatics::RunAsync` method to create a worker thread."},{"content":"Use the <ph id=\"ph1\">`Callback`</ph> function to define the action.","pos":[7957,8006],"source":" Use the `Callback` function to define the action."},{"pos":[8028,8049],"content":"wrl-consume-asyncOp#6"},{"pos":[8147,8218],"content":"The <ph id=\"ph1\">`IsPrime`</ph> function is defined in the complete example that follows.","source":"The `IsPrime` function is defined in the complete example that follows."},{"content":"Print a message to the console and wait for the thread to complete.","pos":[8228,8295]},{"content":"All <ph id=\"ph1\">`ComPtr`</ph> and RAII objects leave scope and are released automatically.","pos":[8296,8369],"source":" All `ComPtr` and RAII objects leave scope and are released automatically."},{"pos":[8391,8412],"content":"wrl-consume-asyncOp#7"},{"content":"Here is the complete example:","pos":[8506,8535]},{"pos":[8553,8574],"content":"wrl-consume-asyncOp#1"},{"content":"Compiling the Code","pos":[8671,8689]},{"pos":[8693,8906],"content":"To compile the code, copy it and then paste it in a Visual Studio project, or paste it in a file that is named <ph id=\"ph1\">`wrl-consume-asyncOp.cpp`</ph> and then run the following command in a Visual Studio Command Prompt window.","source":"To compile the code, copy it and then paste it in a Visual Studio project, or paste it in a file that is named `wrl-consume-asyncOp.cpp` and then run the following command in a Visual Studio Command Prompt window."},{"content":"cl.exe wrl-consume-asyncOp.cpp runtimeobject.lib","pos":[8915,8963]},{"content":"See Also","pos":[8974,8982]},{"content":"Windows Runtime C++ Template Library (WRL)","pos":[8987,9029]}],"content":"---\ntitle: \"How to: Complete Asynchronous Operations Using WRL | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\ndev_langs: \n  - \"C++\"\nms.assetid: 02173eae-731b-49bc-b412-f1f69388b99d\ncaps.latest.revision: 13\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# How to: Complete Asynchronous Operations Using WRL\nThis document shows how to use the [!INCLUDE[cppwrl](../windows/includes/cppwrl_md.md)] ([!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)]) to start asynchronous operations and perform work when the operations complete.  \n  \n This document shows two examples. The first example starts an asynchronous timer and waits for the timer to expire. In this example, you specify the asynchronous action when you create the timer object. The second example runs a background worker thread. This example shows how to work with a [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)] method that returns an `IAsyncInfo` interface. The [Callback](../windows/callback-function-windows-runtime-cpp-template-library.md) function is an important part of both examples because it enables them to specify an event handler to process the results of the asynchronous operations.  \n  \n For a more basic example that creates an instance of that component and retrieves a property value, see [How to: Activate and Use a Windows Runtime Component](../windows/how-to-activate-and-use-a-windows-runtime-component-using-wrl.md).  \n  \n> [!TIP]\n>  These examples use lambda expressions to define the callbacks. You can also use function objects (functors), function pointers, or [std::function](../standard-library/function-class.md) objects. For more information about C++ lambda expressions, see [Lambda Expressions](../cpp/lambda-expressions-in-cpp.md).  \n  \n## Example: Working with a Timer  \n The following steps start an asynchronous timer and wait for the timer to expire. The complete example follows.  \n  \n> [!WARNING]\n>  Although you typically use the [!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)] in a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app, this example uses a console app for illustration. Functions such as `wprintf_s` are not available from a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app. For more information about the types and functions that you can use in a [!INCLUDE[win8_appname_long](../build/includes/win8_appname_long_md.md)] app, see [CRT functions not supported by /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx) and [Win32 and COM for Windows Store apps](http://msdn.microsoft.com/library/windows/apps/br205757.aspx).  \n  \n1.  Include (`#include`) any required [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)], [!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)], or standard C++ library headers.  \n  \n     [!code-cpp[wrl-consume-async#2](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_1.cpp)]  \n  \n     Windows.System.Threading.h declares the types that are required to use an asynchronous timer.  \n  \n     We recommend that you utilize the `using namespace` directive in your .cpp file to make the code more readable.  \n  \n2.  Initialize the [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)].  \n  \n     [!code-cpp[wrl-consume-async#3](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_2.cpp)]  \n  \n3.  Create an activation factory for the `ABI::Windows::System::Threading::IThreadPoolTimer` interface.  \n  \n     [!code-cpp[wrl-consume-async#4](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_3.cpp)]  \n  \n     The [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)] uses fully-qualified names to identify types. The `RuntimeClass_Windows_System_Threading_ThreadPoolTimer` parameter is a string that's provided by the [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)] and contains the required runtime class name.  \n  \n4.  Create an [Event](../windows/event-class-windows-runtime-cpp-template-library.md) object that synchronizes the timer callback to the main app.  \n  \n     [!code-cpp[wrl-consume-async#5](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_4.cpp)]  \n  \n    > [!NOTE]\n    >  This event is for demonstration only as part of a console app. This example uses the event to ensure that an async operation completes before the app exits. In most apps, you typically don’t wait for async operations to complete.  \n  \n5.  Create an `IThreadPoolTimer` object that expires after two seconds. Use the `Callback` function to create the event handler (an `ABI::Windows::System::Threading::ITimerElapsedHandler` object).  \n  \n     [!code-cpp[wrl-consume-async#6](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_5.cpp)]  \n  \n6.  Print a message to the console and wait for the timer callback to complete. All `ComPtr` and RAII objects leave scope and are released automatically.  \n  \n     [!code-cpp[wrl-consume-async#7](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_6.cpp)]  \n  \n Here is the complete example:  \n  \n [!code-cpp[wrl-consume-async#1](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_7.cpp)]  \n  \n### Compiling the Code  \n To compile the code, copy it and then paste it in a Visual Studio project, or paste it in a file that is named `wrl-consume-async.cpp` and then run the following command in a Visual Studio Command Prompt window.  \n  \n **cl.exe wrl-consume-async.cpp runtimeobject.lib**  \n  \n## Example: Working with a Background Thread  \n The following steps start a worker thread and define the action that's performed by that thread. The complete example follows.  \n  \n> [!TIP]\n>  This example demonstrates how to work with the `ABI::Windows::Foundation::IAsyncAction` interface. You can apply this pattern to any interface that implements `IAsyncInfo`: `IAsyncAction`, `IAsyncActionWithProgress`, `IAsyncOperation`, and`IAsyncOperationWithProgress`.  \n  \n1.  Include (`#include`) any required [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)], [!INCLUDE[cppwrl_short](../windows/includes/cppwrl_short_md.md)], or standard C++ library headers.  \n  \n     [!code-cpp[wrl-consume-asyncOp#2](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_8.cpp)]  \n  \n     Windows.System.Threading.h declares the types that are required to use a worker thread.  \n  \n     We recommend that you use the `using namespace` directive in your .cpp file to make the code more readable.  \n  \n2.  Initialize the [!INCLUDE[wrt](../atl/reference/includes/wrt_md.md)].  \n  \n     [!code-cpp[wrl-consume-asyncOp#3](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_9.cpp)]  \n  \n3.  Create an activation factory for the `ABI::Windows::System::Threading::IThreadPoolStatics` interface.  \n  \n     [!code-cpp[wrl-consume-asyncOp#4](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_10.cpp)]  \n  \n4.  Create an [Event](../windows/event-class-windows-runtime-cpp-template-library.md) object that synchronizes completion of the worker thread to the main app.  \n  \n     [!code-cpp[wrl-consume-asyncOp#5](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_11.cpp)]  \n  \n    > [!NOTE]\n    >  This event is for demonstration only as part of a console app. This example uses the event to ensure that an async operation completes before the app exits. In most apps, you typically don’t wait for async operations to complete.  \n  \n5.  Call the `IThreadPoolStatics::RunAsync` method to create a worker thread. Use the `Callback` function to define the action.  \n  \n     [!code-cpp[wrl-consume-asyncOp#6](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_12.cpp)]  \n  \n     The `IsPrime` function is defined in the complete example that follows.  \n  \n6.  Print a message to the console and wait for the thread to complete. All `ComPtr` and RAII objects leave scope and are released automatically.  \n  \n     [!code-cpp[wrl-consume-asyncOp#7](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_13.cpp)]  \n  \n Here is the complete example:  \n  \n [!code-cpp[wrl-consume-asyncOp#1](../windows/codesnippet/CPP/how-to-complete-asynchronous-operations-using-wrl_14.cpp)]  \n  \n### Compiling the Code  \n To compile the code, copy it and then paste it in a Visual Studio project, or paste it in a file that is named `wrl-consume-asyncOp.cpp` and then run the following command in a Visual Studio Command Prompt window.  \n  \n **cl.exe wrl-consume-asyncOp.cpp runtimeobject.lib**  \n  \n## See Also  \n [Windows Runtime C++ Template Library (WRL)](../windows/windows-runtime-cpp-template-library-wrl.md)"}