{"nodes":[{"pos":[12,84],"content":"Using Callback Fields in a Date and Time Picker Control | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Using Callback Fields in a Date and Time Picker Control | Microsoft Docs","pos":[0,72]}]},{"content":"Using Callback Fields in a Date and Time Picker Control","pos":[943,998]},{"content":"In addition to the standard format characters that define date and time picker fields, you can customize your output by specifying certain parts of a custom format string as callback fields.","pos":[999,1189]},{"content":"To declare a callback field, include one or more \"X\" characters (ASCII Code 88) anywhere in the body of the format string.","pos":[1190,1312]},{"content":"For example, the following string \"'Today is: 'yy'/'MM'/'dd' (Day 'X')'\"causes the date and time picker control to display the current value as the year followed by the month, date, and finally the day of the year.","pos":[1313,1527]},{"pos":[1535,1655],"content":"[!NOTE]\n The number of X's in a callback field does not correspond to the number of characters that will be displayed.","leadings":["","> "],"nodes":[{"content":"The number of X's in a callback field does not correspond to the number of characters that will be displayed.","pos":[9,118]}]},{"content":"You can distinguish between multiple callback fields in a custom string by repeating the \"X\" character.","pos":[1662,1765]},{"content":"Thus, the format string \"XXddddMMMdd', 'yyyXXX\" contains two unique callback fields, \"XX\" and \"XXX\".","pos":[1766,1866]},{"pos":[1874,2017],"content":"[!NOTE]\n Callback fields are treated as valid fields, so your application must be prepared to handle **DTN_WMKEYDOWN** notification messages.","leadings":["","> "],"nodes":[{"content":"Callback fields are treated as valid fields, so your application must be prepared to handle <bpt id=\"p1\">**</bpt>DTN_WMKEYDOWN<ept id=\"p1\">**</ept> notification messages.","pos":[9,141],"source":" Callback fields are treated as valid fields, so your application must be prepared to handle **DTN_WMKEYDOWN** notification messages."}]},{"content":"Implementing callback fields in your date and time picker control consists of three parts:","pos":[2024,2114]},{"content":"Initializing the custom format string","pos":[2124,2161]},{"pos":[2171,2216],"content":"Handling the <bpt id=\"p1\">**</bpt>DTN_FORMATQUERY<ept id=\"p1\">**</ept> notification","source":"Handling the **DTN_FORMATQUERY** notification"},{"pos":[2226,2266],"content":"Handling the <bpt id=\"p1\">**</bpt>DTN_FORMAT<ept id=\"p1\">**</ept> notification","source":"Handling the **DTN_FORMAT** notification"},{"content":"Initializing the Custom Format String","pos":[2275,2312]},{"content":"Initialize the custom string with a call to <ph id=\"ph1\">`CDateTimeCtrl::SetFormat`</ph>.","pos":[2316,2387],"source":"Initialize the custom string with a call to `CDateTimeCtrl::SetFormat`."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Using Custom Format Strings in a Date and Time Picker Control<ept id=\"p1\">](../mfc/using-custom-format-strings-in-a-date-and-time-picker-control.md)</ept>.","pos":[2388,2551],"source":" For more information, see [Using Custom Format Strings in a Date and Time Picker Control](../mfc/using-custom-format-strings-in-a-date-and-time-picker-control.md)."},{"content":"A common place to set the custom format string is in the <ph id=\"ph1\">`OnInitDialog`</ph> function of your containing dialog class or <ph id=\"ph2\">`OnInitialUpdate`</ph> function of your containing view class.","pos":[2552,2725],"source":" A common place to set the custom format string is in the `OnInitDialog` function of your containing dialog class or `OnInitialUpdate` function of your containing view class."},{"content":"Handling the DTN_FORMATQUERY Notification","pos":[2734,2775]},{"content":"When the control parses the format string and encounters a callback field, the application sends <bpt id=\"p1\">**</bpt>DTN_FORMAT<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>DTN_FORMATQUERY<ept id=\"p2\">**</ept> notification messages.","pos":[2779,2937],"source":"When the control parses the format string and encounters a callback field, the application sends **DTN_FORMAT** and **DTN_FORMATQUERY** notification messages."},{"content":"The callback field string is included with the notifications so you can determine which callback field is being queried.","pos":[2938,3058]},{"pos":[3065,3226],"content":"The <bpt id=\"p1\">**</bpt>DTN_FORMATQUERY<ept id=\"p1\">**</ept> notification is sent to retrieve the maximum allowable size in pixels of the string that will be displayed in the current callback field.","source":"The **DTN_FORMATQUERY** notification is sent to retrieve the maximum allowable size in pixels of the string that will be displayed in the current callback field."},{"content":"To properly calculate this value, you must calculate the height and width of the string, to be substituted for the field, using the control's display font.","pos":[3233,3388]},{"content":"The actual calculation of the string is easily achieved with a call to the <bpt id=\"p1\">[</bpt>GetTextExtentPoint32<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd144938)</ept> Win32 function.","pos":[3389,3562],"source":" The actual calculation of the string is easily achieved with a call to the [GetTextExtentPoint32](http://msdn.microsoft.com/library/windows/desktop/dd144938) Win32 function."},{"content":"Once the size is determined, pass the value back to the application and exit the handler function.","pos":[3563,3661]},{"content":"The following example is one method of supplying the size of the callback string:","pos":[3668,3749]},{"pos":[3767,3794],"content":"NVC_MFCControlLadenDialog#8"},{"content":"Once the size of the current callback field has been calculated, you must supply a value for the field.","pos":[3889,3992]},{"content":"This is done in the handler for the <bpt id=\"p1\">**</bpt>DTN_FORMAT<ept id=\"p1\">**</ept> notification.","pos":[3993,4057],"source":" This is done in the handler for the **DTN_FORMAT** notification."},{"content":"Handling the DTN_FORMAT Notification","pos":[4066,4102]},{"content":"The <bpt id=\"p1\">**</bpt>DTN_FORMAT<ept id=\"p1\">**</ept> notification is used by the application to request the character string that will be substituted.","pos":[4106,4222],"source":"The **DTN_FORMAT** notification is used by the application to request the character string that will be substituted."},{"content":"The following example demonstrates one possible method:","pos":[4223,4278]},{"pos":[4296,4323],"content":"NVC_MFCControlLadenDialog#9"},{"pos":[4419,4567],"content":"[!NOTE]\n The pointer to the **NMDATETIMEFORMAT** structure is found by casting the first parameter of the notification handler to the proper type.","leadings":["","> "],"nodes":[{"content":"The pointer to the <bpt id=\"p1\">**</bpt>NMDATETIMEFORMAT<ept id=\"p1\">**</ept> structure is found by casting the first parameter of the notification handler to the proper type.","pos":[9,146],"source":" The pointer to the **NMDATETIMEFORMAT** structure is found by casting the first parameter of the notification handler to the proper type."}]},{"content":"See Also","pos":[4576,4584]},{"content":"Using CDateTimeCtrl","pos":[4589,4608]},{"content":"Controls","pos":[4646,4654]}],"content":"---\ntitle: \"Using Callback Fields in a Date and Time Picker Control | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"DTN_FORMATQUERY\"\n  - \"DTN_FORMAT\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"DateTimePicker control [MFC], callback fields\"\n  - \"callback fields in CDateTimeCtrl class\"\n  - \"CDateTimeCtrl class, callback fields\"\n  - \"CDateTimeCtrl class, handling DTN_FORMAT and DTN_FORMATQ\"\n  - \"DTN_FORMATQUERY notification\"\n  - \"DTN_FORMAT notification\"\n  - \"DateTimePicker control [MFC]\"\nms.assetid: 404f4ba9-cba7-4718-9faa-bc6b274a723f\ncaps.latest.revision: 11\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Using Callback Fields in a Date and Time Picker Control\nIn addition to the standard format characters that define date and time picker fields, you can customize your output by specifying certain parts of a custom format string as callback fields. To declare a callback field, include one or more \"X\" characters (ASCII Code 88) anywhere in the body of the format string. For example, the following string \"'Today is: 'yy'/'MM'/'dd' (Day 'X')'\"causes the date and time picker control to display the current value as the year followed by the month, date, and finally the day of the year.  \n  \n> [!NOTE]\n>  The number of X's in a callback field does not correspond to the number of characters that will be displayed.  \n  \n You can distinguish between multiple callback fields in a custom string by repeating the \"X\" character. Thus, the format string \"XXddddMMMdd', 'yyyXXX\" contains two unique callback fields, \"XX\" and \"XXX\".  \n  \n> [!NOTE]\n>  Callback fields are treated as valid fields, so your application must be prepared to handle **DTN_WMKEYDOWN** notification messages.  \n  \n Implementing callback fields in your date and time picker control consists of three parts:  \n  \n-   Initializing the custom format string  \n  \n-   Handling the **DTN_FORMATQUERY** notification  \n  \n-   Handling the **DTN_FORMAT** notification  \n  \n## Initializing the Custom Format String  \n Initialize the custom string with a call to `CDateTimeCtrl::SetFormat`. For more information, see [Using Custom Format Strings in a Date and Time Picker Control](../mfc/using-custom-format-strings-in-a-date-and-time-picker-control.md). A common place to set the custom format string is in the `OnInitDialog` function of your containing dialog class or `OnInitialUpdate` function of your containing view class.  \n  \n## Handling the DTN_FORMATQUERY Notification  \n When the control parses the format string and encounters a callback field, the application sends **DTN_FORMAT** and **DTN_FORMATQUERY** notification messages. The callback field string is included with the notifications so you can determine which callback field is being queried.  \n  \n The **DTN_FORMATQUERY** notification is sent to retrieve the maximum allowable size in pixels of the string that will be displayed in the current callback field.  \n  \n To properly calculate this value, you must calculate the height and width of the string, to be substituted for the field, using the control's display font. The actual calculation of the string is easily achieved with a call to the [GetTextExtentPoint32](http://msdn.microsoft.com/library/windows/desktop/dd144938) Win32 function. Once the size is determined, pass the value back to the application and exit the handler function.  \n  \n The following example is one method of supplying the size of the callback string:  \n  \n [!code-cpp[NVC_MFCControlLadenDialog#8](../mfc/codesnippet/cpp/using-callback-fields-in-a-date-and-time-picker-control_1.cpp)]  \n  \n Once the size of the current callback field has been calculated, you must supply a value for the field. This is done in the handler for the **DTN_FORMAT** notification.  \n  \n## Handling the DTN_FORMAT Notification  \n The **DTN_FORMAT** notification is used by the application to request the character string that will be substituted. The following example demonstrates one possible method:  \n  \n [!code-cpp[NVC_MFCControlLadenDialog#9](../mfc/codesnippet/cpp/using-callback-fields-in-a-date-and-time-picker-control_2.cpp)]  \n  \n> [!NOTE]\n>  The pointer to the **NMDATETIMEFORMAT** structure is found by casting the first parameter of the notification handler to the proper type.  \n  \n## See Also  \n [Using CDateTimeCtrl](../mfc/using-cdatetimectrl.md)   \n [Controls](../mfc/controls-mfc.md)\n\n"}