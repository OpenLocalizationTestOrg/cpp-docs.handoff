{"nodes":[{"pos":[12,69],"content":"Data Source: Managing Connections (ODBC) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Data Source: Managing Connections (ODBC) | Microsoft Docs","pos":[0,57]}]},{"content":"Data Source: Managing Connections (ODBC)","pos":[1221,1261]},{"content":"This topic applies to the MFC ODBC classes.","pos":[1262,1305]},{"content":"This topic explains:","pos":[1312,1332]},{"pos":[1342,1409],"content":"<bpt id=\"p1\">[</bpt>How to configure a data source<ept id=\"p1\">](#_core_configuring_a_data_source)</ept>.","source":"[How to configure a data source](#_core_configuring_a_data_source)."},{"pos":[1419,1533],"content":"<bpt id=\"p1\">[</bpt>How a multiuser environment affects a data source and its recordsets<ept id=\"p1\">](#_core_working_in_a_multiuser_environment)</ept>.","source":"[How a multiuser environment affects a data source and its recordsets](#_core_working_in_a_multiuser_environment)."},{"pos":[1543,1644],"content":"<bpt id=\"p1\">[</bpt>Why you generalize a connection string to a data source<ept id=\"p1\">](#_core_generalizing_the_connection_string)</ept>.","source":"[Why you generalize a connection string to a data source](#_core_generalizing_the_connection_string)."},{"pos":[1654,1733],"content":"<bpt id=\"p1\">[</bpt>How to connect to a data source<ept id=\"p1\">](#_core_connecting_to_a_specific_data_source)</ept>.","source":"[How to connect to a data source](#_core_connecting_to_a_specific_data_source)."},{"pos":[1743,1823],"content":"<bpt id=\"p1\">[</bpt>How to disconnect from a data source<ept id=\"p1\">](#_core_disconnecting_from_a_data_source)</ept>.","source":"[How to disconnect from a data source](#_core_disconnecting_from_a_data_source)."},{"pos":[1833,1902],"content":"<bpt id=\"p1\">[</bpt>How to reuse a CDatabase object<ept id=\"p1\">](#_core_reusing_a_cdatabase_object)</ept>.","source":"[How to reuse a CDatabase object](#_core_reusing_a_cdatabase_object)."},{"content":"Connecting to a data source means establishing communications with a DBMS to access the data.","pos":[1909,2002]},{"content":"When you connect to a data source from an application through an ODBC driver, the driver makes the connection for you, either locally or across a network.","pos":[2003,2157]},{"content":"You can connect to any data source for which you have an ODBC driver.","pos":[2164,2233]},{"content":"Users of your application must also have the same ODBC driver for their data source.","pos":[2234,2318]},{"content":"For more information about redistributing ODBC drivers, see <bpt id=\"p1\">[</bpt>Redistributing ODBC Components to Your Customers<ept id=\"p1\">](../../data/odbc/redistributing-odbc-components-to-your-customers.md)</ept>.","pos":[2319,2499],"source":" For more information about redistributing ODBC drivers, see [Redistributing ODBC Components to Your Customers](../../data/odbc/redistributing-odbc-components-to-your-customers.md)."},{"pos":[2556,2581],"content":"Configuring a Data Source"},{"content":"ODBC Administrator is used to configure your data sources.","pos":[2585,2643]},{"content":"You can also use ODBC Administrator after installation to add or remove data sources.","pos":[2644,2729]},{"content":"When you create applications, you can either direct your users to the ODBC Administrator to let them add data sources or you can build this functionality into your application by making direct ODBC installation calls.","pos":[2730,2947]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>ODBC Administrator<ept id=\"p1\">](../../data/odbc/odbc-administrator.md)</ept>.","pos":[2948,3034],"source":" For more information, see [ODBC Administrator](../../data/odbc/odbc-administrator.md)."},{"pos":[3041,3198],"content":"You can use an Excel file as a data source, and you need to configure the file so that it is registered and appears in the <bpt id=\"p1\">**</bpt>Select Data Source<ept id=\"p1\">**</ept> dialog box.","source":"You can use an Excel file as a data source, and you need to configure the file so that it is registered and appears in the **Select Data Source** dialog box."},{"content":"To use an Excel file as a data source","pos":[3209,3246]},{"content":"Configure the file with the ODBC Data Source Administrator.","pos":[3256,3315]},{"pos":[3325,3364],"content":"On the <bpt id=\"p1\">**</bpt>File DSN<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>.","source":"On the **File DSN** tab, click **Add**."},{"pos":[3374,3468],"content":"In the <bpt id=\"p1\">**</bpt>Create New Data Source<ept id=\"p1\">**</ept> dialog box, select an Excel driver, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.","source":"In the **Create New Data Source** dialog box, select an Excel driver, and then click **Next**."},{"pos":[3478,3556],"content":"Click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept>, and select the name of the file to be used as a date source.","source":"Click **Browse**, and select the name of the file to be used as a date source."},{"pos":[3564,3659],"content":"[!NOTE]\n You might need to select **All Files** in the drop-down menu to view the .xls files.","leadings":["","> "],"nodes":[{"content":"You might need to select <bpt id=\"p1\">**</bpt>All Files<ept id=\"p1\">**</ept> in the drop-down menu to view the .xls files.","pos":[9,93],"source":" You might need to select **All Files** in the drop-down menu to view the .xls files."}]},{"pos":[3669,3711],"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept>.","source":"Click **Next**, and then click **Finish**."},{"pos":[3721,3812],"content":"In the <bpt id=\"p1\">**</bpt>ODBC Microsoft Excel Setup<ept id=\"p1\">**</ept> dialog box, select the database Version and Workbook.","source":"In the **ODBC Microsoft Excel Setup** dialog box, select the database Version and Workbook."},{"pos":[3878,3912],"content":"Working in a Multiuser Environment"},{"content":"If multiple users are connected to a data source, they can change data while you are manipulating it in your recordsets.","pos":[3916,4036]},{"content":"Similarly, your changes might affect other users' recordsets.","pos":[4037,4098]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Recordset: How Recordsets Update Records (ODBC)<ept id=\"p1\">](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)</ept> and <bpt id=\"p2\">[</bpt>Transaction (ODBC)<ept id=\"p2\">](../../data/odbc/transaction-odbc.md)</ept>.","pos":[4099,4302],"source":" For more information, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md) and [Transaction (ODBC)](../../data/odbc/transaction-odbc.md)."},{"pos":[4368,4402],"content":"Generalizing the Connection String"},{"content":"The wizards use a default connection string to establish a connection to a data source.","pos":[4406,4493]},{"content":"You use this connection to view tables and columns while you are developing your application.","pos":[4494,4587]},{"content":"However, this default connection string might not be appropriate for your users' connections to the data source through your application.","pos":[4588,4725]},{"content":"For example, their data source and the path to its location might be different from the one used in developing your application.","pos":[4726,4854]},{"content":"In that case, you should reimplement the <bpt id=\"p1\">[</bpt>CRecordset::GetDefaultConnect<ept id=\"p1\">](../../mfc/reference/crecordset-class.md#crecordset__getdefaultconnect)</ept> member function in a more generic fashion and discard the wizard implementation.","pos":[4855,5079],"source":" In that case, you should reimplement the [CRecordset::GetDefaultConnect](../../mfc/reference/crecordset-class.md#crecordset__getdefaultconnect) member function in a more generic fashion and discard the wizard implementation."},{"content":"For example, use one of the following approaches:","pos":[5080,5129]},{"content":"Register and manage the connection strings using ODBC Administrator.","pos":[5139,5207]},{"content":"Edit the connection string and remove the data source name.","pos":[5217,5276]},{"content":"The framework supplies ODBC as the data source; at run time, ODBC displays a dialog box asking for the data source name and any other required connection information.","pos":[5277,5443]},{"content":"Supply the data source name only.","pos":[5453,5486]},{"content":"ODBC asks for the user ID and password, if required.","pos":[5487,5539]},{"content":"For example, before generalizing, the connection string looks like this:","pos":[5540,5612]},{"content":"This connection string specifies a trusted connection, which uses Windows NT integrated security.","pos":[5762,5859]},{"content":"You should avoid hard-coding a password or specifying a blank password, because doing so creates a major security weakness.","pos":[5860,5983]},{"content":"Instead, you can give <ph id=\"ph1\">`GetDefaultConnect`</ph> a new connection string so that it queries for a user ID and password.","pos":[5984,6096],"source":" Instead, you can give `GetDefaultConnect` a new connection string so that it queries for a user ID and password."},{"pos":[6603,6639],"content":"Connecting to a Specific Data Source"},{"pos":[6643,6797],"content":"To connect to a specific data source, your data source must already have been configured with <bpt id=\"p1\">[</bpt>ODBC Administrator<ept id=\"p1\">](../../data/odbc/odbc-administrator.md)</ept>.","source":"To connect to a specific data source, your data source must already have been configured with [ODBC Administrator](../../data/odbc/odbc-administrator.md)."},{"content":"To connect to a specific data source","pos":[6808,6844]},{"pos":[6854,6885],"content":"Construct a <ph id=\"ph1\">`CDatabase`</ph> object.","source":"Construct a `CDatabase` object."},{"pos":[6895,6941],"content":"Call its <ph id=\"ph1\">`OpenEx`</ph> or <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> member function.","source":"Call its `OpenEx` or **Open** member function."},{"pos":[6948,7255],"content":"For more information about how to specify the data source if it is something other than the one you specified with a wizard, see <bpt id=\"p1\">[</bpt>CDatabase::OpenEx<ept id=\"p1\">](../../mfc/reference/cdatabase-class.md#cdatabase__openex)</ept> or <bpt id=\"p2\">[</bpt>CDatabase::Open<ept id=\"p2\">](../../mfc/reference/cdatabase-class.md#cdatabase__open)</ept> in the <bpt id=\"p3\">*</bpt>MFC Reference<ept id=\"p3\">*</ept>.","source":"For more information about how to specify the data source if it is something other than the one you specified with a wizard, see [CDatabase::OpenEx](../../mfc/reference/cdatabase-class.md#cdatabase__openex) or [CDatabase::Open](../../mfc/reference/cdatabase-class.md#cdatabase__open) in the *MFC Reference*."},{"pos":[7319,7351],"content":"Disconnecting from a Data Source"},{"content":"You must close any open recordsets before calling the <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> member function of <ph id=\"ph1\">`CDatabase`</ph>.","pos":[7355,7450],"source":"You must close any open recordsets before calling the **Close** member function of `CDatabase`."},{"content":"In recordsets associated with the <ph id=\"ph1\">`CDatabase`</ph> object you want to close, any pending <ph id=\"ph2\">`AddNew`</ph> or <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> statements are canceled and all pending transactions are rolled back.","pos":[7451,7625],"source":" In recordsets associated with the `CDatabase` object you want to close, any pending `AddNew` or **Edit** statements are canceled and all pending transactions are rolled back."},{"content":"To disconnect from a data source","pos":[7636,7668]},{"pos":[7678,7789],"content":"Call the <ph id=\"ph1\">`CDatabase`</ph> object's <bpt id=\"p1\">[</bpt>Close<ept id=\"p1\">](../../mfc/reference/cdatabase-class.md#cdatabase__close)</ept> member function.","source":"Call the `CDatabase` object's [Close](../../mfc/reference/cdatabase-class.md#cdatabase__close) member function."},{"content":"Destroy the object unless you want to reuse it.","pos":[7799,7846]},{"pos":[7904,7930],"content":"Reusing a CDatabase Object"},{"pos":[7934,8095],"content":"You can reuse a <ph id=\"ph1\">`CDatabase`</ph> object after disconnecting from it, whether you use it to reconnect to the same data source or to connect to a different data source.","source":"You can reuse a `CDatabase` object after disconnecting from it, whether you use it to reconnect to the same data source or to connect to a different data source."},{"content":"To reuse a CDatabase object","pos":[8106,8133]},{"content":"Close the object's original connection.","pos":[8143,8182]},{"pos":[8192,8278],"content":"Instead of destroying the object, call its <ph id=\"ph1\">`OpenEx`</ph> or <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept> member function again.","source":"Instead of destroying the object, call its `OpenEx` or **Open** member function again."},{"content":"See Also","pos":[8287,8295]},{"content":"Data Source (ODBC)","pos":[8300,8318]},{"content":"Data Source: Determining the Schema of the Data Source (ODBC)","pos":[8362,8423]},{"content":"CRecordset Class","pos":[8509,8525]}],"content":"---\ntitle: \"Data Source: Managing Connections (ODBC) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"ODBC data sources [C++], multiuser environments\"\n  - \"generalizing connection strings\"\n  - \"ODBC [C++], disconnecting from data sources\"\n  - \"connection strings [C++], generalizing\"\n  - \"database connections [C++], creating\"\n  - \"GetDefaultConnect method\"\n  - \"connections [C++], data source\"\n  - \"ODBC connections [C++], configuring\"\n  - \"disconnecting from data sources\"\n  - \"databases [C++], connecting to\"\n  - \"ODBC connections [C++], disconnecting\"\n  - \"data sources [C++], connecting to\"\n  - \"ODBC connections [C++], connecting to data source\"\n  - \"ODBC data sources [C++], connections\"\n  - \"database connections [C++], MFC ODBC classes\"\nms.assetid: c0adbcdd-c000-40c6-b199-09ffdc7b6ef2\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Data Source: Managing Connections (ODBC)\nThis topic applies to the MFC ODBC classes.  \n  \n This topic explains:  \n  \n-   [How to configure a data source](#_core_configuring_a_data_source).  \n  \n-   [How a multiuser environment affects a data source and its recordsets](#_core_working_in_a_multiuser_environment).  \n  \n-   [Why you generalize a connection string to a data source](#_core_generalizing_the_connection_string).  \n  \n-   [How to connect to a data source](#_core_connecting_to_a_specific_data_source).  \n  \n-   [How to disconnect from a data source](#_core_disconnecting_from_a_data_source).  \n  \n-   [How to reuse a CDatabase object](#_core_reusing_a_cdatabase_object).  \n  \n Connecting to a data source means establishing communications with a DBMS to access the data. When you connect to a data source from an application through an ODBC driver, the driver makes the connection for you, either locally or across a network.  \n  \n You can connect to any data source for which you have an ODBC driver. Users of your application must also have the same ODBC driver for their data source. For more information about redistributing ODBC drivers, see [Redistributing ODBC Components to Your Customers](../../data/odbc/redistributing-odbc-components-to-your-customers.md).  \n  \n##  <a name=\"_core_configuring_a_data_source\"></a> Configuring a Data Source  \n ODBC Administrator is used to configure your data sources. You can also use ODBC Administrator after installation to add or remove data sources. When you create applications, you can either direct your users to the ODBC Administrator to let them add data sources or you can build this functionality into your application by making direct ODBC installation calls. For more information, see [ODBC Administrator](../../data/odbc/odbc-administrator.md).  \n  \n You can use an Excel file as a data source, and you need to configure the file so that it is registered and appears in the **Select Data Source** dialog box.  \n  \n#### To use an Excel file as a data source  \n  \n1.  Configure the file with the ODBC Data Source Administrator.  \n  \n2.  On the **File DSN** tab, click **Add**.  \n  \n3.  In the **Create New Data Source** dialog box, select an Excel driver, and then click **Next**.  \n  \n4.  Click **Browse**, and select the name of the file to be used as a date source.  \n  \n> [!NOTE]\n>  You might need to select **All Files** in the drop-down menu to view the .xls files.  \n  \n1.  Click **Next**, and then click **Finish**.  \n  \n2.  In the **ODBC Microsoft Excel Setup** dialog box, select the database Version and Workbook.  \n  \n##  <a name=\"_core_working_in_a_multiuser_environment\"></a> Working in a Multiuser Environment  \n If multiple users are connected to a data source, they can change data while you are manipulating it in your recordsets. Similarly, your changes might affect other users' recordsets. For more information, see [Recordset: How Recordsets Update Records (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md) and [Transaction (ODBC)](../../data/odbc/transaction-odbc.md).  \n  \n##  <a name=\"_core_generalizing_the_connection_string\"></a> Generalizing the Connection String  \n The wizards use a default connection string to establish a connection to a data source. You use this connection to view tables and columns while you are developing your application. However, this default connection string might not be appropriate for your users' connections to the data source through your application. For example, their data source and the path to its location might be different from the one used in developing your application. In that case, you should reimplement the [CRecordset::GetDefaultConnect](../../mfc/reference/crecordset-class.md#crecordset__getdefaultconnect) member function in a more generic fashion and discard the wizard implementation. For example, use one of the following approaches:  \n  \n-   Register and manage the connection strings using ODBC Administrator.  \n  \n-   Edit the connection string and remove the data source name. The framework supplies ODBC as the data source; at run time, ODBC displays a dialog box asking for the data source name and any other required connection information.  \n  \n-   Supply the data source name only. ODBC asks for the user ID and password, if required. For example, before generalizing, the connection string looks like this:  \n  \n    ```  \n    CString CApp1Set::GetDefaultConnect()  \n    {  \n       return \"ODBC;DSN=afx;Trusted_Connection=Yes;\";  \n    }  \n    ```  \n  \n     This connection string specifies a trusted connection, which uses Windows NT integrated security. You should avoid hard-coding a password or specifying a blank password, because doing so creates a major security weakness. Instead, you can give `GetDefaultConnect` a new connection string so that it queries for a user ID and password.  \n  \n    ```  \n    // User must select data source and supply user ID and password:  \n        return \"ODBC;\";  \n    // User ID and password required:  \n        return \"ODBC;DSN=mydb;\";  \n    // Password required (myuserid must be replaced with a valid user ID):  \n        return \"ODBC;DSN=mydb;UID=myuserid;\";  \n    // Hard-coded user ID and password (SECURITY WEAKNESS--AVOID):  \n        return \"ODBC;DSN=mydb;UID=sa;PWD=777;\";  \n    ```  \n  \n##  <a name=\"_core_connecting_to_a_specific_data_source\"></a> Connecting to a Specific Data Source  \n To connect to a specific data source, your data source must already have been configured with [ODBC Administrator](../../data/odbc/odbc-administrator.md).  \n  \n#### To connect to a specific data source  \n  \n1.  Construct a `CDatabase` object.  \n  \n2.  Call its `OpenEx` or **Open** member function.  \n  \n For more information about how to specify the data source if it is something other than the one you specified with a wizard, see [CDatabase::OpenEx](../../mfc/reference/cdatabase-class.md#cdatabase__openex) or [CDatabase::Open](../../mfc/reference/cdatabase-class.md#cdatabase__open) in the *MFC Reference*.  \n  \n##  <a name=\"_core_disconnecting_from_a_data_source\"></a> Disconnecting from a Data Source  \n You must close any open recordsets before calling the **Close** member function of `CDatabase`. In recordsets associated with the `CDatabase` object you want to close, any pending `AddNew` or **Edit** statements are canceled and all pending transactions are rolled back.  \n  \n#### To disconnect from a data source  \n  \n1.  Call the `CDatabase` object's [Close](../../mfc/reference/cdatabase-class.md#cdatabase__close) member function.  \n  \n2.  Destroy the object unless you want to reuse it.  \n  \n##  <a name=\"_core_reusing_a_cdatabase_object\"></a> Reusing a CDatabase Object  \n You can reuse a `CDatabase` object after disconnecting from it, whether you use it to reconnect to the same data source or to connect to a different data source.  \n  \n#### To reuse a CDatabase object  \n  \n1.  Close the object's original connection.  \n  \n2.  Instead of destroying the object, call its `OpenEx` or **Open** member function again.  \n  \n## See Also  \n [Data Source (ODBC)](../../data/odbc/data-source-odbc.md)   \n [Data Source: Determining the Schema of the Data Source (ODBC)](../../data/odbc/data-source-determining-the-schema-of-the-data-source-odbc.md)   \n [CRecordset Class](../../mfc/reference/crecordset-class.md)"}