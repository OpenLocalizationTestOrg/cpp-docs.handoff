{"nodes":[{"pos":[12,71],"content":"Creating a Consumer Without Using a Wizard | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Creating a Consumer Without Using a Wizard | Microsoft Docs","pos":[0,59]}]},{"content":"Creating a Consumer Without Using a Wizard","pos":[606,648]},{"content":"The following example assumes that you are adding OLE DB consumer support to an existing ATL project.","pos":[649,750]},{"content":"If you want to add OLE DB consumer support to an MFC application, you should run the MFC Application Wizard, which creates all the support necessary and invokes MFC routines necessary to execute the application.","pos":[751,962]},{"content":"To add OLE DB consumer support without using the ATL OLE DB Consumer Wizard:","pos":[969,1045]},{"pos":[1055,1121],"content":"In your Stdafx.h file, append the following <ph id=\"ph1\">`#include`</ph> statements:","source":"In your Stdafx.h file, append the following `#include` statements:"},{"content":"Programmatically, a consumer typically performs the following sequence of operations:","pos":[1271,1356]},{"content":"Create a user record class that binds columns to local variables.","pos":[1366,1431]},{"content":"In this example, <ph id=\"ph1\">`CMyTableNameAccessor`</ph> is the user record class (see <bpt id=\"p1\">[</bpt>User Records<ept id=\"p1\">](../../data/oledb/user-records.md)</ept>).","pos":[1432,1552],"source":" In this example, `CMyTableNameAccessor` is the user record class (see [User Records](../../data/oledb/user-records.md))."},{"content":"This class contains the column map and parameter map.","pos":[1553,1606]},{"content":"Declare a data member in the user record class for each field you specify in your column map; for each of these data members, also declare a status data member and a length data member.","pos":[1607,1792]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Field Status Data Members in Wizard-Generated Accessors<ept id=\"p1\">](../../data/oledb/field-status-data-members-in-wizard-generated-accessors.md)</ept>.","pos":[1793,1954],"source":" For more information, see [Field Status Data Members in Wizard-Generated Accessors](../../data/oledb/field-status-data-members-in-wizard-generated-accessors.md)."},{"pos":[1966,2081],"content":"[!NOTE]\n If you write your own consumer, the data variables must come before the status and length variables.","leadings":["","    > "],"nodes":[{"content":"If you write your own consumer, the data variables must come before the status and length variables.","pos":[9,109]}]},{"content":"Instantiate a data source and a session.","pos":[2091,2131]},{"content":"Decide what type of accessor and rowset to use and then instantiate a rowset using <bpt id=\"p1\">[</bpt>CCommand<ept id=\"p1\">](../../data/oledb/ccommand-class.md)</ept> or <bpt id=\"p2\">[</bpt>CTable<ept id=\"p2\">](../../data/oledb/ctable-class.md)</ept>:","pos":[2132,2308],"source":" Decide what type of accessor and rowset to use and then instantiate a rowset using [CCommand](../../data/oledb/ccommand-class.md) or [CTable](../../data/oledb/ctable-class.md):"},{"content":"Call <bpt id=\"p1\">**</bpt>CoInitialize<ept id=\"p1\">**</ept> to initialize COM.","pos":[2459,2499],"source":"Call **CoInitialize** to initialize COM."},{"content":"This is usually called in the main code.","pos":[2500,2540]},{"content":"For example:","pos":[2541,2553]},{"pos":[2625,2713],"content":"Call <bpt id=\"p1\">[</bpt>CDataSource::Open<ept id=\"p1\">](../../data/oledb/cdatasource-open.md)</ept> or one of its variations.","source":"Call [CDataSource::Open](../../data/oledb/cdatasource-open.md) or one of its variations."},{"content":"Open a connection to the data source, open the session, and open and initialize the rowset (and if a command, also execute it):","pos":[2723,2850]},{"content":"Optionally, set rowset properties using <ph id=\"ph1\">`CDBPropSet::AddProperty`</ph> and pass them as a parameter to <ph id=\"ph2\">`rs.Open`</ph>.","pos":[2998,3106],"source":"Optionally, set rowset properties using `CDBPropSet::AddProperty` and pass them as a parameter to `rs.Open`."},{"content":"For an example of how this is done, see GetRowsetProperties in <bpt id=\"p1\">[</bpt>Consumer Wizard-Generated Methods<ept id=\"p1\">](../../data/oledb/consumer-wizard-generated-methods.md)</ept>.","pos":[3107,3261],"source":" For an example of how this is done, see GetRowsetProperties in [Consumer Wizard-Generated Methods](../../data/oledb/consumer-wizard-generated-methods.md)."},{"content":"You can now use the rowset to retrieve/manipulate the data.","pos":[3271,3330]},{"content":"When your application is done, close the connection, session, and rowset:","pos":[3340,3413]},{"content":"If you are using a command, you might want to call <ph id=\"ph1\">`ReleaseCommand`</ph> after <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept>.","pos":[3501,3585],"source":"If you are using a command, you might want to call `ReleaseCommand` after **Close**."},{"content":"The code example in <bpt id=\"p1\">[</bpt>CCommand::Close<ept id=\"p1\">](../../data/oledb/ccommand-close.md)</ept> shows how to call <bpt id=\"p2\">**</bpt>Close<ept id=\"p2\">**</ept> and <ph id=\"ph1\">`ReleaseCommand`</ph>.","pos":[3586,3709],"source":" The code example in [CCommand::Close](../../data/oledb/ccommand-close.md) shows how to call **Close** and `ReleaseCommand`."},{"content":"Call <bpt id=\"p1\">**</bpt>CoUnInitialize<ept id=\"p1\">**</ept> to uninitialize COM.","pos":[3719,3763],"source":"Call **CoUnInitialize** to uninitialize COM."},{"content":"This is usually called in the main code.","pos":[3764,3804]},{"content":"See Also","pos":[3860,3868]},{"content":"Creating an OLE DB Consumer","pos":[3873,3900]}],"content":"---\ntitle: \"Creating a Consumer Without Using a Wizard | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"OLE DB consumers, creating\"\nms.assetid: e8241cfe-5faf-48f8-9de3-241203de020b\ncaps.latest.revision: 7\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Creating a Consumer Without Using a Wizard\nThe following example assumes that you are adding OLE DB consumer support to an existing ATL project. If you want to add OLE DB consumer support to an MFC application, you should run the MFC Application Wizard, which creates all the support necessary and invokes MFC routines necessary to execute the application.  \n  \n To add OLE DB consumer support without using the ATL OLE DB Consumer Wizard:  \n  \n-   In your Stdafx.h file, append the following `#include` statements:  \n  \n    ```  \n    #include <atlbase.h>  \n    #include <atldbcli.h>  \n    #include <atldbsch.h> // if you are using schema templates  \n    ```  \n  \n Programmatically, a consumer typically performs the following sequence of operations:  \n  \n-   Create a user record class that binds columns to local variables. In this example, `CMyTableNameAccessor` is the user record class (see [User Records](../../data/oledb/user-records.md)). This class contains the column map and parameter map. Declare a data member in the user record class for each field you specify in your column map; for each of these data members, also declare a status data member and a length data member. For more information, see [Field Status Data Members in Wizard-Generated Accessors](../../data/oledb/field-status-data-members-in-wizard-generated-accessors.md).  \n  \n    > [!NOTE]\n    >  If you write your own consumer, the data variables must come before the status and length variables.  \n  \n-   Instantiate a data source and a session. Decide what type of accessor and rowset to use and then instantiate a rowset using [CCommand](../../data/oledb/ccommand-class.md) or [CTable](../../data/oledb/ctable-class.md):  \n  \n    ```  \n    CDataSource ds;  \n    CSession ss;  \n    class CMyTableName : public CCommand<CAccessor<CMyTableNameAccessor> >  \n    ```  \n  \n-   Call **CoInitialize** to initialize COM. This is usually called in the main code. For example:  \n  \n    ```  \n    HRESULT hr = CoInitialize(NULL);  \n    ```  \n  \n-   Call [CDataSource::Open](../../data/oledb/cdatasource-open.md) or one of its variations.  \n  \n-   Open a connection to the data source, open the session, and open and initialize the rowset (and if a command, also execute it):  \n  \n    ```  \n    hr = ds.Open();  \n    hr = ss.Open(ds);  \n    hr = rs.Open();            // (Open also executes the command)  \n    ```  \n  \n-   Optionally, set rowset properties using `CDBPropSet::AddProperty` and pass them as a parameter to `rs.Open`. For an example of how this is done, see GetRowsetProperties in [Consumer Wizard-Generated Methods](../../data/oledb/consumer-wizard-generated-methods.md).  \n  \n-   You can now use the rowset to retrieve/manipulate the data.  \n  \n-   When your application is done, close the connection, session, and rowset:  \n  \n    ```  \n    rs.Close();  \n    ss.Close();  \n    ds.Close();  \n    ```  \n  \n     If you are using a command, you might want to call `ReleaseCommand` after **Close**. The code example in [CCommand::Close](../../data/oledb/ccommand-close.md) shows how to call **Close** and `ReleaseCommand`.  \n  \n-   Call **CoUnInitialize** to uninitialize COM. This is usually called in the main code.  \n  \n    ```  \n    CoUninitialize();  \n    ```  \n  \n## See Also  \n [Creating an OLE DB Consumer](../../data/oledb/creating-an-ole-db-consumer.md)"}