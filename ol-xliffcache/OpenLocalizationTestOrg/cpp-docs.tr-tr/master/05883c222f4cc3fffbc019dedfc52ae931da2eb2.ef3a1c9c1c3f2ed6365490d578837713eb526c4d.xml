{"nodes":[{"pos":[12,54],"content":"Supporting IDispEventImpl | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Supporting IDispEventImpl | Microsoft Docs","pos":[0,42]}]},{"content":"Supporting IDispEventImpl","pos":[846,871]},{"content":"The template class <bpt id=\"p1\">[</bpt>IDispEventImpl<ept id=\"p1\">](../atl/reference/idispeventimpl-class.md)</ept> can be used to provide support for connection point sinks in your ATL class.","pos":[872,1026],"source":"The template class [IDispEventImpl](../atl/reference/idispeventimpl-class.md) can be used to provide support for connection point sinks in your ATL class."},{"content":"A connection point sink allows your class to handle events fired from external COM objects.","pos":[1027,1118]},{"content":"These connection point sinks are mapped with an event sink map, provided by your class.","pos":[1119,1206]},{"content":"To properly implement a connection point sink for your class, the following steps must be completed:","pos":[1213,1313]},{"content":"Import the type libraries for each external object","pos":[1323,1373]},{"pos":[1383,1422],"content":"Declare the <ph id=\"ph1\">`IDispEventImpl`</ph> interfaces","source":"Declare the `IDispEventImpl` interfaces"},{"content":"Declare an event sink map","pos":[1432,1457]},{"content":"Advise and unadvise the connection points","pos":[1467,1508]},{"content":"The steps involved in implementing a connection point sink are all accomplished by modifying only the header file (.h) of your class.","pos":[1515,1648]},{"content":"Importing the Type Libraries","pos":[1657,1685]},{"content":"For each external object whose events you want to handle, you must import the type library.","pos":[1689,1780]},{"content":"This step defines the events that can be handled and provides information that is used when declaring the event sink map.","pos":[1781,1902]},{"content":"The <bpt id=\"p1\">[</bpt>#import<ept id=\"p1\">](../preprocessor/hash-import-directive-cpp.md)</ept> directive can be used to accomplish this.","pos":[1903,2004],"source":" The [#import](../preprocessor/hash-import-directive-cpp.md) directive can be used to accomplish this."},{"content":"Add the necessary <ph id=\"ph1\">`#import`</ph> directive lines for each dispatch interface you will support to the header file (.h) of your class.","pos":[2005,2132],"source":" Add the necessary `#import` directive lines for each dispatch interface you will support to the header file (.h) of your class."},{"pos":[2139,2233],"content":"The following example imports the type library of an external COM server (<ph id=\"ph1\">`MSCAL.Calendar.7`</ph>):","source":"The following example imports the type library of an external COM server (`MSCAL.Calendar.7`):"},{"pos":[2251,2272],"content":"NVC_ATL_Windowing#141"},{"pos":[2336,2440],"content":"[!NOTE]\n You must have a separate `#import` statement for each external type library you will support.","leadings":["","> "],"nodes":[{"content":"You must have a separate <ph id=\"ph1\">`#import`</ph> statement for each external type library you will support.","pos":[9,102],"source":" You must have a separate `#import` statement for each external type library you will support."}]},{"content":"Declaring the IDispEventImpl Interfaces","pos":[2449,2488]},{"content":"Now that you have imported the type libraries of each dispatch interface, you need to declare separate <ph id=\"ph1\">`IDispEventImpl`</ph> interfaces for each external dispatch interface.","pos":[2492,2660],"source":"Now that you have imported the type libraries of each dispatch interface, you need to declare separate `IDispEventImpl` interfaces for each external dispatch interface."},{"content":"Modify the declaration of your class by adding an <ph id=\"ph1\">`IDispEventImpl`</ph> interface declaration for each external object.","pos":[2661,2775],"source":" Modify the declaration of your class by adding an `IDispEventImpl` interface declaration for each external object."},{"content":"For more information on the parameters, see <bpt id=\"p1\">[</bpt>IDispEventImpl<ept id=\"p1\">](../atl/reference/idispeventimpl-class.md)</ept>.","pos":[2776,2879],"source":" For more information on the parameters, see [IDispEventImpl](../atl/reference/idispeventimpl-class.md)."},{"pos":[2886,3038],"content":"The following code declares two connection point sinks, for the <ph id=\"ph1\">`DCalendarEvents`</ph> interface, for the COM object implemented by class <ph id=\"ph2\">`CMyCompositCtrl2`</ph>:","source":"The following code declares two connection point sinks, for the `DCalendarEvents` interface, for the COM object implemented by class `CMyCompositCtrl2`:"},{"pos":[3056,3077],"content":"NVC_ATL_Windowing#142"},{"content":"Declaring an Event Sink Map","pos":[3142,3169]},{"content":"In order for the event notifications to be handled by the proper function, your class must route each event to its correct handler.","pos":[3173,3304]},{"content":"This is achieved by declaring an event sink map.","pos":[3305,3353]},{"content":"ATL provides several macros, <bpt id=\"p1\">[</bpt>BEGIN_SINK_MAP<ept id=\"p1\">](http://msdn.microsoft.com/library/32542b3d-ac43-4139-8ac4-41c48481744f)</ept>, <bpt id=\"p2\">[</bpt>END_SINK_MAP<ept id=\"p2\">](http://msdn.microsoft.com/library/c8bb87a0-b224-46e5-9edc-fc4d7f1129b4)</ept>, and <bpt id=\"p3\">[</bpt>SINK_ENTRY_EX<ept id=\"p3\">](http://msdn.microsoft.com/library/33a5fff6-5248-47c0-8cf4-8bdf760e86e5)</ept>, that make this mapping easier.","pos":[3360,3690],"source":"ATL provides several macros, [BEGIN_SINK_MAP](http://msdn.microsoft.com/library/32542b3d-ac43-4139-8ac4-41c48481744f), [END_SINK_MAP](http://msdn.microsoft.com/library/c8bb87a0-b224-46e5-9edc-fc4d7f1129b4), and [SINK_ENTRY_EX](http://msdn.microsoft.com/library/33a5fff6-5248-47c0-8cf4-8bdf760e86e5), that make this mapping easier."},{"content":"The standard format is as follows:","pos":[3691,3725]},{"content":"The following example declares an event sink map with two event handlers:","pos":[3883,3956]},{"pos":[3974,3995],"content":"NVC_ATL_Windowing#136"},{"content":"The implementation is nearly complete.","pos":[4058,4096]},{"content":"The last step concerns the advising and unadvising of the external interfaces.","pos":[4097,4175]},{"content":"Advising and Unadvising the IDispEventImpl Interfaces","pos":[4184,4237]},{"content":"The final step is to implement a method that will advise (or unadvise) all connection points at the proper times.","pos":[4241,4354]},{"content":"This advising must be done before communication between the external clients and your object can take place.","pos":[4355,4463]},{"content":"Before your object becomes visible, each external dispatch interface supported by your object is queried for outgoing interfaces.","pos":[4464,4593]},{"content":"A connection is established and a reference to the outgoing interface is used to handle events from the object.","pos":[4594,4705]},{"content":"This procedure is referred to as \"advising.\"","pos":[4706,4750]},{"content":"After your object is finished with the external interfaces, the outgoing interfaces should be notified that they are no longer used by your class.","pos":[4757,4903]},{"content":"This process is referred to as \"unadvising.\"","pos":[4904,4948]},{"content":"Because of the unique nature of COM objects, this procedure varies, in detail and execution, between implementations.","pos":[4955,5072]},{"content":"These details are beyond the scope of this topic and are not addressed.","pos":[5073,5144]},{"content":"See Also","pos":[5153,5161]},{"content":"Fundamentals of ATL COM Objects","pos":[5166,5197]}],"content":"---\ntitle: \"Supporting IDispEventImpl | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nf1_keywords: \n  - \"IDispEventImpl\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"event sink maps, declaring\"\n  - \"IDispEventImpl class, advising and unadvising\"\n  - \"SINK_ENTRY macro\"\n  - \"type libraries, importing\"\n  - \"ATL, IDispEventImpl support in COM objects\"\n  - \"BEGIN_SINK_MAP macro\"\n  - \"IDispEventImpl class, declaring\"\nms.assetid: b957f930-6a5b-4598-8e4d-8027759957e7\ncaps.latest.revision: 11\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Supporting IDispEventImpl\nThe template class [IDispEventImpl](../atl/reference/idispeventimpl-class.md) can be used to provide support for connection point sinks in your ATL class. A connection point sink allows your class to handle events fired from external COM objects. These connection point sinks are mapped with an event sink map, provided by your class.  \n  \n To properly implement a connection point sink for your class, the following steps must be completed:  \n  \n-   Import the type libraries for each external object  \n  \n-   Declare the `IDispEventImpl` interfaces  \n  \n-   Declare an event sink map  \n  \n-   Advise and unadvise the connection points  \n  \n The steps involved in implementing a connection point sink are all accomplished by modifying only the header file (.h) of your class.  \n  \n## Importing the Type Libraries  \n For each external object whose events you want to handle, you must import the type library. This step defines the events that can be handled and provides information that is used when declaring the event sink map. The [#import](../preprocessor/hash-import-directive-cpp.md) directive can be used to accomplish this. Add the necessary `#import` directive lines for each dispatch interface you will support to the header file (.h) of your class.  \n  \n The following example imports the type library of an external COM server (`MSCAL.Calendar.7`):  \n  \n [!code-cpp[NVC_ATL_Windowing#141](../atl/codesnippet/cpp/supporting-idispeventimpl_1.h)]  \n  \n> [!NOTE]\n>  You must have a separate `#import` statement for each external type library you will support.  \n  \n## Declaring the IDispEventImpl Interfaces  \n Now that you have imported the type libraries of each dispatch interface, you need to declare separate `IDispEventImpl` interfaces for each external dispatch interface. Modify the declaration of your class by adding an `IDispEventImpl` interface declaration for each external object. For more information on the parameters, see [IDispEventImpl](../atl/reference/idispeventimpl-class.md).  \n  \n The following code declares two connection point sinks, for the `DCalendarEvents` interface, for the COM object implemented by class `CMyCompositCtrl2`:  \n  \n [!code-cpp[NVC_ATL_Windowing#142](../atl/codesnippet/cpp/supporting-idispeventimpl_2.h)]  \n  \n## Declaring an Event Sink Map  \n In order for the event notifications to be handled by the proper function, your class must route each event to its correct handler. This is achieved by declaring an event sink map.  \n  \n ATL provides several macros, [BEGIN_SINK_MAP](http://msdn.microsoft.com/library/32542b3d-ac43-4139-8ac4-41c48481744f), [END_SINK_MAP](http://msdn.microsoft.com/library/c8bb87a0-b224-46e5-9edc-fc4d7f1129b4), and [SINK_ENTRY_EX](http://msdn.microsoft.com/library/33a5fff6-5248-47c0-8cf4-8bdf760e86e5), that make this mapping easier. The standard format is as follows:  \n  \n `BEGIN_SINK_MAP(comClass)`  \n  \n `SINK_ENTRY_EX(id, iid, dispid, func)`  \n  \n `. . . //additional external event entries`  \n  \n `END_SINK_MAP()`  \n  \n The following example declares an event sink map with two event handlers:  \n  \n [!code-cpp[NVC_ATL_Windowing#136](../atl/codesnippet/cpp/supporting-idispeventimpl_3.h)]  \n  \n The implementation is nearly complete. The last step concerns the advising and unadvising of the external interfaces.  \n  \n## Advising and Unadvising the IDispEventImpl Interfaces  \n The final step is to implement a method that will advise (or unadvise) all connection points at the proper times. This advising must be done before communication between the external clients and your object can take place. Before your object becomes visible, each external dispatch interface supported by your object is queried for outgoing interfaces. A connection is established and a reference to the outgoing interface is used to handle events from the object. This procedure is referred to as \"advising.\"  \n  \n After your object is finished with the external interfaces, the outgoing interfaces should be notified that they are no longer used by your class. This process is referred to as \"unadvising.\"  \n  \n Because of the unique nature of COM objects, this procedure varies, in detail and execution, between implementations. These details are beyond the scope of this topic and are not addressed.  \n  \n## See Also  \n [Fundamentals of ATL COM Objects](../atl/fundamentals-of-atl-com-objects.md)\n\n"}