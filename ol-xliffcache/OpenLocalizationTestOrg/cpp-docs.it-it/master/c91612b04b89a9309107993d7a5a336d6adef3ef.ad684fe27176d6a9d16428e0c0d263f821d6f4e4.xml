{"nodes":[{"pos":[12,71],"content":"Serialization: Making a Serializable Class | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Serialization: Making a Serializable Class | Microsoft Docs","pos":[0,59]}]},{"content":"Serialization: Making a Serializable Class","pos":[1022,1064]},{"content":"Five main steps are required to make a class serializable.","pos":[1065,1123]},{"content":"They are listed below and explained in the following sections:","pos":[1124,1186]},{"pos":[1196,1316],"content":"<bpt id=\"p1\">[</bpt>Deriving your class from CObject<ept id=\"p1\">](#_core_deriving_your_class_from_cobject)</ept> (or from some class derived from <ph id=\"ph1\">`CObject`</ph>).","source":"[Deriving your class from CObject](#_core_deriving_your_class_from_cobject) (or from some class derived from `CObject`)."},{"pos":[1326,1418],"content":"<bpt id=\"p1\">[</bpt>Overriding the Serialize member function<ept id=\"p1\">](#_core_overriding_the_serialize_member_function)</ept>.","source":"[Overriding the Serialize member function](#_core_overriding_the_serialize_member_function)."},{"pos":[1428,1525],"content":"<bpt id=\"p1\">[</bpt>Using the DECLARE_SERIAL macro<ept id=\"p1\">](#_core_using_the_declare_serial_macro)</ept> in the class declaration.","source":"[Using the DECLARE_SERIAL macro](#_core_using_the_declare_serial_macro) in the class declaration."},{"pos":[1535,1633],"content":"<bpt id=\"p1\">[</bpt>Defining a constructor that takes no arguments<ept id=\"p1\">](#_core_defining_a_constructor_with_no_arguments)</ept>.","source":"[Defining a constructor that takes no arguments](#_core_defining_a_constructor_with_no_arguments)."},{"pos":[1643,1788],"content":"<bpt id=\"p1\">[</bpt>Using the IMPLEMENT_SERIAL macro in the implementation file<ept id=\"p1\">](#_core_using_the_implement_serial_macro_in_the_implementation_file)</ept> for your class.","source":"[Using the IMPLEMENT_SERIAL macro in the implementation file](#_core_using_the_implement_serial_macro_in_the_implementation_file) for your class."},{"pos":[1795,1979],"content":"If you call <ph id=\"ph1\">`Serialize`</ph> directly rather than through the &gt;&gt; and &lt;&lt; operators of <bpt id=\"p1\">[</bpt>CArchive<ept id=\"p1\">](../mfc/reference/carchive-class.md)</ept>, the last three steps are not required for serialization.","source":"If you call `Serialize` directly rather than through the >> and << operators of [CArchive](../mfc/reference/carchive-class.md), the last three steps are not required for serialization."},{"pos":[2043,2075],"content":"Deriving Your Class from CObject"},{"content":"The basic serialization protocol and functionality are defined in the <ph id=\"ph1\">`CObject`</ph> class.","pos":[2079,2165],"source":"The basic serialization protocol and functionality are defined in the `CObject` class."},{"content":"By deriving your class from <ph id=\"ph1\">`CObject`</ph> (or from a class derived from <ph id=\"ph2\">`CObject`</ph>), as shown in the following declaration of class <ph id=\"ph3\">`CPerson`</ph>, you gain access to the serialization protocol and functionality of <ph id=\"ph4\">`CObject`</ph>.","pos":[2166,2381],"source":" By deriving your class from `CObject` (or from a class derived from `CObject`), as shown in the following declaration of class `CPerson`, you gain access to the serialization protocol and functionality of `CObject`."},{"pos":[2453,2493],"content":"Overriding the Serialize Member Function"},{"content":"The <ph id=\"ph1\">`Serialize`</ph> member function, which is defined in the <ph id=\"ph2\">`CObject`</ph> class, is responsible for actually serializing the data necessary to capture an object's current state.","pos":[2497,2667],"source":"The `Serialize` member function, which is defined in the `CObject` class, is responsible for actually serializing the data necessary to capture an object's current state."},{"content":"The <ph id=\"ph1\">`Serialize`</ph> function has a <ph id=\"ph2\">`CArchive`</ph> argument that it uses to read and write the object data.","pos":[2668,2766],"source":" The `Serialize` function has a `CArchive` argument that it uses to read and write the object data."},{"content":"The <bpt id=\"p1\">[</bpt>CArchive<ept id=\"p1\">](../mfc/reference/carchive-class.md)</ept> object has a member function, <ph id=\"ph1\">`IsStoring`</ph>, which indicates whether <ph id=\"ph2\">`Serialize`</ph> is storing (writing data) or loading (reading data).","pos":[2767,2949],"source":" The [CArchive](../mfc/reference/carchive-class.md) object has a member function, `IsStoring`, which indicates whether `Serialize` is storing (writing data) or loading (reading data)."},{"content":"Using the results of <ph id=\"ph1\">`IsStoring`</ph> as a guide, you either insert your object's data in the <ph id=\"ph2\">`CArchive`</ph> object with the insertion operator (<bpt id=\"p1\">**</bpt><ph id=\"ph3\">&lt;\\&lt;</ph><ept id=\"p1\">**</ept>) or extract data with the extraction operator (<bpt id=\"p2\">**</bpt><ph id=\"ph4\">&gt;&gt;</ph><ept id=\"p2\">**</ept>).","pos":[2950,3149],"source":" Using the results of `IsStoring` as a guide, you either insert your object's data in the `CArchive` object with the insertion operator (**<\\<**) or extract data with the extraction operator (**>>**)."},{"content":"Consider a class that is derived from <ph id=\"ph1\">`CObject`</ph> and has two new member variables, of types <ph id=\"ph2\">`CString`</ph> and <bpt id=\"p1\">**</bpt>WORD<ept id=\"p1\">**</ept>.","pos":[3156,3270],"source":"Consider a class that is derived from `CObject` and has two new member variables, of types `CString` and **WORD**."},{"content":"The following class declaration fragment shows the new member variables and the declaration for the overridden <ph id=\"ph1\">`Serialize`</ph> member function:","pos":[3271,3410],"source":" The following class declaration fragment shows the new member variables and the declaration for the overridden `Serialize` member function:"},{"pos":[3428,3450],"content":"NVC_MFCSerialization#1"},{"content":"To override the Serialize member function","pos":[3533,3574]},{"pos":[3584,3696],"content":"Call your base class version of <ph id=\"ph1\">`Serialize`</ph> to make sure that the inherited portion of the object is serialized.","source":"Call your base class version of `Serialize` to make sure that the inherited portion of the object is serialized."},{"content":"Insert or extract the member variables specific to your class.","pos":[3706,3768]},{"content":"The insertion and extraction operators interact with the archive class to read and write the data.","pos":[3779,3877]},{"content":"The following example shows how to implement <ph id=\"ph1\">`Serialize`</ph> for the <ph id=\"ph2\">`CPerson`</ph> class declared above:","pos":[3878,3974],"source":" The following example shows how to implement `Serialize` for the `CPerson` class declared above:"},{"pos":[3996,4018],"content":"NVC_MFCSerialization#2"},{"pos":[4099,4327],"content":"You can also use the <bpt id=\"p1\">[</bpt>CArchive::Read<ept id=\"p1\">](../mfc/reference/carchive-class.md#carchive__read)</ept> and <bpt id=\"p2\">[</bpt>CArchive::Write<ept id=\"p2\">](../mfc/reference/carchive-class.md#carchive__write)</ept> member functions to read and write large amounts of untyped data.","source":"You can also use the [CArchive::Read](../mfc/reference/carchive-class.md#carchive__read) and [CArchive::Write](../mfc/reference/carchive-class.md#carchive__write) member functions to read and write large amounts of untyped data."},{"pos":[4389,4419],"content":"Using the DECLARE_SERIAL Macro"},{"pos":[4423,4539],"content":"The <ph id=\"ph1\">`DECLARE_SERIAL`</ph> macro is required in the declaration of classes that will support serialization, as shown here:","source":"The `DECLARE_SERIAL` macro is required in the declaration of classes that will support serialization, as shown here:"},{"pos":[4557,4579],"content":"NVC_MFCSerialization#3"},{"pos":[4723,4763],"content":"Defining a Constructor with No Arguments"},{"content":"MFC requires a default constructor when it re-creates your objects as they are deserialized (loaded from disk).","pos":[4767,4878]},{"content":"The deserialization process will fill in all member variables with the values required to re-create the object.","pos":[4879,4990]},{"content":"This constructor can be declared public, protected, or private.","pos":[4997,5060]},{"content":"If you make it protected or private, you help make sure that it will only be used by the serialization functions.","pos":[5061,5174]},{"content":"The constructor must put the object in a state that allows it to be deleted if necessary.","pos":[5175,5264]},{"pos":[5272,5534],"content":"[!NOTE]\n If you forget to define a constructor with no arguments in a class that uses the `DECLARE_SERIAL` and `IMPLEMENT_SERIAL` macros, you will get a \"no default constructor available\" compiler warning on the line where the `IMPLEMENT_SERIAL` macro is used.","leadings":["","> "],"nodes":[{"content":"If you forget to define a constructor with no arguments in a class that uses the <ph id=\"ph1\">`DECLARE_SERIAL`</ph> and <ph id=\"ph2\">`IMPLEMENT_SERIAL`</ph> macros, you will get a \"no default constructor available\" compiler warning on the line where the <ph id=\"ph3\">`IMPLEMENT_SERIAL`</ph> macro is used.","pos":[9,260],"source":" If you forget to define a constructor with no arguments in a class that uses the `DECLARE_SERIAL` and `IMPLEMENT_SERIAL` macros, you will get a \"no default constructor available\" compiler warning on the line where the `IMPLEMENT_SERIAL` macro is used."}]},{"pos":[5625,5684],"content":"Using the IMPLEMENT_SERIAL Macro in the Implementation File"},{"content":"The <ph id=\"ph1\">`IMPLEMENT_SERIAL`</ph> macro is used to define the various functions needed when you derive a serializable class from <ph id=\"ph2\">`CObject`</ph>.","pos":[5688,5816],"source":"The `IMPLEMENT_SERIAL` macro is used to define the various functions needed when you derive a serializable class from `CObject`."},{"content":"You use this macro in the implementation file (.CPP) for your class.","pos":[5817,5885]},{"content":"The first two arguments to the macro are the name of the class and the name of its immediate base class.","pos":[5886,5990]},{"content":"The third argument to this macro is a schema number.","pos":[5997,6049]},{"content":"The schema number is essentially a version number for objects of the class.","pos":[6050,6125]},{"content":"Use an integer greater than or equal to 0 for the schema number.","pos":[6126,6190]},{"content":"(Don't confuse this schema number with database terminology.)","pos":[6191,6252]},{"content":"The MFC serialization code checks the schema number when reading objects into memory.","pos":[6259,6344]},{"content":"If the schema number of the object on disk does not match the schema number of the class in memory, the library will throw a <ph id=\"ph1\">`CArchiveException`</ph>, preventing your program from reading an incorrect version of the object.","pos":[6345,6563],"source":" If the schema number of the object on disk does not match the schema number of the class in memory, the library will throw a `CArchiveException`, preventing your program from reading an incorrect version of the object."},{"content":"If you want your <ph id=\"ph1\">`Serialize`</ph> member function to be able to read multiple versions — that is, files written with different versions of the application — you can use the value <bpt id=\"p1\">**</bpt>VERSIONABLE_SCHEMA<ept id=\"p1\">**</ept> as an argument to the <ph id=\"ph2\">`IMPLEMENT_SERIAL`</ph> macro.","pos":[6570,6814],"source":"If you want your `Serialize` member function to be able to read multiple versions — that is, files written with different versions of the application — you can use the value **VERSIONABLE_SCHEMA** as an argument to the `IMPLEMENT_SERIAL` macro."},{"content":"For usage information and an example, see the <ph id=\"ph1\">`GetObjectSchema`</ph> member function of class <ph id=\"ph2\">`CArchive`</ph>.","pos":[6815,6915],"source":" For usage information and an example, see the `GetObjectSchema` member function of class `CArchive`."},{"pos":[6922,7035],"content":"The following example shows how to use <ph id=\"ph1\">`IMPLEMENT_SERIAL`</ph> for a class, <ph id=\"ph2\">`CPerson`</ph>, that is derived from <ph id=\"ph3\">`CObject`</ph>:","source":"The following example shows how to use `IMPLEMENT_SERIAL` for a class, `CPerson`, that is derived from `CObject`:"},{"pos":[7053,7075],"content":"NVC_MFCSerialization#4"},{"pos":[7156,7346],"content":"Once you have a serializable class, you can serialize objects of the class, as discussed in the article <bpt id=\"p1\">[</bpt>Serialization: Serializing an Object<ept id=\"p1\">](../mfc/serialization-serializing-an-object.md)</ept>.","source":"Once you have a serializable class, you can serialize objects of the class, as discussed in the article [Serialization: Serializing an Object](../mfc/serialization-serializing-an-object.md)."},{"content":"See Also","pos":[7355,7363]},{"content":"Serialization","pos":[7368,7381]}],"content":"---\ntitle: \"Serialization: Making a Serializable Class | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"serializable class\"\n  - \"DECLARE_SERIAL macro\"\n  - \"default constructor\"\n  - \"VERSIONABLE_SCHEMA macro\"\n  - \"classes [C++], derived\"\n  - \"IMPLEMENT_SERIAL macro\"\n  - \"no-arguments constructor\"\n  - \"Serialize method, overriding\"\n  - \"defaults [C++], constructor\"\n  - \"CObject class, deriving serializable classes\"\n  - \"constructors [C++], defining with no arguments\"\n  - \"serialization [C++], serializable classes\"\n  - \"no default constructor\"\nms.assetid: 59a14d32-1cc8-4275-9829-99639beee27c\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Serialization: Making a Serializable Class\nFive main steps are required to make a class serializable. They are listed below and explained in the following sections:  \n  \n1.  [Deriving your class from CObject](#_core_deriving_your_class_from_cobject) (or from some class derived from `CObject`).  \n  \n2.  [Overriding the Serialize member function](#_core_overriding_the_serialize_member_function).  \n  \n3.  [Using the DECLARE_SERIAL macro](#_core_using_the_declare_serial_macro) in the class declaration.  \n  \n4.  [Defining a constructor that takes no arguments](#_core_defining_a_constructor_with_no_arguments).  \n  \n5.  [Using the IMPLEMENT_SERIAL macro in the implementation file](#_core_using_the_implement_serial_macro_in_the_implementation_file) for your class.  \n  \n If you call `Serialize` directly rather than through the >> and << operators of [CArchive](../mfc/reference/carchive-class.md), the last three steps are not required for serialization.  \n  \n##  <a name=\"_core_deriving_your_class_from_cobject\"></a> Deriving Your Class from CObject  \n The basic serialization protocol and functionality are defined in the `CObject` class. By deriving your class from `CObject` (or from a class derived from `CObject`), as shown in the following declaration of class `CPerson`, you gain access to the serialization protocol and functionality of `CObject`.  \n  \n##  <a name=\"_core_overriding_the_serialize_member_function\"></a> Overriding the Serialize Member Function  \n The `Serialize` member function, which is defined in the `CObject` class, is responsible for actually serializing the data necessary to capture an object's current state. The `Serialize` function has a `CArchive` argument that it uses to read and write the object data. The [CArchive](../mfc/reference/carchive-class.md) object has a member function, `IsStoring`, which indicates whether `Serialize` is storing (writing data) or loading (reading data). Using the results of `IsStoring` as a guide, you either insert your object's data in the `CArchive` object with the insertion operator (**<\\<**) or extract data with the extraction operator (**>>**).  \n  \n Consider a class that is derived from `CObject` and has two new member variables, of types `CString` and **WORD**. The following class declaration fragment shows the new member variables and the declaration for the overridden `Serialize` member function:  \n  \n [!code-cpp[NVC_MFCSerialization#1](../mfc/codesnippet/cpp/serialization-making-a-serializable-class_1.h)]  \n  \n#### To override the Serialize member function  \n  \n1.  Call your base class version of `Serialize` to make sure that the inherited portion of the object is serialized.  \n  \n2.  Insert or extract the member variables specific to your class.  \n  \n     The insertion and extraction operators interact with the archive class to read and write the data. The following example shows how to implement `Serialize` for the `CPerson` class declared above:  \n  \n     [!code-cpp[NVC_MFCSerialization#2](../mfc/codesnippet/cpp/serialization-making-a-serializable-class_2.cpp)]  \n  \n You can also use the [CArchive::Read](../mfc/reference/carchive-class.md#carchive__read) and [CArchive::Write](../mfc/reference/carchive-class.md#carchive__write) member functions to read and write large amounts of untyped data.  \n  \n##  <a name=\"_core_using_the_declare_serial_macro\"></a> Using the DECLARE_SERIAL Macro  \n The `DECLARE_SERIAL` macro is required in the declaration of classes that will support serialization, as shown here:  \n  \n [!code-cpp[NVC_MFCSerialization#3](../mfc/codesnippet/cpp/serialization-making-a-serializable-class_3.h)]  \n  \n##  <a name=\"_core_defining_a_constructor_with_no_arguments\"></a> Defining a Constructor with No Arguments  \n MFC requires a default constructor when it re-creates your objects as they are deserialized (loaded from disk). The deserialization process will fill in all member variables with the values required to re-create the object.  \n  \n This constructor can be declared public, protected, or private. If you make it protected or private, you help make sure that it will only be used by the serialization functions. The constructor must put the object in a state that allows it to be deleted if necessary.  \n  \n> [!NOTE]\n>  If you forget to define a constructor with no arguments in a class that uses the `DECLARE_SERIAL` and `IMPLEMENT_SERIAL` macros, you will get a \"no default constructor available\" compiler warning on the line where the `IMPLEMENT_SERIAL` macro is used.  \n  \n##  <a name=\"_core_using_the_implement_serial_macro_in_the_implementation_file\"></a> Using the IMPLEMENT_SERIAL Macro in the Implementation File  \n The `IMPLEMENT_SERIAL` macro is used to define the various functions needed when you derive a serializable class from `CObject`. You use this macro in the implementation file (.CPP) for your class. The first two arguments to the macro are the name of the class and the name of its immediate base class.  \n  \n The third argument to this macro is a schema number. The schema number is essentially a version number for objects of the class. Use an integer greater than or equal to 0 for the schema number. (Don't confuse this schema number with database terminology.)  \n  \n The MFC serialization code checks the schema number when reading objects into memory. If the schema number of the object on disk does not match the schema number of the class in memory, the library will throw a `CArchiveException`, preventing your program from reading an incorrect version of the object.  \n  \n If you want your `Serialize` member function to be able to read multiple versions — that is, files written with different versions of the application — you can use the value **VERSIONABLE_SCHEMA** as an argument to the `IMPLEMENT_SERIAL` macro. For usage information and an example, see the `GetObjectSchema` member function of class `CArchive`.  \n  \n The following example shows how to use `IMPLEMENT_SERIAL` for a class, `CPerson`, that is derived from `CObject`:  \n  \n [!code-cpp[NVC_MFCSerialization#4](../mfc/codesnippet/cpp/serialization-making-a-serializable-class_4.cpp)]  \n  \n Once you have a serializable class, you can serialize objects of the class, as discussed in the article [Serialization: Serializing an Object](../mfc/serialization-serializing-an-object.md).  \n  \n## See Also  \n [Serialization](../mfc/serialization-in-mfc.md)\n\n"}