{"nodes":[{"pos":[12,54],"content":"Event Handling Principles | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Event Handling Principles | Microsoft Docs","pos":[0,42]}]},{"content":"Event Handling Principles","pos":[786,811]},{"content":"There are three steps common to all event handling.","pos":[812,863]},{"content":"You will need to:","pos":[864,881]},{"content":"Implement the event interface on your object.","pos":[891,936]},{"content":"Advise the event source that your object wants to receive events.","pos":[946,1011]},{"content":"Unadvise the event source when your object no longer needs to receive events.","pos":[1021,1098]},{"content":"The way that you'll implement the event interface will depend on its type.","pos":[1105,1179]},{"content":"An event interface can be vtable, dual, or a dispinterface.","pos":[1180,1239]},{"content":"It's up to the designer of the event source to define the interface; it's up to you to implement that interface.","pos":[1240,1352]},{"pos":[1360,1886],"content":"[!NOTE]\n Although there are no technical reasons that an event interface can't be dual, there are a number of good design reasons to avoid the use of duals. However, this is a decision made by the designer/implementer of the event *source*. Since you're working from the perspective of the event `sink`, you need to allow for the possibility that you might not have any choice but to implement a dual event interface. For more information on dual interfaces, see [Dual Interfaces and ATL](../atl/dual-interfaces-and-atl.md).","leadings":["","> "],"nodes":[{"content":" Although there are no technical reasons that an event interface can't be dual, there are a number of good design reasons to avoid the use of duals. However, this is a decision made by the designer/implementer of the event *source*. Since you're working from the perspective of the event `sink`, you need to allow for the possibility that you might not have any choice but to implement a dual event interface. For more information on dual interfaces, see [Dual Interfaces and ATL](../atl/dual-interfaces-and-atl.md).","pos":[8,524],"nodes":[{"content":"Although there are no technical reasons that an event interface can't be dual, there are a number of good design reasons to avoid the use of duals.","pos":[1,148]},{"content":"However, this is a decision made by the designer/implementer of the event <bpt id=\"p1\">*</bpt>source<ept id=\"p1\">*</ept>.","pos":[149,232],"source":" However, this is a decision made by the designer/implementer of the event *source*."},{"content":"Since you're working from the perspective of the event <ph id=\"ph1\">`sink`</ph>, you need to allow for the possibility that you might not have any choice but to implement a dual event interface.","pos":[233,409],"source":" Since you're working from the perspective of the event `sink`, you need to allow for the possibility that you might not have any choice but to implement a dual event interface."},{"content":"For more information on dual interfaces, see <bpt id=\"p1\">[</bpt>Dual Interfaces and ATL<ept id=\"p1\">](../atl/dual-interfaces-and-atl.md)</ept>.","pos":[410,516],"source":" For more information on dual interfaces, see [Dual Interfaces and ATL](../atl/dual-interfaces-and-atl.md)."}]}]},{"content":"Advising the event source can be broken down into three steps:","pos":[1893,1955]},{"pos":[1965,2081],"content":"Query the source object for <bpt id=\"p1\">[</bpt>IConnectionPointContainer<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms683857)</ept>.","source":"Query the source object for [IConnectionPointContainer](http://msdn.microsoft.com/library/windows/desktop/ms683857)."},{"content":"Call <bpt id=\"p1\">[</bpt>IConnectionPointContainer::FindConnectionPoint<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms692476)</ept> passing the IID of the event interface that interests you.","pos":[2091,2263],"source":"Call [IConnectionPointContainer::FindConnectionPoint](http://msdn.microsoft.com/library/windows/desktop/ms692476) passing the IID of the event interface that interests you."},{"content":"If successful, this will return the <bpt id=\"p1\">[</bpt>IConnectionPoint<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms694318)</ept> interface on a connection point object.","pos":[2264,2418],"source":" If successful, this will return the [IConnectionPoint](http://msdn.microsoft.com/library/windows/desktop/ms694318) interface on a connection point object."},{"content":"Call <bpt id=\"p1\">[</bpt>IConnectionPoint::Advise<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms678815)</ept> passing the <bpt id=\"p2\">**</bpt>IUnknown<ept id=\"p2\">**</ept> of the event sink.","pos":[2428,2563],"source":"Call [IConnectionPoint::Advise](http://msdn.microsoft.com/library/windows/desktop/ms678815) passing the **IUnknown** of the event sink."},{"content":"If successful, this will return a <ph id=\"ph1\">`DWORD`</ph> cookie representing the connection.","pos":[2564,2641],"source":" If successful, this will return a `DWORD` cookie representing the connection."},{"content":"Once you have successfully registered your interest in receiving events, methods on your object's event interface will be called according to the events fired by the source object.","pos":[2648,2828]},{"content":"When you no longer need to receive events, you can pass the cookie back to the connection point via <bpt id=\"p1\">[</bpt>IConnectionPoint::Unadvise<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms686608)</ept>.","pos":[2829,3018],"source":" When you no longer need to receive events, you can pass the cookie back to the connection point via [IConnectionPoint::Unadvise](http://msdn.microsoft.com/library/windows/desktop/ms686608)."},{"content":"This will break the connection between source and sink.","pos":[3019,3074]},{"content":"Be careful to avoid reference cycles when handling events.","pos":[3081,3139]},{"content":"See Also","pos":[3148,3156]},{"content":"Event Handling","pos":[3161,3175]}],"content":"---\ntitle: \"Event Handling Principles | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"event handling, implementing\"\n  - \"event handling, advising event sources\"\n  - \"interfaces, event and event sink\"\n  - \"dual interfaces, event interfaces\"\n  - \"event handling, dual event interfaces\"\nms.assetid: d17ca7cb-54f2-4658-ab8b-b721ac56801d\ncaps.latest.revision: 10\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"ru-ru\"\n  - \"zh-cn\"\n  - \"zh-tw\"\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# Event Handling Principles\nThere are three steps common to all event handling. You will need to:  \n  \n-   Implement the event interface on your object.  \n  \n-   Advise the event source that your object wants to receive events.  \n  \n-   Unadvise the event source when your object no longer needs to receive events.  \n  \n The way that you'll implement the event interface will depend on its type. An event interface can be vtable, dual, or a dispinterface. It's up to the designer of the event source to define the interface; it's up to you to implement that interface.  \n  \n> [!NOTE]\n>  Although there are no technical reasons that an event interface can't be dual, there are a number of good design reasons to avoid the use of duals. However, this is a decision made by the designer/implementer of the event *source*. Since you're working from the perspective of the event `sink`, you need to allow for the possibility that you might not have any choice but to implement a dual event interface. For more information on dual interfaces, see [Dual Interfaces and ATL](../atl/dual-interfaces-and-atl.md).  \n  \n Advising the event source can be broken down into three steps:  \n  \n-   Query the source object for [IConnectionPointContainer](http://msdn.microsoft.com/library/windows/desktop/ms683857).  \n  \n-   Call [IConnectionPointContainer::FindConnectionPoint](http://msdn.microsoft.com/library/windows/desktop/ms692476) passing the IID of the event interface that interests you. If successful, this will return the [IConnectionPoint](http://msdn.microsoft.com/library/windows/desktop/ms694318) interface on a connection point object.  \n  \n-   Call [IConnectionPoint::Advise](http://msdn.microsoft.com/library/windows/desktop/ms678815) passing the **IUnknown** of the event sink. If successful, this will return a `DWORD` cookie representing the connection.  \n  \n Once you have successfully registered your interest in receiving events, methods on your object's event interface will be called according to the events fired by the source object. When you no longer need to receive events, you can pass the cookie back to the connection point via [IConnectionPoint::Unadvise](http://msdn.microsoft.com/library/windows/desktop/ms686608). This will break the connection between source and sink.  \n  \n Be careful to avoid reference cycles when handling events.  \n  \n## See Also  \n [Event Handling](../atl/event-handling-and-atl.md)\n\n"}