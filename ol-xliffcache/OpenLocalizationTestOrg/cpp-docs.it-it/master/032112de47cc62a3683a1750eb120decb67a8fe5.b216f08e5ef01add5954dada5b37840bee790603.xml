{"nodes":[{"pos":[12,38],"content":"_heapwalk | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"_heapwalk | Microsoft Docs","pos":[0,26]}]},{"content":"_heapwalk","pos":[996,1005]},{"content":"Traverses the heap and returns information about the next entry.","pos":[1006,1070]},{"pos":[1078,1321],"content":"[!IMPORTANT]\n This API cannot be used in applications that execute in the Windows Runtime except in Debug builds. For more information, see [CRT functions not supported with /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx).","leadings":["","> "],"nodes":[{"content":" This API cannot be used in applications that execute in the Windows Runtime except in Debug builds. For more information, see [CRT functions not supported with /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx).","pos":[13,241],"nodes":[{"content":"This API cannot be used in applications that execute in the Windows Runtime except in Debug builds.","pos":[1,100]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>CRT functions not supported with /ZW<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx)</ept>.","pos":[101,228],"source":" For more information, see [CRT functions not supported with /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx)."}]}]},{"content":"Syntax","pos":[1330,1336]},{"content":"Parameters","pos":[1412,1422]},{"content":"Buffer to contain heap information.","pos":[1441,1476]},{"content":"Return Value","pos":[1485,1497]},{"pos":[1513,1589],"content":"returns one of the following integer manifest constants defined in Malloc.h."},{"content":"Initial header information invalid or not found.","pos":[1615,1663]},{"content":"Heap damaged or bad node found.","pos":[1688,1719]},{"content":"field of the <ph id=\"ph1\">`_HEAPINFO`</ph> structure does not contain a valid pointer into the heap or <ph id=\"ph2\">`entryinfo`</ph> is a null pointer.","pos":[1753,1868],"source":" field of the `_HEAPINFO` structure does not contain a valid pointer into the heap or `entryinfo` is a null pointer."},{"content":"End of the heap reached successfully.","pos":[1889,1926]},{"content":"Heap not initialized.","pos":[1949,1970]},{"content":"No errors so far; <ph id=\"ph1\">`entryinfo`</ph> is updated with information about the next heap entry.","pos":[1990,2074],"source":" No errors so far; `entryinfo` is updated with information about the next heap entry."},{"pos":[2081,2151],"content":"In addition, if an error occurs, <ph id=\"ph1\">`_heapwalk`</ph> sets <ph id=\"ph2\">`errno`</ph> to <ph id=\"ph3\">`ENOSYS`</ph>.","source":"In addition, if an error occurs, `_heapwalk` sets `errno` to `ENOSYS`."},{"content":"Remarks","pos":[2160,2167]},{"content":"The <ph id=\"ph1\">`_heapwalk`</ph> function helps debug heap-related problems in programs.","pos":[2171,2242],"source":"The `_heapwalk` function helps debug heap-related problems in programs."},{"content":"The function walks through the heap, traversing one entry per call, and returns a pointer to a structure of type <ph id=\"ph1\">`_HEAPINFO`</ph> that contains information about the next heap entry.","pos":[2243,2420],"source":" The function walks through the heap, traversing one entry per call, and returns a pointer to a structure of type `_HEAPINFO` that contains information about the next heap entry."},{"content":"The <ph id=\"ph1\">`_HEAPINFO`</ph> type, defined in Malloc.h, contains the following elements.","pos":[2421,2496],"source":" The `_HEAPINFO` type, defined in Malloc.h, contains the following elements."},{"content":"Heap entry pointer.","pos":[2521,2540]},{"content":"Size of the heap entry.","pos":[2565,2588]},{"content":"Flag that indicates whether the heap entry is in use.","pos":[2613,2666]},{"content":"A call to <ph id=\"ph1\">`_heapwalk`</ph> that returns <ph id=\"ph2\">`_HEAPOK`</ph> stores the size of the entry in the <ph id=\"ph3\">`_size`</ph> field and sets the <ph id=\"ph4\">`_useflag`</ph> field to either <ph id=\"ph5\">`_FREEENTRY`</ph> or <ph id=\"ph6\">`_USEDENTRY`</ph> (both are constants defined in Malloc.h).","pos":[2673,2878],"source":"A call to `_heapwalk` that returns `_HEAPOK` stores the size of the entry in the `_size` field and sets the `_useflag` field to either `_FREEENTRY` or `_USEDENTRY` (both are constants defined in Malloc.h)."},{"content":"To obtain this information about the first entry in the heap, pass <ph id=\"ph1\">`_heapwalk`</ph> a pointer to a <ph id=\"ph2\">`_HEAPINFO`</ph> structure whose <ph id=\"ph3\">`_pentry`</ph> member is <ph id=\"ph4\">`NULL`</ph>.","pos":[2879,3028],"source":" To obtain this information about the first entry in the heap, pass `_heapwalk` a pointer to a `_HEAPINFO` structure whose `_pentry` member is `NULL`."},{"content":"If the operating system does not support <ph id=\"ph1\">`_heapwalk`</ph>(for example, Windows 98), the function returns <ph id=\"ph2\">`_HEAPEND`</ph> and sets <ph id=\"ph3\">`errno`</ph> to <ph id=\"ph4\">`ENOSYS`</ph>.","pos":[3029,3169],"source":" If the operating system does not support `_heapwalk`(for example, Windows 98), the function returns `_HEAPEND` and sets `errno` to `ENOSYS`."},{"content":"This function validates its parameter.","pos":[3176,3214]},{"content":"If <ph id=\"ph1\">`entryinfo`</ph> is a null pointer, the invalid parameter handler is invoked, as described in <bpt id=\"p1\">[</bpt>Parameter Validation<ept id=\"p1\">](../../c-runtime-library/parameter-validation.md)</ept>.","pos":[3215,3379],"source":" If `entryinfo` is a null pointer, the invalid parameter handler is invoked, as described in [Parameter Validation](../../c-runtime-library/parameter-validation.md)."},{"content":"If execution is allowed to continue, <ph id=\"ph1\">`errno`</ph> is set to <ph id=\"ph2\">`EINVAL`</ph> and the function returns <ph id=\"ph3\">`_HEAPBADPTR`</ph>.","pos":[3380,3483],"source":" If execution is allowed to continue, `errno` is set to `EINVAL` and the function returns `_HEAPBADPTR`."},{"content":"Requirements","pos":[3492,3504]},{"content":"Routine","pos":[3511,3518]},{"content":"Required header","pos":[3519,3534]},{"content":"Optional header","pos":[3535,3550]},{"content":"malloc.h&gt;","pos":[3631,3640],"source":"malloc.h>"},{"content":"errno.h&gt;","pos":[3643,3651],"source":"errno.h>"},{"pos":[3659,3757],"content":"For more compatibility information, see <bpt id=\"p1\">[</bpt>Compatibility<ept id=\"p1\">](../../c-runtime-library/compatibility.md)</ept>.","source":"For more compatibility information, see [Compatibility](../../c-runtime-library/compatibility.md)."},{"content":"Example","pos":[3766,3773]},{"content":".NET Framework Equivalent","pos":[5811,5836]},{"content":"Not applicable.","pos":[5840,5855]},{"content":"To call the standard C function, use <ph id=\"ph1\">`PInvoke`</ph>.","pos":[5856,5903],"source":" To call the standard C function, use `PInvoke`."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Platform Invoke Examples<ept id=\"p1\">](http://msdn.microsoft.com/Library/15926806-f0b7-487e-93a6-4e9367ec689f)</ept>.","pos":[5904,6029],"source":" For more information, see [Platform Invoke Examples](http://msdn.microsoft.com/Library/15926806-f0b7-487e-93a6-4e9367ec689f)."},{"content":"See Also","pos":[6038,6046]},{"content":"Memory Allocation","pos":[6051,6068]},{"content":"_heapadd","pos":[6121,6129]},{"content":"_heapchk","pos":[6172,6180]},{"content":"_heapmin","pos":[6233,6241]},{"content":"_heapset","pos":[6294,6302]}],"content":"---\ntitle: \"_heapwalk | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\napiname: \n  - \"_heapwalk\"\napilocation: \n  - \"msvcrt.dll\"\n  - \"msvcr80.dll\"\n  - \"msvcr90.dll\"\n  - \"msvcr100.dll\"\n  - \"msvcr100_clr0400.dll\"\n  - \"msvcr110.dll\"\n  - \"msvcr110_clr0400.dll\"\n  - \"msvcr120.dll\"\n  - \"msvcr120_clr0400.dll\"\n  - \"ucrtbase.dll\"\n  - \"api-ms-win-crt-heap-l1-1-0.dll\"\napitype: \"DLLExport\"\nf1_keywords: \n  - \"heapwalk\"\n  - \"_heapwalk\"\ndev_langs: \n  - \"C++\"\n  - \"C\"\nhelpviewer_keywords: \n  - \"debugging [CRT], heap-related problems\"\n  - \"heapwalk function\"\n  - \"_heapwalk function\"\nms.assetid: 2df67649-fb00-4570-a8b1-a4eca5738744\ncaps.latest.revision: 22\nauthor: \"corob-msft\"\nms.author: \"corob\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# _heapwalk\nTraverses the heap and returns information about the next entry.  \n  \n> [!IMPORTANT]\n>  This API cannot be used in applications that execute in the Windows Runtime except in Debug builds. For more information, see [CRT functions not supported with /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx).  \n  \n## Syntax  \n  \n```  \nint _heapwalk(   \n   _HEAPINFO *entryinfo   \n);  \n```  \n  \n#### Parameters  \n `entryinfo`  \n Buffer to contain heap information.  \n  \n## Return Value  \n `_heapwalk` returns one of the following integer manifest constants defined in Malloc.h.  \n  \n `_HEAPBADBEGIN`  \n Initial header information invalid or not found.  \n  \n `_HEAPBADNODE`  \n Heap damaged or bad node found.  \n  \n `_HEAPBADPTR`  \n `_pentry` field of the `_HEAPINFO` structure does not contain a valid pointer into the heap or `entryinfo` is a null pointer.  \n  \n `_HEAPEND`  \n End of the heap reached successfully.  \n  \n `_HEAPEMPTY`  \n Heap not initialized.  \n  \n `_HEAPOK`  \n No errors so far; `entryinfo` is updated with information about the next heap entry.  \n  \n In addition, if an error occurs, `_heapwalk` sets `errno` to `ENOSYS`.  \n  \n## Remarks  \n The `_heapwalk` function helps debug heap-related problems in programs. The function walks through the heap, traversing one entry per call, and returns a pointer to a structure of type `_HEAPINFO` that contains information about the next heap entry. The `_HEAPINFO` type, defined in Malloc.h, contains the following elements.  \n  \n `int *_pentry`  \n Heap entry pointer.  \n  \n `size_t _size`  \n Size of the heap entry.  \n  \n `int _useflag`  \n Flag that indicates whether the heap entry is in use.  \n  \n A call to `_heapwalk` that returns `_HEAPOK` stores the size of the entry in the `_size` field and sets the `_useflag` field to either `_FREEENTRY` or `_USEDENTRY` (both are constants defined in Malloc.h). To obtain this information about the first entry in the heap, pass `_heapwalk` a pointer to a `_HEAPINFO` structure whose `_pentry` member is `NULL`. If the operating system does not support `_heapwalk`(for example, Windows 98), the function returns `_HEAPEND` and sets `errno` to `ENOSYS`.  \n  \n This function validates its parameter. If `entryinfo` is a null pointer, the invalid parameter handler is invoked, as described in [Parameter Validation](../../c-runtime-library/parameter-validation.md). If execution is allowed to continue, `errno` is set to `EINVAL` and the function returns `_HEAPBADPTR`.  \n  \n## Requirements  \n  \n|Routine|Required header|Optional header|  \n|-------------|---------------------|---------------------|  \n|`_heapwalk`|\\<malloc.h>|\\<errno.h>|  \n  \n For more compatibility information, see [Compatibility](../../c-runtime-library/compatibility.md).  \n  \n## Example  \n  \n```  \n// crt_heapwalk.c  \n  \n// This program \"walks\" the heap, starting  \n// at the beginning (_pentry = NULL). It prints out each  \n// heap entry's use, location, and size. It also prints  \n// out information about the overall state of the heap as  \n// soon as _heapwalk returns a value other than _HEAPOK  \n// or if the loop has iterated 100 times.  \n  \n#include <stdio.h>  \n#include <malloc.h>  \n  \nvoid heapdump(void);  \n  \nint main(void)  \n{  \n    char *buffer;  \n  \n    heapdump();  \n    if((buffer = (char *)malloc(59)) != NULL)  \n    {  \n        heapdump();  \n        free(buffer);  \n    }  \n    heapdump();  \n}  \n  \nvoid heapdump(void)  \n{  \n    _HEAPINFO hinfo;  \n    int heapstatus;  \n    int numLoops;  \n    hinfo._pentry = NULL;  \n    numLoops = 0;  \n    while((heapstatus = _heapwalk(&hinfo)) == _HEAPOK &&  \n          numLoops < 100)  \n    {  \n        printf(\"%6s block at %Fp of size %4.4X\\n\",  \n               (hinfo._useflag == _USEDENTRY ? \"USED\" : \"FREE\"),  \n               hinfo._pentry, hinfo._size);  \n        numLoops++;  \n    }  \n  \n    switch(heapstatus)  \n    {  \n    case _HEAPEMPTY:  \n        printf(\"OK - empty heap\\n\");  \n        break;  \n    case _HEAPEND:  \n        printf(\"OK - end of heap\\n\");  \n        break;  \n    case _HEAPBADPTR:  \n        printf(\"ERROR - bad pointer to heap\\n\");  \n        break;  \n    case _HEAPBADBEGIN:  \n        printf(\"ERROR - bad start of heap\\n\");  \n        break;  \n    case _HEAPBADNODE:  \n        printf(\"ERROR - bad node in heap\\n\");  \n        break;  \n    }  \n}  \n```  \n  \n```Output  \n  USED block at 00310650 of size 0100  \n  USED block at 00310758 of size 0800  \n  USED block at 00310F60 of size 0080  \n  FREE block at 00310FF0 of size 0398  \n  USED block at 00311390 of size 000D  \n  USED block at 003113A8 of size 00B4  \n  USED block at 00311468 of size 0034  \n  USED block at 003114A8 of size 0039  \n...  \n  USED block at 00312228 of size 0010  \n  USED block at 00312240 of size 1000  \n  FREE block at 00313250 of size 1DB0  \nOK - end of heap  \n```  \n  \n## .NET Framework Equivalent  \n Not applicable. To call the standard C function, use `PInvoke`. For more information, see [Platform Invoke Examples](http://msdn.microsoft.com/Library/15926806-f0b7-487e-93a6-4e9367ec689f).  \n  \n## See Also  \n [Memory Allocation](../../c-runtime-library/memory-allocation.md)   \n [_heapadd](../../c-runtime-library/heapadd.md)   \n [_heapchk](../../c-runtime-library/reference/heapchk.md)   \n [_heapmin](../../c-runtime-library/reference/heapmin.md)   \n [_heapset](../../c-runtime-library/heapset.md)"}