{"nodes":[{"pos":[12,60],"content":"Fundamentals of ATL COM Objects | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Fundamentals of ATL COM Objects | Microsoft Docs","pos":[0,48]}]},{"content":"Fundamentals of ATL COM Objects","pos":[642,673]},{"content":"The following illustration depicts the relationship among the classes and interfaces that are used to define an ATL COM object.","pos":[674,801]},{"content":"ATL structure","pos":[810,823]},{"pos":[868,1032],"content":"[!NOTE]\n This diagram shows that `CComObject` is derived from `CYourClass` whereas `CComAggObject` and `CComPolyObject` include `CYourClass` as a member variable.","leadings":["","> "],"nodes":[{"content":"This diagram shows that <ph id=\"ph1\">`CComObject`</ph> is derived from <ph id=\"ph2\">`CYourClass`</ph> whereas <ph id=\"ph3\">`CComAggObject`</ph> and <ph id=\"ph4\">`CComPolyObject`</ph> include <ph id=\"ph5\">`CYourClass`</ph> as a member variable.","pos":[9,162],"source":" This diagram shows that `CComObject` is derived from `CYourClass` whereas `CComAggObject` and `CComPolyObject` include `CYourClass` as a member variable."}]},{"content":"There are three ways to define an ATL COM object.","pos":[1039,1088]},{"content":"The standard option is to use the <ph id=\"ph1\">`CComObject`</ph> class which is derived from <ph id=\"ph2\">`CYourClass`</ph>.","pos":[1089,1177],"source":" The standard option is to use the `CComObject` class which is derived from `CYourClass`."},{"content":"The second option is to create an aggregated object by using the <ph id=\"ph1\">`CComAggObject`</ph> class.","pos":[1178,1265],"source":" The second option is to create an aggregated object by using the `CComAggObject` class."},{"content":"The third option is to use the <ph id=\"ph1\">`CComPolyObject`</ph> class.","pos":[1266,1320],"source":" The third option is to use the `CComPolyObject` class."},{"content":"acts as a hybrid: it can function as a <ph id=\"ph1\">`CComObject`</ph> class or as a <ph id=\"ph2\">`CComAggObject`</ph> class, depending on how it is first created.","pos":[1338,1464],"source":" acts as a hybrid: it can function as a `CComObject` class or as a `CComAggObject` class, depending on how it is first created."},{"content":"For more information about how to use the <ph id=\"ph1\">`CComPolyObject`</ph> class, see <bpt id=\"p1\">[</bpt>CComPolyObject Class<ept id=\"p1\">](../atl/reference/ccompolyobject-class.md)</ept>.","pos":[1465,1600],"source":" For more information about how to use the `CComPolyObject` class, see [CComPolyObject Class](../atl/reference/ccompolyobject-class.md)."},{"content":"When you use standard ATL COM, you use two objects: an outer object and an inner object.","pos":[1607,1695]},{"content":"External clients access the functionality of the inner object through the wrapper functions that are defined in the outer object.","pos":[1696,1825]},{"content":"The outer object is of type <ph id=\"ph1\">`CComObject`</ph>.","pos":[1826,1867],"source":" The outer object is of type `CComObject`."},{"content":"When you use an aggregated object, the outer object does not provide wrappers for the functionality of the inner object.","pos":[1874,1994]},{"content":"Instead, the outer object provides a pointer that is directly accessed by external clients.","pos":[1995,2086]},{"content":"In this scenario, the outer object is of type <ph id=\"ph1\">`CComAggObject`</ph>.","pos":[2087,2149],"source":" In this scenario, the outer object is of type `CComAggObject`."},{"content":"The inner object is a member variable of the outer object, and it is of type <ph id=\"ph1\">`CYourClass`</ph>.","pos":[2150,2240],"source":" The inner object is a member variable of the outer object, and it is of type `CYourClass`."},{"content":"Because the client does not have to go through the outer object to interact with the inner object, aggregated objects are usually more efficient.","pos":[2247,2392]},{"content":"Also, the outer object does not have to know the functionality of the aggregated object, given that the interface of the aggregated object is directly available to the client.","pos":[2393,2568]},{"content":"However, not all objects can be aggregated.","pos":[2569,2612]},{"content":"For an object to be aggregated, it needs to be designed with aggregation in mind.","pos":[2613,2694]},{"pos":[2701,2801],"content":"ATL implements <bpt id=\"p1\">[</bpt>IUnknown<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ms680509)</ept> in two phases:","source":"ATL implements [IUnknown](http://msdn.microsoft.com/library/windows/desktop/ms680509) in two phases:"},{"pos":[2811,3019],"content":"<bpt id=\"p1\">[</bpt>CComObject<ept id=\"p1\">](../atl/reference/ccomobject-class.md)</ept>, <bpt id=\"p2\">[</bpt>CComAggObject<ept id=\"p2\">](../atl/reference/ccomaggobject-class.md)</ept>, or <bpt id=\"p3\">[</bpt>CComPolyObject<ept id=\"p3\">](../atl/reference/ccompolyobject-class.md)</ept> implements the <bpt id=\"p4\">**</bpt>IUnknown<ept id=\"p4\">**</ept> methods.","source":"[CComObject](../atl/reference/ccomobject-class.md), [CComAggObject](../atl/reference/ccomaggobject-class.md), or [CComPolyObject](../atl/reference/ccompolyobject-class.md) implements the **IUnknown** methods."},{"pos":[3029,3217],"content":"<bpt id=\"p1\">[</bpt>CComObjectRoot<ept id=\"p1\">](../atl/reference/ccomobjectroot-class.md)</ept> or <bpt id=\"p2\">[</bpt>CComObjectRootEx<ept id=\"p2\">](../atl/reference/ccomobjectrootex-class.md)</ept> manages the reference count and outer pointers of <bpt id=\"p3\">**</bpt>IUnknown<ept id=\"p3\">**</ept>.","source":"[CComObjectRoot](../atl/reference/ccomobjectroot-class.md) or [CComObjectRootEx](../atl/reference/ccomobjectrootex-class.md) manages the reference count and outer pointers of **IUnknown**."},{"content":"Other aspects of your ATL COM object are handled by other classes:","pos":[3224,3290]},{"pos":[3300,3418],"content":"<bpt id=\"p1\">[</bpt>CComCoClass<ept id=\"p1\">](../atl/reference/ccomcoclass-class.md)</ept> defines the object's default class factory and aggregation model.","source":"[CComCoClass](../atl/reference/ccomcoclass-class.md) defines the object's default class factory and aggregation model."},{"pos":[3428,3593],"content":"<bpt id=\"p1\">[</bpt>IDispatchImpl<ept id=\"p1\">](../atl/reference/idispatchimpl-class.md)</ept> provides a default implementation of the <ph id=\"ph1\">`IDispatch Interface`</ph> portion of any dual interfaces on the object.","source":"[IDispatchImpl](../atl/reference/idispatchimpl-class.md) provides a default implementation of the `IDispatch Interface` portion of any dual interfaces on the object."},{"pos":[3603,3800],"content":"<bpt id=\"p1\">[</bpt>ISupportErrorInfoImpl<ept id=\"p1\">](../atl/reference/isupporterrorinfoimpl-class.md)</ept> implements the <bpt id=\"p2\">**</bpt>ISupportErrorInfo<ept id=\"p2\">**</ept> interface that ensures error information can be propagated up the call chain correctly.","source":"[ISupportErrorInfoImpl](../atl/reference/isupporterrorinfoimpl-class.md) implements the **ISupportErrorInfo** interface that ensures error information can be propagated up the call chain correctly."},{"content":"In This Section","pos":[3809,3824]},{"content":"Implementing CComObjectRootEx","pos":[3829,3858]},{"content":"Show example COM map entries for implementing <ph id=\"ph1\">`CComObjectRootEx`</ph>.","pos":[3904,3969],"source":" Show example COM map entries for implementing `CComObjectRootEx`."},{"content":"Implementing CComObject, CComAggObject, and CComPolyObject","pos":[3977,4035]},{"content":"Discusses how the <bpt id=\"p1\">**</bpt>DECLARE_<ph id=\"ph1\">\\*</ph>_AGGREGATABLE<ept id=\"p1\">**</ept> macros affect the use of <ph id=\"ph2\">`CComObject`</ph>, <ph id=\"ph3\">`CComAggObject`</ph>, and <ph id=\"ph4\">`CComPolyObject`</ph>.","pos":[4108,4231],"source":" Discusses how the **DECLARE_\\*_AGGREGATABLE** macros affect the use of `CComObject`, `CComAggObject`, and `CComPolyObject`."},{"content":"Supporting IDispatch and IErrorInfo","pos":[4239,4274]},{"content":"Lists the ATL implementation classes to use for supporting the <ph id=\"ph1\">`IDispatch`</ph> and <bpt id=\"p1\">**</bpt>IErrorInfo<ept id=\"p1\">**</ept> interfaces.","pos":[4326,4431],"source":" Lists the ATL implementation classes to use for supporting the `IDispatch` and **IErrorInfo** interfaces."},{"content":"Supporting IDispEventImpl","pos":[4439,4464]},{"content":"Discusses the steps to implement a connection point for your class.","pos":[4506,4573]},{"content":"Changing the Default Class Factory and Aggregation Model","pos":[4581,4637]},{"content":"Show what macros to use to change the default class factory and aggregation model.","pos":[4710,4792]},{"content":"Creating an Aggregated Object","pos":[4800,4829]},{"content":"Lists the steps for creating an aggregated object.","pos":[4875,4925]},{"content":"Related Sections","pos":[4934,4950]},{"content":"Creating an ATL Project","pos":[4955,4978]},{"content":"Provides information about creating an ATL COM object.","pos":[5028,5082]},{"content":"ATL","pos":[5090,5093]},{"content":"Provides links to conceptual topics on how to program using the Active Template Library.","pos":[5146,5234]},{"content":"See Also","pos":[5243,5251]},{"content":"Concepts","pos":[5256,5264]}],"content":"---\ntitle: \"Fundamentals of ATL COM Objects | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"11/04/2016\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-cpp\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"COM, and ATL\"\n  - \"ATL, COM\"\n  - \"ATL COM objects\"\n  - \"COM objects, ATL\"\nms.assetid: 0f9c9d98-cc28-45da-89ac-dc94cee422fe\ncaps.latest.revision: 25\nauthor: \"mikeblome\"\nms.author: \"mblome\"\nmanager: \"ghogen\"\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Fundamentals of ATL COM Objects\nThe following illustration depicts the relationship among the classes and interfaces that are used to define an ATL COM object.  \n  \n ![ATL structure](../atl/media/vc307y1.gif \"vc307y1\")  \n  \n> [!NOTE]\n>  This diagram shows that `CComObject` is derived from `CYourClass` whereas `CComAggObject` and `CComPolyObject` include `CYourClass` as a member variable.  \n  \n There are three ways to define an ATL COM object. The standard option is to use the `CComObject` class which is derived from `CYourClass`. The second option is to create an aggregated object by using the `CComAggObject` class. The third option is to use the `CComPolyObject` class. `CComPolyObject` acts as a hybrid: it can function as a `CComObject` class or as a `CComAggObject` class, depending on how it is first created. For more information about how to use the `CComPolyObject` class, see [CComPolyObject Class](../atl/reference/ccompolyobject-class.md).  \n  \n When you use standard ATL COM, you use two objects: an outer object and an inner object. External clients access the functionality of the inner object through the wrapper functions that are defined in the outer object. The outer object is of type `CComObject`.  \n  \n When you use an aggregated object, the outer object does not provide wrappers for the functionality of the inner object. Instead, the outer object provides a pointer that is directly accessed by external clients. In this scenario, the outer object is of type `CComAggObject`. The inner object is a member variable of the outer object, and it is of type `CYourClass`.  \n  \n Because the client does not have to go through the outer object to interact with the inner object, aggregated objects are usually more efficient. Also, the outer object does not have to know the functionality of the aggregated object, given that the interface of the aggregated object is directly available to the client. However, not all objects can be aggregated. For an object to be aggregated, it needs to be designed with aggregation in mind.  \n  \n ATL implements [IUnknown](http://msdn.microsoft.com/library/windows/desktop/ms680509) in two phases:  \n  \n-   [CComObject](../atl/reference/ccomobject-class.md), [CComAggObject](../atl/reference/ccomaggobject-class.md), or [CComPolyObject](../atl/reference/ccompolyobject-class.md) implements the **IUnknown** methods.  \n  \n-   [CComObjectRoot](../atl/reference/ccomobjectroot-class.md) or [CComObjectRootEx](../atl/reference/ccomobjectrootex-class.md) manages the reference count and outer pointers of **IUnknown**.  \n  \n Other aspects of your ATL COM object are handled by other classes:  \n  \n-   [CComCoClass](../atl/reference/ccomcoclass-class.md) defines the object's default class factory and aggregation model.  \n  \n-   [IDispatchImpl](../atl/reference/idispatchimpl-class.md) provides a default implementation of the `IDispatch Interface` portion of any dual interfaces on the object.  \n  \n-   [ISupportErrorInfoImpl](../atl/reference/isupporterrorinfoimpl-class.md) implements the **ISupportErrorInfo** interface that ensures error information can be propagated up the call chain correctly.  \n  \n## In This Section  \n [Implementing CComObjectRootEx](../atl/implementing-ccomobjectrootex.md)  \n Show example COM map entries for implementing `CComObjectRootEx`.  \n  \n [Implementing CComObject, CComAggObject, and CComPolyObject](../atl/implementing-ccomobject-ccomaggobject-and-ccompolyobject.md)  \n Discusses how the **DECLARE_\\*_AGGREGATABLE** macros affect the use of `CComObject`, `CComAggObject`, and `CComPolyObject`.  \n  \n [Supporting IDispatch and IErrorInfo](../atl/supporting-idispatch-and-ierrorinfo.md)  \n Lists the ATL implementation classes to use for supporting the `IDispatch` and **IErrorInfo** interfaces.  \n  \n [Supporting IDispEventImpl](../atl/supporting-idispeventimpl.md)  \n Discusses the steps to implement a connection point for your class.  \n  \n [Changing the Default Class Factory and Aggregation Model](../atl/changing-the-default-class-factory-and-aggregation-model.md)  \n Show what macros to use to change the default class factory and aggregation model.  \n  \n [Creating an Aggregated Object](../atl/creating-an-aggregated-object.md)  \n Lists the steps for creating an aggregated object.  \n  \n## Related Sections  \n [Creating an ATL Project](../atl/reference/creating-an-atl-project.md)  \n Provides information about creating an ATL COM object.  \n  \n [ATL](../atl/active-template-library-atl-concepts.md)  \n Provides links to conceptual topics on how to program using the Active Template Library.  \n  \n## See Also  \n [Concepts](../atl/active-template-library-atl-concepts.md)\n\n"}